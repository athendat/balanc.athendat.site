"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[333],{88458:(q,w,s)=>{s.d(w,{L:()=>v});var e=s(56223);class v{static isEmptyInputValue(i){return null==i||0===i.length}static mustMatch(i,m){return l=>{const h=l.get(i),c=l.get(m);if(!h||!c||(c.hasError("mustMatch")&&(delete c.errors.mustMatch,c.updateValueAndValidity()),this.isEmptyInputValue(c.value)||h.value===c.value))return null;const d={mustMatch:"Las contrase\xf1a no coinciden."};return c.setErrors(d),d}}static notMustMatch(i,m){return l=>{const h=l.get(i),c=l.get(m);if(!h||!c||(c.hasError("notMustMatch")&&(delete c.errors.notMustMatch,c.updateValueAndValidity()),this.isEmptyInputValue(c.value)))return null;if(h.value===c.value){const d={notMustMatch:"no pueden coincidir."};return c.setErrors(d),d}return null}}static strongPassWord(i,m,l,h,c){return d=>{const C=d.value;if(!C)return null;const _=!i||/[A-Z]+/.test(C),x=!m||/[a-z]+/.test(C),U=!l||/[0-9]+/.test(C),y=!h||!/^[a-zA-Z0-9]+$/.test(C);return _&&x&&U&&y&&C.length>=c?null:{password:"La contrase\xf1a no cumple con los est\xe1ndares de seguridad requeridos"}}}static onlyNumber(i){return m=>{const l=m.get(i);if(!l||(l.hasError("onlyNumber")&&(delete l.errors.mustMatch,l.updateValueAndValidity()),/^[a-zA-Z0-9]+$/.test(l.value.toString())))return null;const c={onlyNumber:"Solo se admiten n\xfameros."};return l.setErrors(c),c}}static strongPasWordPattern(){return e.kI.pattern(/((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/)}static emailPattern(){return e.kI.pattern("^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+.[a-zA-Z0-9-.]+$")}static onlyIntegerPattern(){return e.kI.pattern("^[0-9]*$")}static onlyNumbersPattern(){return e.kI.pattern(/^[+-]?\d+(\.\d+)?$/)}static onlyAlphabetsWithAccentPattern(){return e.kI.pattern("^[a-zA-Z \xe1\xe9\xed\xf3\xfa\xf1\xfc]*$")}static onlyAlphabetsPattern(){return e.kI.pattern("^[a-zA-Z ]*$")}static futureDateValidator(){return i=>new Date(i.value)<=new Date?null:{futureDate:!0}}static validateIdNumber(){return i=>{if(!i)return null;let m=i.value;if(!m)return null;void 0!==i.value.idNumber&&(m=i.value.idNumber);const l=parseInt(m.substring(0,2),10),h=parseInt(m.substring(2,4),10)-1,c=parseInt(m.substring(4,6),10),d=new Date(l,h,c);if(d.getFullYear().toString().substring(2,4)===l.toString()&&d.getMonth()===h&&d.getDate()===c)return null;const _={validateIdNumber:"El n\xfamero de identidad introducido es incorrecto"};return i.setErrors(_),_}}static validFullName(i){return m=>{const l=m.get(i);if(!l||!i||(l.hasError("validFullName")&&(delete l.errors.validFullName,l.updateValueAndValidity()),this._isEmptyInputValue(l.value))||l.value.trim().split(" ").length>1)return null;const h={validFullName:"El nombre completo deber\xe1 tener al menos un nombre y un apellido"};return l.setErrors(h),h}}static _isEmptyInputValue(i){return null==i||0===i.length}}},97801:(q,w,s)=>{s.d(w,{NB:()=>h,RW:()=>l,xQ:()=>c});var e=s(58504),v=s(26306),f=s(19212),i=s(48851),m=s(64190);let l=(()=>{class d{constructor(_,x){this._rolesService=_,this._router=x}resolve(_,x){return this._rolesService.findAllRoles().pipe((0,v.K)(U=>this._router.navigateByUrl("/dashboard")))}static#e=this.\u0275fac=function(x){return new(x||d)(f.LFG(i.N),f.LFG(m.F0))};static#t=this.\u0275prov=f.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})(),h=(()=>{class d{constructor(_,x){this._rolesService=_,this._router=x}resolve(_,x){const U=_.params.roleId;return"new"===U?null:this._rolesService.findRoleById(U).pipe((0,v.K)(y=>{const I=x.url.split("/").slice(0,-1).join("/");return this._router.navigateByUrl(I),(0,e._)(y)}))}static#e=this.\u0275fac=function(x){return new(x||d)(f.LFG(i.N),f.LFG(m.F0))};static#t=this.\u0275prov=f.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})(),c=(()=>{class d{constructor(_,x){this._rolesService=_,this._router=x}resolve(_,x){return this._rolesService.findAllActiveRoles().pipe((0,v.K)(U=>this._router.navigateByUrl("/dashboard")))}static#e=this.\u0275fac=function(x){return new(x||d)(f.LFG(i.N),f.LFG(m.F0))};static#t=this.\u0275prov=f.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},60129:(q,w,s)=>{s.d(w,{g$:()=>i,oM:()=>f});var e=s(84221);const v=m=>m.roles,f=(0,e.P1)(v,m=>m.role),i=(0,e.P1)(v,m=>m.roles)},48851:(q,w,s)=>{s.d(w,{N:()=>I});var e=s(19212),v=s(37398),f=s(99397),i=s(50967),m=s(84221),l=s(32193),h=s(97214);const c=i.Ps`
    query PaginatedRoles($page: Int, $size: Int, $sort: String, $order: Order, $search: String ) {
        paginatedRoles(page: $page, size: $size, sort: $sort, order: $order, search: $search ) {

        ok,
        message,

        pagination {
            length
            size
            page
        },

        items {
            id,
            name,
            description,
            active,
            permissionsId
            isCoreRole
        }
        }
    }
`,d=i.Ps`
    query FindAllActiveRoles {
        findAllActiveRoles {
            id
            name
            description
            isCoreRole
        }
    }
`,C=i.Ps`
    query FindRoleById($roleId: String!) {
        findRoleById(id: $roleId ) {
            ok
            message

            role {
                id
                name
                description
                permissionsId
            }
        }
    }
`,_=i.Ps`
    mutation createRole($createRoleInput: CreateRoleInput!) {
        createRole(createRoleInput: $createRoleInput) {
            ok
            message

            role {
                id,
                name,
                description,
                active,
                permissionsId
            }
        }
    }
`,x=i.Ps`
    mutation UpdateRole($updateRoleInput: UpdateRoleInput!) {
        updateRole(updateRoleInput: $updateRoleInput) {
            ok
            message

            role {
                id,
                name,
                description,
                active,
                permissionsId
            }
        }
    }
`,U=i.Ps`
    mutation UpdateRoleStatus($updateEntityStatusInput: UpdateEntityStatusInput!) {
        updateRoleStatus(updateEntityStatusInput: $updateEntityStatusInput) {
            ok,
            message
        }
    }
`,y=i.Ps`
    mutation paginatedRemoveRole($removeRoleById: String!,  $page: Int, $size: Int, $sort: String, $order: Order, $search: String ) {
        paginatedRemoveRole(id: $removeRoleById, page: $page, size: $size, sort: $sort, order: $order, search: $search ) {

            ok,
            message,

            pagination {
                length,
                size,
                page,
                lastPage,
                startIndex,
                endIndex,
            },

            items {
                id,
                name,

                description,
                active,
                permissionsId
            }
        }
    }
`;let I=(()=>{class A{constructor(){this.apolloProvider=(0,e.f3M)(i._M),this.store=(0,e.f3M)(m.yh),this._apollo=this.apolloProvider.use("BALANC")}createRole(g){return this._apollo.mutate({mutation:_,variables:{createRoleInput:g},errorPolicy:"all"}).pipe((0,v.U)(({data:u})=>u?u.createRole:null),(0,f.b)(u=>{u&&this.store.dispatch((0,l.fA)({role:u.role}))}))}findAllRoles(g=0,u=500,M="createdAt",k="asc",R=""){return this._apollo.query({query:c,errorPolicy:"all",variables:{page:g,size:u,sort:M,order:k,search:R}}).pipe((0,f.b)(({data:T})=>{T&&(this.store.dispatch((0,h.Jr)({pagination:T.paginatedRoles.pagination})),this.store.dispatch((0,l.Lk)({roles:T.paginatedRoles.items})))}))}findAllActiveRoles(){return this._apollo.query({query:d,errorPolicy:"all"}).pipe((0,v.U)(({data:g})=>g?g.findAllActiveRoles:null),(0,f.b)(g=>{g&&this.store.dispatch((0,l.Lk)({roles:g}))}))}findRoleById(g){return this._apollo.query({query:C,variables:{roleId:g},errorPolicy:"all"}).pipe((0,v.U)(({data:u})=>u?u.findRoleById:null),(0,f.b)(u=>{u&&this.store.dispatch((0,l.gD)({role:u.role}))}))}updateRole(g){return this._apollo.mutate({mutation:x,variables:{updateRoleInput:g},errorPolicy:"all"}).pipe((0,v.U)(({data:u})=>u?u.updateRole:null),(0,f.b)(u=>{u&&this.store.dispatch((0,l.ul)({role:u.role}))}))}updateRoleStatus(g){return this._apollo.mutate({mutation:U,variables:{updateEntityStatusInput:g},errorPolicy:"all"}).pipe((0,v.U)(({data:u})=>u?u.updateRoleStatus:null),(0,f.b)(u=>{u&&this.store.dispatch((0,l.cq)(g))}))}removeRole(g,u=0,M=500,k="name",R="desc",T=null){return this._apollo.mutate({mutation:y,variables:{removeRoleById:g,page:u,size:M,sort:k,order:R,search:T},errorPolicy:"all"}).pipe((0,f.b)(({data:F})=>{F&&(this.store.dispatch((0,h.Jr)({pagination:F.paginatedRemoveRole.pagination})),this.store.dispatch((0,l.Lk)({roles:F.paginatedRemoveRole.items})))}))}static#e=this.\u0275fac=function(u){return new(u||A)};static#t=this.\u0275prov=e.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})()},90333:(q,w,s)=>{s.r(w),s.d(w,{default:()=>it});var e=s(19212),v=s(64190),f=s(95407),i=s(56223),m=s(32296),l=s(75986),h=s(3305),c=s(64170),d=s(30617),C=s(24516),_=s(23680),x=s(98525),U=s(82599),y=s(22939),I=s(96814),A=s(78645),b=s(59773),g=s(90621),u=s(84221),M=s(53374),k=s(60129),R=s(28052),T=s(94748),F=s(56278),D=s(42090),N=s(18240),E=s(88458);function G(t,a){1&t&&(e.TgZ(0,"a",34),e._uU(1,"Nuevo"),e.qZA())}function V(t,a){if(1&t&&(e.TgZ(0,"a",34),e._uU(1),e.qZA()),2&t){const o=e.oxw();e.xp6(),e.Oqu(o.selectedUser.fullname)}}function K(t,a){1&t&&e._uU(0," Nuevo ")}function j(t,a){if(1&t&&e._uU(0),2&t){const o=e.oxw();e.hij(" ",o.selectedUser.fullname," ")}}const z=t=>({"cursor-not-allowed":t});function H(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"button",35),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.createUser())}),e._UZ(1,"mat-icon",36),e.TgZ(2,"span",37),e._uU(3,"Guardar"),e.qZA()()}if(2&t){const o=e.oxw();e.Q6J("ngClass",e.VKq(3,z,o.userForm.invalid))("disabled",o.userForm.invalid),e.xp6(),e.Q6J("svgIcon","mat_solid:save_alt")}}function W(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"button",38),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.updateUser())}),e._UZ(1,"mat-icon",36),e.TgZ(2,"span",37),e._uU(3,"Actualizar"),e.qZA()()}if(2&t){const o=e.oxw();e.Q6J("disabled",o.userForm.invalid)("ngClass",e.VKq(3,z,o.userForm.invalid)),e.xp6(),e.Q6J("svgIcon","mat_solid:refresh")}}function X(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," El nombre es obligatorio. "),e.qZA())}function ee(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," El nombre debe contener entre 3 y 255 caracteres. "),e.qZA())}function te(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," El nombre no debe poseer n\xfameros. "),e.qZA())}function oe(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," Los apellidos son obligatorios. "),e.qZA())}function re(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," Los apellidos deben contener entre 3 y 255 caracteres. "),e.qZA())}function ie(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," los apellidos no deben poseer n\xfameros. "),e.qZA())}function ne(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," Los apellidos deben contener entre 3 y 255 caracteres. "),e.qZA())}function se(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," los apellidos no deben poseer n\xfameros. "),e.qZA())}function ae(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," El correo electr\xf3nico es obligatorio. "),e.qZA())}function le(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," El correo no posee un formato v\xe1lido. "),e.qZA())}function ce(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," El tel\xe9fono no posee un formato v\xe1lido. "),e.qZA())}function de(t,a){1&t&&e._UZ(0,"mat-icon",48),2&t&&e.Q6J("svgIcon","mat_solid:visibility")}function me(t,a){1&t&&e._UZ(0,"mat-icon",48),2&t&&e.Q6J("svgIcon","mat_solid:visibility_off")}function ue(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," La contrase\xf1a es obligatoria. "),e.qZA())}function pe(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1,' La contrase\xf1a deber\xe1 tener entre 8 y 100 caracteres e incluir may\xfasculas, min\xfasculas n\xfameros y s\xedmbolos como: ! " ? $ % ^ &. '),e.qZA())}function he(t,a){1&t&&e._UZ(0,"mat-icon",48),2&t&&e.Q6J("svgIcon","mat_solid:visibility")}function fe(t,a){1&t&&e._UZ(0,"mat-icon",48),2&t&&e.Q6J("svgIcon","mat_solid:visibility_off")}function ge(t,a){1&t&&(e.TgZ(0,"mat-error",49),e._uU(1," La contrase\xf1a es obligatoria "),e.qZA())}function _e(t,a){if(1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.qZA()),2&t){const o=e.oxw(2);e.xp6(),e.hij(" ",o.userForm.get("pwd2").getError("mustMatch")," ")}}function xe(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"mat-expansion-panel",39)(1,"mat-expansion-panel-header",21)(2,"mat-panel-title",22)(3,"div",23),e._uU(4," Contrase\xf1a "),e.qZA()()(),e.TgZ(5,"div",40)(6,"div",25)(7,"mat-form-field",26)(8,"mat-label"),e._uU(9,"Contrase\xf1a"),e.qZA(),e._UZ(10,"input",41,42),e.TgZ(12,"button",43),e.NdJ("click",function(){e.CHM(o);const r=e.MAs(11);return e.KtG(r.type="password"===r.type?"text":"password")}),e.YNc(13,de,1,1,"mat-icon",44)(14,me,1,1,"mat-icon",44),e.qZA(),e.YNc(15,ue,2,0,"mat-error")(16,pe,2,0,"mat-error"),e.qZA()(),e.TgZ(17,"div",25)(18,"mat-form-field",26)(19,"mat-label"),e._uU(20,"Confirmar contrase\xf1a"),e.qZA(),e._UZ(21,"input",45,46),e.TgZ(23,"button",43),e.NdJ("click",function(){e.CHM(o);const r=e.MAs(22);return e.KtG(r.type="password"===r.type?"text":"password")}),e.YNc(24,he,1,1,"mat-icon",44)(25,fe,1,1,"mat-icon",44),e.qZA(),e.YNc(26,ge,2,0,"mat-error",47)(27,_e,2,1,"mat-error"),e.qZA()()()()}if(2&t){const o=e.MAs(11),n=e.MAs(22),r=e.oxw();e.Q6J("expanded",!0),e.xp6(),e.Q6J("collapsedHeight","56px"),e.xp6(9),e.Q6J("formControlName","pwd")("minlength",8)("maxlength",100),e.xp6(3),e.um2(13,"password"===o.type?13:-1),e.xp6(),e.um2(14,"text"===o.type?14:-1),e.xp6(),e.um2(15,r.userForm.get("pwd").hasError("required")?15:-1),e.xp6(),e.um2(16,r.userForm.get("pwd").hasError("pattern")||r.userForm.get("pwd").hasError("minlength")?16:-1),e.xp6(5),e.Q6J("formControlName","pwd2"),e.xp6(3),e.um2(24,"password"===n.type?24:-1),e.xp6(),e.um2(25,"text"===n.type?25:-1),e.xp6(),e.um2(26,r.userForm.get("pwd2").hasError("required")?26:-1),e.xp6(),e.um2(27,r.userForm.get("pwd2").hasError("mustMatch")?27:-1)}}const ve=(t,a)=>a.id;function Ce(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"div",58),e.NdJ("click",function(){e.CHM(o);const r=e.oxw().$implicit,p=e.oxw(2);return e.KtG(p.markRole(r.id,!r.checked))}),e.TgZ(1,"div",59),e._uU(2),e.qZA()()}if(2&t){const o=e.oxw().$implicit;e.xp6(2),e.hij(" ",o.description," ")}}function be(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"div",54)(1,"mat-checkbox",55),e.NdJ("change",function(r){const Z=e.CHM(o).$implicit,Q=e.oxw(2);return e.KtG(Q.markRole(Z.id,r.checked))}),e.TgZ(2,"span",56),e._uU(3),e.qZA()(),e.YNc(4,Ce,3,1,"div",57),e.qZA()}if(2&t){const o=a.$implicit;e.xp6(),e.Q6J("color","primary")("color","primary")("checked",o.checked),e.xp6(2),e.hij(" ",o.name," "),e.xp6(),e.um2(4,o.description?4:-1)}}function Ue(t,a){if(1&t&&(e.TgZ(0,"mat-expansion-panel",50)(1,"mat-expansion-panel-header",21)(2,"mat-panel-title",22)(3,"div",23),e._uU(4," Roles "),e.qZA()()(),e.TgZ(5,"div",51)(6,"div",52)(7,"div",53),e.SjG(8,be,5,5,"div",60,ve),e.qZA()()()()),2&t){const o=e.oxw();e.xp6(),e.Q6J("collapsedHeight","56px"),e.xp6(7),e.wJu(o.roles)}}let Ze=(()=>{class t{constructor(){this.merchants=[],this.roles=[],this.windowMode="new",this._activatedRoute=(0,e.f3M)(v.gz),this._changeDetectorRef=(0,e.f3M)(e.sBO),this._formBuilder=(0,e.f3M)(i.qu),this._fuseConfirmationService=(0,e.f3M)(F.R),this._router=(0,e.f3M)(v.F0),this._snackBar=(0,e.f3M)(y.ux),this._unsubscribeAll=new A.x,this._usersService=(0,e.f3M)(N.f),this.store=(0,e.f3M)(u.yh)}ngOnInit(){this.store.select(M.rk).pipe((0,b.R)(this._unsubscribeAll)).subscribe(o=>{this.authUser=o,this._changeDetectorRef.markForCheck()}),this.store.select(R.dy).pipe((0,b.R)(this._unsubscribeAll)).subscribe(o=>{this.selectedUser=o,this._changeDetectorRef.markForCheck()}),this.userForm=this._formBuilder.group({id:[null],name:["",[i.kI.required,i.kI.maxLength(255),E.L.onlyAlphabetsWithAccentPattern()]],lastname1:["",[i.kI.required,i.kI.maxLength(255),E.L.onlyAlphabetsWithAccentPattern()]],lastname2:["",[i.kI.maxLength(255),E.L.onlyAlphabetsWithAccentPattern()]],email:["",[i.kI.email,i.kI.required]],phone:[""],pwd:["",[i.kI.minLength(8),i.kI.maxLength(100),E.L.strongPasWordPattern()]],pwd2:[""],roleId:[null,[i.kI.required]]},{validators:E.L.mustMatch("pwd","pwd2")}),this._activatedRoute.params.pipe((0,b.R)(this._unsubscribeAll)).subscribe(({userId:o})=>{this.windowMode="new"===o?"new":"edit",this._fillUserData(),this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}createUser(){const o=this.userForm.getRawValue();delete o.id,delete o.pwd2,console.log({user:o}),this._fuseConfirmationService.open({title:"Crear usuario",message:"\xbfEst\xe1 seguro que todos los datos son correctos?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,b.R)(this._unsubscribeAll)).subscribe(r=>{"confirmed"===r&&this._usersService.createUser(o).pipe((0,b.R)(this._unsubscribeAll)).subscribe(({data:p})=>{p&&(this._snackBar.openFromComponent(D.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"Usuario creado correctamente",title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"mat_solid:done"}}),this._router.navigateByUrl("/users"))})}),this._changeDetectorRef.markForCheck()}updateUser(){const o=this.userForm.getRawValue();delete o.pwd,delete o.pwd2,this._fuseConfirmationService.open({title:"Actualizar datos del usuario",message:"\xbfEst\xe1 seguro que todos los datos son correctos?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(r=>{"confirmed"===r&&this._usersService.updateUser(o).pipe((0,b.R)(this._unsubscribeAll)).subscribe(({data:p})=>{p&&(this._snackBar.openFromComponent(D.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"Usuario actualizado correctamente",title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"mat_solid:done"}}),this._router.navigateByUrl("/users"))})}),this._changeDetectorRef.markForCheck()}trackByFn(o,n){return n.id||o}markRole(o,n){for(const r of this.roles)r.id===o&&n?(r.checked=!0,this.userForm.get("roleId").setValue(r.id)):r.checked=!1;this.roles.some(r=>r.checked)||this.userForm.get("roleId").setValue(null),this._changeDetectorRef.markForCheck()}_fillUserData(){"edit"===this.windowMode&&(this.userForm.patchValue(this.selectedUser),this.userForm.get("pwd").removeValidators([i.kI.required]),this.userForm.get("pwd2").removeValidators([i.kI.required])),"new"===this.windowMode&&(this.userForm.get("pwd").setValidators([i.kI.required]),this.userForm.get("pwd2").setValidators([i.kI.required]),this.store.select(k.g$).pipe((0,b.R)(this._unsubscribeAll)).subscribe(o=>{this.roles=structuredClone(o.filter(n=>!n.isCoreRole)),this._changeDetectorRef.markForCheck()}))}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["ath-user-detail"]],standalone:!0,features:[e.jDz],decls:77,vars:48,consts:[["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-y-auto"],[1,"flex","flex-col","flex-wrap","p-6","sm:flex-row","flex-0","sm:items-center","sm:justify-between","sm:pt-12","sm:px-10","bg-mine-50","dark:bg-transparent"],[1,"flex-1","min-w-0"],[1,"flex-wrap","items-center","hidden","font-medium","sm:flex"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"ml-1","text-primary-700",3,"routerLink"],[1,"icon-size-5","text-secondary",3,"svgIcon"],["class","ml-1 text-primary-700"],[1,"flex","sm:hidden"],[1,"inline-flex","items-center","-ml-1.5","text-secondary","font-medium",3,"routerLink"],[1,"ml-1"],[1,"mt-2"],[1,"mt-2","text-3xl","font-extrabold","leading-tight","tracking-tight","sm:text-3xl"],[1,"flex","items-center","flex-shrink-0","mt-6","sm:mt-0","sm:ml-4"],["mat-raised-button","","class","ml-4 text-white bg-primary-500 hover:shadow-lg","mat-button","",3,"ngClass","disabled"],["mat-raised-button","","class","ml-4 text-white bg-primary-500 hover:shadow-lg","mat-button","",3,"disabled","ngClass"],[1,"flex-auto","p-4","shadow","sm:p-6","bg-mine-200","rounded-t-2xl"],[1,"flex","flex-col","flex-auto","min-w-0"],[3,"formGroup","autocomplete"],["multi","",1,"w-full","bg-transparent"],[2,"border-top-left-radius","0.5rem !important","border-top-right-radius","0.5rem !important",3,"expanded"],[3,"collapsedHeight"],[1,"flex","items-center"],[1,"text-2xl","font-extrabold","leading-tight","tracking-tight","sm:text-2xl"],[1,"grid","w-full","px-4","py-8","border-t-2","gap-y-3","gap-x-6","sm:grid-cols-4"],[1,"sm:col-span-2"],[1,"w-full","fuse-mat-dense"],["matInput","","required","",3,"type","formControlName","placeholder","minlength","maxlength"],["matInput","","required","",3,"type","formControlName","maxlength"],["matInput","",3,"type","formControlName","maxlength"],["matInput","","required","",3,"type","formControlName","placeholder"],["matInput","",3,"type","formControlName","placeholder"],["style","border-bottom-left-radius: 0.5rem !important; border-bottom-right-radius:0.5rem !important",3,"expanded"],["style","border-bottom-left-radius: 0.5rem !important; border-bottom-right-radius:0.5rem !important"],[1,"ml-1","text-primary-700"],["mat-raised-button","","mat-button","",1,"ml-4","text-white","bg-primary-500","hover:shadow-lg",3,"ngClass","disabled","click"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],["mat-raised-button","","mat-button","",1,"ml-4","text-white","bg-primary-500","hover:shadow-lg",3,"disabled","ngClass","click"],[2,"border-bottom-left-radius","0.5rem !important","border-bottom-right-radius","0.5rem !important",3,"expanded"],[1,"grid","w-full","pt-8","pb-8","pl-4","pr-4","border-t-2","gap-y-3","gap-x-6","sm:grid-cols-2","md:grid-cols-4"],["type","password","placeholder","Contrase\xf1a","matInput","","required","",3,"formControlName","minlength","maxlength"],["passwordField1",""],["mat-icon-button","","type","button","matSuffix","",3,"click"],["class","icon-size-5",3,"svgIcon"],["type","password","placeholder","Repita la contrase\xf1a","matInput","","required","",3,"formControlName"],["passwordField2",""],["class","pb-5"],[1,"icon-size-5",3,"svgIcon"],[1,"pb-5"],[2,"border-bottom-left-radius","0.5rem !important","border-bottom-right-radius","0.5rem !important"],[1,"flex","flex-col","w-full","px-4","pt-8","pb-8","border-t-2"],[1,"flex","flex-col"],[1,"flex","flex-wrap","w-full","gap-4","sm:grid","sm:grid-cols-3","md:grid-cols-4"],[1,"relative","w-full","p-3","overflow-hidden","border","border-dashed","rounded-sm","cursor-pointer","sm:w-auto","border-primary-700","max-h-30"],[1,"absolute","top-2.5","left-3",3,"color","checked","change"],[1,"font-medium","truncate"],["class","h-full mt-8"],[1,"h-full","mt-8",3,"click"],[1,"whitespace-pre-line","text-md","text-hint","line-clamp-3"],["class","relative w-full p-3 overflow-hidden border border-dashed rounded-sm cursor-pointer sm:w-auto border-primary-700 max-h-30 "]],template:function(n,r){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"div",4)(6,"a",5),e._uU(7,"Inicio"),e.qZA()(),e.TgZ(8,"div",4),e._UZ(9,"mat-icon",6),e.TgZ(10,"a",5),e._uU(11,"Usuarios"),e.qZA()(),e.TgZ(12,"div",4),e._UZ(13,"mat-icon",6),e.YNc(14,G,2,0,"a",7)(15,V,2,1,"a",7),e.qZA()(),e.TgZ(16,"div",8)(17,"a",9),e._UZ(18,"mat-icon",6),e.TgZ(19,"span",10),e._uU(20,"Regresar"),e.qZA()()()(),e.TgZ(21,"div",11)(22,"div",12),e.YNc(23,K,1,0)(24,j,1,1),e.qZA()()(),e.TgZ(25,"div",13),e.YNc(26,H,4,5,"button",14)(27,W,4,5,"button",15),e.qZA()(),e.TgZ(28,"div",16)(29,"div",17)(30,"form",18)(31,"mat-accordion",19)(32,"mat-expansion-panel",20)(33,"mat-expansion-panel-header",21)(34,"mat-panel-title",22)(35,"div",23),e._uU(36," Informaci\xf3n General "),e.qZA()()(),e.TgZ(37,"div",24)(38,"div",25)(39,"mat-form-field",26)(40,"mat-label"),e._uU(41,"Nombre"),e.qZA(),e._UZ(42,"input",27),e.YNc(43,X,2,0,"mat-error")(44,ee,2,0,"mat-error")(45,te,2,0,"mat-error"),e.qZA()(),e.TgZ(46,"div",25)(47,"mat-form-field",26)(48,"mat-label"),e._uU(49,"Primer apellidos"),e.qZA(),e._UZ(50,"input",28),e.YNc(51,oe,2,0,"mat-error")(52,re,2,0,"mat-error")(53,ie,2,0,"mat-error"),e.qZA()(),e.TgZ(54,"div",25)(55,"mat-form-field",26)(56,"mat-label"),e._uU(57,"Segundo apellidos"),e.qZA(),e._UZ(58,"input",29),e.YNc(59,ne,2,0,"mat-error")(60,se,2,0,"mat-error"),e.qZA()(),e._UZ(61,"div"),e.TgZ(62,"div",25)(63,"mat-form-field",26)(64,"mat-label"),e._uU(65,"Correo electr\xf3nico"),e.qZA(),e._UZ(66,"input",30),e.YNc(67,ae,2,0,"mat-error")(68,le,2,0,"mat-error"),e.qZA()(),e.TgZ(69,"div",25)(70,"mat-form-field",26)(71,"mat-label"),e._uU(72,"Tel\xe9fono"),e.qZA(),e._UZ(73,"input",31),e.YNc(74,ce,2,0,"mat-error"),e.qZA()()()(),e.YNc(75,xe,28,14,"mat-expansion-panel",32)(76,Ue,10,1,"mat-expansion-panel",33),e.qZA()()()()()),2&n&&(e.xp6(6),e.Q6J("routerLink","/dashboard"),e.xp6(3),e.Q6J("svgIcon","mat_solid:chevron_right"),e.xp6(),e.Q6J("routerLink","/modules/users"),e.xp6(3),e.Q6J("svgIcon","mat_solid:chevron_right"),e.xp6(),e.um2(14,"new"===r.windowMode?14:-1),e.xp6(),e.um2(15,"new"!==r.windowMode?15:-1),e.xp6(2),e.Q6J("routerLink","./.."),e.xp6(),e.Q6J("svgIcon","mat_solid:chevron_left"),e.xp6(5),e.um2(23,"new"===r.windowMode?23:-1),e.xp6(),e.um2(24,"new"!==r.windowMode?24:-1),e.xp6(2),e.um2(26,"new"===r.windowMode?26:-1),e.xp6(),e.um2(27,"new"!==r.windowMode?27:-1),e.xp6(3),e.Q6J("formGroup",r.userForm)("autocomplete","off"),e.xp6(2),e.Udp("border-bottom-left-radius","new"!==r.windowMode?"0.5rem !important":""),e.Q6J("expanded",!0),e.xp6(),e.Q6J("collapsedHeight","56px"),e.xp6(9),e.Q6J("type","text")("formControlName","name")("placeholder","Nombre")("minlength",3)("maxlength",255),e.xp6(),e.um2(43,r.userForm.get("name").hasError("required")?43:-1),e.xp6(),e.um2(44,r.userForm.get("name").hasError("maxlength")?44:-1),e.xp6(),e.um2(45,r.userForm.get("name").hasError("pattern")?45:-1),e.xp6(5),e.Q6J("type","text")("formControlName","lastname1")("maxlength",255),e.xp6(),e.um2(51,r.userForm.get("lastname1").hasError("required")?51:-1),e.xp6(),e.um2(52,r.userForm.get("lastname1").hasError("maxlength")?52:-1),e.xp6(),e.um2(53,r.userForm.get("lastname1").hasError("pattern")?53:-1),e.xp6(5),e.Q6J("type","text")("formControlName","lastname2")("maxlength",255),e.xp6(),e.um2(59,r.userForm.get("lastname2").hasError("maxlength")?59:-1),e.xp6(),e.um2(60,r.userForm.get("lastname2").hasError("pattern")?60:-1),e.xp6(6),e.Q6J("type","email")("formControlName","email")("placeholder","Correo electr\xf3nico"),e.xp6(),e.um2(67,r.userForm.get("email").hasError("required")?67:-1),e.xp6(),e.um2(68,r.userForm.get("email").hasError("email")?68:-1),e.xp6(5),e.Q6J("type","phone")("formControlName","phone")("placeholder","+53........"),e.xp6(),e.um2(74,r.userForm.get("phone").hasError("pattern")?74:-1),e.xp6(),e.um2(75,"edit"!==r.windowMode?75:-1),e.xp6(),e.um2(76,"edit"!==r.windowMode?76:-1))},dependencies:[f.PQ,i.u5,i._Y,i.Fj,i.JJ,i.JL,i.Q7,i.wO,i.nD,m.ot,m.lW,m.RK,l.p9,l.oG,h.To,h.pp,h.ib,h.yz,h.yK,c.lN,c.KE,c.hX,c.TO,c.R9,d.Ps,d.Hw,C.c,C.Nt,_.Ng,x.LD,U.rP,I.mk,g.VI,i.UX,i.sg,i.u,v.rH],encapsulation:2,data:{animation:T.L},changeDetection:0})}return t})();var we=s(15861),L=s(17700),S=s(21476),J=s(13566),$=s(55940),P=s(92596),B=s(94664),ye=s(63019),Ae=s(83620),Te=s(37398),Ie=s(83604);function Fe(t,a){1&t&&e._UZ(0,"mat-icon",25),2&t&&e.Q6J("svgIcon","mat_solid:visibility")}function ke(t,a){1&t&&e._UZ(0,"mat-icon",25),2&t&&e.Q6J("svgIcon","mat_solid:visibility_off")}function Re(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," La contrase\xf1a es obligatoria "),e.qZA())}function De(t,a){1&t&&e._UZ(0,"mat-icon",25),2&t&&e.Q6J("svgIcon","mat_solid:visibility")}function Ee(t,a){1&t&&e._UZ(0,"mat-icon",25),2&t&&e.Q6J("svgIcon","mat_solid:visibility_off")}function Me(t,a){1&t&&(e.TgZ(0,"mat-error"),e._uU(1," La contrase\xf1a es obligatoria "),e.qZA())}function Ne(t,a){if(1&t&&(e.TgZ(0,"mat-error"),e._uU(1),e.qZA()),2&t){const o=e.oxw(2);e.xp6(),e.hij(" ",o.userPasswordForm.get("pwd2").getError("mustMatch")," ")}}function qe(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"div",13)(1,"div",14)(2,"div",15)(3,"form",16)(4,"div",17)(5,"mat-form-field",18)(6,"mat-label"),e._uU(7,"Contrase\xf1a"),e.qZA(),e._UZ(8,"input",19,20),e.TgZ(10,"button",21),e.NdJ("click",function(){e.CHM(o);const r=e.MAs(9);return e.KtG(r.type="password"===r.type?"text":"password")}),e.YNc(11,Fe,1,1,"mat-icon",22)(12,ke,1,1,"mat-icon",22),e.qZA(),e.YNc(13,Re,2,0,"mat-error"),e.qZA(),e.TgZ(14,"mat-form-field",18)(15,"mat-label"),e._uU(16,"Confirmar contrase\xf1a "),e.qZA(),e._UZ(17,"input",23,24),e.TgZ(19,"button",21),e.NdJ("click",function(){e.CHM(o);const r=e.MAs(18);return e.KtG(r.type="password"===r.type?"text":"password")}),e.YNc(20,De,1,1,"mat-icon",22)(21,Ee,1,1,"mat-icon",22),e.qZA(),e.YNc(22,Me,2,0,"mat-error")(23,Ne,2,1,"mat-error"),e.qZA()()()()()()}if(2&t){const o=e.MAs(9),n=e.MAs(18),r=e.oxw();e.xp6(3),e.Q6J("formGroup",r.userPasswordForm)("autocomplete","off"),e.xp6(5),e.Q6J("formControlName","pwd")("minlength",8)("maxlength",100),e.xp6(3),e.um2(11,"password"===o.type?11:-1),e.xp6(),e.um2(12,"text"===o.type?12:-1),e.xp6(),e.um2(13,r.userPasswordForm.get("pwd").hasError("required")?13:-1),e.xp6(4),e.Q6J("formControlName","pwd2"),e.xp6(3),e.um2(20,"password"===n.type?20:-1),e.xp6(),e.um2(21,"text"===n.type?21:-1),e.xp6(),e.um2(22,r.userPasswordForm.get("pwd2").hasError("required")?22:-1),e.xp6(),e.um2(23,r.userPasswordForm.get("pwd2").hasError("mustMatch")?23:-1)}}function Je(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"div",34),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(2).$implicit,p=e.oxw(2);return e.KtG(p.markRole(r.id,!r.checked))}),e.TgZ(1,"div",35),e._uU(2),e.qZA()()}if(2&t){const o=e.oxw(2).$implicit;e.xp6(2),e.hij(" ",o.description," ")}}function Pe(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"div",30)(1,"mat-checkbox",31),e.NdJ("change",function(r){e.CHM(o);const p=e.oxw().$implicit,Z=e.oxw(2);return e.KtG(Z.markRole(p.id,r.checked))}),e.TgZ(2,"span",32),e._uU(3),e.qZA()(),e.YNc(4,Je,3,1,"div",33),e.qZA()}if(2&t){const o=e.oxw().$implicit;e.xp6(),e.Q6J("color","primary")("color","primary")("checked",o.checked),e.xp6(2),e.hij(" ",o.name," "),e.xp6(),e.um2(4,o.description?4:-1)}}function Le(t,a){1&t&&e.YNc(0,Pe,5,5,"div",29),2&t&&e.um2(0,a.$implicit.isCoreRole?-1:0)}function Se(t,a){if(1&t&&(e.TgZ(0,"div",13)(1,"div",14)(2,"div",26)(3,"div",27)(4,"div",28),e.SjG(5,Le,1,1,null,null,e.x6l),e.qZA()()()()()),2&t){const o=e.oxw();e.xp6(5),e.wJu(o.roles)}}const O=t=>({"cursor-not-allowed":t});function Qe(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"button",36),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.updateUser())}),e._uU(1," Actualizar Rol "),e.qZA()}if(2&t){const o=e.oxw();e.Q6J("disabled",!o.selectedRoleId)("matTooltip","Actualizar")("ngClass",e.VKq(3,O,!o.selectedRoleId))}}function ze(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"button",36),e.NdJ("click",function(){e.CHM(o);const r=e.oxw();return e.KtG(r.updateUserPassword())}),e._uU(1," Actualizar Contrase\xf1a "),e.qZA()}if(2&t){const o=e.oxw();e.Q6J("disabled",o.userPasswordForm.invalid)("matTooltip","Actualizar")("ngClass",e.VKq(3,O,o.userPasswordForm.invalid))}}let $e=(()=>{class t{constructor(o){this.data=o,this.dialogRef=(0,e.f3M)(L.so),this.dialogMode="edit",this.roles=[],this.selectedRoleId="",this._changeDetectorRef=(0,e.f3M)(e.sBO),this._formBuilder=(0,e.f3M)(i.QS),this._fuseConfirmationService=(0,e.f3M)(F.R),this._snackBar=(0,e.f3M)(y.ux),this._unsubscribeAll=new A.x,this._usersService=(0,e.f3M)(N.f),this.store=(0,e.f3M)(u.yh),this.dialogMode=o.dialogMode,this.selectedUser=o.user}ngOnInit(){"editPass"===this.dialogMode&&(this.userPasswordForm=this._formBuilder.group({id:[this.selectedUser.id,[i.kI.required]],pwd:[null,[i.kI.required,i.kI.minLength(8),i.kI.maxLength(100)]],pwd2:[null,[i.kI.required]]},{validators:E.L.mustMatch("pwd","pwd2")})),"edit"===this.dialogMode&&this.store.select(k.g$).pipe((0,b.R)(this._unsubscribeAll)).subscribe(o=>{const n=structuredClone(o);n.forEach(r=>{r.checked=this.selectedUser.roleId===r.id,r.checked&&(this.selectedRoleId=r.id)}),this.roles=n,this._changeDetectorRef.markForCheck()})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}closeDialog(){this.dialogRef.close()}updateUser(){this._fuseConfirmationService.open({title:"Actualizar roles de usuario",message:"\xbfEsta seguro que todos los datos son correctos?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(n=>{"confirmed"===n&&this._usersService.updateUser({id:this.selectedUser.id,roleId:this.selectedRoleId,email:this.selectedUser.email,name:this.selectedUser.name,lastname1:this.selectedUser.lastname1,lastname2:this.selectedUser.lastname2}).pipe((0,b.R)(this._unsubscribeAll)).subscribe(({})=>{this._snackBar.openFromComponent(D.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"Rol actualizado correctamente",title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"mat_solid:done"}}),this.closeDialog()})})}updateUserPassword(){const o=this.userPasswordForm.getRawValue();delete o.pwd2,this._fuseConfirmationService.open({title:"Actualizar contrase\xf1a",message:"\xbfEst\xe1 seguro que todos los datos son correctos?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(r=>{"confirmed"===r&&this._usersService.updateUserPwd({id:o.id,newPwd:o.pwd}).pipe((0,b.R)(this._unsubscribeAll)).subscribe(({data:p})=>{p&&(this._snackBar.openFromComponent(D.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:p.updateUserPwd,title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"mat_solid:done"}}),this.closeDialog())})})}markRole(o,n){for(const r of this.roles)r.id===o&&n?(r.checked=!0,this.selectedRoleId=r.id):r.checked=!1;this.roles.some(r=>r.checked)||(this.selectedRoleId=null),this._changeDetectorRef.markForCheck()}static#e=this.\u0275fac=function(n){return new(n||t)(e.Y36(L.WI))};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["user-role-dialog"]],standalone:!0,features:[e.jDz],decls:18,vars:9,consts:[[1,"relative","flex","flex-col","w-full","max-h-screen"],[1,"flex","flex-col","items-center","flex-auto","w-full"],[1,"w-full","px-12","py-5"],[1,"flex","w-full"],[1,"flex","flex-col","justify-end","w-4/5","my-2"],[1,"text-2xl","font-bold","truncate","sm:text-2xl"],[1,"flex","text-xl","font-normal","text-red-900","truncate","cursor-pointer","hover:underline"],[1,"mr-2.5","text-mine-900",3,"svgIcon"],["target","_blank",1,"text-primary-900","hover:text-primary-700",3,"href"],["class","flex flex-col border-t gap-y-5"],[1,"flex","items-center","w-full","px-8","py-4","space-x-3","sm:justify-end","sm:px-12","bg-gray-50","dark:bg-transparent"],["mat-stroked-button","",3,"matTooltip","click"],["mat-flat-button","","class","text-white bg-primary-500",3,"disabled","matTooltip","ngClass"],[1,"flex","flex-col","border-t","gap-y-5"],[1,"flex","flex-col","w-full","gap-8","md:flex-row"],[1,"flex","flex-col","w-full","space-y-4"],[1,"flex","flex-col",3,"formGroup","autocomplete"],[1,"flex","flex-col","w-full","gap-4","mt-5","mb-2"],[1,"w-full"],["id","pwd","matInput","","type","password","placeholder","Contrase\xf1a","required","",3,"formControlName","minlength","maxlength"],["passwordUpdateField1",""],["mat-icon-button","","type","button","matSuffix","",3,"click"],["class","icon-size-5",3,"svgIcon"],["type","password","matInput","","placeholder","Repita la contrase\xf1a","required","",3,"formControlName"],["passwordUpdateField2",""],[1,"icon-size-5",3,"svgIcon"],[1,"flex","flex-col","w-full","pt-6","space-y-4","sm:mt-4","sm:space-y-8"],[1,"flex","flex-col","mb-10"],[1,"flex","flex-wrap","w-full","gap-4","sm:grid","sm:grid-cols-2"],["class","relative w-full p-3 overflow-hidden border border-dashed rounded-sm cursor-pointer sm:w-auto border-primary-700 max-h-30 "],[1,"relative","w-full","p-3","overflow-hidden","border","border-dashed","rounded-sm","cursor-pointer","sm:w-auto","border-primary-700","max-h-30"],[1,"absolute","top-2.5","left-3",3,"color","checked","change"],[1,"font-medium","truncate"],["class","h-full mt-8"],[1,"h-full","mt-8",3,"click"],[1,"whitespace-pre-line","text-md","text-hint","line-clamp-3"],["mat-flat-button","",1,"text-white","bg-primary-500",3,"disabled","matTooltip","ngClass","click"]],template:function(n,r){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5),e._uU(6),e.qZA(),e.TgZ(7,"span",6),e._UZ(8,"mat-icon",7),e.TgZ(9,"a",8),e._uU(10),e.qZA()()()(),e.YNc(11,qe,24,13,"div",9)(12,Se,7,0,"div",9),e.qZA(),e.TgZ(13,"div",10)(14,"button",11),e.NdJ("click",function(){return r.closeDialog()}),e._uU(15," Cancelar "),e.qZA(),e.YNc(16,Qe,2,5,"button",12)(17,ze,2,5,"button",12),e.qZA()()()),2&n&&(e.xp6(6),e.hij(" ",r.selectedUser.fullname," "),e.xp6(2),e.Q6J("svgIcon","mat_solid:email"),e.xp6(),e.Q6J("href","mailto:"+r.selectedUser.email,e.LSH),e.xp6(),e.Oqu(r.selectedUser.email),e.xp6(),e.um2(11,"editPass"===r.dialogMode?11:-1),e.xp6(),e.um2(12,"edit"===r.dialogMode?12:-1),e.xp6(2),e.Q6J("matTooltip","Cancelar"),e.xp6(2),e.um2(16,"edit"===r.data.dialogMode?16:-1),e.xp6(),e.um2(17,"editPass"===r.data.dialogMode?17:-1))},dependencies:[d.Ps,d.Hw,i.u5,i._Y,i.Fj,i.JJ,i.JL,i.Q7,i.wO,i.nD,i.UX,i.sg,i.u,c.lN,c.KE,c.hX,c.TO,c.R9,C.c,C.Nt,m.ot,m.lW,m.RK,l.p9,l.oG,P.AV,P.gM,I.mk],encapsulation:2,data:{animation:T.L},changeDetection:0})}return t})();const Be=(t,a)=>a.id;function Oe(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"mat-slide-toggle",40),e.NdJ("change",function(r){e.CHM(o);const p=e.oxw(),Z=p.$implicit,Q=p.$index,nt=e.oxw(2);return e.KtG(nt.updateUserStatus(r,Z,Q))}),e.qZA()}if(2&t){const o=e.oxw().$implicit;e.Q6J("checked",o.active)("color","primary")}}function Ye(t,a){1&t&&e._UZ(0,"mat-spinner",41),2&t&&e.Q6J("diameter",20)("color","primary")}const Ge=t=>[t];function Ve(t,a){if(1&t){const o=e.EpF();e.TgZ(0,"div",29)(1,"div",30),e._uU(2),e.qZA(),e.TgZ(3,"div",31),e._uU(4),e.qZA(),e.TgZ(5,"div",31),e._uU(6),e.qZA(),e.TgZ(7,"div",26),e._uU(8),e.qZA(),e.TgZ(9,"div",32),e.YNc(10,Oe,1,2,"mat-slide-toggle",33)(11,Ye,1,2),e.qZA(),e.TgZ(12,"div",34)(13,"button",35),e._UZ(14,"mat-icon",36),e.qZA(),e.TgZ(15,"button",37),e.NdJ("click",function(){const p=e.CHM(o).$implicit,Z=e.oxw(2);return e.KtG(Z.openDialog(p,"editPass","720px"))}),e._UZ(16,"mat-icon",36),e.qZA(),e.TgZ(17,"button",38),e.NdJ("click",function(){const p=e.CHM(o).$implicit,Z=e.oxw(2);return e.KtG(Z.openDialog(p,"edit","720px"))}),e._UZ(18,"mat-icon",36),e.qZA(),e.TgZ(19,"button",39),e.NdJ("click",function(){const p=e.CHM(o).$implicit,Z=e.oxw(2);return e.KtG(Z.deleteUser(p))}),e._UZ(20,"mat-icon",36),e.qZA()()()}if(2&t){const o=a.$implicit,n=a.$index,r=e.oxw(2);e.xp6(2),e.hij(" ",o.fullname," "),e.xp6(2),e.hij(" ",o.email," "),e.xp6(2),e.hij(" ",o.phone," "),e.xp6(2),e.hij(" ",o.role.name," "),e.xp6(2),e.um2(10,r.isLoading&&r.selectedSlide===n?11:10),e.xp6(3),e.Q6J("routerLink",e.VKq(10,Ge,o.id)),e.xp6(),e.Q6J("svgIcon","mat_solid:edit"),e.xp6(2),e.Q6J("svgIcon","mat_solid:password"),e.xp6(2),e.Q6J("svgIcon","mat_solid:admin_panel_settings"),e.xp6(2),e.Q6J("svgIcon","mat_solid:delete")}}function Ke(t,a){if(1&t&&(e.TgZ(0,"div",23)(1,"div",24)(2,"div",25),e._uU(3," Nombre y Apellidos "),e.qZA(),e.TgZ(4,"div",25)(5,"span"),e._uU(6,"Correo electr\xf3nico"),e.qZA()(),e.TgZ(7,"div",26),e._uU(8," Tel\xe9fono "),e.qZA(),e.TgZ(9,"div",26),e._uU(10," Rol "),e.qZA(),e.TgZ(11,"div",27)(12,"span"),e._uU(13,"Activo"),e.qZA()(),e.TgZ(14,"div",28),e._uU(15," Acciones "),e.qZA()(),e.SjG(16,Ve,21,12,"div",42,Be),e.qZA()),2&t){const o=e.oxw();e.xp6(2),e.Q6J("mat-sort-header","name"),e.xp6(2),e.Q6J("mat-sort-header","email"),e.xp6(7),e.Q6J("mat-sort-header","active"),e.xp6(5),e.wJu(o.users)}}function je(t,a){if(1&t&&(e.TgZ(0,"div",43),e._uU(1),e.qZA()),2&t){const o=e.oxw();e.xp6(),e.hij(" ",o.searchInputControl.value?"\xa1No se han encontrado usuarios!":"\xa1No se ha creado ning\xfan usuario a\xfan!"," ")}}const He=t=>({"pointer-events-none":t}),We=()=>[10,25,50,100];function Xe(t,a){if(1&t&&e._UZ(0,"mat-paginator",44),2&t){const o=e.oxw();e.Q6J("ngClass",e.VKq(6,He,o.isLoading))("length",o.pagination.length)("pageIndex",o.pagination.page)("pageSize",o.pagination.size)("pageSizeOptions",e.DdM(8,We))("showFirstLastButtons",!0)}}const et=()=>["new"];let tt=(()=>{class t{constructor(){this.isLoading=!1,this.searchInputControl=new i.NI,this.selectedSlide=null,this.users=[],this._unsubscribeAll=new A.x,this._changeDetectorRef=(0,e.f3M)(e.sBO),this._fuseConfirmationService=(0,e.f3M)(F.R),this._userDialog=(0,e.f3M)(L.uw),this._usersService=(0,e.f3M)(N.f),this._snackBar=(0,e.f3M)(y.ux),this.store=(0,e.f3M)(u.yh)}ngOnInit(){this.store.select(R.YN).pipe((0,b.R)(this._unsubscribeAll)).subscribe(o=>{this.users=o,this._changeDetectorRef.markForCheck()}),this.store.select(Ie.B).pipe((0,b.R)(this._unsubscribeAll)).subscribe(o=>{this.pagination=o,this._changeDetectorRef.markForCheck()}),this.searchInputControl.valueChanges.pipe((0,b.R)(this._unsubscribeAll),(0,Ae.b)(300),(0,B.w)(o=>(this.isLoading=!0,this._usersService.getUsers(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,o))),(0,Te.U)(()=>{this.isLoading=!1})).subscribe()}ngAfterViewInit(){this.waitForPaginatorLoad().then(()=>{this._sort&&this._paginator&&(this._sort.sort({id:"name",start:"desc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,b.R)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,ye.T)(this._sort.sortChange,this._paginator.page).pipe((0,B.w)(()=>this._usersService.getUsers(this._paginator.pageIndex,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value))).subscribe())})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}updateUserStatus(o,n,r){this.isLoading=!0,this.selectedSlide=r,this._usersService.updateUserStatus({id:n.id,active:o.checked}).pipe((0,b.R)(this._unsubscribeAll)).subscribe(p=>{p&&(this._snackBar.openFromComponent(D.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"Estado Actualizado correctamente",title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this.isLoading=!1,this.selectedSlide=-1,this._changeDetectorRef.markForCheck())})}deleteUser(o){this._fuseConfirmationService.open({title:"Eliminar Usuario",message:`\xbfEst\xe1 seguro que desea eliminar el usuario ${o.fullname}?`,icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(r=>{"confirmed"===r&&this._usersService.removeUser(o.id).pipe((0,b.R)(this._unsubscribeAll)).subscribe(({data:p})=>{p&&this._snackBar.openFromComponent(D.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:`Usuario ${o.fullname} eliminado correctamente`,title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"mat_solid:done"}}),this._changeDetectorRef.markForCheck()})})}trackByFn(o,n){return n.id||o}openDialog(o,n,r){this._userDialog.open($e,{data:{user:o,dialogMode:n},width:r,panelClass:"ath-dialog-panel"})}waitForPaginatorLoad(){var o=this;return(0,we.Z)(function*(){for(;!o._paginator||void 0===o._paginator;)yield new Promise(n=>{setTimeout(n,200)});return o._paginator})()}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["ath-users"]],viewQuery:function(n,r){if(1&n&&(e.Gf(S.NW,5),e.Gf(J.YE,5)),2&n){let p;e.iGM(p=e.CRH())&&(r._paginator=p.first),e.iGM(p=e.CRH())&&(r._sort=p.first)}},standalone:!0,features:[e.jDz],decls:33,vars:14,consts:[[1,"absolute","inset-0","flex","flex-col","flex-auto","min-w-0","overflow-x-auto","overflow-y-auto","bg-card","dark:bg-transparent","lg:overflow-x-hidden"],[1,"relative","flex","flex-col","px-6","py-8","border-b","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex-wrap","items-center","hidden","font-medium","sm:flex"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"ml-1","text-primary-700",3,"routerLink"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-700"],[1,"flex","sm:hidden"],[1,"inline-flex","items-center","-ml-1.5","text-secondary","font-medium",3,"routerLink"],[1,"ml-1"],[1,"mt-2","text-2xl","font-extrabold","leading-tight","tracking-tight"],[1,"flex","flex-wrap","items-center","mt-2","sm:mt-0","shrink-0","sm:ml-4"],[1,"mt-4","mr-4","sm:mt-0","fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],["mat-raised-button","",1,"mt-4","text-white","sm:mt-0","bg-gradient-to-r","from-primary-500","to-primary-600","hover:to-primary-900","hover:shadow-lg",3,"routerLink"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],[1,"flex","flex-col","flex-auto"],[1,"flex","flex-col","justify-between","flex-auto"],["class","grid"],["class","z-10 border-b sm:inset-x-0 sm:bottom-0 sm:border-t sm:border-b-0 bg-gray-50 dark:bg-transparent",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],[1,"grid"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5","users-table"],[3,"mat-sort-header"],[1,"text-center","truncate"],[1,"flex","items-center","justify-center",3,"mat-sort-header"],[1,"pr-10","mr-6","text-right"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","md:px-8","users-table"],[1,"flex","truncate"],[1,"truncate"],[1,"flex","justify-center","mr-4","text-center"],[3,"checked","color"],[1,"flex","flex-row","justify-end","gap-2"],["mat-stroked-button","","matTooltip","Editar",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"routerLink"],[1,"icon-size-5",3,"svgIcon"],["mat-stroked-button","","matTooltip","Cambiar contrase\xf1a",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],["mat-stroked-button","","matTooltip","Asignar Roles",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],["mat-stroked-button","","matTooltip","Eliminar",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[3,"checked","color","change"],[3,"diameter","color"],["class","grid items-center gap-4 px-6 py-3 border-b md:px-8 users-table"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","sm:p-16"],[1,"z-10","border-b","sm:inset-x-0","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"]],template:function(n,r){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"div",4)(6,"a",5),e._uU(7,"Inicio"),e.qZA()(),e.TgZ(8,"div",4),e._UZ(9,"mat-icon",6),e.TgZ(10,"a",7),e._uU(11,"Usuarios"),e.qZA()()(),e.TgZ(12,"div",8)(13,"a",9),e._UZ(14,"mat-icon",6),e.TgZ(15,"span",10),e._uU(16,"Regresar"),e.qZA()()()(),e.TgZ(17,"div",11),e._uU(18," Listado de usuarios "),e.qZA()(),e.TgZ(19,"div",12)(20,"mat-form-field",13),e._UZ(21,"mat-icon",14)(22,"input",15),e.qZA(),e.TgZ(23,"button",16),e._UZ(24,"mat-icon",17),e.TgZ(25,"span",18),e._uU(26,"Nuevo"),e.qZA()()()(),e.TgZ(27,"div",19)(28,"div",20),e.YNc(29,Ke,18,3,"div",21)(30,je,2,1),e.ynx(31),e.YNc(32,Xe,1,9,"mat-paginator",22),e.BQk(),e.qZA()()()),2&n&&(e.xp6(6),e.Q6J("routerLink","/dashboard"),e.xp6(3),e.Q6J("svgIcon","mat_solid:chevron_right"),e.xp6(4),e.Q6J("routerLink","./.."),e.xp6(),e.Q6J("svgIcon","mat_solid:chevron_left"),e.xp6(6),e.Q6J("subscriptSizing","dynamic"),e.xp6(),e.Q6J("svgIcon","mat_solid:search"),e.xp6(),e.Q6J("formControl",r.searchInputControl)("autocomplete","off")("placeholder","Escriba para filtrar..."),e.xp6(),e.Q6J("routerLink",e.DdM(13,et)),e.xp6(),e.Q6J("svgIcon","mat_solid:add"),e.xp6(5),e.um2(29,r.users.length>0?29:30),e.xp6(3),e.um2(32,r.pagination.length>0?32:-1))},dependencies:[i.u5,i.Fj,i.JJ,m.ot,m.lW,c.lN,c.KE,c.qo,d.Ps,d.Hw,C.c,C.Nt,S.TU,S.NW,$.Cq,$.Ou,U.rP,U.Rr,J.JX,J.YE,J.nU,P.AV,P.gM,I.mk,g.VI,i.UX,i.oH,v.rH],encapsulation:2,data:{animation:T.L},changeDetection:0})}return t})(),ot=(()=>{class t{constructor(o){this._usersService=o}resolve(o,n){return this._usersService.getUsers()}static#e=this.\u0275fac=function(n){return new(n||t)(e.LFG(N.f))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),rt=(()=>{class t{constructor(o){this._usersService=o}resolve(o,n){const r=o.params.userId;if("new"!==r)return this._usersService.getUser(r)}static#e=this.\u0275fac=function(n){return new(n||t)(e.LFG(N.f))};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Y=s(97801);const it=[{path:"",component:tt,resolve:{users:ot,roles:Y.xQ}},{path:":userId",component:Ze,resolve:{user:rt,roles:Y.xQ}}]}}]);