(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[4378],{84378:(df,Ds,R)=>{"use strict";R.r(Ds),R.d(Ds,{default:()=>JX});var e=R(54438),U=R(60177),m=R(89417),Ie=R(96695),Oe=R(95416),pe=R(2042),ea=R(30450),se=R(75351),te=R(88834),O=R(32102),de=R(99213),le=R(59042),ve=R(59115),ot=R(9183),ft=R(51188),Ke=R(21413),An=R(57786),T=R(56977),ye=R(70152),ce=R(25558),Fe=R(96354),Be=R(96697),ne=R(97586),ff=R(77235),Dt=R(82643),fe=R(59640),bn=R(63729),At=R(70819),Mn=R(47413);const mf=t=>t.assistances,It=((0,fe.Mz)(mf,t=>t.assistance),(0,fe.Mz)(mf,t=>t.assistances));var Mt=R(46601),gt=R(82798),we=R(89079),Pn=R(91401),ue=R(94794),oe=R(88141),Bn=R(51917),Jr=R(98216),X=R(53473);const c2=X.J1`
    mutation CreateAssistance($createAssistanceInput: CreateAssistanceInput!) {
        createAssistance(createAssistanceInput: $createAssistanceInput) {

            ok
            message

            assistance {
                id
                active
                no
                userId
                description
                price
                currencyId
                currency {
                    id
                    name
                    iso
                }
                uomId
                uom {
                    id
                    name
                    abbr
                }
            }

        }
    }
`,u2=X.J1`
    mutation UpdateAssistance($updateAssistanceInput: UpdateAssistanceInput!) {
        updateAssistance(updateAssistanceInput: $updateAssistanceInput) {
            ok
            message

            assistance {
                id
                active
                no
                userId
                description
                price
                currencyId
                currency {
                    id
                    name
                    iso
                }
                uomId
                uom {
                    id
                    name
                    abbr
                }
            }
        }
    }
`,d2=X.J1`
    mutation Mutation($updateEntityStatusInput: UpdateEntityStatusInput!) {
        updateAssistanceStatus(updateEntityStatusInput: $updateEntityStatusInput) {
            ok
            message
        }

    }
`,f2=X.J1`
    mutation RemoveAssistance($assistanceId: String!) {
        removeAssistance(id: $assistanceId) {
            ok
            message
        }
    }
`,m2=X.J1`
    query FindAssistancesActive {
        findAssistancesActive {
            ok
            message

            assistances {
                id
                active
                no
                userId
                description
                price
                currencyId
                currency {
                    id
                    name
                    iso
                }
                uomId
                uom {
                    id
                    name
                    abbr
                }
            }
        }
    }
`,p2=X.J1`
    query FindAssistances($offset: Int, $limit: Int, $sort: String, $order: Order, $search: String) {
        findAssistances(offset: $offset, limit: $limit, sort: $sort, order: $order, search: $search) {
            ok
            message

            pagination {
                length
                size
                page
            }

            assistances {
                id
                active
                no
                userId
                description
                price
                currencyId
                currency {
                    id
                    name
                    iso
                }
                uomId
                uom {
                    id
                    name
                    abbr
                }
            }
        }
    }
`,h2=X.J1`
    query FindAllAssistances {
        findAllAssistances {
            ok
            message

            assistances {
                no
                description
                price
                currency {
                    iso
                }
                uomId
                uom {
                    id
                    name
                    abbr
                }
            }
        }
    }
`,g2=X.J1`
    query FindAssistanceById($assistanceId: String!) {
        findAssistanceById(id: $assistanceId) {
            ok
            message

            assistance {
                id
                active
                no
                userId
                description
                price
                currencyId
                currency {
                    id
                    name
                    iso
                }
                uomId
                uom {
                    id
                    name
                    abbr
                }
            }
        }
    }
`;let ta=(()=>{class t{constructor(n,i){this.apolloProvider=n,this.store=i,this._apollo=this.apolloProvider.use("BALANC")}createAssistance(n){return this.store.select(It).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:c2,variables:{createAssistanceInput:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:a})=>{const o=structuredClone(i);o.push(a.createAssistance.assistance),this.store.dispatch((0,Bn.Ab)({assistances:o}))}))))}getAssistances(n=1,i=20,a="no",o="asc",s=""){return this._apollo.query({query:p2,errorPolicy:"all",variables:{offset:i*(n-1),limit:i,sort:a,order:o,search:s}}).pipe((0,oe.M)(({data:l})=>{this.store.dispatch((0,Jr.Bp)({pagination:l.findAssistances.pagination})),this.store.dispatch((0,Bn.Ab)({assistances:l.findAssistances.assistances}))}))}getAssistancesActive(){return this._apollo.query({query:m2,errorPolicy:"all"}).pipe((0,oe.M)(({data:n})=>{this.store.dispatch((0,Bn.Ab)({assistances:n.findAssistancesActive.assistances}))}))}getAllAssistances(){return this._apollo.query({query:h2,errorPolicy:"all"})}getAssistanceById(n){return this._apollo.query({query:g2,variables:{assistanceId:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:i})=>{this.store.dispatch((0,Bn.Py)({assistance:i.findAssistanceById.assistance}))}))}updateAssistance(n){return this.store.select(It).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:u2,variables:{updateAssistanceInput:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:a})=>{const o=structuredClone(i);o[i.findIndex(l=>l.id===n.id)]=a.updateAssistance.assistance,this.store.dispatch((0,Bn.Ab)({assistances:o}))}))))}updateAssistanceStatus(n){return this.store.select(It).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:d2,variables:{updateEntityStatusInput:n},errorPolicy:"all"}).pipe((0,oe.M)(()=>{const a=structuredClone(i);a[i.findIndex(s=>s.id===n.id)].active=n.active,this.store.dispatch((0,Bn.Ab)({assistances:a}))}))))}removeAssistance(n){return this.store.select(It).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:f2,variables:{assistanceId:n},errorPolicy:"all"}).pipe((0,oe.M)(({errors:a})=>{if(a)return;const o=structuredClone(i),s=i.findIndex(l=>l.id===n);o.splice(s,1),this.store.dispatch((0,Bn.Ab)({assistances:o}))}))))}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(X.Ic),e.KVO(fe.il))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var b2=R(17085),Hr=R(86600);const v2=(t,r)=>r.id;function _2(t,r){1&t&&(e.j41(0,"h2",2),e.EFF(1," Agregar servicio "),e.k0s())}function y2(t,r){1&t&&(e.j41(0,"h2",2),e.EFF(1," Editar servicio "),e.k0s())}function C2(t,r){if(1&t&&(e.j41(0,"div",4)(1,"div",7)(2,"div",8)(3,"div",9)(4,"div",10)(5,"h6",11),e.EFF(6,"Nombre"),e.k0s(),e.j41(7,"span",12),e.EFF(8),e.k0s()()()()()()),2&t){const n=e.XpG();e.R7$(8),e.JRh(n.data.assistance.description||"Sin nombre")}}function x2(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," La descripci\xf3n del es obligatoria "),e.k0s())}function F2(t,r){if(1&t&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.iso," ")}}function S2(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," La moneda es obligatoria "),e.k0s())}function k2(t,r){if(1&t&&(e.j41(0,"mat-option",19),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.abbr," ")}}function $2(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," La unidad de medida es obligatoria "),e.k0s())}function I2(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El precio es obligatorio "),e.k0s())}function w2(t,r){if(1&t&&(e.j41(0,"div",5)(1,"div",13)(2,"form",14)(3,"mat-form-field",15)(4,"mat-label"),e.EFF(5,"Descripci\xf3n"),e.k0s(),e.nrm(6,"input",16),e.j41(7,"mat-hint"),e.EFF(8,"Ejemplo: Monte y desmonte de caja"),e.k0s(),e.DNE(9,x2,2,0,"mat-error"),e.k0s(),e.j41(10,"mat-form-field",17)(11,"mat-label"),e.EFF(12,"Moneda"),e.k0s(),e.j41(13,"mat-select",18),e.Z7z(14,F2,2,2,"mat-option",19,e.fX1),e.k0s(),e.DNE(16,S2,2,0,"mat-error"),e.k0s(),e.j41(17,"mat-form-field",17)(18,"mat-label"),e.EFF(19,"Unidad de medida"),e.k0s(),e.j41(20,"mat-select",18),e.Z7z(21,k2,2,2,"mat-option",19,v2),e.k0s(),e.DNE(23,$2,2,0,"mat-error"),e.k0s(),e.j41(24,"mat-form-field",17)(25,"mat-label"),e.EFF(26,"Precio"),e.k0s(),e.nrm(27,"input",20),e.DNE(28,I2,2,0,"mat-error"),e.k0s()()()()),2&t){const n=e.XpG();e.R7$(2),e.Y8G("formGroup",n.assistanceForm)("autocomplete","off"),e.R7$(4),e.Y8G("formControlName","description")("placeholder","Ejemplo: Monte y desmonte de caja"),e.R7$(3),e.vxM(9,n.assistanceForm.get("description").hasError("required")?9:-1),e.R7$(4),e.Y8G("formControlName","currencyId")("required",!0),e.R7$(),e.Dyx(n.currencies),e.R7$(2),e.vxM(16,n.assistanceForm.get("currencyId").hasError("required")?16:-1),e.R7$(4),e.Y8G("formControlName","uomId")("required",!0),e.R7$(),e.Dyx(n.uoms),e.R7$(2),e.vxM(23,n.assistanceForm.get("uomId").hasError("required")?23:-1),e.R7$(4),e.Y8G("formControlName","price")("min",n.assistanceForm.get("price").value)("placeholder","0.00"),e.R7$(),e.vxM(28,n.assistanceForm.get("price").hasError("required")?28:-1)}}function R2(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.updateAssistance())}),e.EFF(1," Actualizar "),e.k0s()}if(2&t){const n=e.XpG(2);e.Y8G("color","primary")("disabled",n.assistanceForm.invalid)("matDialogClose","confirmed")}}function T2(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.createAssistance())}),e.EFF(1," Agregar "),e.k0s()}if(2&t){const n=e.XpG(2);e.Y8G("color","primary")("disabled",n.assistanceForm.invalid)("matDialogClose","confirmed")}}function E2(t,r){if(1&t&&(e.j41(0,"div",6)(1,"button",21),e.EFF(2," Cancelar "),e.k0s(),e.DNE(3,R2,2,3,"button",22)(4,T2,2,3,"button",22),e.k0s()),2&t){const n=e.XpG();e.R7$(),e.Y8G("matDialogClose","cancelled"),e.R7$(2),e.vxM(3,"edit"===n.data.dialogMode?3:-1),e.R7$(),e.vxM(4,"add"===n.data.dialogMode?4:-1)}}let j2=(()=>{class t{constructor(n){this.data=n,this.uoms=[],this.currencies=[],this.dialogMode="view",this.maxDate=new Date,this._assistancesService=(0,e.WQX)(ta),this._changeDetectorRef=(0,e.WQX)(e.gRc),this._dialogRef=(0,e.WQX)(se.CP),this._destroyRef=(0,e.WQX)(e.abz),this._formBuilder=(0,e.WQX)(m.ok),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._snackBar=(0,e.WQX)(Oe.UG),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il),this.dialogMode=n.dialogMode,this.assistance=n.assistance}ngOnInit(){this.assistanceForm=this._formBuilder.group({id:new m.MJ(null),description:new m.MJ(null,[m.k0.required,m.k0.maxLength(1e5)]),price:new m.MJ(0,[m.k0.required,m.k0.min(0)]),currencyId:new m.MJ(null,[m.k0.required,m.k0.maxLength(100)]),uomId:new m.MJ(null,[m.k0.required,m.k0.maxLength(100)])}),"edit"===this.dialogMode&&this.assistanceForm.patchValue(this.assistance),this.store.select(Pn.y$).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.currencies=n,this._changeDetectorRef.markForCheck()}),this.store.select(b2.Ns).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.uoms=n,this._changeDetectorRef.markForCheck()})}closeDialog(){this._dialogRef.close()}createAssistance(){let n=this.assistanceForm.getRawValue();delete n.id,this._fuseConfirmationService.open({title:"Crear servicio",message:"\xbfEsta seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(a=>{"confirmed"===a&&this._assistancesService.createAssistance(n).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:o})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.createAssistance.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}})}),this._changeDetectorRef.markForCheck()})}updateAssistance(){const n=this.assistanceForm.getRawValue();this._fuseConfirmationService.open({title:"Actualizar servicio de taller",message:"\xbfEsta seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(a=>{"confirmed"===a&&this._assistancesService.updateAssistance(n).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:o})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.updateAssistance.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}})}),this._changeDetectorRef.markForCheck()})}static#e=this.\u0275fac=function(i){return new(i||t)(e.rXU(se.Vh))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-assistance-dialog"]],standalone:!0,features:[e.aNF],decls:8,vars:5,consts:[[1,"relative","flex","flex-col","w-full","max-h-screenl"],[1,"flex","flex-col","items-center","px-8","pt-4","space-y-1","text-center","sm:items-start","sm:mt-0","sm:pr-8","sm:text-left"],[1,"text-2xl","text-gray-400"],[1,"flex","flex-col","items-center","flex-auto","w-full","px-8","pb-6","sm:flex-row","sm:items-start","sm:pb-8"],[1,"flex-auto"],[1,"w-full","overflow-hidden"],[1,"flex","items-center","justify-center","px-6","py-4","space-x-3","sm:justify-end","bg-gray-50","dark:bg-black/10"],[1,"flex"],[1,"flex","flex-col","w-full","mt-5"],[1,"flex","flex-col","p-8","pb-0","sm:flex-row"],[1,"w-full","py-10","my-10"],[1,"mb-2","font-medium"],[1,"border-sm"],[1,"flex","flex-col"],[1,"grid","w-full","grid-cols-1","gap-5","mt-3","sm:grid-cols-3",3,"formGroup","autocomplete"],[1,"w-full","fuse-mat-dense","sm:col-span-3"],["matInput","","type","text","required","","maxlength","100000",3,"formControlName","placeholder"],[1,"w-full","fuse-mat-dense"],[3,"formControlName","required"],[3,"value"],["matInput","","type","number","required","",3,"formControlName","min","placeholder"],["mat-stroked-button","",3,"matDialogClose"],["mat-flat-button","",3,"color","disabled","matDialogClose"],["mat-flat-button","",3,"click","color","disabled","matDialogClose"]],template:function(i,a){1&i&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,_2,2,0,"h2",2)(3,y2,2,0,"h2",2),e.k0s(),e.j41(4,"div",3),e.DNE(5,C2,9,1,"div",4)(6,w2,29,15,"div",5),e.k0s(),e.DNE(7,E2,5,3,"div",6),e.k0s()),2&i&&(e.R7$(2),e.vxM(2,"add"===a.data.dialogMode?2:-1),e.R7$(),e.vxM(3,"edit"===a.data.dialogMode?3:-1),e.R7$(2),e.vxM(5,"view"===a.data.dialogMode?5:-1),e.R7$(),e.vxM(6,6),e.R7$(),e.vxM(7,"view"!==a.data.dialogMode?7:-1))},dependencies:[te.Hl,te.$z,se.tx,O.RG,O.rl,O.nJ,O.MV,O.TL,le.fS,le.fg,gt.Ve,gt.VO,Hr.wT,m.X1,m.qT,m.me,m.Q0,m.BC,m.cb,m.YS,m.tU,m.VZ,m.j4,m.JD],encapsulation:2})}return t})();var As=R(68824);const D2=t=>({"pointer-events-none":t}),A2=()=>[5,10,25,100];function M2(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-slide-toggle",39),e.bIt("change",function(a){e.eBV(n);const o=e.XpG(),s=o.$implicit,l=o.$index,c=e.XpG(2);return e.Njj(c.updateRateStatus(a,s,l))}),e.k0s()}if(2&t){const n=e.XpG().$implicit;e.Y8G("checked",n.active)("color","primary")}}function P2(t,r){1&t&&e.nrm(0,"mat-spinner",35),2&t&&e.Y8G("diameter",20)("color","primary")}function B2(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",28)(1,"div",30),e.EFF(2),e.k0s(),e.j41(3,"div",31),e.EFF(4),e.k0s(),e.j41(5,"div",32),e.EFF(6),e.k0s(),e.j41(7,"div",33),e.EFF(8),e.nI1(9,"currency"),e.k0s(),e.j41(10,"div",26),e.DNE(11,M2,1,2,"mat-slide-toggle",34)(12,P2,1,2,"mat-spinner",35),e.k0s(),e.j41(13,"div",36)(14,"button",37),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.openDialog(a,"edit"))}),e.nrm(15,"mat-icon",38),e.k0s(),e.j41(16,"button",37),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.deleteAssistance(a))}),e.nrm(17,"mat-icon",38),e.k0s()()()}if(2&t){const n=r.$implicit,i=r.$index,a=e.XpG(2);e.R7$(2),e.SpI(" ",i+1," "),e.R7$(2),e.SpI(" ",n.no," "),e.R7$(2),e.SpI(" ",n.description," "),e.R7$(2),e.SpI(" ",e.brH(9,8,n.price,n.currency.iso+" ","symbol")," "),e.R7$(3),e.vxM(11,a.isSlideLoading&&a.selectedSlide===i?-1:11),e.R7$(),e.vxM(12,a.isSlideLoading&&a.selectedSlide===i?12:-1),e.R7$(3),e.Y8G("svgIcon","mat_solid:edit"),e.R7$(2),e.Y8G("svgIcon","mat_solid:delete")}}function O2(t,r){if(1&t&&(e.j41(0,"div",23)(1,"div",24)(2,"div",25),e.EFF(3," No "),e.k0s(),e.j41(4,"div",26),e.EFF(5," C\xf3digo "),e.k0s(),e.j41(6,"div",27),e.EFF(7," Descripci\xf3n "),e.k0s(),e.j41(8,"div",26),e.EFF(9," Precio "),e.k0s(),e.j41(10,"div",26),e.EFF(11," Estado "),e.k0s(),e.j41(12,"div",26),e.EFF(13," Acciones "),e.k0s()(),e.Z7z(14,B2,18,12,"div",28,e.BUC().trackByFn,!0),e.nrm(16,"mat-paginator",29),e.k0s()),2&t){const n=e.XpG();e.R7$(2),e.Y8G("mat-sort-header","no"),e.R7$(12),e.Dyx(n.assistances),e.R7$(2),e.Y8G("ngClass",e.eq3(7,D2,n.isLoading))("length",n.pagination.length)("pageIndex",n.pagination.page)("pageSize",n.pagination.size)("pageSizeOptions",e.lJ4(9,A2))("showFirstLastButtons",!0)}}function N2(t,r){1&t&&(e.j41(0,"div",40),e.EFF(1," \xa1No hay servicios creados para el negocio!"),e.k0s())}Dt.vfs=ff.b.vfs;let G2=(()=>{class t{constructor(){this.assistance=null,this.assistances=[],this.isLoading=!1,this.isSlideLoading=!1,this.merchant=null,this.searchInputControl=new m.MJ(""),this.selectedSlide=null,this.user=null,this._assistancesService=(0,e.WQX)(ta),this._changeDetectorRef=(0,e.WQX)(e.gRc),this._dialog=(0,e.WQX)(se.bZ),this._fileSaverService=(0,e.WQX)(As.f),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._snackBar=(0,e.WQX)(Oe.UG),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.store.select(bn.SW).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.user=n,this._changeDetectorRef.markForCheck()}),this.store.select(At.Xb).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.merchant=n,this._changeDetectorRef.markForCheck()}),this.store.select(It).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.assistances=n,this._changeDetectorRef.markForCheck()}),this.store.select(Mn.Dz).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.pagination=n,this._changeDetectorRef.markForCheck()}),this.searchInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,ce.n)(n=>(this.isLoading=!0,this._assistancesService.getAssistances(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,n))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe()}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"no",start:"asc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,An.h)(this._sort.sortChange,this._paginator.page).pipe((0,ce.n)(()=>(this.isLoading=!0,this._assistancesService.getAssistances(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}deleteAssistance(n){this._fuseConfirmationService.open({title:"Cuidado",message:`\xbfEst\xe1 seguro que desea eliminar la orden de trabajo: ${n.no}?`,icon:{show:!0,name:"mat_solid:question_mark",color:"warning"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{"confirmed"===a&&this._assistancesService.removeAssistance(n.id).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:o})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.removeAssistance.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this._changeDetectorRef.markForCheck()})})}updateRateStatus(n,i,a){this.isSlideLoading=!0,this.selectedSlide=a,this._assistancesService.updateAssistanceStatus({id:i.id,active:n.checked}).subscribe(({data:o})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.updateAssistanceStatus.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this.isSlideLoading=!1,this.selectedSlide=null,this._changeDetectorRef.markForCheck()})}openDialog(n,i){this._dialog.open(j2,{data:{assistance:n,dialogMode:i},width:"90%",panelClass:"ath-dialog-panel",disableClose:!0})}printAssistancesList(n="open"){this._assistancesService.getAllAssistances().pipe((0,Be.s)(1)).subscribe(({data:i})=>{let a={header:{text:"Listado de servicios",style:"header",marginTop:5},content:[{lineHeight:1.3,table:{headerRows:1,widths:[60,120,"*",120],body:[[{text:"No.",style:"table_header"},{text:"C\xf3digo",style:"table_header"},{text:"Descripci\xf3n",style:"table_header",alignment:"left"},{text:"Precio M\xednimo",style:"table_header"}],...i.findAllAssistances.assistances.map((o,s)=>[{style:"table_body",text:s+1,alignment:"center"},{style:"table_body",text:o.no,alignment:"center"},{style:"table_body",text:o.description,alignment:"left"},{style:"table_body",text:o.currency.iso+" "+o.price.toFixed(2),alignment:"right"}])]},layout:"lightHorizontalLines"}],footer:(o,s)=>({table:{widths:["*","*"],body:[[{text:`Reporte generador por: ${this.user.fullname} | Esta informaci\xf3n es exclusiva de ${this.merchant.name}`,bold:!0,fontSize:8},{text:`P\xe1gina ${o.toString()}/${s} - Fecha de impresi\xf3n ${ne().format("DD/MM/yyyy HH:mm:ss")}`,bold:!0,fontSize:8,alignment:"right"}]]},margin:[30,0,30,0],layout:"noBorders",italics:!0}),defaultStyle:{fontSize:12},styles:{header:{fontSize:18,bold:!0,marginBottom:5,alignment:"center",fontFeatures:["c2sc","smcp"]},table_header:{fontSize:11,bold:!0,alignment:"center",fontFeatures:["c2sc","smcp"]},table_body:{fontSize:10}},pageOrientation:"landscape",pageSize:"LETTER",watermark:{text:this.merchant.name,color:"#fff",opacity:.07,angle:-35,bold:!0,italics:!1},info:{title:"Listado de servicios",author:`${this.user.fullname}`,creationDate:ne().toDate(),modDate:ne().toDate(),producer:this.merchant.name}};switch(n){case n="download":Dt.createPdf(a).download();break;case n="open":Dt.createPdf(a).open();break;case n="print":Dt.createPdf(a).print()}})}exportAssistancesListToExcel(){this._assistancesService.getAllAssistances().pipe((0,Be.s)(1)).subscribe(({data:n})=>{this._fileSaverService.exportAsExcelFile(n.findAllAssistances.assistances,"Listado de servicios")})}trackByFn(n,i){return i.id||n}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-assistances"]],viewQuery:function(i,a){if(1&i&&(e.GBs(Ie.iy,5),e.GBs(pe.B4,5)),2&i){let o;e.mGM(o=e.lsd())&&(a._paginator=o.first),e.mGM(o=e.lsd())&&(a._sort=o.first)}},standalone:!0,features:[e.aNF],decls:42,vars:14,consts:[["itemMenu","matMenu"],[1,"flex","flex-col","flex-auto","min-w-0","sm:absolute","sm:inset-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","px-6","py-8","border-b","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/desktop",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","sm:leading-10"],[1,"flex","items-center","gap-2","mt-6","shrink-0","lg:mt-0","lg:ml-4"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],["mat-raised-button","",1,"text-white","bg-gradient-to-r","from-yellow-500","to-yellow-600",3,"matMenuTriggerFor"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],[3,"xPosition"],["mat-menu-item","",3,"click"],["mat-raised-button","",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","overflow-auto","sm:mb-18"],[1,"grid"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","assistances-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-slate-900"],[1,"hidden","sm:block",3,"mat-sort-header"],[1,"text-center"],[1,"text-left"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","assistances-grid","md:px-8"],[1,"z-10","border-b","sm:absolute","sm:inset-x-0","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],[1,"hidden","font-mono","sm:block"],[1,"hidden","font-mono","text-center","sm:block"],[1,"text-left","truncate"],[1,"font-mono","text-center"],[3,"checked","color"],[3,"diameter","color"],[1,"flex","flex-row","items-center","justify-start","gap-1"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"icon-size-5",3,"svgIcon"],[3,"change","checked","color"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"a",5),e.EFF(6,"Inicio"),e.k0s()(),e.j41(7,"div",6),e.nrm(8,"mat-icon",7),e.j41(9,"a",8),e.EFF(10,"Ventas"),e.k0s()(),e.j41(11,"div",6),e.nrm(12,"mat-icon",7),e.j41(13,"a",8),e.EFF(14,"Servicios"),e.k0s()()(),e.j41(15,"div",9)(16,"h2",10),e.EFF(17," Servicios "),e.k0s()()(),e.j41(18,"div",11)(19,"mat-form-field",12),e.nrm(20,"mat-icon",13)(21,"input",14),e.k0s(),e.j41(22,"button",15),e.nrm(23,"mat-icon",16),e.j41(24,"span",17),e.EFF(25,"Reportes"),e.k0s()(),e.j41(26,"mat-menu",18,0)(28,"button",19),e.bIt("click",function(){return e.eBV(o),e.Njj(a.printAssistancesList())}),e.nrm(29,"mat-icon",16),e.EFF(30," Imprimir listado de servicios "),e.k0s(),e.j41(31,"button",19),e.bIt("click",function(){return e.eBV(o),e.Njj(a.exportAssistancesListToExcel())}),e.nrm(32,"mat-icon",16),e.EFF(33," Exportar listado de servicios "),e.k0s()(),e.j41(34,"button",20),e.bIt("click",function(){return e.eBV(o),e.Njj(a.openDialog(a.assistance,"add"))}),e.nrm(35,"mat-icon",16),e.j41(36,"span",17),e.EFF(37,"Agregar"),e.k0s()()()(),e.j41(38,"div",21)(39,"div",22),e.DNE(40,O2,17,10,"div",23)(41,N2,2,0),e.k0s()()()}if(2&i){const o=e.sdS(27);e.R7$(8),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(7),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",a.searchInputControl)("autocomplete","off")("placeholder","Escriba para buscar..."),e.R7$(),e.Y8G("matMenuTriggerFor",o),e.R7$(),e.Y8G("svgIcon","mat_solid:expand_more"),e.R7$(3),e.Y8G("xPosition","before"),e.R7$(3),e.Y8G("svgIcon","mat_solid:description"),e.R7$(3),e.Y8G("svgIcon","mat_solid:description"),e.R7$(3),e.Y8G("svgIcon","mat_solid:add"),e.R7$(5),e.vxM(40,a.assistances.length>0?40:41)}},dependencies:[U.oe,te.Hl,te.$z,O.RG,O.rl,O.JW,de.m_,de.An,le.fS,le.fg,Ie.Ou,Ie.iy,pe.NQ,pe.B4,pe.aE,ve.Cn,ve.kk,ve.fb,ve.Cp,ea.mV,ea.sG,ot.D6,ot.LG,U.YU,m.X1,m.me,m.BC,m.l_,ft.Wk],styles:[".assistances-grid[_ngcontent-%COMP%]{grid-template-columns:50px 100px 200px 100px 75px 75px}@media (min-width: 600px){.assistances-grid[_ngcontent-%COMP%]{grid-template-columns:20px 200px auto 200px 75px 75px 100px}}"],changeDetection:0})}return t})();var yt=R(60850),mt=R(82765),Z=R(25084),De=R(14823),ie=R(7673),Ne=R(99172),Qe=R(31397),bt=R(70980),Ms=R(56808),Ps=R(98929),fr=R(13189),mr=R(64193);const L2=X.J1`
    mutation CreateOffer($createOfferInput: CreateOfferInput!) {
        createOffer(createOfferInput: $createOfferInput) {
            ok
            message

            offer {
                id
                no
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                createdAt
                currencyId
                currency {
                    iso
                }
                status
                customerId
                customer {
                    name
                    address
                    city
                    state
                    nit
                }
                products {
                    productId
                    quantity
                    price

                    product {
                        name
                        uom {
                            name
                            abbr
                        }
                    }
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                total
                subtotal
                discount
                date
            }
        }
    }

`,Y2=X.J1`
    mutation UpdateOffer($updateOfferInput: UpdateOfferInput!) {
        updateOffer(updateOfferInput: $updateOfferInput) {
            ok
            message

            offer {
                id
                no
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                createdAt
                currencyId
                currency {
                    iso
                }
                status
                customerId
                customer {
                    name
                    address
                    city
                    state
                    nit
                }
                products {
                    productId
                    quantity
                    price

                    product {
                        name
                        uom {
                            name
                            abbr
                        }
                    }
                }

                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                total
                subtotal
                discount
                date
            }
        }
    }
`,V2=X.J1`
    mutation RemoveOffer($removeOfferId: String!) {
        removeOffer(id: $removeOfferId) {
            ok
            message
        }
    }
`,z2=X.J1`
    query FindAllOffers($offset: Int, $limit: Int, $sort: String, $order: Order, $search: String) {
        findAllOffers(offset: $offset, limit: $limit, sort: $sort, order: $order, search: $search) {
            ok
            message

            pagination {
                length
                size
                page
            }

            offers {
                id
                no
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                createdAt
                currencyId
                currency {
                    iso
                }
                status
                customerId
                customer {
                    name
                    address
                    city
                    state
                    nit
                }
                products {
                    productId
                    quantity
                    price

                    product {
                        name
                        uom {
                            name
                            abbr
                        }
                    }
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                total
                subtotal
                discount
                date
            }
        }
    }
`,q2=X.J1`
    query FindOfferById($findOfferById: String!) {
        offer(id: $findOfferById) {
            ok
            message

            offer {
                id
                no
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                createdAt
                currencyId
                currency {
                    iso
                }
                status
                customerId
                customer {
                    name
                    address
                    city
                    state
                    nit
                }
                products {
                    productId
                    quantity
                    price

                    product {
                        name
                        uom {
                            name
                            abbr
                        }
                    }
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                total
                subtotal
                discount
                date
            }
        }
    }
`,U2=X.J1`
    mutation UpdateOfferStatus($updateOfferStatusInput: UpdateOfferStatusInput!) {
        updateOfferStatus(updateOfferStatusInput: $updateOfferStatusInput) {

            ok
            message

            offer {
                id
                no
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                createdAt
                currencyId
                currency {
                    iso
                }
                status
                customerId
                customer {
                    name
                    address
                    city
                    state
                    nit
                }
                products {
                    productId
                    quantity
                    price

                    product {
                        name
                        uom {
                            name
                            abbr
                        }
                    }
                }

                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }

                total
                subtotal
                discount
                date
            }
        }
    }
`;var X2=R(45312);let W2=(()=>{class t{constructor(n){this.apolloProvider=n,this._apollo=this.apolloProvider.use(X2.c.GRAPHQL_PROVIDER)}createOffer(n){return this._apollo.mutate({mutation:L2,variables:{createOfferInput:n},errorPolicy:"all"})}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(X.Ic))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Zr=R(72797),Bs=R(4840),Os=R(25910),Je=R(55364);const pf=(t,r)=>r.id,Q2=()=>({suppressScrollX:!0}),hf=()=>({suppressScrollY:!0}),gf=t=>({"text-warn":t}),bf=()=>["$"],J2=t=>({"cursor-not-allowed":t}),H2=t=>({"cursor-pointer shadow":t});function Z2(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",38),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.selectCustomer(a))}),e.EFF(1),e.k0s()}if(2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",n.name," ")}}function K2(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," La fecha de la oferta es obligatoria "),e.k0s())}function e4(t,r){1&t&&(e.j41(0,"mat-option",25),e.EFF(1," x1 "),e.k0s()),2&t&&e.Y8G("value",1)}function t4(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.value),e.R7$(),e.SpI(" x",n.value," ")}}function n4(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El multiplicador es obligatorio "),e.k0s())}function r4(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",38),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.selectedCurrencyIso=a.iso)}),e.EFF(1),e.k0s()}if(2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.iso," ")}}function i4(t,r){if(1&t&&(e.j41(0,"span",32),e.EFF(1),e.k0s()),2&t){let n;const i=e.XpG();e.R7$(),e.Lme(" (+ ",2===(null==(n=i.bidForm.get("rates").value)?null:n.length)?"otro":"otros"," ",i.bidForm.get("rates").value.length>2?i.bidForm.get("rates").value.length-1:"",") ")}}function a4(t,r){if(1&t&&(e.j41(0,"mat-option",25)(1,"span",39),e.EFF(2),e.nI1(3,"number"),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(2),e.JRh(e.i5U(3,3,n.value,"1.4-4")),e.R7$(3),e.SpI(" ",n.name,"")}}function o4(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," Las tasas de cambio son requeridas "),e.k0s())}function s4(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",48),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addProductToOffer(o),e.Njj(a.stopPropagation())}),e.j41(1,"div",49),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addProductToOffer(o),e.Njj(a.stopPropagation())}),e.j41(2,"span",50),e.nrm(3,"mat-checkbox",51),e.EFF(4),e.k0s(),e.j41(5,"span",52),e.EFF(6),e.k0s(),e.j41(7,"span",53),e.EFF(8),e.k0s()()()}if(2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(3),e.Y8G("checked",n.checked),e.R7$(),e.SpI(" ",n.name," "),e.R7$(2),e.JRh(n.depot),e.R7$(2),e.Lme("",n.quantity," ",n.uom,"")}}function l4(t,r){1&t&&(e.j41(0,"mat-error",67),e.EFF(1," Valor m\xednimo 0.1 "),e.k0s())}function c4(t,r){if(1&t&&(e.j41(0,"mat-error",67),e.EFF(1),e.k0s()),2&t){const n=e.XpG().$implicit;e.R7$(),e.SpI(" Valor m\xe1ximo ",n.quantity," ")}}function u4(t,r){1&t&&(e.j41(0,"mat-error",67),e.EFF(1," Patr\xf3n no v\xe1lido "),e.k0s())}function d4(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",58)(1,"div"),e.EFF(2),e.k0s(),e.j41(3,"div",59),e.EFF(4),e.k0s(),e.j41(5,"div",60),e.EFF(6),e.k0s(),e.j41(7,"div",56),e.EFF(8),e.k0s(),e.j41(9,"div",61)(10,"div",62)(11,"button",63),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.decrementProductQty(a))}),e.nrm(12,"mat-icon",64),e.k0s(),e.j41(13,"mat-form-field",65),e.nrm(14,"input",66),e.k0s(),e.j41(15,"button",63),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.incrementProductQty(a))}),e.nrm(16,"mat-icon",64),e.k0s()(),e.DNE(17,l4,2,0,"mat-error",67)(18,c4,2,1,"mat-error",67)(19,u4,2,0,"mat-error",67),e.k0s(),e.j41(20,"div",68),e.EFF(21),e.nI1(22,"number"),e.j41(23,"span",69),e.EFF(24),e.k0s()(),e.j41(25,"div",68),e.EFF(26),e.nI1(27,"currency"),e.k0s(),e.j41(28,"div",70)(29,"button",71),e.bIt("click",function(){const a=e.eBV(n).$index,o=e.XpG(3);return e.Njj(o.removeProductToOffer(a))}),e.nrm(30,"mat-icon",64),e.k0s()()()}if(2&t){const n=r.$implicit,i=r.$index,a=e.XpG(3);e.R7$(2),e.SpI(" ",i+1," "),e.R7$(),e.Y8G("matTooltip",n.get("name").value),e.R7$(),e.SpI(" ",n.get("name").value," "),e.R7$(2),e.SpI(" ",n.get("depot").value," "),e.R7$(2),e.Lme(" ",n.get("stock").value," ",n.get("uom").value," "),e.R7$(3),e.Y8G("disabled",n.get("quantity").value<=.1||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:remove"),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",.1)("max",n.get("stock").value)("formControl",n.get("quantity")),e.R7$(),e.Y8G("disabled",n.get("quantity").value>=n.get("stock").value||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:add"),e.R7$(),e.vxM(17,n.get("quantity").hasError("min")?17:-1),e.R7$(),e.vxM(18,n.get("quantity").hasError("max")?18:-1),e.R7$(),e.vxM(19,n.get("quantity").hasError("pattern")&&!n.get("quantity").hasError("min")?19:-1),e.R7$(2),e.SpI(" ",e.i5U(22,22,n.get("price").value*a.bidForm.get("multiplier").value*(n.get("rate").value?n.get("rate").value:1),"1.2-2")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(28,gf,!n.get("rate").value)),e.R7$(),e.SpI(" ",n.get("rate").value?a.selectedCurrencyIso:n.get("currency").value," "),e.R7$(2),e.SpI(" ",e.i5U(27,25,n.get("quantity").value*n.get("price").value*a.bidForm.get("multiplier").value*(n.get("rate").value?n.get("rate").value:1),e.lJ4(30,bf))," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:close")}}function f4(t,r){if(1&t&&(e.j41(0,"div",46)(1,"div",54),e.nrm(2,"div"),e.j41(3,"div",55),e.EFF(4," Producto "),e.k0s(),e.j41(5,"div",55),e.EFF(6," Almac\xe9n "),e.k0s(),e.j41(7,"div",56),e.EFF(8," Disponibilidad "),e.k0s(),e.j41(9,"div",56),e.EFF(10," Cantidad "),e.k0s(),e.j41(11,"div",57),e.EFF(12," Precio "),e.k0s(),e.j41(13,"div",57),e.EFF(14," Total "),e.k0s(),e.j41(15,"div",56),e.EFF(16," Quitar "),e.k0s()(),e.Z7z(17,d4,31,31,"div",58,pf),e.k0s()),2&t){const n=e.XpG(2);e.R7$(17),e.Dyx(n.bidForm.get("products").controls)}}function m4(t,r){1&t&&(e.j41(0,"div",72),e.EFF(1," \xa1No ha seleccionado ning\xfan producto a\xfan! "),e.k0s())}function p4(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",73),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.createOffer())}),e.EFF(1),e.nI1(2,"number"),e.k0s()}if(2&t){const n=e.XpG(2);e.Y8G("ngClass",e.eq3(6,J2,n.bidForm.pristine||n.bidForm.invalid||0===n.bidForm.get("products").controls.length)),e.R7$(),e.Lme(" ",e.i5U(2,3,n.subtotal,"1.2-2")," ",n.selectedCurrencyIso," ")}}function h4(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",37)(1,"div",40)(2,"mat-form-field",41),e.nrm(3,"mat-icon",22)(4,"input",42),e.j41(5,"mat-autocomplete",43,3),e.bIt("closed",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.searchProductControl.reset())}),e.Z7z(7,s4,9,6,"mat-option",44,e.fX1),e.nI1(9,"async"),e.k0s()(),e.j41(10,"div",45),e.DNE(11,f4,19,0,"div",46)(12,m4,2,0),e.k0s()(),e.DNE(13,p4,3,8,"div",47),e.k0s()}if(2&t){const n=e.sdS(6),i=e.XpG();e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",i.searchProductControl)("matAutocomplete",n)("placeholder","Buscar productos"),e.R7$(),e.Y8G("displayWith",i.displayFn),e.R7$(2),e.Dyx(e.bMT(9,9,i.productsFiltered)),e.R7$(3),e.Y8G("fuseScrollbarOptions",e.lJ4(11,hf)),e.R7$(),e.vxM(11,i.bidForm.get("products").controls.length>0?11:12),e.R7$(2),e.vxM(13,i.bidAssistances?-1:13)}}function g4(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",48),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addAssistance(o),e.Njj(a.stopPropagation())}),e.j41(1,"div",49),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addAssistance(o),e.Njj(a.stopPropagation())}),e.j41(2,"span",50),e.nrm(3,"mat-checkbox",51),e.EFF(4),e.k0s()()()}if(2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(3),e.Y8G("checked",n.checked),e.R7$(),e.SpI(" ",n.description," ")}}function b4(t,r){1&t&&(e.j41(0,"mat-error",67),e.EFF(1," Valor m\xednimo 1 "),e.k0s())}function v4(t,r){1&t&&(e.j41(0,"mat-error",67),e.EFF(1," Patr\xf3n no v\xe1lido "),e.k0s())}function _4(t,r){1&t&&(e.j41(0,"mat-error",67),e.EFF(1," Valor m\xednimo 0 "),e.k0s())}function y4(t,r){1&t&&(e.j41(0,"mat-error",67),e.EFF(1," Valor requerido "),e.k0s())}function C4(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",78)(1,"div"),e.EFF(2),e.k0s(),e.j41(3,"div",59),e.EFF(4),e.k0s(),e.j41(5,"div",61)(6,"div",62)(7,"button",79),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.decrementAssistanceQty(a))}),e.nrm(8,"mat-icon",64),e.k0s(),e.j41(9,"mat-form-field",65),e.nrm(10,"input",80),e.k0s(),e.j41(11,"button",63),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.incrementAssistanceQty(a))}),e.nrm(12,"mat-icon",64),e.k0s()(),e.DNE(13,b4,2,0,"mat-error",67)(14,v4,2,0,"mat-error",67),e.k0s(),e.j41(15,"div",81)(16,"mat-form-field",65),e.nrm(17,"input",82),e.k0s(),e.DNE(18,_4,2,0,"mat-error",67)(19,y4,2,0,"mat-error",67),e.k0s(),e.j41(20,"div",83),e.EFF(21),e.k0s(),e.j41(22,"div",68),e.EFF(23),e.nI1(24,"currency"),e.k0s(),e.j41(25,"div",70)(26,"button",71),e.bIt("click",function(){const a=e.eBV(n).$index,o=e.XpG(3);return e.Njj(o.removeAssistanceToBid(a))}),e.nrm(27,"mat-icon",64),e.k0s()()()}if(2&t){const n=r.$implicit,i=r.$index,a=e.XpG(3);e.R7$(2),e.SpI(" ",i+1," "),e.R7$(),e.Y8G("matTooltip",n.get("description").value),e.R7$(),e.SpI(" ",n.get("description").value," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:remove"),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",1)("formControl",n.get("quantity")),e.R7$(),e.Y8G("disabled",n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:add"),e.R7$(),e.vxM(13,n.get("quantity").hasError("min")?13:-1),e.R7$(),e.vxM(14,n.get("quantity").hasError("pattern")&&!n.get("quantity").hasError("min")?14:-1),e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",0)("max",9999999)("formControl",n.get("price")),e.R7$(),e.vxM(18,n.get("price").hasError("min")?18:-1),e.R7$(),e.vxM(19,n.get("price").hasError("required")?19:-1),e.R7$(),e.Y8G("ngClass",e.eq3(24,gf,!n.get("rate").value)),e.R7$(),e.SpI(" ",n.get("rate").value?a.selectedCurrencyIso:n.get("currency").value," "),e.R7$(2),e.SpI(" ",e.i5U(24,21,n.get("pt").value,e.lJ4(26,bf))," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:close")}}function x4(t,r){if(1&t&&(e.j41(0,"div",46)(1,"div",77),e.nrm(2,"div"),e.j41(3,"div",55),e.EFF(4," Servicio "),e.k0s(),e.j41(5,"div",56),e.EFF(6," Cantidad "),e.k0s(),e.j41(7,"div",56),e.EFF(8," Precio "),e.k0s(),e.j41(9,"div",56),e.EFF(10," Moneda "),e.k0s(),e.j41(11,"div",57),e.EFF(12," Total "),e.k0s(),e.j41(13,"div",56),e.EFF(14," Quitar "),e.k0s()(),e.Z7z(15,C4,28,27,"div",78,pf),e.k0s()),2&t){const n=e.XpG(2);e.R7$(15),e.Dyx(n.bidForm.get("assistances").controls)}}function F4(t,r){1&t&&(e.j41(0,"div",72),e.EFF(1," \xa1No ha seleccionado ning\xfan servicio a\xfan! "),e.k0s())}function S4(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",37)(1,"div",74)(2,"mat-form-field",41),e.nrm(3,"mat-icon",22)(4,"input",42),e.j41(5,"mat-autocomplete",43,4),e.bIt("closed",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.searchAssistanceControl.reset())}),e.Z7z(7,g4,5,3,"mat-option",44,e.fX1),e.nI1(9,"async"),e.k0s()(),e.j41(10,"div",75),e.DNE(11,x4,17,0,"div",46)(12,F4,2,0),e.k0s()(),e.j41(13,"div",76),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.createOffer())}),e.EFF(14),e.nI1(15,"number"),e.k0s()()}if(2&t){const n=e.sdS(6),i=e.XpG();e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",i.searchAssistanceControl)("matAutocomplete",n)("placeholder","Buscar servicios en el cat\xe1logo del negocio"),e.R7$(),e.Y8G("displayWith",i.displayFnAssistance),e.R7$(2),e.Dyx(e.bMT(9,11,i.assistancesFiltered)),e.R7$(3),e.Y8G("fuseScrollbarOptions",e.lJ4(16,hf)),e.R7$(),e.vxM(11,i.bidForm.get("assistances").controls.length>0?11:12),e.R7$(2),e.Y8G("ngClass",e.eq3(17,H2,i.bidForm.valid)),e.R7$(),e.Lme(" ",e.i5U(15,13,i.subtotal-i.subtotal*i.bidForm.get("discount").value,"1.2-2")," ",i.selectedCurrencyIso," ")}}let k4=(()=>{class t{constructor(){this.assistances=[],this.assistances$=(0,ie.of)([]),this.audio=new Audio("./assets/sounds/caja.mp3"),this.bidAssistances=!1,this.bidProducts=!1,this.currencies$=(0,ie.of)([]),this.maxDate=new Date,this.multipliers$=(0,ie.of)([]),this.previewsAssistancesFormData=[],this.previewsProductsFormData=[],this.rates=[],this.searchAssistanceControl=new m.MJ(""),this.searchCustomerControl=new m.MJ(null),this.searchProductControl=new m.MJ(null),this.selectedCurrencyIso="",this.selectedCustomerName="",this.subtotal=0,this._bidService=(0,e.WQX)(W2),this._changeDetectorRef=(0,e.WQX)(e.gRc),this._customersService=(0,e.WQX)(Zr.h),this._formBuilder=(0,e.WQX)(m.ok),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._ratesService=(0,e.WQX)(Os.f),this._snackBar=(0,e.WQX)(Oe.UG),this._stocksService=(0,e.WQX)(Bs.t),this._router=(0,e.WQX)(ft.Ix),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.bidForm=this._formBuilder.group({id:new m.MJ,currencyId:new m.MJ(null,[m.k0.required]),customerId:new m.MJ("",[m.k0.required]),discount:new m.MJ(0,[m.k0.required,m.k0.min(0),m.k0.max(100)]),subtotal:new m.MJ(0,[m.k0.required,m.k0.min(0)]),multiplier:new m.MJ(1,[m.k0.required,m.k0.min(1)]),obs:new m.MJ("",[m.k0.maxLength(5e4)]),date:new m.MJ(new Date,[m.k0.required]),rates:new m.MJ([],[m.k0.required]),products:new m.Yp([]),assistances:new m.Yp([])}),this.bidForm.get("products").valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(()=>{this._calculateOfferSubtotal()}),this.currencies$=this.store.select(Pn.y$),this.multipliers$=this.store.select(Ps.DC),this.customers$=this.store.select(Ms.wQ),this.productsInStock$=this.store.select(fr.IP),this.store.select(fr.IP).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.productsInStock=n,n.length>0&&(this.bidProducts=!0),this._changeDetectorRef.markForCheck()}),this.assistances$=this.store.select(It),this.store.select(It).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.assistances=n,n.length>0&&(this.bidAssistances=!0),this._changeDetectorRef.markForCheck()}),this.ratesFiltered=this.bidForm.get("currencyId").valueChanges.pipe((0,Ne.Z)(null),(0,Qe.Z)(n=>n?this._ratesService.findActiveByBaseId(n):(0,ie.of)([]))),this.ratesFiltered.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(500)).subscribe(n=>{this._resetSelectedProductsRates()}),this.bidForm.get("rates").valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this._resetSelectedProductsRates(),this._resetSelectedAssistancesRates()}),this.bidForm.get("multiplier").valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this._calcAllProductPrice(n),this._calcAllAssistancePrice(n),this._calculateOfferSubtotal()}),this.bidForm.get("assistances").valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this._verifyChanges(n,this.previewsAssistancesFormData)&&this._calcAllAssistancePrice(this.bidForm.get("multiplier").value),this.previewsAssistancesFormData=[...n],this._calculateOfferTotal(),this._changeDetectorRef.markForCheck()}),this.productsFiltered=this.searchProductControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>this._mapChecked(null!==n&&"string"==typeof n?this._stocksService.getProductsInStockAvailable(n,10):this.productsInStock$))),this.assistancesFiltered=this.searchAssistanceControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>{const i=this.assistances.filter(a=>a.description.includes(n));return this._mapCheckedAssistances(null!==n&&"string"==typeof n?(0,ie.of)(i):this.assistances$)})),this.customersFiltered=this.searchCustomerControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>null!==n&&"string"==typeof n&&n!==this.selectedCustomerName?this._customersService.findActiveCustomers(n.trim()):this.customers$))}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}displayFn(n){return n&&n.name?n.name:""}selectCustomer(n){this.bidForm.get("customerId").setValue(n.id),this.selectedCustomerName=n.name}addStockProduct(n){const i=this.bidForm.get("currencyId").value,a=structuredClone(this.bidForm.get("rates").value);let o=a.find(l=>l.currencyBaseId===i&&l.currencyRefId===n.currencyId);o||(o=a.find(l=>l.currencyRefId===i),o&&(o.value=1/o.value));const s=this._formBuilder.group({productId:new m.MJ(n.productId,[m.k0.required]),currencyId:new m.MJ(n.currencyId,[m.k0.required]),name:new m.MJ(n.name,[m.k0.required]),price:new m.MJ(n.price,[m.k0.required]),uom:new m.MJ(n.uom,[m.k0.required]),depotId:new m.MJ(n.depotId,[m.k0.required]),depot:new m.MJ(n.depot,[m.k0.required]),currency:new m.MJ(n.currency,[m.k0.required]),stock:new m.MJ(n.quantity,[m.k0.required]),rateId:new m.MJ(o?o.id:null,[m.k0.required]),rate:new m.MJ(o?o.value:null,[m.k0.required]),quantity:new m.MJ(1,[Je.t.onlyNumbersPattern(),m.k0.required,m.k0.min(.1),m.k0.max(n.quantity)])});this.bidForm.get("products").push(s),this._changeDetectorRef.markForCheck()}removeStockProduct(n){this.bidForm.get("products").removeAt(n),this._changeDetectorRef.markForCheck()}addProductToOffer(n){const i=this.bidForm.get("products").getRawValue().findIndex(a=>a.productId===n.productId&&a.depotId===n.depotId);n.checked?(this.removeStockProduct(i),n.checked=!1):n.checked=!0,!(i>-1)&&(this.addStockProduct(n),this.updateSelectedRates())}incrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(+i+1)}decrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(+i-1)}removeProductToOffer(n){this.removeStockProduct(n),this.searchProductControl.reset(),this.updateSelectedRates()}createOffer(){if(this.bidForm.invalid||0===this.bidForm.get("products").controls.length&&0===this.bidForm.get("assistances").controls.length)return;const n=this.bidForm.getRawValue();delete n.id,n.ratesId=n.products.map(a=>a.rateId).filter((a,o,s)=>s.indexOf(a)===o),n.products=n.products.map(a=>({productId:a.productId,quantity:a.quantity,price:a.price})),n.assistances=n.assistances.map(a=>({assistanceId:a.assistanceId,quantity:a.quantity,price:a.price})),n.subtotal=Number(this.subtotal.toFixed(2)),n.total=Number((this.subtotal-n.discount/100*this.subtotal).toFixed(2)),delete n.rates,this._fuseConfirmationService.open({title:"Generar oferta",message:"\xbfEst\xe1 seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{"confirmed"===a&&this._bidService.createOffer(n).pipe((0,T.Q)(this._unsubscribeAll),(0,bt.j)(()=>{this._changeDetectorRef.markForCheck()})).subscribe(({data:o})=>{o&&(this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{title:"Confirmaci\xf3n",message:o.createOffer.message,type:"success",svgIcon:"mat_solid:done"}}),this.audio.play(),this.bidForm.get("products").clear(),this.searchProductControl.reset(),this.searchCustomerControl.reset(),this.bidForm.reset(),this.subtotal=0,this.selectedCustomerName="",this._router.navigateByUrl("/modules/sales/offers"))})})}addAssistance(n){const i=this.bidForm.get("currencyId").value,a=structuredClone(this.bidForm.get("rates").value);let o=a.find(c=>c.currencyBaseId===i&&c.currencyRefId===n.currencyId);!o&&i!==n.currencyId&&(o=a.find(c=>c.currencyRefId===i&&c.currencyRefId!==c.currencyBaseId),o&&(o.value=1/o.value));const s=this.bidForm.get("multiplier").value,l=this._formBuilder.group({assistanceId:new m.MJ(n.id,[m.k0.required]),currencyId:new m.MJ(n.currencyId,[m.k0.required]),description:new m.MJ(n.description,[m.k0.required]),staticPrice:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),price:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),multiplier:new m.MJ(s),quantity:new m.MJ(1,[Je.t.onlyNumbersPattern(),m.k0.required,m.k0.min(1)]),pt:new m.MJ(0),currency:new m.MJ(n.currency.iso,[m.k0.required]),uom:new m.MJ(n.uom.abbr,[m.k0.required]),rateId:new m.MJ(o?o.id:null,[m.k0.required]),rate:new m.MJ(o?o.value:null,[m.k0.required])});this.bidForm.get("assistances").push(l),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}removeAssistance(n){this.bidForm.get("assistances").removeAt(n),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}addAssistanceToBid(n){const i=this.bidForm.get("assistances").getRawValue().findIndex(a=>a.assistanceId===n.id);n.checked?(this.removeAssistance(i),n.checked=!1):n.checked=!0,!(i>-1)&&this.addAssistance(n)}incrementAssistanceQty(n){let i=n.get("quantity").value;n.get("quantity").setValue(++i)}decrementAssistanceQty(n){let i=n.get("quantity").value;n.get("quantity").setValue(--i)}removeAssistanceToBid(n){this.removeAssistance(n),this.searchAssistanceControl.reset()}displayFnAssistance(n){return n&&n.description?n.description:""}updateSelectedRates(){const n=this.bidForm.get("currencyId").value,i=this.bidForm.get("products").getRawValue(),a=this.bidForm.get("assistances").getRawValue();let o=[];for(const l of i)o=[...this.rates.filter(d=>d.currencyBaseId===n&&d.currencyRefId===l.currencyId),...this.rates.filter(d=>d.currencyBaseId===l.currencyId&&d.currencyRefId===n&&d.currencyRefId!==d.currencyBaseId),...o];for(const l of a)o=[...this.rates.filter(d=>d.currencyBaseId===n&&d.currencyRefId===l.currencyId),...this.rates.filter(d=>d.currencyBaseId===l.currencyId&&d.currencyRefId===n&&d.currencyRefId!==d.currencyBaseId),...o];const s=o.reduce((l,c)=>(l.find(d=>d.id===c.id&&d.name===c.name)||l.push(c),l),[]);this.bidForm.get("rates").setValue(s)}_verifyChanges(n,i){for(let a=0;a<n.length;a++)if(n.length!==i.length||n[a].price!==i[a].price||Number(n[a].quantity)!==Number(i[a].quantity))return!0;return!1}_resetSelectedAssistancesRates(){const n=this.bidForm.get("currencyId").value,i=this.bidForm.get("multiplier").value;for(const a of this.bidForm.get("assistances").controls){const o=a.getRawValue(),s=structuredClone(this.bidForm.get("rates").value);let l=s.find(p=>p.currencyBaseId===n&&p.currencyRefId===o.currencyId);!l&&n!==o.currencyId&&(l=s.find(p=>p.currencyRefId===n&&p.currencyRefId!==p.currencyBaseId),l&&(l.value=1/l.value));let c=l?l.value:null;const u=a.get("price").value,d=a.get("staticPrice").value;let f=a.get("rate").value?a.get("rate").value:1;f&&c===f&&(f=1,c=1),a.patchValue({...o,price:(c?u*c:1*u/f)*i,staticPrice:c?d*c:1*d/f,multiplier:i,rate:l?l.value:null,rateId:l?l.id:null})}this._changeDetectorRef.markForCheck()}_calculateOfferSubtotal(){const n=this.bidForm.get("multiplier").value;this.subtotal=this.bidForm.get("products").getRawValue().map(i=>i.quantity*i.price*n*(i.rate?i.rate:1)).reduce((i,a)=>i+a,0)}_calcAllProductPrice(n){const i=this.bidForm.get("products").getRawValue();this.previewsProductsFormData=[...i];for(const a of this.bidForm.get("products").controls){const o=a.getRawValue();let s=o.price/o.multiplier!==o.staticPrice?o.price:o.staticPrice,l=Number((s*n).toFixed(2));n===o.multiplier&&(l=Number((+o.price).toFixed(2)),s=o.price/n),a.patchValue({...o,staticPrice:s,price:l,pt:l*Number(o.quantity),multiplier:n})}}_calcAllAssistancePrice(n){const i=this.bidForm.get("assistances").getRawValue();this.previewsAssistancesFormData=[...i];for(const a of this.bidForm.get("assistances").controls){const o=a.getRawValue();let s=o.price/o.multiplier!==o.staticPrice?o.price:o.staticPrice,l=Number((s*n).toFixed(2));n===o.multiplier&&(l=Number((+o.price).toFixed(2)),s=o.price/n),a.patchValue({...o,staticPrice:s,price:l,pt:l*Number(o.quantity),multiplier:n})}}_calculateOfferTotal(){const n=this.bidForm.get("products").getRawValue().map(a=>Number(a.quantity)*a.price).reduce((a,o)=>a+o,0),i=this.bidForm.get("assistances").getRawValue().map(a=>Number(a.quantity)*a.price).reduce((a,o)=>a+o,0);this.subtotal=Number(n.toFixed(2))+Number(i.toFixed(2))}_mapChecked(n){return n.pipe((0,Fe.T)(i=>i.map(a=>this.bidForm.get("products").getRawValue().some(s=>s.productId===a.productId&&s.depotId===a.depotId)?{...structuredClone(a),checked:!0}:{...structuredClone(a),checked:!1})))}_mapCheckedAssistances(n){return n.pipe((0,Fe.T)(i=>i.map(a=>this.bidForm.get("assistances").getRawValue().some(s=>s.id===a.id)?{...structuredClone(a),checked:!0}:{...structuredClone(a),checked:!1})))}_resetSelectedProductsRates(){const n=this.bidForm.get("currencyId").value,i=structuredClone(this.bidForm.get("rates").value);for(const a of this.bidForm.get("products").controls){let o=i.find(s=>s.currencyBaseId===n&&s.currencyRefId===a.value.currencyId);o||(o=i.find(s=>s.currencyRefId===n),o&&(o.value=1/o.value)),a.get("rate").setValue(o?o.value:null),a.get("rateId").setValue(o?o.id:null)}this._changeDetectorRef.markForCheck()}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-bid"]],standalone:!0,features:[e.aNF],decls:88,vars:50,consts:[["bidNgForm","ngForm"],["customerAutocomplete","matAutocomplete"],["date",""],["productsAutocomplete","matAutocomplete"],["assistancesAutocomplete","matAutocomplete"],["fuseScrollbar","",1,"absolute","inset-0","flex","flex-col","flex-auto","min-w-0",3,"fuseScrollbarOptions"],[1,"relative","flex","flex-col","px-6","py-8","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/desktop",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],["routerLink","/modules/sales/offers",1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","sm:leading-10"],[1,"flex","items-center","gap-2","mt-6","shrink-0","lg:mt-0","lg:ml-4"],["mat-flat-button","",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click","disabled"],[1,"flex","flex-col","px-4","mt-4","mb-12","gap-y-8","sm:px-8"],[1,"col-span-2","shadow","rounded-2xl","bg-card"],[1,"grid","gap-4","p-10","sm:grid-cols-4","lg:grid-cols-7",3,"formGroup"],["appearance","fill",1,"w-full","md:col-span-2","fuse-mat-dense"],["matPrefix","",3,"svgIcon"],["type","text","matInput","",3,"formControl","matAutocomplete","placeholder","required"],[1,"ath-autocomplete",3,"displayWith"],[3,"value"],[1,"w-full","fuse-mat-dense"],["matInput","",3,"matDatepicker","formControlName","max","required"],["matIconSuffix","",3,"for"],[3,"formControlName","required"],[3,"formControlName","required","placeholder"],["multiple","",3,"formControlName","required","placeholder"],[1,"text-sm","opacity-75"],["matInput","","type","number",3,"formControlName","min","max","required"],["matSuffix","",3,"svgIcon"],[1,"w-full","sm:col-span-4","lg:col-span-7","fuse-mat-textarea"],["matInput","",3,"formControlName"],[1,"col-span-4","shadow","rounded-2xl","bg-card"],[3,"click","value"],[1,"w-18"],[1,"p-6"],["appearance","fill",1,"w-full","fuse-mat-dense",3,"subscriptSizing"],["type","text","matInput","",3,"formControl","matAutocomplete","placeholder"],[1,"ath-autocomplete",3,"closed","displayWith"],[1,"w-full",3,"value"],["fuseScrollbar","",1,"flex","flex-col","flex-auto","mt-2","mb-2","min-h-36",3,"fuseScrollbarOptions"],[1,"grid"],[1,"flex","items-center","justify-center","w-full","gap-2","p-2","font-mono","text-3xl","font-semibold","leading-7","text-white","cursor-pointer","rounded-b-2xl","bg-gradient-to-r","from-primary-500","to-primary-700",3,"ngClass"],[1,"w-full",3,"click","value"],[1,"grid","w-full","grid-cols-6",3,"click"],[1,"flex","flex-row","items-center","col-span-5","truncate","md:col-span-3"],["color","primary",3,"checked"],[1,"items-center","hidden","col-span-2","md:flex"],[1,"flex","items-center","text-center"],[1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","billing-products-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-primary","dark:bg-opacity-5"],[1,"text-left"],[1,"text-center"],[1,"text-right"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","billing-products-grid","md:px-8"],[1,"truncate",3,"matTooltip"],[1,"truncate"],[1,"flex","flex-col","justify-center"],[1,"flex","flex-row","items-center","justify-center","gap-2"],["mat-stroked-button","",1,"p-2","leading-6","min-w-7","min-h-7","h-7",3,"click","disabled"],[1,"icon-size-5",3,"svgIcon"],[1,"fuse-mat-dense","fuse-mat-rounded",3,"subscriptSizing"],["matInput","","type","text","name","quantity",1,"font-mono","font-semibold","text-center",3,"min","max","formControl"],[1,"w-full","text-sm","text-center"],[1,"font-mono","text-right"],[3,"ngClass"],[1,"flex","justify-center"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"],[1,"flex","items-center","justify-center","w-full","gap-2","p-2","font-mono","text-3xl","font-semibold","leading-7","text-white","cursor-pointer","rounded-b-2xl","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click","ngClass"],[1,"p-6","pb-0"],["fuseScrollbar","",1,"flex","flex-col","flex-auto","pb-2","mt-2","min-h-24",3,"fuseScrollbarOptions"],[1,"flex","items-center","justify-center","w-full","gap-2","p-2","font-mono","text-3xl","font-semibold","leading-7","text-white","rounded-b-2xl","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click","ngClass"],[1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","billing-assistances-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-primary","dark:bg-opacity-5"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","billing-assistances-grid","md:px-8"],["mat-stroked-button","",1,"p-2","leading-6","min-w-7","min-h-7","h-7",3,"click"],["matInput","","type","text","name","quantity",1,"font-mono","font-semibold","text-center",3,"min","formControl"],[1,"flex","flex-col","items-center","justify-center"],["matInput","","type","number",1,"font-mono","font-semibold","text-center",3,"min","max","formControl"],[1,"text-center",3,"ngClass"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"div")(5,"a",9),e.EFF(6,"Inicio"),e.k0s()(),e.j41(7,"div",10),e.nrm(8,"mat-icon",11),e.j41(9,"a",12),e.EFF(10,"Ventas"),e.k0s()(),e.j41(11,"div",10),e.nrm(12,"mat-icon",11),e.j41(13,"a",13),e.EFF(14,"Cotizaciones"),e.k0s()(),e.j41(15,"div",10),e.nrm(16,"mat-icon",11),e.j41(17,"a",12),e.EFF(18,"Ofertar"),e.k0s()()(),e.j41(19,"div",14)(20,"h2",15),e.EFF(21," Ofertar "),e.k0s()()(),e.j41(22,"div",16)(23,"button",17),e.bIt("click",function(){return e.eBV(o),e.Njj(a.createOffer())}),e.EFF(24," Generar Oferta "),e.k0s()()(),e.j41(25,"div",18)(26,"div",19)(27,"form",20,0)(29,"mat-form-field",21)(30,"mat-label"),e.EFF(31,"Cliente"),e.k0s(),e.nrm(32,"mat-icon",22)(33,"input",23),e.j41(34,"mat-autocomplete",24,1),e.Z7z(36,Z2,2,2,"mat-option",25,e.fX1),e.nI1(38,"async"),e.k0s()(),e.j41(39,"mat-form-field",26)(40,"mat-label"),e.EFF(41,"Fecha de la oferta"),e.k0s(),e.nrm(42,"input",27),e.j41(43,"mat-hint"),e.EFF(44,"DD/MM/YYYY"),e.k0s(),e.nrm(45,"mat-datepicker-toggle",28)(46,"mat-datepicker",null,2),e.DNE(48,K2,2,0,"mat-error"),e.k0s(),e.j41(49,"mat-form-field",26)(50,"mat-label"),e.EFF(51,"Multiplicador"),e.k0s(),e.j41(52,"mat-select",29),e.DNE(53,e4,2,1,"mat-option",25),e.nI1(54,"async"),e.Z7z(55,t4,2,2,"mat-option",25,e.fX1),e.nI1(57,"async"),e.k0s(),e.DNE(58,n4,2,0,"mat-error"),e.k0s(),e.j41(59,"mat-form-field",26)(60,"mat-label"),e.EFF(61,"Moneda"),e.k0s(),e.j41(62,"mat-select",30),e.Z7z(63,r4,2,2,"mat-option",25,e.fX1),e.nI1(65,"async"),e.k0s()(),e.j41(66,"mat-form-field",26)(67,"mat-label"),e.EFF(68,"Tasa de Cambio"),e.k0s(),e.j41(69,"mat-select",31)(70,"mat-select-trigger"),e.EFF(71),e.DNE(72,i4,2,2,"span",32),e.k0s(),e.Z7z(73,a4,6,6,"mat-option",25,e.fX1),e.nI1(75,"async"),e.k0s(),e.DNE(76,o4,2,0,"mat-error"),e.k0s(),e.j41(77,"mat-form-field",26)(78,"mat-label"),e.EFF(79,"Descuento"),e.k0s(),e.nrm(80,"input",33)(81,"mat-icon",34),e.k0s(),e.j41(82,"mat-form-field",35)(83,"mat-label"),e.EFF(84,"Observaciones"),e.k0s(),e.nrm(85,"textarea",36),e.k0s()()(),e.DNE(86,h4,14,12,"div",37)(87,S4,16,19,"div",37),e.k0s()()}if(2&i){let o,s;const l=e.sdS(35),c=e.sdS(47);e.Y8G("fuseScrollbarOptions",e.lJ4(49,Q2)),e.R7$(8),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(7),e.Y8G("disabled",a.bidForm.pristine||a.bidForm.invalid),e.R7$(4),e.Y8G("formGroup",a.bidForm),e.R7$(5),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",a.searchCustomerControl)("matAutocomplete",l)("placeholder","Buscar cliente")("required",!0),e.R7$(),e.Y8G("displayWith",a.displayFn),e.R7$(2),e.Dyx(e.bMT(38,39,a.customersFiltered)),e.R7$(6),e.Y8G("matDatepicker",c)("formControlName","date")("max",a.maxDate)("required",!0),e.R7$(3),e.Y8G("for",c),e.R7$(3),e.vxM(48,a.bidForm.get("date").hasError("required")?48:-1),e.R7$(4),e.Y8G("formControlName","multiplier")("required",!0),e.R7$(),e.vxM(53,0===e.bMT(54,41,a.multipliers$).length?53:-1),e.R7$(2),e.Dyx(e.bMT(57,43,a.multipliers$)),e.R7$(3),e.vxM(58,a.bidForm.get("multiplier").hasError("required")?58:-1),e.R7$(4),e.Y8G("formControlName","currencyId")("required",!0)("placeholder","Moneda"),e.R7$(),e.Dyx(e.bMT(65,45,a.currencies$)),e.R7$(6),e.Y8G("formControlName","rates")("required",!0)("placeholder","Tasa de cambio"),e.R7$(2),e.SpI(" ",(null==(o=a.bidForm.get("rates").value)||null==o[0]?null:o[0].name)||""," "),e.R7$(),e.vxM(72,((null==(s=a.bidForm.get("rates").value)?null:s.length)||0)>1?72:-1),e.R7$(),e.Dyx(e.bMT(75,47,a.ratesFiltered)),e.R7$(3),e.vxM(76,a.bidForm.get("rates").hasError("required")?76:-1),e.R7$(4),e.Y8G("formControlName","discount")("min",0)("max",100)("required",!0),e.R7$(),e.Y8G("svgIcon","mat_solid:percent"),e.R7$(4),e.Y8G("formControlName","obs"),e.R7$(),e.vxM(86,a.bidProducts?86:-1),e.R7$(),e.vxM(87,a.bidAssistances?87:-1)}},dependencies:[U.Jj,U.oe,U.QX,m.YN,m.qT,m.me,m.Q0,m.BC,m.cb,m.YS,m.VZ,m.zX,mr.p,yt.jL,yt.$3,Hr.wT,yt.pN,te.Hl,te.$z,mt.g7,mt.So,Z.X6,Z.Vh,Z.bZ,Z.bU,O.RG,O.rl,O.nJ,O.MV,O.TL,O.JW,O.yw,de.m_,de.An,le.fS,le.fg,ve.Cn,gt.Ve,gt.VO,gt.$2,De.uc,De.oV,U.YU,m.X1,m.l_,m.j4,m.JD,ft.Wk],encapsulation:2,changeDetection:0})}return t})();var Ns=R(29217),vf=R(94425),Gs=R(84713);const $4=X.J1`
    query FindAllBills(
            $page: Int,
            $size: Int,
            $sort: String,
            $order: Order,
            $search: String,
            $customerId: String,
            $currenciesId: [String!],
            $status: [BillStatus!],
            $paymentStatus: [PaymentStatus!],
            $billDate: DateTime,
            $startDate: DateTime,
            $endDate: DateTime
        )
        {
        findAllBills(
            page: $page,
            size: $size,
            sort: $sort,
            order: $order,
            search: $search,
            customerId: $customerId,
            currenciesId: $currenciesId,
            status: $status,
            paymentStatus: $paymentStatus,
            billDate: $billDate,
            startDate: $startDate,
            endDate: $endDate
        ) {
            ok
            message

            pagination {
                length,
                size,
                page,
                lastPage,
                startIndex,
                endIndex
            }

            bills {
                id
                no

                createdAt
                canceledAt
                rejectedAt
                collectedAt
                deliveredAt
                refundedAt
                dispatchedAt

                currencyId
                isDispatched
                currency {
                    iso
                }

                paymentStatus
                status

                customerId
                customer {
                    name
                }

                total

                billDate

                hasProducts
                hasAssistances
                isPromotion

                statusChangeAgo
                paymentStatusChangeAgo
            }
        }
    }
`,I4=X.J1`
    query FindAllBillsByDate($date: String!) {
        findAllBillsByDate(date: $date) {
            ok
            message

            bills {
                id
                no
                createdAt
                currencyId
                currency {
                    iso
                    namev
                }
                currenciesPercents {
                    cup
                    usd
                }

                operationTypeId
                operationType {
                    name
                }

                paymentMethodId
                paymentMethod {
                    name
                }
                paymentStatus

                ratesId

                status
                customerId
                customer {
                    name
                    code
                    address
                    city
                    state
                   phoneNumber {
                        phoneNumber
                        label
                    }

                    email {
                        email
                        label
                    }
                    nit
                }
                commercial {
                    name
                    lastname1
                    lastname2
                }
                total
                totalCup
                totalUsd
                billDate
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                products {
                    productId
                    quantity
                    price
                }

                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }

                vehicle {
                    model
                    registrationNumber
                }

                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                    no
                    currencyId
                    currency {
                        iso
                    }
                    beneficiary
                }
            }
        }
    }
`,w4=X.J1`
    query getBillsByDateRangeAndStatus(
        $initDate: DateTime,
        $endDate: DateTime,
        $status: BillStatus,
        $paymentStatus: PaymentStatus,
        $clientId: String) {
        getBillsByDateRangeAndStatus(
            initDate: $initDate,
            endDate: $endDate,
            status: $status,
            paymentStatus: $paymentStatus,
            clientId: $clientId
            ) {
            ok
            message

            bills {
                id
                no
                createdAt
                collectedAt
                currencyId
                currency {
                    iso
                }

                operationTypeId
                operationType {
                    name
                }

                paymentMethodId
                paymentMethod {
                    name
                }
                paymentStatus

                ratesId

                status
                customerId
                customer {
                    name
                    code
                    address
                    city
                    state
                   phoneNumber {
                        phoneNumber
                        label
                    }

                    email {
                        email
                        label
                    }
                    nit
                }
                commercial {
                    name
                    lastname1
                    lastname2
                }
                total
                totalCup
                totalUsd
                billDate
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                products {
                    productId
                    quantity
                    price
                }
                assistances {
                    assistanceId
                    quantity
                    price
                }

                vehicle {
                    model
                    registrationNumber
                }

                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                     no
                     currencyId
                     currency {
                         iso
                     }
                     beneficiary
                }
            }
        }
    }
`,R4=X.J1`
query FindBillById($findBillById: String!) {
    bill(id: $findBillById) {
        id
        no
        createdAt
        currencyId
        isDispatched
        currency {
            iso
            namev
        }

        operationTypeId
        operationType {
            name
        }
        paymentMethodId
        paymentMethod {
            name
        }
        paymentStatus
        ratesId
        rates {
            name
            value
        }

        status
        customerId
        customer {
            name
            code
            address
            city
            state
            state
            nit

            phoneNumber {
                phoneNumber
                label
            }

            email {
                email
                label
            }
        }

        commercial {
            name
            lastname1
            lastname2
        }

        surcharge
        discount
        obs
        subtotal
        total
        billDate

        userId
        user {
            name
            lastname1
            lastname2
            fullname
        }

        products {
            depotId
            productId
            quantity
            price
            product {
                name
                uom {
                    name
                    abbr
                }
            }
        }

        assistances {
            assistanceId
            quantity
            price
            assistance {
                description
                uom {
                    name
                    abbr
                }
            }
        }

        courierId
        courier {
            id
            name
            fullname
            idNumber
        }

        bankAccountId
        bankAccount {
            no
            currencyId
            currency {
                iso
            }
            beneficiary
        }

        isPromotion

        returns {

            billId

            products {
                productId
                depotId
                quantity
                price
            }

            depotId
            reason
            total
        }

    }
}
`,T4=X.J1`
    mutation CreatedBill($createBillInput: CreateBillInput!) {
        createdBill(createBillInput: $createBillInput) {
            id
            no
            createdAt
            currencyId
            paymentMethodId
            paymentStatus
            products {
                productId
                quantity
                price
            }

            assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
            status
            customerId
            total
            userId
            billDate

            courierId
            courier {
                    id
                    name
                    fullname
                    idNumber
                }

            bankAccount {
                no
                currencyId
                currency {
                    iso
                }
                beneficiary
            }

            isPromotion
        }
    }
`,E4=X.J1`
    mutation UpdateBill($updateBillInput: UpdateBillInput!) {
        updatedBill(updateBillInput: $updateBillInput) {
            id
            no
            createdAt
            currencyId
            paymentMethodId
            paymentStatus
            products {
                productId
                quantity
                price
            }

            assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
            status
            customerId
            total
            userId
            billDate
        }
    }
`,j4=X.J1`
    mutation UpdateBillStatus($updateBillStatusInput: UpdateBillStatusInput!) {
        updateBillStatus(updateBillStatusInput: $updateBillStatusInput) {

            ok
            message

            bill {
                id
                no
                createdAt
                currencyId
                isDispatched
                currency {
                    iso
                }

                paymentStatus
                status

                customerId
                customer {
                    name
                }

                total

                billDate

                hasProducts
                hasAssistances
                isPromotion
            }
        }
    }
`,D4=X.J1`
    mutation ReturnBill($returnBillInput: ReturnBillInput!) {
        returnBill(returnBillInput: $returnBillInput) {
            ok
            message
            bill {
                id
                no
                createdAt
                currencyId
                isDispatched
                currency {
                    iso
                }

                paymentStatus
                status

                customerId
                customer {
                    name
                }

                total

                billDate

                hasProducts
                hasAssistances
                isPromotion
            }
        }
    }
`,A4=X.J1`
    mutation RemoveBill($removeBillId: String!) {
        removeBill(id: $removeBillId)
    }
`,M4=X.J1`
    mutation DispatchBill($billId: String!) {
        dispatchBill(id: $billId) {
            ok
            message

            bill {
                id
                no
                createdAt
                currencyId
                isDispatched
                currency {
                    iso
                }

                paymentStatus
                status

                customerId
                customer {
                    name
                }

                total

                billDate

                products {
                    productId
                    quantity
                    price
                }

                assistances {
                    assistanceId
                    quantity
                    price
                }

                isPromotion
            }
        }
    }
`;let P4=(()=>{class t{constructor(n,i){this.apolloProvider=n,this._snackBar=i,this._apollo=this.apolloProvider.use("BALANC")}createBill(n){return this._apollo.mutate({mutation:T4,variables:{createBillInput:n},errorPolicy:"all"})}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(X.Ic),e.KVO(Oe.UG))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var On=R(21607),Re=R(5864);const Ls=(t,r)=>r.id,B4=()=>({suppressScrollX:!0}),_f=()=>({suppressScrollY:!0}),yf=t=>({"text-warn":t}),Cf=()=>["$"],xf=t=>({"cursor-pointer shadow":t});function O4(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-checkbox",16),e.mxI("ngModelChange",function(a){e.eBV(n);const o=e.XpG();return e.DH7(o.billProducts,a)||(o.billProducts=a),e.Njj(a)}),e.EFF(1,"Productos"),e.k0s(),e.j41(2,"mat-checkbox",16),e.mxI("ngModelChange",function(a){e.eBV(n);const o=e.XpG();return e.DH7(o.billAssistances,a)||(o.billAssistances=a),e.Njj(a)}),e.EFF(3,"Servicios"),e.k0s()}if(2&t){const n=e.XpG();e.R50("ngModel",n.billProducts),e.R7$(2),e.R50("ngModel",n.billAssistances)}}function N4(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",40),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.selectCustomer(a))}),e.EFF(1),e.k0s()}if(2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",n.name," ")}}function G4(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," La fecha de la factura es obligatoria "),e.k0s())}function L4(t,r){1&t&&(e.j41(0,"mat-option",25),e.EFF(1," x1 "),e.k0s()),2&t&&e.Y8G("value",1)}function Y4(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.value),e.R7$(),e.SpI(" x",n.value," ")}}function V4(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El multiplicador es obligatorio "),e.k0s())}function z4(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function q4(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El tipo de comprobante es obligatorio "),e.k0s())}function U4(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function X4(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El tipo de operaci\xf3n es obligatorio "),e.k0s())}function W4(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",40),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.selectedCurrencyIso=a.iso)}),e.EFF(1),e.k0s()}if(2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.iso," ")}}function Q4(t,r){if(1&t&&(e.j41(0,"span",32),e.EFF(1),e.k0s()),2&t){let n;const i=e.XpG();e.R7$(),e.Lme(" (+ ",2===(null==(n=i.billingForm.get("rates").value)?null:n.length)?"otro":"otros"," ",i.billingForm.get("rates").value.length>2?i.billingForm.get("rates").value.length-1:"",") ")}}function J4(t,r){if(1&t&&(e.j41(0,"mat-option",25)(1,"span",41),e.EFF(2),e.nI1(3,"number"),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(2),e.JRh(e.i5U(3,3,n.value,"1.4-4")),e.R7$(3),e.SpI(" ",n.name,"")}}function H4(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," Las tasas de cambio son requeridas "),e.k0s())}function Z4(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.Lme(" ",n.no," ",n.currency.iso," ")}}function K4(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," La cuenta bancaria es obligatorio "),e.k0s())}function e3(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function t3(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",50),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addProductToBill(o),e.Njj(a.stopPropagation())}),e.j41(1,"div",51),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addProductToBill(o),e.Njj(a.stopPropagation())}),e.j41(2,"span",52),e.nrm(3,"mat-checkbox",53),e.EFF(4),e.k0s(),e.j41(5,"span",54),e.EFF(6),e.k0s(),e.j41(7,"span",55),e.EFF(8),e.nI1(9,"number"),e.k0s()()()}if(2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(3),e.Y8G("checked",n.checked),e.R7$(),e.SpI(" ",n.name," "),e.R7$(2),e.JRh(n.depot),e.R7$(2),e.Lme("",e.i5U(9,6,n.quantity,"1.2-2")," ",n.uom,"")}}function n3(t,r){1&t&&(e.j41(0,"mat-error",69),e.EFF(1," Valor m\xednimo 0.1 "),e.k0s())}function r3(t,r){if(1&t&&(e.j41(0,"mat-error",69),e.EFF(1),e.k0s()),2&t){const n=e.XpG().$implicit;e.R7$(),e.SpI(" Valor m\xe1ximo ",n.quantity," ")}}function i3(t,r){1&t&&(e.j41(0,"mat-error",69),e.EFF(1," Patr\xf3n no v\xe1lido "),e.k0s())}function a3(t,r){1&t&&(e.j41(0,"mat-error",69),e.EFF(1," Valor m\xednimo 0 "),e.k0s())}function o3(t,r){1&t&&(e.j41(0,"mat-error",69),e.EFF(1," Valor requerido "),e.k0s())}function s3(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",60)(1,"div"),e.EFF(2),e.k0s(),e.j41(3,"div",61),e.EFF(4),e.k0s(),e.j41(5,"div",62),e.EFF(6),e.k0s(),e.j41(7,"div",58),e.EFF(8),e.nI1(9,"number"),e.k0s(),e.j41(10,"div",63)(11,"div",64)(12,"button",65),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.decrementProductQty(a))}),e.nrm(13,"mat-icon",66),e.k0s(),e.j41(14,"mat-form-field",67),e.nrm(15,"input",68),e.k0s(),e.j41(16,"button",65),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.incrementProductQty(a))}),e.nrm(17,"mat-icon",66),e.k0s()(),e.DNE(18,n3,2,0,"mat-error",69)(19,r3,2,1,"mat-error",69)(20,i3,2,0,"mat-error",69),e.k0s(),e.j41(21,"div",70)(22,"mat-form-field",67),e.nrm(23,"input",71),e.k0s(),e.DNE(24,a3,2,0,"mat-error",69)(25,o3,2,0,"mat-error",69),e.k0s(),e.j41(26,"div",72),e.EFF(27),e.k0s(),e.j41(28,"div",73),e.EFF(29),e.nI1(30,"currency"),e.k0s(),e.j41(31,"div",74)(32,"button",75),e.bIt("click",function(){const a=e.eBV(n).$index,o=e.XpG(3);return e.Njj(o.removeProductToBill(a))}),e.nrm(33,"mat-icon",66),e.k0s()()()}if(2&t){const n=r.$implicit,i=r.$index,a=e.XpG(3);e.R7$(2),e.SpI(" ",i+1," "),e.R7$(),e.Y8G("matTooltip",n.get("name").value),e.R7$(),e.SpI(" ",n.get("name").value," "),e.R7$(2),e.SpI(" ",n.get("depot").value," "),e.R7$(2),e.Lme(" ",e.i5U(9,27,n.get("stock").value,"1.2-2")," ",n.get("uom").value," "),e.R7$(4),e.Y8G("disabled",n.get("quantity").value<=.1||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:remove"),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",.1)("max",n.get("stock").value)("formControl",n.get("quantity")),e.R7$(),e.Y8G("disabled",n.get("quantity").value>=n.get("stock").value||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:add"),e.R7$(),e.vxM(18,n.get("quantity").hasError("min")?18:-1),e.R7$(),e.vxM(19,n.get("quantity").hasError("max")?19:-1),e.R7$(),e.vxM(20,n.get("quantity").hasError("pattern")&&!n.get("quantity").hasError("min")?20:-1),e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",0)("max",9999999)("formControl",n.get("price")),e.R7$(),e.vxM(24,n.get("price").hasError("min")?24:-1),e.R7$(),e.vxM(25,n.get("price").hasError("required")?25:-1),e.R7$(),e.Y8G("ngClass",e.eq3(33,yf,!n.get("rate").value)),e.R7$(),e.SpI(" ",n.get("rate").value?a.selectedCurrencyIso:n.get("currency").value," "),e.R7$(2),e.SpI(" ",e.i5U(30,30,n.get("pt").value,e.lJ4(35,Cf))," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:close")}}function l3(t,r){if(1&t&&(e.j41(0,"div",48)(1,"div",56),e.nrm(2,"div"),e.j41(3,"div",57),e.EFF(4," Producto "),e.k0s(),e.j41(5,"div",57),e.EFF(6," Almac\xe9n "),e.k0s(),e.j41(7,"div",58),e.EFF(8," Disponibilidad "),e.k0s(),e.j41(9,"div",58),e.EFF(10," Cantidad "),e.k0s(),e.j41(11,"div",58),e.EFF(12," Precio "),e.k0s(),e.j41(13,"div",58),e.EFF(14," Moneda "),e.k0s(),e.j41(15,"div",59),e.EFF(16," Total "),e.k0s(),e.j41(17,"div",58),e.EFF(18," Quitar "),e.k0s()(),e.Z7z(19,s3,34,36,"div",60,Ls),e.k0s()),2&t){const n=e.XpG(2);e.R7$(19),e.Dyx(n.billingForm.get("products").controls)}}function c3(t,r){1&t&&(e.j41(0,"div",76),e.EFF(1," \xa1No ha seleccionado ning\xfan producto a\xfan! "),e.k0s())}function u3(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",77),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.createBill())}),e.EFF(1),e.nI1(2,"number"),e.k0s()}if(2&t){const n=e.XpG(2);e.Y8G("ngClass",e.eq3(6,xf,n.billingForm.valid&&n.billingForm.get("products").controls.length>0)),e.R7$(),e.Lme(" ",n.billingForm.get("isPromotion").value?n.total:e.i5U(2,3,n.total-n.billingForm.get("discount").value+n.billingForm.get("surcharge").value,"1.2-2")," ",n.selectedCurrencyIso," ")}}function d3(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",39)(1,"div",42)(2,"mat-form-field",43),e.nrm(3,"mat-icon",22)(4,"input",44),e.j41(5,"mat-autocomplete",45,3),e.bIt("closed",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.searchProductControl.reset())}),e.Z7z(7,t3,10,9,"mat-option",46,e.fX1),e.nI1(9,"async"),e.k0s()(),e.j41(10,"div",47),e.DNE(11,l3,21,0,"div",48)(12,c3,2,0),e.k0s()(),e.DNE(13,u3,3,8,"div",49),e.k0s()}if(2&t){const n=e.sdS(6),i=e.XpG();e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",i.searchProductControl)("matAutocomplete",n)("placeholder","Buscar existencia de productos en inventario"),e.R7$(),e.Y8G("displayWith",i.displayFn),e.R7$(2),e.Dyx(e.bMT(9,9,i.productsFiltered)),e.R7$(3),e.Y8G("fuseScrollbarOptions",e.lJ4(11,_f)),e.R7$(),e.vxM(11,i.billingForm.get("products").controls.length>0?11:12),e.R7$(2),e.vxM(13,i.billAssistances?-1:13)}}function f3(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",50),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addAssistanceToBill(o),e.Njj(a.stopPropagation())}),e.j41(1,"div",51),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addAssistanceToBill(o),e.Njj(a.stopPropagation())}),e.j41(2,"span",52),e.nrm(3,"mat-checkbox",53),e.EFF(4),e.k0s()()()}if(2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(3),e.Y8G("checked",n.checked),e.R7$(),e.SpI(" ",n.description," ")}}function m3(t,r){1&t&&(e.j41(0,"mat-error",69),e.EFF(1," Valor m\xednimo 1 "),e.k0s())}function p3(t,r){1&t&&(e.j41(0,"mat-error",69),e.EFF(1," Patr\xf3n no v\xe1lido "),e.k0s())}function h3(t,r){1&t&&(e.j41(0,"mat-error",69),e.EFF(1," Valor m\xednimo 0 "),e.k0s())}function g3(t,r){1&t&&(e.j41(0,"mat-error",69),e.EFF(1," Valor requerido "),e.k0s())}function b3(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",79)(1,"div"),e.EFF(2),e.k0s(),e.j41(3,"div",61),e.EFF(4),e.k0s(),e.j41(5,"div",63)(6,"div",64)(7,"button",80),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.decrementAssistanceQty(a))}),e.nrm(8,"mat-icon",66),e.k0s(),e.j41(9,"mat-form-field",67),e.nrm(10,"input",81),e.k0s(),e.j41(11,"button",65),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.incrementAssistanceQty(a))}),e.nrm(12,"mat-icon",66),e.k0s()(),e.DNE(13,m3,2,0,"mat-error",69)(14,p3,2,0,"mat-error",69),e.k0s(),e.j41(15,"div",70)(16,"mat-form-field",67),e.nrm(17,"input",71),e.k0s(),e.DNE(18,h3,2,0,"mat-error",69)(19,g3,2,0,"mat-error",69),e.k0s(),e.j41(20,"div",72),e.EFF(21),e.k0s(),e.j41(22,"div",73),e.EFF(23),e.nI1(24,"currency"),e.k0s(),e.j41(25,"div",74)(26,"button",75),e.bIt("click",function(){const a=e.eBV(n).$index,o=e.XpG(3);return e.Njj(o.removeAssistanceToBill(a))}),e.nrm(27,"mat-icon",66),e.k0s()()()}if(2&t){const n=r.$implicit,i=r.$index,a=e.XpG(3);e.R7$(2),e.SpI(" ",i+1," "),e.R7$(),e.Y8G("matTooltip",n.get("description").value),e.R7$(),e.SpI(" ",n.get("description").value," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:remove"),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",1)("formControl",n.get("quantity")),e.R7$(),e.Y8G("disabled",n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:add"),e.R7$(),e.vxM(13,n.get("quantity").hasError("min")?13:-1),e.R7$(),e.vxM(14,n.get("quantity").hasError("pattern")&&!n.get("quantity").hasError("min")?14:-1),e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",0)("max",9999999)("formControl",n.get("price")),e.R7$(),e.vxM(18,n.get("price").hasError("min")?18:-1),e.R7$(),e.vxM(19,n.get("price").hasError("required")?19:-1),e.R7$(),e.Y8G("ngClass",e.eq3(24,yf,!n.get("rate").value)),e.R7$(),e.SpI(" ",n.get("rate").value?a.selectedCurrencyIso:n.get("currency").value," "),e.R7$(2),e.SpI(" ",e.i5U(24,21,n.get("pt").value,e.lJ4(26,Cf))," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:close")}}function v3(t,r){if(1&t&&(e.j41(0,"div",48)(1,"div",78),e.nrm(2,"div"),e.j41(3,"div",57),e.EFF(4," Servicio "),e.k0s(),e.j41(5,"div",58),e.EFF(6," Cantidad "),e.k0s(),e.j41(7,"div",58),e.EFF(8," Precio "),e.k0s(),e.j41(9,"div",58),e.EFF(10," Moneda "),e.k0s(),e.j41(11,"div",59),e.EFF(12," Total "),e.k0s(),e.j41(13,"div",58),e.EFF(14," Quitar "),e.k0s()(),e.Z7z(15,b3,28,27,"div",79,Ls),e.k0s()),2&t){const n=e.XpG(2);e.R7$(15),e.Dyx(n.billingForm.get("assistances").controls)}}function _3(t,r){1&t&&(e.j41(0,"div",76),e.EFF(1," \xa1No ha seleccionado ning\xfan servicio a\xfan! "),e.k0s())}function y3(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",39)(1,"div",42)(2,"mat-form-field",43),e.nrm(3,"mat-icon",22)(4,"input",44),e.j41(5,"mat-autocomplete",45,4),e.bIt("closed",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.searchAssistanceControl.reset())}),e.Z7z(7,f3,5,3,"mat-option",46,e.fX1),e.nI1(9,"async"),e.k0s()(),e.j41(10,"div",47),e.DNE(11,v3,17,0,"div",48)(12,_3,2,0),e.k0s()(),e.j41(13,"div",77),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.createBill())}),e.EFF(14),e.nI1(15,"number"),e.k0s()()}if(2&t){const n=e.sdS(6),i=e.XpG();e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",i.searchAssistanceControl)("matAutocomplete",n)("placeholder","Buscar servicios en el cat\xe1logo del negocio"),e.R7$(),e.Y8G("displayWith",i.displayFnAssistance),e.R7$(2),e.Dyx(e.bMT(9,11,i.assistancesFiltered)),e.R7$(3),e.Y8G("fuseScrollbarOptions",e.lJ4(16,_f)),e.R7$(),e.vxM(11,i.billingForm.get("assistances").controls.length>0?11:12),e.R7$(2),e.Y8G("ngClass",e.eq3(17,xf,i.billingForm.valid)),e.R7$(),e.Lme(" ",i.billingForm.get("isPromotion").value?i.total:e.i5U(15,13,i.total-i.billingForm.get("discount").value+i.billingForm.get("surcharge").value,"1.2-2")," ",i.selectedCurrencyIso," ")}}let C3=(()=>{class t{constructor(){this.assistances=[],this.assistances$=(0,ie.of)([]),this.audio=new Audio("./assets/sounds/caja.mp3"),this.bankAccounts=[],this.billAssistances=!1,this.billProducts=!1,this.currencies=[],this.employees$=(0,ie.of)([]),this.maxDate=new Date,this.merchant=null,this.multipliers$=(0,ie.of)([]),this.operationTypes$=(0,ie.of)([]),this.paymentMethods$=(0,ie.of)([]),this.previewsAssistancesFormData=[],this.previewsProductsFormData=[],this.productsInStock$=(0,ie.of)([]),this.rates=[],this.searchAssistanceControl=new m.MJ(""),this.searchCustomerControl=new m.MJ(null),this.searchProductControl=new m.MJ(null),this.selectedCurrencyIso="",this.selectedCustomerName="",this.stayHere=!1,this.total=0,this._billingService=(0,e.WQX)(P4),this._changeDetectorRef=(0,e.WQX)(e.gRc),this._customersService=(0,e.WQX)(Zr.h),this._destroyRef=(0,e.WQX)(e.abz),this._formBuilder=(0,e.WQX)(m.ok),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._ratesService=(0,e.WQX)(Os.f),this._router=(0,e.WQX)(ft.Ix),this._snackBar=(0,e.WQX)(Oe.UG),this._stocksService=(0,e.WQX)(Bs.t),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.billingForm=this._formBuilder.group({id:new m.MJ,billDate:new m.MJ(new Date,[m.k0.required]),multiplier:new m.MJ(1,[m.k0.required,m.k0.min(1)]),currencyId:new m.MJ(null,[m.k0.required]),courierId:new m.MJ(null),customerId:new m.MJ("",[m.k0.required]),bankAccountId:new m.MJ(null,[m.k0.required]),operationTypeId:new m.MJ(null,[m.k0.required]),paymentMethodId:new m.MJ(null,[m.k0.required]),rates:new m.MJ([],[m.k0.required]),surcharge:new m.MJ(0,[m.k0.required,m.k0.min(0)]),discount:new m.MJ(0,[m.k0.required,m.k0.min(0)]),obs:new m.MJ("",[m.k0.maxLength(5e4)]),products:new m.Yp([]),assistances:new m.Yp([]),isPromotion:new m.MJ(!1)}),this.store.select(At.Xb).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.merchant=n,this.bankAccounts=n.bankAccounts,Re.H.IsNullOrEmpty(n.bankAccounts)||this.billingForm.get("bankAccountId").setValue(n.bankAccounts[0].id),this._changeDetectorRef.markForCheck()}),this.billingForm.get("products").valueChanges.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this._verifyChanges(n,this.previewsProductsFormData)&&this.calcAllProductPrice(this.billingForm.get("multiplier").value),this.previewsProductsFormData=[...n],this._calculateBillTotal(),this.billingForm.get("isPromotion").value&&(this.billingForm.get("discount").setValue(this.total),this.billingForm.get("discount").disable(),this.billingForm.get("surcharge").setValue(0),this.billingForm.get("surcharge").disable(),this.total=0),this._changeDetectorRef.markForCheck()}),this.billingForm.get("assistances").valueChanges.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this._verifyChanges(n,this.previewsAssistancesFormData)&&this.calcAllAssistancePrice(this.billingForm.get("multiplier").value),this.previewsAssistancesFormData=[...n],this._calculateBillTotal(),this._changeDetectorRef.markForCheck()}),this.store.select(Pn.y$).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.currencies=n,Re.H.IsNullOrEmpty(n)||setTimeout(()=>{const i=n.find(a=>a.id===this.merchant.currencyId);this.billingForm.get("currencyId").setValue(i.id)},500),this._changeDetectorRef.markForCheck()}),this.employees$=this.store.select(Ns.OB),this.multipliers$=this.store.select(Ps.DC),this.customers$=this.store.select(Ms.wQ),this.paymentMethods$=this.store.select(Gs.xi),this.paymentMethods$.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{if(!Re.H.IsNullOrEmpty(n)){const i=n.find(a=>"Efectivo"===a.name);this.billingForm.get("paymentMethodId").setValue(i?i.id:n[0].id)}this._changeDetectorRef.markForCheck()}),this.operationTypes$=this.store.select(vf.nK),this.operationTypes$.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{Re.H.IsNullOrEmpty(n)||this.billingForm.get("operationTypeId").setValue(n[0].id),this._changeDetectorRef.markForCheck()}),this.productsInStock$=this.store.select(fr.IP),this.store.select(fr.IP).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.productsInStock=n,n.length>0&&(this.billProducts=!0),this._changeDetectorRef.markForCheck()}),this.assistances$=this.store.select(It),this.store.select(It).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.assistances=n,n.length>0&&(this.billAssistances=!0),this._changeDetectorRef.markForCheck()}),this.ratesFiltered=this.billingForm.get("currencyId").valueChanges.pipe((0,Ne.Z)(null),(0,Qe.Z)(n=>{if(n){const i=this.currencies.find(a=>a.id===n);return this.selectedCurrencyIso=i.iso,i&&(this.bankAccounts=this.merchant.bankAccounts.filter(a=>a.currencyId===i.id)),this.bankAccounts.length>0&&this.billingForm.get("bankAccountId").setValue(this.bankAccounts[0].id),this._ratesService.findActiveByBaseId(n)}return(0,ie.of)([])})),this.ratesFiltered.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.rates=n,this._resetSelectedProductsRates(),this._resetSelectedAssistancesRates(),this.updateSelectedRates()}),this.billingForm.get("rates").valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(500)).subscribe(n=>{this._resetSelectedProductsRates(),this._resetSelectedAssistancesRates()}),this.billingForm.get("multiplier").valueChanges.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.calcAllProductPrice(n),this.calcAllAssistancePrice(n),this._calculateBillTotal()}),this.productsFiltered=this.searchProductControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>this._mapChecked(null!==n&&"string"==typeof n?this._stocksService.getProductsInStockAvailable(n,10):this.productsInStock$))),this.assistancesFiltered=this.searchAssistanceControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>{const i=this.assistances.filter(a=>a.description.includes(n));return this._mapCheckedAssistances(null!==n&&"string"==typeof n?(0,ie.of)(i):this.assistances$)})),this.customersFiltered=this.searchCustomerControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>null!==n&&"string"==typeof n&&n!==this.selectedCustomerName?this._customersService.findActiveCustomers(n.trim()):this.customers$)),this.billingForm.get("isPromotion").valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{n?(this.billingForm.get("surcharge").setValue(0),this.billingForm.get("discount").setValue(this.total),this.billingForm.get("discount").disable(),this.billingForm.get("surcharge").setValue(0),this.billingForm.get("surcharge").disable(),this.total=0):(this.billingForm.get("discount").setValue(0),this.billingForm.get("discount").enable(),this.billingForm.get("surcharge").enable(),this._calculateBillTotal())})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}displayFn(n){return n&&n.name?n.name:""}displayFnAssistance(n){return n&&n.description?n.description:""}selectCustomer(n){this.billingForm.get("customerId").setValue(n.id),this.selectedCustomerName=n.name}addStockProduct(n){const i=this.billingForm.get("currencyId").value,a=structuredClone(this.billingForm.get("rates").value);let o=a.find(c=>c.currencyBaseId===i&&c.currencyRefId===n.currencyId);!o&&i!==n.currencyId&&(o=a.find(c=>c.currencyRefId===i&&c.currencyRefId!==c.currencyBaseId),o&&(o.value=1/o.value));const s=this.billingForm.get("multiplier").value,l=this._formBuilder.group({productId:new m.MJ(n.productId,[m.k0.required]),currencyId:new m.MJ(n.currencyId,[m.k0.required]),name:new m.MJ(n.name,[m.k0.required]),staticPrice:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),price:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),multiplier:new m.MJ(s),pt:new m.MJ(0),uom:new m.MJ(n.uom,[m.k0.required]),depotId:new m.MJ(n.depotId,[m.k0.required]),depot:new m.MJ(n.depot,[m.k0.required]),currency:new m.MJ(n.currency,[m.k0.required]),stock:new m.MJ(n.quantity,[m.k0.required]),rateId:new m.MJ(o?o.id:null,[m.k0.required]),rate:new m.MJ(o?o.value:null,[m.k0.required]),quantity:new m.MJ(1,[Je.t.onlyNumbersPattern(),m.k0.required,m.k0.min(.1),m.k0.max(n.quantity)])});this.billingForm.get("products").push(l),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}removeStockProduct(n){this.billingForm.get("products").removeAt(n),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}addProductToBill(n){const i=this.billingForm.get("products").getRawValue().findIndex(a=>a.productId===n.productId&&a.depotId===n.depotId);n.checked?(this.removeStockProduct(i),n.checked=!1):n.checked=!0,!(i>-1)&&this.addStockProduct(n)}incrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(+i+1)}decrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(+i-1)}removeProductToBill(n){this.removeStockProduct(n),this.searchProductControl.reset()}addAssistance(n){const i=this.billingForm.get("currencyId").value,a=structuredClone(this.billingForm.get("rates").value);let o=a.find(c=>c.currencyBaseId===i&&c.currencyRefId===n.currencyId);!o&&i!==n.currencyId&&(o=a.find(c=>c.currencyRefId===i&&c.currencyRefId!==c.currencyBaseId),o&&(o.value=1/o.value));const s=this.billingForm.get("multiplier").value,l=this._formBuilder.group({assistanceId:new m.MJ(n.id,[m.k0.required]),currencyId:new m.MJ(n.currencyId,[m.k0.required]),description:new m.MJ(n.description,[m.k0.required]),staticPrice:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),price:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),multiplier:new m.MJ(s),quantity:new m.MJ(1,[Je.t.onlyNumbersPattern(),m.k0.required,m.k0.min(1)]),pt:new m.MJ(0),currency:new m.MJ(n.currency.iso,[m.k0.required]),rateId:new m.MJ(o?o.id:null,[m.k0.required]),rate:new m.MJ(o?o.value:null,[m.k0.required])});this.billingForm.get("assistances").push(l),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}removeAssistance(n){this.billingForm.get("assistances").removeAt(n),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}addAssistanceToBill(n){const i=this.billingForm.get("assistances").getRawValue().findIndex(a=>a.assistanceId===n.id);n.checked?(this.removeAssistance(i),n.checked=!1):n.checked=!0,!(i>-1)&&this.addAssistance(n)}incrementAssistanceQty(n){let i=n.get("quantity").value;n.get("quantity").setValue(++i)}decrementAssistanceQty(n){let i=n.get("quantity").value;n.get("quantity").setValue(--i)}removeAssistanceToBill(n){this.removeAssistance(n),this.searchAssistanceControl.reset()}createBill(){if(this.billingForm.invalid)return;if(0===this.billingForm.get("products").controls.length&&0===this.billingForm.get("assistances").controls.length)return void this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{title:"Alerta",message:"Debe agrear al menos un producto o servicio a la factura",type:"warning",svgIcon:"mat_solid:warning"}});let n=this.billingForm.getRawValue();delete n.id;const i=[],a=[];n.ratesId=n.products.map(s=>s.rateId).filter((s,l,c)=>c.indexOf(s)===l);for(const s of n.products)i.push(this._mapProductToBill(s));for(const s of n.assistances)a.push(this._mapAssistanceToBill(s));n.products=i,n.assistances=a,n.subtotal=Number(this.total.toFixed(2)),delete n.rates,this._fuseConfirmationService.open({title:"Generar factura",message:"\xbfEst\xe1 seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,we.pQ)(this._destroyRef)).subscribe(s=>{"confirmed"===s&&this._billingService.createBill(n).pipe((0,T.Q)(this._unsubscribeAll),(0,bt.j)(()=>{this._changeDetectorRef.markForCheck()})).subscribe(({data:l})=>{l&&(this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{title:"Confirmaci\xf3n",message:"Factura registrada correctamente",type:"success",svgIcon:"mat_solid:done"}}),this.audio.play(),this.stayHere?this.restoreForm():this._router.navigateByUrl("/modules/sales/bills"))})})}restoreForm(){const n=this.billingForm.get("paymentMethodId").value,i=this.billingForm.get("operationTypeId").value,a=this.billingForm.get("multiplier").value;if(this.billingForm.get("products").clear(),this.searchCustomerControl.reset(),this.billingForm.reset(),this.total=0,this.selectedCustomerName="",this.searchProductControl.setValue(""),this.billingForm.get("paymentMethodId").setValue(n),this.billingForm.get("operationTypeId").setValue(i),this.billingForm.get("multiplier").setValue(a),this.billingForm.get("billDate").setValue(new Date),this.billingForm.get("observation").setValue(""),this.billingForm.get("surcharge").setValue(0),this.billingForm.get("discount").setValue(0),Re.H.IsNullOrEmpty(this.merchant.bankAccounts)||(this.bankAccounts=this.merchant.bankAccounts,this.billingForm.get("bankAccountId").setValue(this.merchant.bankAccounts[0].id)),!Re.H.IsNullOrEmpty(this.currencies)){const o=this.currencies.find(s=>s.id===this.merchant.currencyId);this.billingForm.get("currencyId").setValue(o.id)}}_mapProductToBill(n){const{productId:i,price:a,depotId:o,quantity:s}=n,l=new On.tz(i,"","",Number(a.toFixed(2)),Number(Number(s).toFixed(4)),o);return delete l.name,delete l.uom,l}_mapAssistanceToBill(n){const{assistanceId:i,price:a,quantity:o}=n;return new On.At(i,a,o)}_calculateBillTotal(){const n=this.billingForm.get("products").getRawValue().map(a=>Number(a.quantity)*a.price).reduce((a,o)=>a+o,0),i=this.billingForm.get("assistances").getRawValue().map(a=>Number(a.quantity)*a.price).reduce((a,o)=>a+o,0);this.total=Number(n.toFixed(2))+Number(i.toFixed(2))}_mapChecked(n){return n.pipe((0,Fe.T)(i=>i.map(a=>this.billingForm.get("products").getRawValue().some(s=>s.productId===a.productId&&s.depotId===a.depotId)?{...structuredClone(a),checked:!0}:{...structuredClone(a),checked:!1})))}_mapCheckedAssistances(n){return n.pipe((0,Fe.T)(i=>i.map(a=>this.billingForm.get("assistances").getRawValue().some(s=>s.id===a.id)?{...structuredClone(a),checked:!0}:{...structuredClone(a),checked:!1})))}_resetSelectedProductsRates(){const n=this.billingForm.get("currencyId").value,i=this.billingForm.get("multiplier").value;for(const a of this.billingForm.get("products").controls){const o=a.getRawValue(),s=structuredClone(this.billingForm.get("rates").value);let l=s.find(p=>p.currencyBaseId===n&&p.currencyRefId===o.currencyId);!l&&n!==o.currencyId&&(l=s.find(p=>p.currencyRefId===n&&p.currencyRefId!==p.currencyBaseId),l&&(l.value=1/l.value));let c=l?l.value:null;const u=a.get("price").value,d=a.get("staticPrice").value;let f=a.get("rate").value?a.get("rate").value:1;f&&c===f&&(f=1,c=1),a.patchValue({...o,price:(c?u*c:1*u/f)*i,staticPrice:c?d*c:1*d/f,multiplier:i,rate:l?l.value:null,rateId:l?l.id:null})}this._changeDetectorRef.markForCheck()}_resetSelectedAssistancesRates(){const n=this.billingForm.get("currencyId").value,i=this.billingForm.get("multiplier").value;for(const a of this.billingForm.get("assistances").controls){const o=a.getRawValue(),s=structuredClone(this.billingForm.get("rates").value);let l=s.find(p=>p.currencyBaseId===n&&p.currencyRefId===o.currencyId);!l&&n!==o.currencyId&&(l=s.find(p=>p.currencyRefId===n&&p.currencyRefId!==p.currencyBaseId),l&&(l.value=1/l.value));let c=l?l.value:null;const u=a.get("price").value,d=a.get("staticPrice").value;let f=a.get("rate").value?a.get("rate").value:1;f&&c===f&&(f=1,c=1),a.patchValue({...o,price:(c?u*c:1*u/f)*i,staticPrice:c?d*c:1*d/f,multiplier:i,rate:l?l.value:null,rateId:l?l.id:null})}this._changeDetectorRef.markForCheck()}calcAllProductPrice(n){const i=this.billingForm.get("products").getRawValue();this.previewsProductsFormData=[...i];for(const a of this.billingForm.get("products").controls){const o=a.getRawValue();let s=o.price/o.multiplier!==o.staticPrice?o.price:o.staticPrice,l=Number((s*n).toFixed(2));n===o.multiplier&&(l=Number((+o.price).toFixed(2)),s=o.price/n),a.patchValue({...o,staticPrice:s,price:l,pt:l*Number(o.quantity),multiplier:n})}}calcAllAssistancePrice(n){const i=this.billingForm.get("assistances").getRawValue();this.previewsAssistancesFormData=[...i];for(const a of this.billingForm.get("assistances").controls){const o=a.getRawValue();let s=o.price/o.multiplier!==o.staticPrice?o.price:o.staticPrice,l=Number((s*n).toFixed(2));n===o.multiplier&&(l=Number((+o.price).toFixed(2)),s=o.price/n),a.patchValue({...o,staticPrice:s,price:l,pt:l*Number(o.quantity),multiplier:n})}}_verifyChanges(n,i){for(let a=0;a<n.length;a++)if(n.length!==i.length||n[a].price!==i[a].price||Number(n[a].quantity)!==Number(i[a].quantity))return!0;return!1}updateSelectedRates(){const n=this.billingForm.get("currencyId").value,i=this.billingForm.get("products").getRawValue();let a=[];for(const s of i)a=[...this.rates.filter(u=>u.currencyBaseId===n&&u.currencyRefId===s.currencyId),...this.rates.filter(u=>u.currencyBaseId===s.currencyId&&u.currencyRefId===n&&u.currencyRefId!==u.currencyBaseId),...a];const o=a.reduce((s,l)=>(s.find(u=>u.id===l.id&&u.name===l.name)||s.push(l),s),[]);this.billingForm.get("rates").setValue(o)}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-billing"]],standalone:!0,features:[e.aNF],decls:128,vars:68,consts:[["billNgForm","ngForm"],["customerAutocomplete","matAutocomplete"],["billDate",""],["productsAutocomplete","matAutocomplete"],["assistancesAutocomplete","matAutocomplete"],["fuseScrollbar","",1,"absolute","inset-0","flex","flex-col","flex-auto","min-w-0",3,"fuseScrollbarOptions"],[1,"relative","flex","flex-col","px-6","py-8","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/desktop",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","sm:leading-10"],[1,"flex","items-center","gap-2","mt-6","shrink-0","lg:mt-0","lg:ml-4"],["color","primary",3,"ngModelChange","ngModel"],["mat-flat-button","",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click","disabled"],[1,"flex","flex-col","px-4","mt-4","mb-12","gap-y-8","sm:px-8"],[1,"col-span-2","shadow","rounded-2xl","bg-card"],[1,"grid","gap-4","p-10","sm:grid-cols-4","lg:grid-cols-5",3,"formGroup"],["appearance","fill",1,"w-full","md:col-span-2","fuse-mat-dense"],["matPrefix","",3,"svgIcon"],["type","text","matInput","",3,"formControl","matAutocomplete","placeholder","required"],[1,"ath-autocomplete",3,"displayWith"],[3,"value"],[1,"w-full","fuse-mat-dense"],["matInput","",3,"matDatepicker","formControlName","max","required"],["matIconSuffix","",3,"for"],[3,"formControlName","required"],[3,"formControlName","required","placeholder"],["multiple","",3,"formControlName","required","placeholder"],[1,"text-sm","opacity-75"],["matInput","","type","number","name","quantity",3,"min","max","formControlName"],[1,"flex","flex-col","gap-3","sm:flex-row","lg:flex-col","sm:col-span-2"],[3,"formControlName"],["formControlName","isPromotion","color","primary"],[1,"w-full","sm:col-span-4","lg:col-span-3","fuse-mat-textarea"],["matInput","",3,"formControlName","rows"],[1,"col-span-4","shadow","rounded-2xl","bg-card"],[3,"click","value"],[1,"w-18"],[1,"p-6","pb-0"],["appearance","fill",1,"w-full","fuse-mat-dense",3,"subscriptSizing"],["type","text","matInput","",3,"formControl","matAutocomplete","placeholder"],[1,"ath-autocomplete",3,"closed","displayWith"],[1,"w-full",3,"value"],["fuseScrollbar","",1,"flex","flex-col","flex-auto","pb-2","mt-2","min-h-36",3,"fuseScrollbarOptions"],[1,"grid"],[1,"flex","items-center","justify-center","w-full","gap-2","p-2","font-mono","text-3xl","font-semibold","leading-7","text-white","rounded-b-2xl","bg-gradient-to-r","from-primary-500","to-primary-700",3,"ngClass"],[1,"w-full",3,"click","value"],[1,"grid","w-full","grid-cols-6",3,"click"],[1,"flex","flex-row","items-center","col-span-5","truncate","md:col-span-3"],["color","primary",3,"checked"],[1,"items-center","hidden","col-span-2","md:flex"],[1,"flex","items-center","text-center"],[1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","billing-products-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-primary","dark:bg-opacity-5"],[1,"text-left"],[1,"text-center"],[1,"text-right"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","billing-products-grid","md:px-8"],[1,"truncate",3,"matTooltip"],[1,"truncate"],[1,"flex","flex-col","justify-center"],[1,"flex","flex-row","items-center","justify-center","gap-2"],["mat-stroked-button","",1,"p-2","leading-6","min-w-7","min-h-7","h-7",3,"click","disabled"],[1,"icon-size-5",3,"svgIcon"],[1,"fuse-mat-dense","fuse-mat-rounded",3,"subscriptSizing"],["matInput","","type","text","name","quantity",1,"font-mono","font-semibold","text-center",3,"min","max","formControl"],[1,"w-full","text-sm","text-center"],[1,"flex","flex-col","items-center","justify-center"],["matInput","","type","number",1,"font-mono","font-semibold","text-center",3,"min","max","formControl"],[1,"text-center",3,"ngClass"],[1,"font-mono","text-right"],[1,"flex","justify-center"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"],[1,"flex","items-center","justify-center","w-full","gap-2","p-2","font-mono","text-3xl","font-semibold","leading-7","text-white","rounded-b-2xl","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click","ngClass"],[1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","billing-assistances-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-primary","dark:bg-opacity-5"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","billing-assistances-grid","md:px-8"],["mat-stroked-button","",1,"p-2","leading-6","min-w-7","min-h-7","h-7",3,"click"],["matInput","","type","text","name","quantity",1,"font-mono","font-semibold","text-center",3,"min","formControl"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"div")(5,"a",9),e.EFF(6,"Inicio"),e.k0s()(),e.j41(7,"div",10),e.nrm(8,"mat-icon",11),e.j41(9,"a",12),e.EFF(10,"Ventas"),e.k0s()(),e.j41(11,"div",10),e.nrm(12,"mat-icon",11),e.j41(13,"a",12),e.EFF(14,"Facturaci\xf3n"),e.k0s()(),e.j41(15,"div",10),e.nrm(16,"mat-icon",11),e.j41(17,"a",12),e.EFF(18,"Facturar"),e.k0s()()(),e.j41(19,"div",13)(20,"h2",14),e.EFF(21," Facturar "),e.k0s()()(),e.j41(22,"div",15),e.DNE(23,O4,4,2),e.j41(24,"mat-checkbox",16),e.mxI("ngModelChange",function(l){return e.eBV(o),e.DH7(a.stayHere,l)||(a.stayHere=l),e.Njj(l)}),e.EFF(25,"Permanecer aqu\xed"),e.k0s(),e.j41(26,"button",17),e.bIt("click",function(){return e.eBV(o),e.Njj(a.createBill())}),e.EFF(27," Generar Factura "),e.k0s()()(),e.j41(28,"div",18)(29,"div",19)(30,"form",20,0)(32,"mat-form-field",21)(33,"mat-label"),e.EFF(34,"Cliente"),e.k0s(),e.nrm(35,"mat-icon",22)(36,"input",23),e.j41(37,"mat-autocomplete",24,1),e.Z7z(39,N4,2,2,"mat-option",25,e.fX1),e.nI1(41,"async"),e.k0s()(),e.j41(42,"mat-form-field",26)(43,"mat-label"),e.EFF(44,"Fecha de la factura"),e.k0s(),e.nrm(45,"input",27),e.j41(46,"mat-hint"),e.EFF(47,"DD/MM/YYYY"),e.k0s(),e.nrm(48,"mat-datepicker-toggle",28)(49,"mat-datepicker",null,2),e.DNE(51,G4,2,0,"mat-error"),e.k0s(),e.j41(52,"mat-form-field",26)(53,"mat-label"),e.EFF(54,"Multiplicador"),e.k0s(),e.j41(55,"mat-select",29),e.DNE(56,L4,2,1,"mat-option",25),e.nI1(57,"async"),e.Z7z(58,Y4,2,2,"mat-option",25,e.fX1),e.nI1(60,"async"),e.k0s(),e.DNE(61,V4,2,0,"mat-error"),e.k0s(),e.j41(62,"mat-form-field",26)(63,"mat-label"),e.EFF(64,"M\xe9todo de pago"),e.k0s(),e.j41(65,"mat-select",29),e.Z7z(66,z4,2,2,"mat-option",25,e.fX1),e.nI1(68,"async"),e.k0s(),e.DNE(69,q4,2,0,"mat-error"),e.k0s(),e.j41(70,"mat-form-field",26)(71,"mat-label"),e.EFF(72,"Tipo de Operaci\xf3n"),e.k0s(),e.j41(73,"mat-select",29),e.Z7z(74,U4,2,2,"mat-option",25,e.fX1),e.nI1(76,"async"),e.k0s(),e.DNE(77,X4,2,0,"mat-error"),e.k0s(),e.j41(78,"mat-form-field",26)(79,"mat-label"),e.EFF(80,"Moneda"),e.k0s(),e.j41(81,"mat-select",30),e.Z7z(82,W4,2,2,"mat-option",25,Ls),e.k0s()(),e.j41(84,"mat-form-field",26)(85,"mat-label"),e.EFF(86,"Tasa de Cambio"),e.k0s(),e.j41(87,"mat-select",31)(88,"mat-select-trigger"),e.EFF(89),e.DNE(90,Q4,2,2,"span",32),e.k0s(),e.Z7z(91,J4,6,6,"mat-option",25,e.fX1),e.nI1(93,"async"),e.k0s(),e.DNE(94,H4,2,0,"mat-error"),e.k0s(),e.j41(95,"mat-form-field",26)(96,"mat-label"),e.EFF(97,"Descuento"),e.k0s(),e.nrm(98,"input",33),e.k0s(),e.j41(99,"mat-form-field",26)(100,"mat-label"),e.EFF(101,"Recargo"),e.k0s(),e.nrm(102,"input",33),e.k0s(),e.j41(103,"div",34)(104,"mat-form-field",26)(105,"mat-label"),e.EFF(106,"Cuenta Bancaria"),e.k0s(),e.j41(107,"mat-select",29),e.Z7z(108,Z4,2,3,"mat-option",25,e.fX1),e.k0s(),e.j41(110,"mat-hint"),e.EFF(111,"Cuentas Bancarias registradas en el negocio"),e.k0s(),e.DNE(112,K4,2,0,"mat-error"),e.k0s(),e.j41(113,"mat-form-field",26)(114,"mat-label"),e.EFF(115,"Transportista"),e.k0s(),e.j41(116,"mat-select",35),e.Z7z(117,e3,2,2,"mat-option",25,e.fX1),e.nI1(119,"async"),e.k0s()(),e.j41(120,"mat-checkbox",36),e.EFF(121,"Promoci\xf3n"),e.k0s()(),e.j41(122,"mat-form-field",37)(123,"mat-label"),e.EFF(124,"Observaciones"),e.k0s(),e.nrm(125,"textarea",38),e.k0s()()(),e.DNE(126,d3,14,12,"div",39)(127,y3,16,19,"div",39),e.k0s()()}if(2&i){let o,s;const l=e.sdS(38),c=e.sdS(50);e.Y8G("fuseScrollbarOptions",e.lJ4(67,B4)),e.R7$(8),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(7),e.vxM(23,a.assistances.length>0&&a.productsInStock.length>0?23:-1),e.R7$(),e.R50("ngModel",a.stayHere),e.R7$(2),e.Y8G("disabled",a.billingForm.invalid),e.R7$(4),e.Y8G("formGroup",a.billingForm),e.R7$(5),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",a.searchCustomerControl)("matAutocomplete",l)("placeholder","Buscar cliente")("required",!0),e.R7$(),e.Y8G("displayWith",a.displayFn),e.R7$(2),e.Dyx(e.bMT(41,53,a.customersFiltered)),e.R7$(6),e.Y8G("matDatepicker",c)("formControlName","billDate")("max",a.maxDate)("required",!0),e.R7$(3),e.Y8G("for",c),e.R7$(3),e.vxM(51,a.billingForm.get("billDate").hasError("required")?51:-1),e.R7$(4),e.Y8G("formControlName","multiplier")("required",!0),e.R7$(),e.vxM(56,0===e.bMT(57,55,a.multipliers$).length?56:-1),e.R7$(2),e.Dyx(e.bMT(60,57,a.multipliers$)),e.R7$(3),e.vxM(61,a.billingForm.get("multiplier").hasError("required")?61:-1),e.R7$(4),e.Y8G("formControlName","paymentMethodId")("required",!0),e.R7$(),e.Dyx(e.bMT(68,59,a.paymentMethods$)),e.R7$(3),e.vxM(69,a.billingForm.get("paymentMethodId").hasError("required")?69:-1),e.R7$(4),e.Y8G("formControlName","operationTypeId")("required",!0),e.R7$(),e.Dyx(e.bMT(76,61,a.operationTypes$)),e.R7$(3),e.vxM(77,a.billingForm.get("operationTypeId").hasError("required")?77:-1),e.R7$(4),e.Y8G("formControlName","currencyId")("required",!0)("placeholder","Moneda"),e.R7$(),e.Dyx(a.currencies),e.R7$(5),e.Y8G("formControlName","rates")("required",!0)("placeholder","Tasa de cambio"),e.R7$(2),e.SpI(" ",(null==(o=a.billingForm.get("rates").value)||null==o[0]?null:o[0].name)||""," "),e.R7$(),e.vxM(90,((null==(s=a.billingForm.get("rates").value)?null:s.length)||0)>1?90:-1),e.R7$(),e.Dyx(e.bMT(93,63,a.ratesFiltered)),e.R7$(3),e.vxM(94,a.billingForm.get("rates").hasError("required")?94:-1),e.R7$(4),e.Y8G("min",0)("max",a.total)("formControlName","discount"),e.R7$(4),e.Y8G("min",0)("max",99999)("formControlName","surcharge"),e.R7$(5),e.Y8G("formControlName","bankAccountId")("required",!0),e.R7$(),e.Dyx(a.bankAccounts),e.R7$(4),e.vxM(112,a.billingForm.get("bankAccountId").hasError("required")?112:-1),e.R7$(4),e.Y8G("formControlName","courierId"),e.R7$(),e.Dyx(e.bMT(119,65,a.employees$)),e.R7$(8),e.Y8G("formControlName","obs")("rows",4),e.R7$(),e.vxM(126,a.billProducts?126:-1),e.R7$(),e.vxM(127,a.billAssistances?127:-1)}},dependencies:[U.Jj,U.oe,U.QX,m.YN,m.qT,m.me,m.Q0,m.BC,m.cb,m.YS,m.VZ,m.zX,m.vS,mr.p,yt.jL,yt.$3,Hr.wT,yt.pN,te.Hl,te.$z,mt.g7,mt.So,Z.X6,Z.Vh,Z.bZ,Z.bU,O.RG,O.rl,O.nJ,O.MV,O.TL,O.JW,O.yw,de.m_,de.An,le.fS,le.fg,ve.Cn,gt.Ve,gt.VO,gt.$2,De.uc,De.oV,U.YU,m.X1,m.l_,m.j4,m.JD,ft.Wk],encapsulation:2,changeDetection:0})}return t})();var pr=R(67376),Qt=R(39409);const Ff=t=>t.bills,na=((0,fe.Mz)(Ff,t=>t.bill),(0,fe.Mz)(Ff,t=>t.bills));let x3=(()=>{class t{constructor(n){this._dialogRef=n,this.dateControl=new m.MJ(null,[m.k0.required])}closeDialog(){this._dialogRef.close()}selectDate(){const n=new Date(this.dateControl.value);this._dialogRef.close(n)}static#e=this.\u0275fac=function(i){return new(i||t)(e.rXU(se.CP))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-bills-date-dialog-select"]],standalone:!0,features:[e.aNF],decls:19,vars:7,consts:[["dp",""],[1,"relative","flex","flex-col","w-full","max-h-screenl"],[1,"flex","flex-col","items-center","px-8","pt-4","space-y-1","text-center","sm:items-start","sm:mt-0","sm:pr-8","sm:text-left"],[1,"text-2xl","text-gray-400"],[1,"flex","flex-col","items-center","flex-auto","w-full","px-8","py-6","sm:flex-row","sm:items-start","sm:pb-8"],[1,"w-full","overflow-hidden"],[1,"flex","flex-col"],["appearance","fill"],["matInput","",3,"matDatepicker","formControl"],["matIconSuffix","",3,"for"],[1,"flex","items-center","px-6","py-4","space-x-3","justify-between","bg-gray-50","dark:bg-black/10"],["mat-stroked-button","",3,"matDialogClose"],["mat-flat-button","",3,"click","color","disabled","matDialogClose"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"h2",3),e.EFF(3," Seleccione la fecha de las facturas que desea exportar "),e.k0s()(),e.j41(4,"div",4)(5,"div",5)(6,"div",6)(7,"mat-form-field",7),e.nrm(8,"input",8),e.j41(9,"mat-hint"),e.EFF(10,"DD/MM/YYYY"),e.k0s(),e.nrm(11,"mat-datepicker-toggle",9)(12,"mat-datepicker",null,0),e.k0s()()()(),e.j41(14,"div",10)(15,"button",11),e.EFF(16," Cancelar "),e.k0s(),e.j41(17,"button",12),e.bIt("click",function(){return e.eBV(o),e.Njj(a.selectDate())}),e.EFF(18," Aceptar "),e.k0s()()()}if(2&i){const o=e.sdS(13);e.R7$(8),e.Y8G("matDatepicker",o)("formControl",a.dateControl),e.R7$(3),e.Y8G("for",o),e.R7$(4),e.Y8G("matDialogClose","cancelled"),e.R7$(2),e.Y8G("color","primary")("disabled",a.dateControl.invalid)("matDialogClose","confirmed")}},dependencies:[O.RG,O.rl,O.MV,O.yw,le.fS,le.fg,Z.X6,Z.Vh,Z.bZ,Z.bU,se.hM,se.tx,te.Hl,te.$z,m.X1,m.me,m.BC,m.l_],encapsulation:2})}return t})();var Ys=R(78357),ra=R(33446);let ia=(()=>{class t{constructor(n,i,a){this.apolloProvider=n,this._snackBar=i,this.store=a,this._apollo=this.apolloProvider.use("BALANC")}getBills(n=0,i=50,a="no",o="desc",s="",l=null,c=[],u=[],d=[],f=null,p=null,h=null){return this._apollo.query({query:$4,errorPolicy:"all",variables:{page:n,size:i,sort:a,order:o,search:s,customerId:l,currenciesId:c,status:u,paymentStatus:d,billDate:f,startDate:p,endDate:h}}).pipe((0,oe.M)(({data:b})=>{b&&this.store.dispatch((0,Qt.zY)({bills:b.findAllBills.bills})),this.store.dispatch((0,Jr.Bp)({pagination:b.findAllBills.pagination}))}))}getBillsByDate(n){return this._apollo.query({query:I4,errorPolicy:"all",variables:{date:n}}).pipe((0,oe.M)(({errors:i})=>{if(i){let a="";i.forEach(o=>a+=`\n ${o.message}.`),this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:a,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}}))}getBillsByDateRangeAndStatus(n,i,a=null,o=null,s=null){return this._apollo.query({query:w4,errorPolicy:"all",variables:{initDate:n,endDate:i,status:a,paymentStatus:o,clientId:s}})}getBillById(n){return this._apollo.query({query:R4,variables:{findBillById:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:a})=>{a&&this.store.dispatch((0,Qt.ST)({bill:a.bill}))}))}updateBill(n){return this.store.select(na).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:E4,variables:{updateBillInput:n},errorPolicy:"all"}).pipe((0,oe.M)(({errors:a,data:o})=>{if(a){let c="";a.forEach(u=>c+=`\n ${u.message}.`),this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:c,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}const s=(0,ra.A)(i);s[i.findIndex(c=>c.id===n.id)]=o.updatedBill,this.store.dispatch((0,Qt.zY)({bills:s}))}))))}updateBillStatus(n,i,a){return this.store.select(na).pipe((0,Be.s)(1),(0,ce.n)(o=>this._apollo.mutate({mutation:j4,variables:{updateBillStatusInput:{id:n,status:i,paymentStatus:a}},errorPolicy:"all"}).pipe((0,oe.M)(({data:s})=>{const l=structuredClone(o);l[o.findIndex(u=>u.id===n)]=s.updateBillStatus.bill,this.store.dispatch((0,Qt.zY)({bills:l}))}))))}returnBill(n){return this._apollo.mutate({mutation:D4,variables:{returnBillInput:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:i})=>{i&&(this.store.dispatch((0,Qt.Ns)({bill:i.returnBill.bill})),this.store.dispatch((0,Qt.ST)({bill:i.returnBill.bill})))}))}removeBill(n){return this.store.select(na).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:A4,variables:{removeBillId:n},errorPolicy:"all"}).pipe((0,oe.M)(({errors:a})=>{if(a){let l="";a.forEach(c=>l+=`\n ${c.message}.`),this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:l,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}const o=(0,ra.A)(i),s=i.findIndex(l=>l.id===n);o.splice(s,1),this.store.dispatch((0,Qt.zY)({bills:o}))}))))}dispatchBill(n){return this._apollo.mutate({mutation:M4,variables:{billId:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:i})=>{i&&this.store.dispatch((0,Qt.Ns)({bill:i.dispatchBill.bill}))}))}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(X.Ic),e.KVO(Oe.UG),e.KVO(fe.il))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var hr=R(56730);let Vs=(()=>{class t{constructor(){Dt.vfs=ff.b.vfs}generateSalesByPeriodReport(n,i,a,o=!0,s=!1){if(o&&n.products.some(d=>null!==d.location&&d.location.name!==n.products[0].location?.name)){const d=n.products.reduce((p,h)=>{const b=h.product.id;return p[b]?p[b].push(h):p[b]=[h],p},{}),f=[...new Set(n.products.map(p=>p.location?.name))];n.products=Object.keys(d).map(p=>{const h=d[p];return{...h[0],location:{name:f.join(", ")},quantity:h.reduce((b,g)=>b+g.quantity,0),costAvg:h.reduce((b,g)=>b+g.costAvg,0)/h.length,priceAvg:h.reduce((b,g)=>b+g.priceAvg,0)/h.length,revenue:h.reduce((b,g)=>b+g.revenue,0),profit:h.reduce((b,g)=>b+g.profit,0)}})}let l=n.products.reduce((u,d)=>{const f=d.location?.name;return u[f]?u[f].push(d):u[f]=[d],u},{});const c={content:[{layout:{hLineWidth:(u,d)=>.5,vLineWidth:(u,d)=>0,hLineColor:(u,d)=>"#eeeeee"},table:{headerRows:1,widths:s?["20%","*","35%"]:["35%","*","*"],body:[[{text:"Documento",style:"table_header_simple",fontSize:8,bold:!0,alignment:"left"},{text:"Per\xedodo",style:"table_header_simple",fontSize:8,bold:!0,colSpan:s?1:2,alignment:"center"},s?{text:"Beneficio",style:"table_header_simple",fontSize:8,bold:!0,alignment:"center"}:{}],[{text:"Productos vendidos",fontSize:10,bold:!0},{text:`${ne(n.startAt).format("DD-MM-yyyy hh:mm a")} al ${ne(n.endAt).format("DD-MM-yyyy hh:mm a")}`,fontSize:10,bold:!0,colSpan:s?1:2,alignment:"center"},s?{text:n.profit.toFixed(2),fontSize:10,bold:!0,alignment:"center"}:{}],[{text:"Total vendido",style:"table_header_simple",fontSize:8,bold:!0,alignment:"left"},{text:"Transferencia",style:"table_header_simple",fontSize:8,bold:!0,alignment:"center"},{text:"Efectivo",style:"table_header_simple",fontSize:8,bold:!0,alignment:"center"}],[{text:n.revenue.toFixed(2),fontSize:10,bold:!0,alignment:"left"},{text:n.cardPaid.toFixed(2),fontSize:10,alignment:"center"},{text:n.cashPaid.toFixed(2),fontSize:10,alignment:"center"}]]}},{table:{headerRows:1,widths:s?["*",42,55,60,100,100]:["45%",50,10,"*","*","*"],body:[[{text:"Producto",style:"table_header",alignment:"left"},{text:"Cantidad",style:"table_header",alignment:"center",colSpan:s?1:2},s?{text:"Costo",style:"table_header",alignment:"right"}:{},{text:"Precio",style:"table_header",alignment:"right"},{text:"Venta",style:"table_header",alignment:"right",colSpan:s?1:2},s?{text:"Beneficio",style:"table_header",alignment:"right",margin:[0,0,10,0]}:{}],...Object.keys(l).map(u=>{const d=[];if(!l.hasOwnProperty(u))return d;!Re.H.IsNullOrEmpty(u)&&"undefined"!==u&&d.push([{text:u.toUpperCase(),colSpan:6,alignment:"center",bold:!0,fontSize:10,fillColor:"whitesmoke"},{},{},{},{},{}]);const f=l[u].sort((p,h)=>p.product.name.localeCompare(h.name));return f.forEach(p=>{d.push([{text:p.product.name,alignment:"left",style:"table_body"},{text:p.quantity,alignment:"center",style:"table_body",colSpan:s?1:2},s?{text:p.costAvg?p.costAvg.toFixed(2):0,alignment:"right",style:"table_body"}:{},{text:p.priceAvg.toFixed(2),alignment:"right",style:"table_body"},{text:p.revenue.toFixed(2),alignment:"right",style:"table_body",colSpan:s?1:2},s?{text:p.profit.toFixed(2),alignment:"right",margin:[0,0,10,0],style:"table_body"}:{}])}),o||d.push([{text:"Subtotales",colSpan:4,style:"table_header",alignment:"left",margin:[10,0,0,0]},{text:"",style:"table_header"},{text:"",style:"table_header"},{text:"",style:"table_header"},{text:f.reduce((p,h)=>p+h.revenue,0).toFixed(2),style:"table_header",alignment:"right",colSpan:s?1:2},s?{text:f.reduce((p,h)=>p+h.profit,0).toFixed(2),style:"table_header",margin:[0,0,10,0],alignment:"right"}:{}]),d}).flat(),[{text:"Totales",colSpan:4,style:"table_header",alignment:"left",margin:[10,0,0,0]},{text:"",style:"table_header"},{text:"",style:"table_header"},{text:"",style:"table_header"},{text:n.products.reduce((u,d)=>u+d.revenue,0).toFixed(2),style:"table_header",alignment:"right",colSpan:s?1:2},s?{text:n.products.reduce((u,d)=>u+d.profit,0).toFixed(2),style:"table_header",margin:[0,0,10,0],alignment:"right"}:{}]]},layout:{hLineWidth:(u,d)=>.7,vLineWidth:(u,d)=>0,hLineColor:(u,d)=>"#eeeeee"},marginTop:20}],footer:(u,d)=>({stack:[u===d?{layout:{hLineWidth:(f,p)=>.7,vLineWidth:(f,p)=>0,hLineColor:(f,p)=>"#eeeeee"},table:{headerRows:1,widths:["*","*","*"],body:[[{style:"table_header_simple",text:"elabora",fontFeatures:["c2sc","smcp"],alignment:"left"},{style:"table_header_simple",text:"",fontFeatures:["c2sc","smcp"],alignment:"left"},{style:"table_header_simple",text:"revisa",fontFeatures:["c2sc","smcp"],alignment:"left"}],[{text:"Nombre y apellidos",bold:!0,fontSize:8,fontFeatures:["c2sc","smcp"]},{text:"",bold:!0,fontSize:8,fontFeatures:["c2sc","smcp"]},{text:"Nombre y apellidos",bold:!0,fontSize:8,fontFeatures:["c2sc","smcp"]}],[{style:"table_header_simple",text:a.employee.fullname,fontSize:10,alignment:"left",fontFeatures:["c2sc","smcp"]},{style:"table_header_simple",text:""},{style:"table_header_simple",text:""}],[{text:"Firma",bold:!0,fontSize:8,fontFeatures:["c2sc","smcp"]},{text:"",bold:!0,fontSize:8,fontFeatures:["c2sc","smcp"]},{text:"Firma",bold:!0,fontSize:8,fontFeatures:["c2sc","smcp"]}],[{style:"table_header_simple",text:" "},{style:"table_header_simple",text:" "},{style:"table_header_simple",text:" "}]]},margin:[40,0,40,0]}:null,{table:{widths:["*","*"],body:[[{text:"Reporte de Productos Vendidos",bold:!0,fontSize:8},{text:`P\xe1gina ${u.toString()}/${d} - Fecha de impresi\xf3n ${ne().format("DD/MM/yyyy HH:mm:ss")}`,bold:!0,fontSize:8,alignment:"right"}]]},margin:u===d?[40,15,40,0]:[40,145,40,0],layout:"noBorders",italics:!0}]}),defaultStyle:{fontSize:12},styles:{header:{fontSize:16,bold:!0,marginBottom:5,alignment:"center",fontFeatures:["c2sc","smcp"]},table_header_simple:{fontSize:8,bold:!0,alignment:"center",fillColor:"#eeeeee"},table_header:{fontSize:10,margin:[0,2,0,2],bold:!0,alignment:"center",fillColor:"#eeeeee"},table_body:{fontSize:10},totals_name:{bold:!0,fillColor:"#eeeeee",alignment:"right",fontFeatures:["c2sc","smcp"],fontSize:10},totals_value:{alignment:"right",bold:!0,fontSize:11}},pageOrientation:"portrait",pageSize:"LETTER",pageMargins:[40,40,40,180],watermark:{text:i.name,color:"#fff",opacity:.07,angle:-35,bold:!0,italics:!1},info:{title:"Reporte de Productos Vendidos",author:a.fullname,creationDate:ne().toDate(),modDate:ne().toDate(),producer:i.name}};Dt.createPdf(c).open()}generateBillsReport(n,i,a,o,s,l=0,c=0,u=new On.G0(0,0,0,0)){const d=`Facturas realizadas de ${ne(n).format("DD/MM/yy")} - ${ne(i).format("DD/MM/yy")}`,f={header:{text:d,style:"header",marginTop:5},content:[{lineHeight:1.3,table:{headerRows:1,widths:[20,80,60,"*",60,60,60,60,60],body:[[{text:"#",style:"table_header"},{text:"N\xba",style:"table_header"},{text:"Fecha",style:"table_header"},{text:"Cliente",style:"table_header",alignment:"left"},{text:"$",style:"table_header"},{text:"Importe",style:"table_header"},{text:"Estado",style:"table_header"},{text:"F. Cobro",style:"table_header"},{text:"Demora",style:"table_header"}],...s.map((p,h)=>[{style:"table_body",text:h+1},{style:"table_body",text:p.no},{style:"table_body",text:ne(p.billDate).format("DD/MM/yy")},{style:"table_body",text:p.customer.name,alignment:"left"},{style:"table_body",text:p.currency.iso},{style:"table_body",text:p.total.toFixed(2),alignment:"right"},{style:"table_body",text:p.paymentStatus.toLocaleUpperCase()},{style:"table_body",text:"pendiente"===p.paymentStatus||void 0===p.collectedAt?"":ne(p.collectedAt).format("DD/MM/yy")},{style:"table_body",text:"pendiente"===p.paymentStatus||void 0===p.collectedAt?ne(p.billDate).fromNow(!0):ne(p.collectedAt).from(ne(p.billDate),!0)}]),[{text:"",style:"table_footer"},{text:"Total",style:"table_footer"},{text:"",style:"table_footer"},{text:"",style:"table_footer"},{text:"CUP",style:"table_footer"},{text:l.toFixed(2),style:"table_footer",alignment:"right"},{text:"",style:"table_footer"},{text:"",style:"table_footer"},{text:"",style:"table_footer"}],[{text:"",style:"table_footer"},{text:"Total",style:"table_footer"},{text:"",style:"table_footer"},{text:"",style:"table_footer"},{text:"USD",style:"table_footer"},{text:c.toFixed(2),style:"table_footer",alignment:"right"},{text:"",style:"table_footer"},{text:"",style:"table_footer"},{text:"",style:"table_footer"}]]},layout:{hLineWidth:(p,h)=>.7,vLineWidth:(p,h)=>0,hLineColor:(p,h)=>"#eeeeee"}}],footer:(p,h)=>({table:{widths:["*","*"],body:[[{text:`Reporte generador por: ${a.fullname} | Esta informaci\xf3n es exclusiva de ${o.name}`,bold:!0,fontSize:8},{text:`P\xe1gina ${p.toString()}/${h} - Fecha de impresi\xf3n ${ne().format("DD/MM/yyyy HH:mm:ss")}`,bold:!0,fontSize:8,alignment:"right"}]]},margin:[30,0,30,0],layout:"noBorders",italics:!0}),defaultStyle:{fontSize:12},styles:{header:{fontSize:18,bold:!0,marginBottom:5,alignment:"center",fontFeatures:["c2sc","smcp"]},table_header:{fontSize:11,bold:!0,alignment:"center",fillColor:"#eeeeee",fontFeatures:["c2sc","smcp"]},table_footer:{fontSize:12,bold:!0,alignment:"center",fillColor:"#eeeeee",fontFeatures:["c2sc","smcp"]},table_body:{fontSize:10,alignment:"center"}},pageOrientation:"landscape",pageSize:"LETTER",watermark:{text:o.name,color:"#fff",opacity:.07,angle:-35,bold:!0,italics:!1},info:{title:d,author:a.fullname,creationDate:ne().toDate(),modDate:ne().toDate(),producer:o.name}};Dt.createPdf(f).open()}generateBillsCollectedByCustomersReport(n,i,a,o,s){const l=[],c=`Facturas Realizadas por Clientes en ${s[0].currency} de ${ne(n).format("DD/MM/yy")} - ${ne(i).format("DD/MM/yy")}`;s.forEach((d,f)=>{const p={lineHeight:1.3,marginTop:10,marginBotton:5,headerRows:1,table:{headerRows:1,widths:["*"],body:[[{text:`Cliente: ${d.customer}`,style:"table_header",alignment:"center"}]]},layout:{hLineWidth:(g,_)=>.7,vLineWidth:(g,_)=>0,hLineColor:(g,_)=>"#eeeeee"}},h=[{columns:[{text:"Total de facturas:",style:"customers_summary"},{text:"Cobradas:",style:"customers_summary"},{text:"Por cobrar:",style:"customers_summary"}]},{columns:[{text:d.totalBills,style:"customers_summary"},{text:d.totalCollected,style:"customers_summary"},{text:d.totalPending,style:"customers_summary"}]},{columns:[{text:`${d.currency} ${d.totalAmount.toFixed(2)}`,style:"customers_summary"},{text:`${d.currency} ${d.totalCollectedAmount.toFixed(2)}`,style:"customers_summary"},{text:`${d.currency} ${d.totalPendingAmount.toFixed(2)}`,style:"customers_summary"}]}],b={lineHeight:1.3,marginTop:10,headerRows:1,table:{headerRows:1,widths:[80,"*",100,80,80],body:[[{text:"Fecha",style:"table_header"},{text:"No. Factura",style:"table_header",alignment:"left"},{text:"Importe",style:"table_header",alignment:"right"},{text:"Estado",style:"table_header"},{text:"Estado de Pago",style:"table_header"}],...d.bills.map(g=>[{text:ne(g.date).format("DD/MM/yy"),style:"table_body"},{text:g.no,style:"table_body",alignment:"left"},{text:g.total.toFixed(2),style:"table_body",alignment:"right"},{text:g.status.toLocaleUpperCase(),style:"table_body"},{text:g.paymentStatus.toLocaleUpperCase(),style:"table_body"}])]},layout:{hLineWidth:(g,_)=>.7,vLineWidth:(g,_)=>0,hLineColor:(g,_)=>"#eeeeee"}};l.push(p,h,b)});const u={header:{text:c,style:"header"},content:l,footer:(d,f)=>({table:{widths:["*","*"],body:[[{text:`Reporte generador por: ${a.fullname} | Esta informaci\xf3n es exclusiva de ${o.name}`,bold:!0,fontSize:8},{text:`P\xe1gina ${d.toString()}/${f} - Fecha de impresi\xf3n ${ne().format("DD/MM/yyyy HH:mm:ss")}`,bold:!0,fontSize:8,alignment:"right"}]]},margin:[30,0,30,0],layout:"noBorders",italics:!0}),defaultStyle:{fontSize:12},styles:{header:{fontSize:16,bold:!0,marginBottom:5,alignment:"center",fontFeatures:["c2sc","smcp"]},customer_name:{fontSize:14,bold:!0,marginTop:20,marginBottom:5,alignment:"center",fillColor:"#bbbbbb",fontFeatures:["c2sc","smcp"]},customers_summary:{fontSize:12,bold:!0,marginBottom:5,alignment:"center",fontFeatures:["c2sc","smcp"]},subheader:{fontSize:14,bold:!0,margin:[0,10,0,5]},table_header:{fontSize:11,bold:!0,alignment:"center",fillColor:"#eeeeee",fontFeatures:["c2sc","smcp"]},table_body:{alignment:"center",fontSize:10}},pageOrientation:"portrait",pageSize:"LETTER",pageMargins:[30,30],watermark:{text:o.name,color:"#fff",opacity:.07,angle:-35,bold:!0,italics:!1},info:{title:c,author:a.fullname,creationDate:ne().toDate(),modDate:ne().toDate(),producer:o.name}};Dt.createPdf(u).open()}generateBillsByCustomersReport(n,i,a,o,s,l=null){const c=[],u=`Facturas ${l?"Cobradas":""} por Clientes en ${s[0].currency} de ${ne(n).format("DD/MM/yy")} - ${ne(i).format("DD/MM/yy")}`;s.forEach(f=>{const p={lineHeight:1.3,marginTop:10,marginBotton:5,headerRows:1,table:{headerRows:1,widths:["*"],body:[[{text:`Cliente: ${f.customer}`,style:"customer_header",alignment:"center"}]]},layout:{hLineWidth:(g,_)=>.7,vLineWidth:(g,_)=>0,hLineColor:(g,_)=>"#a1a1a1"}},h=[{columns:[{text:"Total de facturas:",style:"customers_summary"},{text:`Total ${l?"cobrado":"facturado"}:`,style:"customers_summary"}]},{columns:[{text:f.totalBills,style:"customers_summary"},{text:`${f.currency} ${f.totalAmount.toFixed(2)}`,style:"customers_summary"}]}],b={lineHeight:1.3,marginTop:10,headerRows:1,table:{headerRows:1,widths:[40,80,"*",l?50:100,80,80,l?80:0],body:[[{text:"No.",style:"table_header"},{text:"Fecha",style:"table_header"},{text:"No. Factura",style:"table_header",alignment:"left"},{text:"Importe",style:"table_header",alignment:"right"},{text:"Estado",style:"table_header"},{text:"Estado de Pago",style:"table_header"},{text:l?"F. Cobro":"",style:"table_header"}],...f.bills.map((g,_)=>[{text:_+1,style:"table_body"},{text:ne(g.date).format("DD/MM/yy"),style:"table_body"},{text:g.no,style:"table_body",alignment:"left"},{text:g.total.toFixed(2),style:"table_body",alignment:"right"},{text:g.status.toLocaleUpperCase(),style:"table_body"},{text:g.paymentStatus.toLocaleUpperCase(),style:"table_body"},{text:l?ne(g.collectedAt).format("DD/MM/yy"):"",style:"table_body"}])]},layout:{hLineWidth:(g,_)=>.7,vLineWidth:(g,_)=>0,hLineColor:(g,_)=>"#eeeeee"}};c.push(p,h,b)});const d={header:{text:u,style:"header"},content:c,footer:(f,p)=>({table:{widths:["*","*"],body:[[{text:`Reporte generador por: ${a.fullname} | Esta informaci\xf3n es exclusiva de ${o.name}`,bold:!0,fontSize:8},{text:`P\xe1gina ${f.toString()}/${p} - Fecha de impresi\xf3n ${ne().format("DD/MM/yyyy HH:mm:ss")}`,bold:!0,fontSize:8,alignment:"right"}]]},margin:[30,0,30,0],layout:"noBorders",italics:!0}),defaultStyle:{fontSize:12},styles:{header:{fontSize:16,bold:!0,marginBottom:5,alignment:"center",fontFeatures:["c2sc","smcp"]},customer_name:{fontSize:14,bold:!0,marginTop:20,marginBottom:5,alignment:"center",fillColor:"#eeeeee",fontFeatures:["c2sc","smcp"]},customers_summary:{fontSize:12,bold:!0,marginBottom:5,alignment:"center",fontFeatures:["c2sc","smcp"]},subheader:{fontSize:14,bold:!0,margin:[0,10,0,5]},table_header:{fontSize:11,bold:!0,alignment:"center",fillColor:"#eeeeee",fontFeatures:["c2sc","smcp"]},customer_header:{fontSize:11,bold:!0,alignment:"center",fillColor:"#bbbbbb",fontFeatures:["c2sc","smcp"]},table_body:{alignment:"center",fontSize:10}},pageOrientation:"portrait",pageSize:"LETTER",pageMargins:[30,30],watermark:{text:o.name,color:"#fff",opacity:.07,angle:-35,bold:!0,italics:!1},info:{title:u,author:a.fullname,creationDate:ne().toDate(),modDate:ne().toDate(),producer:o.name}};Dt.createPdf(d).open()}generateProductsBoughtByCustomerReport(n,i,a,o,s){const l=[],c=`Productos comprados por ${s.customer} de ${ne(n).format("DD/MM/yy")} - ${ne(i).format("DD/MM/yy")}`,u={lineHeight:1.3,marginTop:10,headerRows:1,table:{headerRows:1,widths:[20,"*",40,100,80,80],body:[[{text:"No.",style:"table_header"},{text:"Producto",style:"table_header",alignment:"left"},{text:"U",style:"table_header"},{text:"Cantidad",style:"table_header"},{text:"Precio",style:"table_header",alignment:"right"},{text:"Total",style:"table_header",alignment:"right"}],...s.products.map((f,p)=>[{text:p+1,style:"table_body"},{text:f.name,style:"table_body",alignment:"left"},{text:f.uom,style:"table_body"},{text:f.quantity,style:"table_body"},{text:f.price.toFixed(2),style:"table_body",alignment:"right"},{text:(f.quantity*f.price).toFixed(2),style:"table_body",alignment:"right"}])]},layout:{hLineWidth:(f,p)=>.7,vLineWidth:(f,p)=>0,hLineColor:(f,p)=>"#eeeeee"}};l.push(u);const d={header:{text:c,style:"header"},content:l,footer:(f,p)=>({table:{widths:["*","*"],body:[[{text:`Reporte generador por: ${a.fullname} | Esta informaci\xf3n es exclusiva de ${o.name}`,bold:!0,fontSize:8},{text:`P\xe1gina ${f.toString()}/${p} - Fecha de impresi\xf3n ${ne().format("DD/MM/yyyy HH:mm:ss")}`,bold:!0,fontSize:8,alignment:"right"}]]},margin:[30,0,30,0],layout:"noBorders",italics:!0}),defaultStyle:{fontSize:12},styles:{header:{fontSize:16,bold:!0,marginBottom:5,alignment:"center",fontFeatures:["c2sc","smcp"]},customer_name:{fontSize:14,bold:!0,marginTop:20,marginBottom:5,alignment:"center",fillColor:"#eeeeee",fontFeatures:["c2sc","smcp"]},customers_summary:{fontSize:12,bold:!0,marginBottom:5,alignment:"center",fontFeatures:["c2sc","smcp"]},subheader:{fontSize:14,bold:!0,margin:[0,10,0,5]},table_header:{fontSize:11,bold:!0,alignment:"center",fillColor:"#eeeeee",fontFeatures:["c2sc","smcp"]},table_body:{alignment:"center",fontSize:10}},pageOrientation:"portrait",pageSize:"LETTER",pageMargins:[30,30],watermark:{text:o.name,color:"#fff",opacity:.07,angle:-35,bold:!0,italics:!1},info:{title:c,author:a.fullname,creationDate:ne().toDate(),modDate:ne().toDate(),producer:o.name}};Dt.createPdf(d).open()}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var aa=function(t){return t.factura="factura",t.prefactura="prefactura",t.oferta="oferta",t}(aa||{}),F3=R(59649);const S3=t=>({"cursor-not-allowed":t});function k3(t,r){1&t&&(e.j41(0,"mat-error",34),e.EFF(1," Valor m\xednimo 0 "),e.k0s())}function $3(t,r){if(1&t&&(e.j41(0,"mat-error",34),e.EFF(1),e.k0s()),2&t){const n=e.XpG().$implicit;e.R7$(),e.SpI(" Valor m\xe1ximo ",n.quantityPreviews," ")}}function I3(t,r){1&t&&(e.j41(0,"mat-error",34),e.EFF(1," Patr\xf3n no v\xe1lido "),e.k0s())}function w3(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",16)(1,"div",26),e.EFF(2),e.k0s(),e.j41(3,"div",27)(4,"div",28)(5,"button",29),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.decrementProductQty(a))}),e.nrm(6,"mat-icon",30),e.k0s(),e.j41(7,"mat-form-field",31)(8,"span",32),e.EFF(9),e.k0s(),e.nrm(10,"input",33),e.k0s(),e.j41(11,"button",29),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.incrementProductQty(a))}),e.nrm(12,"mat-icon",30),e.k0s()(),e.DNE(13,k3,2,0,"mat-error",34)(14,$3,2,1,"mat-error",34)(15,I3,2,0,"mat-error",34),e.k0s()()}if(2&t){const n=r.$implicit;e.R7$(),e.Y8G("matTooltip",n.get("name").value),e.R7$(),e.SpI(" ",n.get("name").value," "),e.R7$(3),e.Y8G("disabled",n.get("quantity").value<=0||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:remove"),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(2),e.JRh(n.get("uom").value),e.R7$(),e.Y8G("min",0)("max",n.get("quantityPreviews").value)("formControl",n.get("quantity")),e.R7$(),e.Y8G("disabled",n.get("quantity").value>=n.get("quantityPreviews").value||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:add"),e.R7$(),e.vxM(13,n.get("quantity").hasError("min")?13:-1),e.R7$(),e.vxM(14,n.get("quantity").hasError("max")?14:-1),e.R7$(),e.vxM(15,n.get("quantity").hasError("pattern")&&!n.get("quantity").hasError("min")?15:-1)}}function R3(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," EL motivo del rechazo es obligatorio "),e.k0s())}function T3(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," EL motivo del rechazo debe contener entre 3 y 200 caracteres. "),e.k0s())}function E3(t,r){1&t&&(e.j41(0,"span"),e.EFF(1," Aceptar "),e.k0s())}function j3(t,r){1&t&&e.nrm(0,"mat-progress-spinner",25),2&t&&e.Y8G("diameter",24)("mode","indeterminate")}let D3=(()=>{class t{constructor(n){this.data=n,this.isLoading=!1,this.bill=null,this.checkOutControl=new m.MJ(!1),this.billsProducts=[],this.products=[],this.selectedDepot=(0,e.vPA)(null),this.totalAmount=(0,e.vPA)(0),this._changeDetectorRef=(0,e.WQX)(e.gRc),this._billsService=(0,e.WQX)(ia),this._dialogRef=(0,e.WQX)(se.CP),this._formBuilder=(0,e.WQX)(m.ok),this._snackBar=(0,e.WQX)(Oe.UG),this._unsubscribeAll=new Ke.B,this.bill=structuredClone(n),this.products=this.updateReturnsProducts(this.bill.products,this.data.returns.flatMap(i=>i.products)),this.billsProducts=this.groupProductsByProductId(this.products),this.totalAmount.set(Number(this.bill.products.reduce((i,a)=>i+a.quantity*a.price,0).toFixed(2)))}ngOnInit(){const n=this.billsProducts.map(i=>this.createProductFormGroup(i));this.returnForm=this._formBuilder.group({billId:[this.bill.id],products:new m.Yp(n),depotId:[null,[m.k0.required]],reason:["",[m.k0.required,m.k0.maxLength(1e3)]]}),this.returnForm.get("products").valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(i=>{this.totalAmount.set(Number(i.reduce((a,o)=>a+Number(o.quantity)*o.price,0).toFixed(2)))}),this.checkOutControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(i=>{i?(this.returnForm.get("products").controls.forEach((a,o)=>{const s=this.groupProductsByProductId(this.products),l=s.findIndex(c=>c.productId===a.get("productId").value);a.get("quantity").setValue(s[l].quantity)}),this.products=this.returnForm.get("products").getRawValue()):(this.products=this.returnForm.get("products").getRawValue(),this.returnForm.get("products").controls.forEach((a,o)=>{a.get("quantity").setValue(0)}))})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}selectDepot(n){this.selectedDepot.set(n),this.returnForm.get("depotId").setValue(n?.id)}returnBill(n){if("Enter"===n.key&&n.target instanceof HTMLTextAreaElement||this.returnForm.invalid)return;const i=this.returnForm.getRawValue();if(!i.products.some(l=>l.quantity>0))return;const o=[];for(const l of i.products){const c=this.groupProductsByProductAndDepot(this.updateReturnsProducts(this.data.products,this.data.returns.flatMap(d=>d.products))).filter(d=>d.productId===l.productId);let u=l.quantity;for(const d of c)if(u>0){const f=Math.min(u,d.quantity);o.push({productId:d.productId,depotId:d.depotId,price:d.price,quantity:f}),u-=f}}this._billsService.returnBill({billId:i.billId,reason:i.reason,depotId:i.depotId,products:o}).pipe((0,T.Q)(this._unsubscribeAll),(0,bt.j)(()=>{this.isLoading=!1,this._changeDetectorRef.markForCheck()})).subscribe(({data:l})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:l.returnBill.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this._changeDetectorRef.markForCheck(),this.closeDialog()})}incrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(Number(i)+1);const a=this.products.findIndex(o=>o.productId===n.get("productId").value);this.products[a].quantity=Number(i)+1}decrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(Number(i)-1);const a=this.products.findIndex(o=>o.productId===n.get("productId").value);this.products[a].quantity=Number(i)-1}closeDialog(){this._dialogRef.close()}trackByFn(n,i){return i.productId||n}createProductFormGroup(n){return this._formBuilder.group({productId:[n.productId,[m.k0.required]],name:[n.product.name],quantityPreviews:[n.quantity],quantity:[0,[Je.t.onlyNumbersPattern(),m.k0.required,m.k0.min(0),m.k0.max(n.quantity)]],price:[n.price,[m.k0.required]],uom:[n.product.uom.abbr]})}groupProductsByProductId(n){const i=(0,pr.groupBy)(n,o=>o.productId);return Object.keys(i).map(o=>{const s=i[o];return{...s[0],quantity:(0,pr.sumBy)(s,"quantity")}})}groupProductsByProductAndDepot(n){const i=(0,pr.groupBy)(n,o=>`${o.productId}-${o.depotId}`);return Object.keys(i).map(o=>{const s=i[o];return{...s[0],quantity:(0,pr.sumBy)(s,"quantity")}}).sort((o,s)=>s.quantity-o.quantity)}updateReturnsProducts(n,i){return n.map(a=>{const o=i.find(s=>s.productId===a.productId&&s.depotId===a.depotId);return o?{...a,quantity:a.quantity-o.quantity}:a})}static#e=this.\u0275fac=function(i){return new(i||t)(e.rXU(se.Vh))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["bill-return-dialog"]],standalone:!0,features:[e.aNF],decls:39,vars:24,consts:[["refundT",""],[1,"h-full","ng-star-inserted",3,"keydown.enter"],[1,"relative","flex","flex-col","w-full","h-full"],[1,"flex","items-center","h-full"],[1,"block","w-full"],[1,"flex","flex-col","items-center","flex-auto","p-8","pb-4","sm:flex-row","sm:items-start","sm:pb-6"],[1,"flex","flex-col","items-center","mt-4","space-y-1","text-center","sm:items-start","sm:mt-0","sm:pr-8","sm:text-left","ng-star-inserted"],[1,"text-xl","font-medium","leading-6","ng-star-inserted"],[1,"text-secondary","ng-star-inserted"],[1,"flex","flex-col","gap-6","pb-6","pl-8","pr-8","mt-10","sm:mt-0","sm:pl-22",3,"formGroup","autocomplete"],[1,"flex","flex-col"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","grid-cols-2","gap-4","pr-6","pl-2","py-2","font-semibold","shadow","md:pr-8","md:pl-3","text-md","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-10"],["color","primary",3,"formControl"],[1,"font-medium"],[1,"flex","items-center","justify-end","mr-9","h-full"],[1,"overflow-auto","border-b",2,"max-height","40vh"],[1,"flex","items-center","justify-between","border-t","py-2","pr-3"],["labelName","Almac\xe9n de destino",3,"depotChange","isRequired","rounded"],[1,"w-full","mat-fuse-dense","fuse-mat-textarea"],["matPrefix","","svgIcon","mat_solid:subject",1,"hidden","sm:flex","icon-size-5"],["matInput","",3,"formControlName","placeholder","minLength","maxLength","required"],[1,"text-right"],[1,"flex","flex-wrap","justify-center","px-6","py-4","space-x-3","tems-center","bg-gray-50","dark:bg-black","dark:bg-opacity-10","ng-star-inserted"],["mat-stroked-button","",3,"matDialogClose"],["mat-flat-button","","mat-button","",3,"click","color","disabled","ngClass"],[3,"diameter","mode"],[1,"truncate",3,"matTooltip"],[1,"flex","flex-col","justify-center"],[1,"flex","flex-row","items-center","justify-center","gap-2"],["mat-stroked-button","",1,"p-2","leading-6","min-w-7","min-h-7","h-7",3,"click","disabled"],[1,"icon-size-5",3,"svgIcon"],[1,"fuse-mat-dense","fuse-mat-rounded","max-w-22",3,"subscriptSizing"],["matSuffix",""],["matInput","","type","text","name","quantity",1,"font-mono","font-semibold","text-center",3,"min","max","formControl"],[1,"w-full","text-sm","text-center"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",1),e.bIt("keydown.enter",function(l){return e.eBV(o),e.Njj(a.returnBill(l))}),e.j41(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7),e.EFF(7,"Devoluci\xf3n"),e.k0s(),e.j41(8,"div",8),e.EFF(9),e.k0s()()(),e.j41(10,"form",9)(11,"div",10)(12,"div",11)(13,"mat-checkbox",12)(14,"span",13),e.EFF(15,"Productos*"),e.k0s()(),e.j41(16,"div",14)(17,"span"),e.EFF(18,"Cantidades"),e.k0s()()(),e.j41(19,"div",15),e.Z7z(20,w3,16,14,"div",16,a.trackByFn,!0),e.k0s()(),e.j41(22,"autocomplete-depots",17),e.bIt("depotChange",function(l){return e.eBV(o),e.Njj(a.selectDepot(l))}),e.k0s(),e.j41(23,"mat-form-field",18)(24,"mat-label"),e.EFF(25,"Motivo"),e.k0s(),e.nrm(26,"mat-icon",19)(27,"textarea",20,0),e.j41(29,"mat-hint",21),e.EFF(30),e.k0s(),e.DNE(31,R3,2,0,"mat-error")(32,T3,2,0,"mat-error"),e.k0s()()()(),e.j41(33,"div",22)(34,"button",23),e.EFF(35,"Cancelar"),e.k0s(),e.j41(36,"button",24),e.bIt("click",function(l){return e.eBV(o),e.Njj(a.returnBill(l))}),e.DNE(37,E3,2,0,"span")(38,j3,1,2,"mat-progress-spinner",25),e.k0s()()()()}if(2&i){const o=e.sdS(28);e.R7$(9),e.Lme("\xbfEsta seguro que desea efectuar la devoluci\xf3n de las cantidades de la venta # ",a.bill.no," por $",a.totalAmount()," ? "),e.R7$(),e.Y8G("formGroup",a.returnForm)("autocomplete","off"),e.R7$(3),e.Y8G("formControl",a.checkOutControl),e.R7$(7),e.Dyx(a.returnForm.get("products").controls),e.R7$(2),e.Y8G("isRequired",!0)("rounded",!1),e.R7$(5),e.Y8G("formControlName","reason")("placeholder","Escriba el motivo del rechazo")("minLength",3)("maxLength",200)("required",!0),e.R7$(3),e.SpI("Total de caracteres ",o.value.length," / 1000"),e.R7$(),e.vxM(31,a.returnForm.get("reason").hasError("required")?31:-1),e.R7$(),e.vxM(32,a.returnForm.get("reason").hasError("maxlength")||a.returnForm.get("reason").hasError("minlength")?32:-1),e.R7$(2),e.Y8G("matDialogClose",!0),e.R7$(2),e.Y8G("color","primary")("disabled",a.returnForm.invalid)("ngClass",e.eq3(22,S3,a.returnForm.invalid||a.isLoading))("disabled",a.returnForm.invalid||a.isLoading||!a.selectedDepot()),e.R7$(),e.vxM(37,a.isLoading?-1:37),e.R7$(),e.vxM(38,a.isLoading?38:-1)}},dependencies:[te.Hl,te.$z,mt.g7,mt.So,se.hM,se.tx,O.RG,O.rl,O.nJ,O.MV,O.TL,O.JW,O.yw,de.m_,de.An,le.fS,le.fg,ot.D6,ot.LG,De.uc,De.oV,U.YU,m.X1,m.qT,m.me,m.BC,m.cb,m.YS,m.l_,m.j4,m.JD,F3.E],encapsulation:2,changeDetection:0})}return t})();const A3=["billDateFilter"],M3=["customerFilter"],P3=["currencyFilter"],B3=["statusFilter"],O3=["paymentStatusFilter"],N3=()=>({wheelPropagation:!1}),G3=()=>["/modules/bills/dashboard"],L3=()=>["/modules/sales/billing"],Y3=()=>["nueva","entregada","cancelada","rechazada"],V3=()=>["pendiente","cobrada","devuelto","devueltoParcial"],z3=(t,r)=>({"pointer-events-none":t,hidden:r}),q3=()=>[10,25,100],U3=(t,r,n,i)=>({" bg-amber-100  dark:bg-amber-700":t," bg-teal-100  dark:bg-teal-700":r," bg-warn-100  dark:bg-warn-700":n," bg-red-100  dark:bg-red-500 ":i}),X3=(t,r,n,i)=>({"bg-amber-800  dark:bg-black ":t,"bg-teal-800 dark:bg-teal-50":r,"bg-warn-800 dark:bg-warn-50  ":n,"bg-red-800  dark:bg-red-50 ":i}),W3=(t,r,n,i)=>({"text-amber-800  dark:text-amber-50 ":t,"text-teal-800  dark:text-teal-50 ":r,"text-warn-800  dark:text-warn-50 ":n,"text-red-800  dark:red-50 ":i}),Q3=(t,r,n,i,a,o)=>({" bg-teal-100  dark:bg-teal-700":t," bg-green-100  dark:bg-green-700":r," bg-blue-100  dark:bg-blue-700":n," bg-violet-50  dark:bg-violet-700":i," bg-violet-100  dark:bg-violet-700 ":a," bg-amber-100  dark:bg-amber-700":o}),J3=(t,r,n,i,a,o)=>({"bg-teal-800 dark:bg-teal-50":t,"bg-green-800 dark:bg-green-50  ":r,"bg-blue-800  dark:bg-white ":n,"bg-violet-800  dark:bg-violet-50 ":i,"bg-violet-500  dark:bg-violet-50 ":a,"bg-amber-800  dark:bg-black ":o}),H3=(t,r,n,i,a,o)=>({"text-teal-800 bg-teal-100 dark:text-teal-50 ":t,"text-green-800  dark:text-green-50 ":r,"text-blue-800  dark:text-white ":n,"text-violet-800  dark:text-violet-50 ":i,"text-violet-500  dark:text-violet-50 ":a,"text-amber-800  dark:text-black ":o});function Z3(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-icon",40),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.range.reset())}),e.k0s()}}function K3(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",77),e.bIt("click",function(){e.eBV(n);const a=e.XpG().$implicit,o=e.XpG(3);return e.Njj(o.return(a.id))}),e.nrm(1,"mat-icon",78),e.k0s()}if(2&t){const n=e.XpG().$implicit,i=e.XpG(3);e.Y8G("disabled",i.isLoading||"devuelto"===n.paymentStatus||"cancelada"===n.status||!n.isDispatched||0===n.hasProducts)}}function e7(t,r){1&t&&e.nrm(0,"mat-icon",79)}function t7(t,r){1&t&&e.nrm(0,"mat-icon",69),2&t&&e.Y8G("svgIcon","mat_solid:done")}function n7(t,r){1&t&&e.nrm(0,"mat-icon",69),2&t&&e.Y8G("svgIcon","mat_solid:done")}function r7(t,r){1&t&&e.nrm(0,"mat-icon",69),2&t&&e.Y8G("svgIcon","mat_solid:done")}function i7(t,r){1&t&&e.nrm(0,"mat-icon",69),2&t&&e.Y8G("svgIcon","mat_solid:done")}function a7(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",56)(1,"div",57),e.EFF(2),e.k0s(),e.j41(3,"div",58),e.EFF(4),e.nI1(5,"date"),e.k0s(),e.j41(6,"div",33),e.EFF(7),e.k0s(),e.j41(8,"div",59)(9,"span",57),e.EFF(10),e.nI1(11,"number"),e.k0s(),e.j41(12,"span",60),e.EFF(13),e.k0s()(),e.j41(14,"div",61)(15,"div",62)(16,"div",63)(17,"span",64),e.nrm(18,"span",65),e.k0s(),e.j41(19,"span",66),e.EFF(20),e.nI1(21,"uppercase"),e.k0s()(),e.j41(22,"span",60),e.EFF(23),e.k0s()()(),e.j41(24,"div",61)(25,"div",62)(26,"div",63)(27,"span",64),e.nrm(28,"span",65),e.k0s(),e.j41(29,"span",66),e.EFF(30),e.nI1(31,"uppercase"),e.k0s()(),e.j41(32,"span",60),e.EFF(33),e.k0s()()(),e.j41(34,"div",67)(35,"button",68),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.generateBillDocument(a.id))}),e.nrm(36,"mat-icon",69),e.k0s(),e.j41(37,"button",70),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.dispatchBill(a.id))}),e.nrm(38,"mat-icon",69),e.k0s(),e.DNE(39,K3,2,1,"button",71)(40,e7,1,0),e.j41(41,"div")(42,"button",72),e.nrm(43,"mat-icon",69),e.k0s(),e.j41(44,"mat-menu",null,7)(46,"div",73),e.EFF(47," Actualizar Estado "),e.k0s(),e.j41(48,"button",74),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.updateStatus(a.id,"entregada"))}),e.j41(49,"div",75),e.DNE(50,t7,1,1,"mat-icon",69),e.k0s(),e.j41(51,"span",76),e.EFF(52,"Entregada"),e.k0s()(),e.j41(53,"button",74),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.updateStatus(a.id,null,"cobrada"))}),e.j41(54,"div",75),e.DNE(55,n7,1,1,"mat-icon",69),e.k0s(),e.j41(56,"span",76),e.EFF(57,"Cobrada"),e.k0s()(),e.j41(58,"button",74),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.updateStatus(a.id,"cancelada"))}),e.j41(59,"div",75),e.DNE(60,r7,1,1,"mat-icon",69),e.k0s(),e.j41(61,"span",76),e.EFF(62,"Cancelada"),e.k0s()(),e.j41(63,"button",74),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.updateStatus(a.id,"rechazada"))}),e.j41(64,"div",75),e.DNE(65,i7,1,1,"mat-icon",69),e.k0s(),e.j41(66,"span",76),e.EFF(67,"Rechazada"),e.k0s()()()()()()}if(2&t){const n=r.$implicit,i=e.sdS(45);e.R7$(2),e.SpI(" ",n.no," "),e.R7$(2),e.SpI(" ",e.i5U(5,30,n.createdAt,"dd/MM/YY hh:mm a")," "),e.R7$(3),e.SpI(" ",n.customer.name," "),e.R7$(3),e.JRh(e.i5U(11,33,n.total,"1.2-2")),e.R7$(3),e.JRh(n.currency.iso),e.R7$(4),e.Y8G("ngClass",e.ziG(40,U3,"nueva"==n.status,"entregada"===n.status,"rechazada"===n.status,"cancelada"===n.status)),e.R7$(),e.Y8G("ngClass",e.ziG(45,X3,"nueva"===n.status,"entregada"===n.status,"rechazada"===n.status,"cancelada"===n.status)),e.R7$(),e.Y8G("ngClass",e.ziG(50,W3,"nueva"===n.status,"entregada"===n.status,"rechazada"===n.status,"cancelada"===n.status)),e.R7$(),e.SpI(" ",e.bMT(21,36,n.status)," "),e.R7$(3),e.JRh(n.paymentStatusChangeAgo),e.R7$(4),e.Y8G("ngClass",e.l4e(55,Q3,"parcial"===n.paymentStatus,"cobrada"===n.paymentStatus,"pendiente"===n.paymentStatus,"devueltoParcial"===n.paymentStatus,"devuelto"===n.paymentStatus,"dPendiente"===n.paymentStatus)),e.R7$(),e.Y8G("ngClass",e.l4e(62,J3,"parcial"===n.paymentStatus,"pagada"===n.paymentStatus,"pendiente"===n.paymentStatus,"devuelto"===n.paymentStatus,"devueltoParcial"===n.paymentStatus,"dPendiente"===n.paymentStatus)),e.R7$(),e.Y8G("ngClass",e.l4e(69,H3,"parcial"===n.paymentStatus,"cobrada"===n.paymentStatus,"pendiente"===n.paymentStatus,"devuelto"===n.paymentStatus,"devueltoParcial"===n.paymentStatus,"dPendiente"===n.paymentStatus)),e.R7$(),e.SpI(" ",e.bMT(31,38,"cancelada"!==n.status?"devueltoParcial"===n.paymentStatus?"devuelto":n.paymentStatus:n.status)," "),e.R7$(3),e.JRh(n.paymentStatusChangeAgo),e.R7$(3),e.Y8G("svgIcon","mat_solid:description"),e.R7$(),e.Y8G("disabled",0===n.hasProducts||n.isDispatched||n.status.includes("cancelada")||n.status.includes("rechazada")),e.R7$(),e.Y8G("svgIcon","mat_solid:logout"),e.R7$(),e.vxM(39,n.isPromotion?40:39),e.R7$(3),e.Y8G("matMenuTriggerFor",i)("disabled",n.paymentStatus.includes("cobrada")||n.status.includes("cancelada")||n.status.includes("rechazada")),e.R7$(),e.Y8G("svgIcon","mat_solid:update"),e.R7$(5),e.Y8G("disabled",n.status.includes("entregada")||n.status.includes("cancelada")||n.status.includes("rechazada")||n.paymentStatus.includes("cobrada")),e.R7$(2),e.vxM(50,n.status.includes("entregada")?50:-1),e.R7$(3),e.Y8G("disabled",n.paymentStatus.includes("cobrada")||n.status.includes("cancelada")||n.status.includes("rechazada")),e.R7$(2),e.vxM(55,n.paymentStatus.includes("cobrada")?55:-1),e.R7$(3),e.Y8G("disabled",n.paymentStatus.includes("cobrada")||n.status.includes("rechazada")||n.status.includes("cancelada")),e.R7$(2),e.vxM(60,n.status.includes("cancelada")?60:-1),e.R7$(3),e.Y8G("disabled",n.paymentStatus.includes("cobrada")||n.status.includes("cancelada")||n.status.includes("rechazada")),e.R7$(2),e.vxM(65,n.status.includes("rechazada")?65:-1)}}function o7(t,r){if(1&t&&e.Z7z(0,a7,68,76,"div",56,e.BUC().trackByFn,!0),2&t){const n=e.XpG();e.Dyx(n)}}function s7(t,r){1&t&&(e.j41(0,"div",80),e.EFF(1," \xa1No se ha registrado ninguna factura! "),e.k0s())}function l7(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",39)(1,"div",41)(2,"div",42)(3,"span"),e.EFF(4,"No."),e.k0s()(),e.j41(5,"div",43)(6,"span",44),e.EFF(7,"Fecha"),e.k0s(),e.j41(8,"table-filter",45,2),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addDate(a))}),e.k0s()(),e.j41(10,"div",46)(11,"span"),e.EFF(12,"Cliente"),e.k0s(),e.j41(13,"table-filter",47,3),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addCustomer(a))}),e.k0s()(),e.j41(15,"div",48)(16,"span",44),e.EFF(17,"Importe"),e.k0s(),e.j41(18,"table-filter",49,4),e.nI1(20,"async"),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addCurrencies(a))}),e.k0s()(),e.j41(21,"div",43)(22,"span",44),e.EFF(23,"Estado"),e.k0s(),e.j41(24,"table-filter",50,5),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addStatus(a))}),e.k0s()(),e.j41(26,"div",43)(27,"span",51),e.EFF(28,"E.Cobro"),e.k0s(),e.j41(29,"table-filter",50,6),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addPaymentStatus(a))}),e.k0s()(),e.j41(31,"div",52)(32,"span"),e.EFF(33,"Acciones"),e.k0s(),e.j41(34,"button",53),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.clearTableFilters())}),e.nrm(35,"mat-icon",54),e.k0s()()(),e.DNE(36,o7,2,0)(37,s7,2,0),e.nrm(38,"mat-paginator",55),e.k0s()}if(2&t){const n=e.XpG();e.R7$(2),e.Y8G("mat-sort-header","no"),e.R7$(4),e.Y8G("mat-sort-header","billDate"),e.R7$(2),e.Y8G("filterType","date"),e.R7$(5),e.Y8G("filterType","filterEntity")("searchEntityControl",n.searchCustomersControl)("entitiesFiltered",n.customersFiltered),e.R7$(3),e.Y8G("mat-sort-header","total"),e.R7$(2),e.Y8G("filterType","multiSelectEntity")("entityPropertyName","iso")("useUpperCase",!0)("data",e.bMT(20,26,n.currencies$)),e.R7$(4),e.Y8G("mat-sort-header","status"),e.R7$(2),e.Y8G("filterType","multiSelect")("data",e.lJ4(28,Y3)),e.R7$(3),e.Y8G("mat-sort-header","paymentStatus"),e.R7$(2),e.Y8G("filterType","multiSelect")("data",e.lJ4(29,V3)),e.R7$(5),e.Y8G("disabled",!n.existTableFilter()),e.R7$(),e.Y8G("svgIcon","mat_solid:filter_list_off"),e.R7$(),e.vxM(36,r.length>0?36:37),e.R7$(2),e.Y8G("ngClass",e.l_i(30,z3,n.isLoading,n.pagination.length<10&&n.pagination.page<1))("length",n.pagination.length)("pageIndex",n.pagination.page)("pageSize",n.pagination.size)("pageSizeOptions",e.lJ4(33,q3))("showFirstLastButtons",!0)}}let c7=(()=>{class t{constructor(){this.bills$=(0,ie.of)([]),this.currencies$=(0,ie.of)([]),this.isLoading=!1,this.isSlideLoading=!1,this.merchant=null,this.merchantLogo=null,this.maxDate=new Date,this.range=new m.gE({start:new m.MJ({disabled:!1,value:null},[Je.t.futureDateValidator()]),end:new m.MJ({disabled:!1,value:null},[Je.t.futureDateValidator()])}),this.searchCustomersControl=new m.MJ(null),this.searchInputControl=new m.MJ,this.filterInputControl=new m.MJ,this.selectedCustomer=null,this.selectedDate=null,this.selectedCurrenciesId=[],this.selectedStatus=[],this.selectedPaymentStatus=[],this.selectedSlide=null,this.user=null,this._billsService=(0,e.WQX)(ia),this._changeDetectorRef=(0,e.WQX)(e.gRc),this._customersService=(0,e.WQX)(Zr.h),this._dialog=(0,e.WQX)(se.bZ),this._documentsService=(0,e.WQX)(hr.Q),this._fileSaverService=(0,e.WQX)(As.f),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._salesReportsService=(0,e.WQX)(Vs),this._snackBar=(0,e.WQX)(Oe.UG),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.store.select(bn.SW).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.user=n,this._changeDetectorRef.markForCheck()}),this.currencies$=this.store.select(Pn.y$),this.store.select(At.Xb).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.merchant=n,this._changeDetectorRef.markForCheck()}),this.bills$=this.store.select(na),this.customersFiltered=this.searchCustomersControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,bt.j)(()=>{this.isLoading=!1}),(0,Qe.Z)(n=>null!==n&&"string"==typeof n&&(this.selectedCustomer&&n!==this.selectedCustomer.name||!this.selectedCustomer)?(this.isLoading=!0,this._customersService.findActiveCustomers(n.trim())):(0,ie.of)())),this.store.select(Mn.Dz).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.pagination=n,this._changeDetectorRef.markForCheck()}),this.searchInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,ce.n)(n=>(this.isLoading=!0,this._billsService.getBills(0,25,"no","desc",n,this.selectedCustomer?this.selectedCustomer.id:null,this.selectedCurrenciesId,this.selectedStatus,this.selectedPaymentStatus,this.selectedDate,this.range.get("start").value,this.range.get("end").value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe(),this.filterInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,ce.n)(n=>(this.isLoading=!0,this._billsService.getBills(0,25,"no","desc",this.searchInputControl.value,this.selectedCustomer?this.selectedCustomer.id:null,this.selectedCurrenciesId,this.selectedStatus,this.selectedPaymentStatus,this.selectedDate,this.range.get("start").value,this.range.get("end").value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe(),this.range.valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.billDateFilter.clearFilter(),this._billsService.getBills(0,this.pagination.size,"no","desc",this.searchInputControl.value,this.selectedCustomer?this.selectedCustomer.id:null,this.selectedCurrenciesId,this.selectedStatus,this.selectedPaymentStatus,null,n.start,n.end).pipe((0,T.Q)(this._unsubscribeAll)).subscribe()})}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"no",start:"desc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,An.h)(this._sort.sortChange,this._paginator.page).pipe((0,ce.n)(()=>(this.isLoading=!0,this._billsService.getBills(this._paginator.pageIndex,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value,this.selectedCustomer?this.selectedCustomer.id:null,this.selectedCurrenciesId,this.selectedStatus,this.selectedPaymentStatus,this.selectedDate,this.range.get("start").value,this.range.get("end").value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete(),this.store.dispatch((0,Qt.gZ)())}resetCustomer(){this.selectedCustomer=null,this.searchInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addCustomer(n){this.selectedCustomer=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addDate(n){this.selectedDate=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addCurrencies(n){this.selectedCurrenciesId=n.map(i=>i.id),this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addStatus(n){this.selectedStatus=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addPaymentStatus(n){this.selectedPaymentStatus=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}dispatchBill(n){this._fuseConfirmationService.open({title:"Despachar factura",message:"\xbfEsta seguro que desea despachar esta factura?.",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(a=>{"confirmed"===a&&this._billsService.dispatchBill(n).pipe((0,T.Q)(this._unsubscribeAll),(0,bt.j)(()=>{this._changeDetectorRef.markForCheck()})).subscribe(({data:o})=>{o&&this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.dispatchBill.message,title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"mat_solid:done"}})})})}updateStatus(n,i=null,a=null){this._fuseConfirmationService.open({title:"Actualizar estado de la factura",message:"\xbfEsta seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(s=>{"confirmed"===s&&this._billsService.updateBillStatus(n,i,a).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:l})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:l.updateBillStatus.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}})}),this._changeDetectorRef.markForCheck()})}generateBillDocument(n){this._billsService.getBillById(n).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:i})=>{i&&this._documentsService.generateBillDocument(i.bill,aa.factura,this.merchant,this.user)})}return(n){this._billsService.getBillById(n).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:i})=>{i&&this._dialog.open(D3,{data:i.bill,panelClass:"ath-dialog-panel",maxWidth:"550px"})})}generateBillsReport(n=null,i=null){const a=this.range.getRawValue();!a.start||!a.end||this._billsService.getBillsByDateRangeAndStatus(a.start,a.end,n,i,this.selectedCustomer?this.selectedCustomer.id:null).pipe((0,Be.s)(1)).subscribe(({data:o})=>{this._salesReportsService.generateBillsReport(a.start,a.end,this.user,this.merchant,o.getBillsByDateRangeAndStatus.bills,this.getTotalCUP(o.getBillsByDateRangeAndStatus.bills),this.getTotalUSD(o.getBillsByDateRangeAndStatus.bills),this.generateBillsSummary(o.getBillsByDateRangeAndStatus.bills))})}exportVersat(n){this._fileSaverService.exportAsFacFile(n,this.user,this._getBankAccountMC(this.merchant),this._getBankAccountOM(this.merchant,n))}trackByFn(n,i){return n||i.id}exportBillsByDateToVersat(){this._dialog.open(x3,{panelClass:"ath-dialog-panel",disableClose:!0,maxWidth:"500px"}).afterClosed().subscribe(i=>{this._billsService.getBillsByDate(i.toISOString()).pipe((0,Be.s)(1)).subscribe(({data:a})=>{const s=(0,pr.groupBy)(a.findAllBillsByDate.bills,"paymentMethod.name");(0,pr.groupBy)(s,"operationType.name")})})}existTableFilter(){return this.statusFilter?.hasFilter||this.billDateFilter?.hasFilter||this.paymentStatusFilter?.hasFilter||this.currencyFilter?.hasFilter||this.customerFilter?.hasFilter}clearTableFilters(){this.statusFilter?.hasFilter&&this.statusFilter.clearFilter(),this.billDateFilter?.hasFilter&&this.billDateFilter.clearFilter(),this.paymentStatusFilter?.hasFilter&&this.paymentStatusFilter.clearFilter(),this.currencyFilter?.hasFilter&&this.currencyFilter.clearFilter(),this.customerFilter?.hasFilter&&this.customerFilter.clearFilter()}_getBankAccountMC(n){return n.bankAccounts.find(a=>"CUP"===a.currency.iso).no}_getBankAccountOM(n,i){return n.bankAccounts.find(a=>a.currency.iso===i.currency.iso).no}getTotalCUP(n){return n.filter(a=>"CUP"===a.currency.iso).reduce((a,o)=>a+(o.total||0),0)}getTotalUSD(n){return n.filter(a=>"USD"===a.currency.iso).reduce((a,o)=>a+(o.total||0),0)}generateBillsSummary(n){const i={nueva:0,recibida:0,rechazada:0,cancelada:0};return n.forEach(a=>{i[a.status||On.ih.nueva]++}),i}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-bills"]],viewQuery:function(i,a){if(1&i&&(e.GBs(Ie.iy,5),e.GBs(pe.B4,5),e.GBs(A3,5),e.GBs(M3,5),e.GBs(P3,5),e.GBs(B3,5),e.GBs(O3,5)),2&i){let o;e.mGM(o=e.lsd())&&(a._paginator=o.first),e.mGM(o=e.lsd())&&(a._sort=o.first),e.mGM(o=e.lsd())&&(a.billDateFilter=o.first),e.mGM(o=e.lsd())&&(a.customerFilter=o.first),e.mGM(o=e.lsd())&&(a.currencyFilter=o.first),e.mGM(o=e.lsd())&&(a.statusFilter=o.first),e.mGM(o=e.lsd())&&(a.paymentStatusFilter=o.first)}},standalone:!0,features:[e.aNF],decls:59,vars:27,consts:[["picker",""],["reportsMenu","matMenu"],["billDateFilter",""],["customerFilter",""],["currencyFilter",""],["statusFilter",""],["paymentStatusFilter",""],["listStatusMenu","matMenu"],["fuseScrollbar","",1,"absolute","inset-0","flex","flex-col","flex-auto","min-w-0","bg-card","dark:bg-transparent",3,"fuseScrollbarOptions"],[1,"relative","flex","flex-col","px-6","py-8","border-b","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/desktop",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500",3,"routerLink"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","sm:leading-10"],[1,"flex","flex-wrap","items-center","w-full","gap-2","mt-6","md:fixed","right-8","shrink-0","lg:mt-0","lg:ml-4","lg:w-auto","sm:w-1/2"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],[1,"sm:mx-4","min-w-64","fuse-mat-dense","fuse-mat-rounded",3,"subscriptSizing"],[3,"formGroup","rangePicker","max"],["matStartDate","","formControlName","start","placeholder","Fecha de inicio"],["matEndDate","","formControlName","end","placeholder","Fecha final"],["matPrefix","",3,"for"],["disabled","false"],["svgIcon","mat_solid:cancel","matSuffix","",1,"cursor-pointer"],["mat-raised-button","",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700",3,"routerLink"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],[1,""],["mat-raised-button","",1,"text-white","bg-gradient-to-r","from-yellow-500","to-yellow-600",3,"disabled","matMenuTriggerFor"],["xPosition","before"],["mat-menu-item","",3,"click"],[1,"flex","flex-auto"],[1,"z-10","flex","flex-col","flex-auto","bg-white","dark:bg-default"],[1,"relative","grid"],["svgIcon","mat_solid:cancel","matSuffix","",1,"cursor-pointer",3,"click"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","bills-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-slate-900"],[1,"flex","items-center","justify-center",3,"mat-sort-header"],[1,"flex","items-center","justify-center"],[3,"mat-sort-header"],[3,"dataChange","filterType"],[1,"flex","items-center","justify-start"],[3,"dataChange","filterType","searchEntityControl","entitiesFiltered"],[1,"flex","items-center","justify-end"],[3,"dataChange","filterType","entityPropertyName","useUpperCase","data"],[3,"dataChange","filterType","data"],["matTooltip","Estado del cobro",3,"mat-sort-header"],[1,"flex","items-center","justify-end","md:mr-10"],["color","warn","mat-icon-button","","matTooltip","Limpiar filtros",1,"w-6","h-6","min-h-6","min-w-6",3,"click","disabled"],[1,"icon-size-4",3,"svgIcon"],[1,"border-b","first-letter:z-10","sm:inset-x-0","sm:sticky","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-gray-900",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],[1,"z-0","grid","items-center","gap-4","px-6","py-3","border-b","bills-grid","md:px-8"],[1,"font-mono"],[1,"text-center","min-w-40"],[1,"flex","flex-row","justify-end","space-x-1"],[1,"text-xs","text-secondary"],[1,"relative","flex"],[1,"absolute","h-full","flex","justify-center","flex-col"],[1,"flex","items-center"],[1,"flex","justify-center","items-center","h-3","w-3","rounded-full",3,"ngClass"],[1,"h-[40%]","w-[40%]","rounded-full",3,"ngClass"],[1,"py-0.5","pl-1","pr-3","rounded-full","text-sm","font-semibold","uppercase",3,"ngClass"],[1,"flex","flex-row","justify-end","gap-2"],["mat-stroked-button","","matTooltip","Imprimir factura",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"icon-size-5",3,"svgIcon"],["mat-stroked-button","","matTooltip","Despachar Factura",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click","disabled"],["matTooltip","Hacer devoluci\xf3n","mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"disabled"],["mat-stroked-button","","matTooltip","Actualizar estados",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"matMenuTriggerFor","disabled"],[1,"w-full","p-2","text-lg","font-semibold","text-center","text-secondary"],["mat-menu-item","",1,"grid","w-full","grid-cols-4",3,"click","disabled"],[1,"col-span-1"],[1,"col-span-3","text-center"],["matTooltip","Hacer devoluci\xf3n","mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click","disabled"],["svgIcon","mat_solid:undo",1,"icon-size-5"],["svgIcon","mat_solid:redeem","matTooltip","Factura por promoci\xf3n",1,"icon-size-7","mx-1.5"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",8)(1,"div",9)(2,"div",10)(3,"div",11)(4,"div")(5,"a",12),e.EFF(6,"Inicio"),e.k0s()(),e.j41(7,"div",13),e.nrm(8,"mat-icon",14),e.j41(9,"a",15),e.EFF(10,"Ventas"),e.k0s()(),e.j41(11,"div",13),e.nrm(12,"mat-icon",14),e.j41(13,"a",16),e.EFF(14,"Facturaci\xf3n"),e.k0s()(),e.j41(15,"div",13),e.nrm(16,"mat-icon",14),e.j41(17,"a",16),e.EFF(18,"Facturas"),e.k0s()()(),e.j41(19,"div",17)(20,"h2",18),e.EFF(21," Registro de Facturas "),e.k0s()()(),e.j41(22,"div",19)(23,"mat-form-field",20),e.nrm(24,"mat-icon",21)(25,"input",22),e.k0s(),e.j41(26,"mat-form-field",23)(27,"mat-date-range-input",24),e.nrm(28,"input",25)(29,"input",26),e.k0s(),e.nrm(30,"mat-datepicker-toggle",27)(31,"mat-date-range-picker",28,0),e.DNE(33,Z3,1,0,"mat-icon",29),e.k0s(),e.j41(34,"button",30),e.nrm(35,"mat-icon",31),e.j41(36,"span",32),e.EFF(37,"Registrar"),e.k0s()(),e.j41(38,"div",33)(39,"button",34),e.nrm(40,"mat-icon",31),e.j41(41,"span",32),e.EFF(42,"Reportes"),e.k0s()(),e.j41(43,"mat-menu",35,1)(45,"button",36),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateBillsReport())}),e.EFF(46,"Facturas realizadas"),e.k0s(),e.j41(47,"button",36),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateBillsReport(null,"cobrada"))}),e.EFF(48,"Facturas cobradas"),e.k0s(),e.j41(49,"button",36),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateBillsReport(null,"pendiente"))}),e.EFF(50,"Facturas por cobrar"),e.k0s(),e.j41(51,"button",36),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateBillsReport("cancelada"))}),e.EFF(52,"Facturas canceladas"),e.k0s(),e.j41(53,"button",36),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateBillsReport("rechazada"))}),e.EFF(54,"Facturas rechazadas"),e.k0s()()()()(),e.j41(55,"div",37)(56,"div",38),e.DNE(57,l7,39,34,"div",39),e.nI1(58,"async"),e.k0s()()()}if(2&i){let o;const s=e.sdS(32),l=e.sdS(44);e.Y8G("fuseScrollbarOptions",e.lJ4(24,N3)),e.R7$(8),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(),e.Y8G("routerLink",e.lJ4(25,G3)),e.R7$(3),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(7),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",a.searchInputControl)("autocomplete","off")("placeholder","Escriba para buscar..."),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("formGroup",a.range)("rangePicker",s)("max",a.maxDate),e.R7$(3),e.Y8G("for",s),e.R7$(3),e.vxM(33,a.range.get("start").value||a.range.get("end").value?33:-1),e.R7$(),e.Y8G("routerLink",e.lJ4(26,L3)),e.R7$(),e.Y8G("svgIcon","mat_solid:edit"),e.R7$(4),e.Y8G("disabled",!a.range.get("start").value||!a.range.get("end").value||a.range.invalid)("matMenuTriggerFor",l),e.R7$(),e.Y8G("svgIcon","mat_solid:plagiarism"),e.R7$(17),e.vxM(57,(o=e.bMT(58,22,a.bills$))?57:-1,o)}},dependencies:[U.Jj,U.vh,U.QX,te.Hl,te.$z,te.iY,Z.X6,Z.bU,Z.el,Z.xR,Z.IG,Z.SG,O.RG,O.rl,O.JW,O.yw,de.m_,de.An,le.fS,le.fg,ve.Cn,ve.kk,ve.fb,ve.Cp,Ie.Ou,Ie.iy,pe.NQ,pe.B4,pe.aE,U.YU,m.X1,m.me,m.BC,m.cb,m.l_,m.j4,m.JD,ft.Wk,Ys.i,U.Pc,mr.p,De.uc,De.oV],encapsulation:2,changeDetection:0})}return t})();var Sf=R(10467);const oa=(0,fe.Mz)(t=>t.collections,t=>t.collections);var zs=R(87122),sa=R(26325);const d7=X.J1`
    query FindCollections(
        $page: Int
        $size: Int!
        $sort: String
        $order: Order
        $search: String
        $initDate: DateTime
        $endDate: DateTime
    ) {
        findCollections(
            page: $page
            size: $size
            sort: $sort
            order: $order
            search: $search
            initDate: $initDate
            endDate: $endDate
        ) {
            ok
            message

            pagination {
                length
                size
                page
            }

            collections {
                id
                merchantId
                userId
                no
                total

                paymentGatewayId
                paymentGateway {
                    name
                    logo
                }

                currencyId
                currency {
                    iso
                }

                createdAt
                paymentStatus
                qrCode

                # user {
                #     name
                #     lastname1
                #     lastname2
                #     fullname
                # }
                userId
            }
        }
    }
`,f7=X.J1`
    query FindAllCollectionsByDate($date: String!) {
        findAllCollectionsByDate(date: $date) {
            ok
            message

            collections {
                canceledAt
                createdAt
                currency {
                    iso
                }
                # expiredAt
                # failedAt
                id
                merchantId
                no
                paymentAt
                paymentGatewayId
                paymentStatus
                qrCode
                refundedAt

                refunds {
                    id
                    type
                    amount
                    description
                    refundedAt
                }

                total
                # user {
                #     name
                #     lastname1
                #     lastname2
                #     fullname
                # }
                userId
            }
        }
    }
`,m7=X.J1`
    mutation UpdateCollection($updateCollectionInput: UpdateCollectionInput!) {
        updateCollection(updateCollectionInput: $updateCollectionInput) {
            ok
            message

            collections {
                canceledAt
                createdAt
                currency {
                    iso
                }
                # expiredAt
                # failedAt
                id
                merchantId
                no
                paymentAt
                paymentGatewayId
                paymentStatus
                qrCode
                refundedAt

                refunds {
                    id
                    type
                    amount
                    description
                    refundedAt
                }

                total
                # user {
                #     name
                #     lastname1
                #     lastname2
                #     fullname
                # }
                userId
            }
        }
    }
`,p7=X.J1`
    mutation RemoveCollection($removeCollectionId: String!) {
        removeCollection(id: $removeCollectionId) {
            ok
            message
        }
    }
`,h7=X.J1`
    mutation RefundCollection($refundPaymentOrderInput: RefundPaymentOrderInput!) {
        refundCollectionsOrder(refundPaymentOrderInput: $refundPaymentOrderInput) {

            ok
            message

            collection {
                id
                merchantId
                userId
                no
                total

                paymentGatewayId
                paymentGateway {
                    name
                    logo
                }

                currencyId
                currency {
                    iso
                }

                createdAt
                paymentStatus
                qrCode

                # user {
                #     name
                #     lastname1
                #     lastname2
                #     fullname
                # }
                userId
            }
        }
    }
`;var gr=R(46812);let qs=(()=>{class t{constructor(n,i){this.apolloProvider=n,this.store=i,this._apollo=this.apolloProvider.use("BALANC")}getCollections(n=0,i=50,a="no",o="desc",s="",l=ne().subtract(30,"days").toDate(),c=new Date,u=""){return this._apollo.query({query:d7,errorPolicy:"all",variables:{page:n,size:i,sort:a,order:o,search:s,initDate:l,endDate:c,status:u}}).pipe((0,oe.M)(({data:d})=>{this.store.dispatch((0,sa.op)({collections:d.findCollections.collections})),this.store.dispatch((0,Jr.Bp)({pagination:d.findCollections.pagination}))}))}getCollectionsByDate(n){return this._apollo.query({query:f7,errorPolicy:"all",variables:{date:n}}).pipe((0,oe.M)(({})=>{}))}updateCollection(n){return this.store.select(oa).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:m7,variables:{updateCollectionInput:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:a})=>{const o=structuredClone(i);o[i.findIndex(l=>l.id===n.id)]=a.updatedCollection.collection,this.store.dispatch((0,sa.op)({collections:o}))}))))}removeCollection(n){return this.store.select(oa).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:p7,variables:{removeCollectionId:n},errorPolicy:"all"}).pipe((0,oe.M)(()=>{const a=structuredClone(i),o=i.findIndex(s=>s.id===n);a.splice(o,1),this.store.dispatch((0,sa.op)({collections:a}))}))))}refundCollection(n){return this.store.select(oa).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:h7,variables:{refundPaymentOrderInput:n},errorPolicy:"all"}).pipe((0,oe.M)(({})=>{const o=structuredClone(i);o[i.findIndex(l=>l.no===n.no)].paymentStatus=gr.dX.dPendiente,this.store.dispatch((0,sa.op)({collections:o}))}))))}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(X.Ic),e.KVO(fe.il))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var g7=R(5951);const b7=t=>({"cursor-not-allowed":t});function v7(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," EL importe a reembolsar es obligatorio "),e.k0s())}function _7(t,r){if(1&t&&(e.j41(0,"mat-error"),e.EFF(1),e.k0s()),2&t){const n=e.XpG(2);e.R7$(),e.SpI(" El monto a reembolsar debe ser mayor que 0.01 y menor o igual que ",n.data.invoice.amount,". ")}}function y7(t,r){if(1&t&&(e.j41(0,"mat-form-field",15)(1,"mat-label"),e.EFF(2,"Importe"),e.k0s(),e.nrm(3,"mat-icon",24)(4,"input",25),e.DNE(5,v7,2,0,"mat-error")(6,_7,2,1,"mat-error"),e.k0s()),2&t){const n=e.XpG();e.R7$(3),e.Y8G("svgIcon","mat_solid:attach_money"),e.R7$(),e.Y8G("placeholder",n.data.invoice.amount)("formControlName","amount")("min",.01)("max",n.data.invoice.amount),e.R7$(),e.vxM(5,n.refundForm.get("amount").hasError("required")?5:-1),e.R7$(),e.vxM(6,n.refundForm.get("amount").hasError("min")||n.refundForm.get("amount").hasError("max")?6:-1)}}function C7(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," EL motivo del rechazo es obligatorio "),e.k0s())}function x7(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," EL motivo del rechazo debe contener entre 3 y 200 caracteres. "),e.k0s())}function F7(t,r){1&t&&(e.j41(0,"span"),e.EFF(1," Aceptar "),e.k0s())}function S7(t,r){1&t&&e.nrm(0,"mat-progress-spinner",23),2&t&&e.Y8G("diameter",24)("mode","indeterminate")}let k7=(()=>{class t{constructor(n){this.data=n,this.isLoading=!1,this.refundType=gr.H_.total,this._changeDetectorRef=(0,e.WQX)(e.gRc),this._collectionsService=(0,e.WQX)(qs),this._dialogRef=(0,e.WQX)(se.CP),this._formBuilder=(0,e.WQX)(m.ok),this._snackBar=(0,e.WQX)(Oe.UG),this._unsubscribeAll=new Ke.B}ngOnInit(){this.refundForm=this._formBuilder.group({amount:[this.data.invoice.amount,[m.k0.required,m.k0.min(.01),m.k0.max(this.data.invoice.amount)]],refundReason:["",[m.k0.required,m.k0.maxLength(1e3)]]})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}refundTypeChange(n){n.value===gr.H_.total&&this.refundForm.get("amount").setValue(this.data.invoice.amount)}refund(){const n={no:this.data.invoice.no,amount:this.refundForm.get("amount").value,description:this.refundForm.get("refundReason").value.trim(),refundType:this.refundType};this.refundType===gr.H_.total&&(n.amount=this.data.invoice.amount),this._collectionsService.refundCollection(n).pipe((0,T.Q)(this._unsubscribeAll),(0,bt.j)(()=>{this.isLoading=!1,this._changeDetectorRef.markForCheck()})).subscribe(({data:i})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:i.refundCollectionsOrder.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this._changeDetectorRef.markForCheck(),this._dialogRef.close()})}static#e=this.\u0275fac=function(i){return new(i||t)(e.rXU(se.Vh))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["collection-refund-dialog"]],standalone:!0,features:[e.aNF],decls:38,vars:23,consts:[["refundT",""],[1,"h-full","ng-star-inserted"],[1,"relative","flex","flex-col","w-full","h-full"],[1,"flex","items-center","h-full"],[1,"block","w-full"],[1,"flex","flex-col","items-center","flex-auto","p-8","pb-4","sm:flex-row","sm:items-start","sm:pb-6"],[1,"flex","items-center","justify-center","w-10","h-10","text-blue-600","bg-blue-100","rounded-full","flex-0","sm:mr-4","dark:text-blue-50","dark:bg-blue-600","ng-star-inserted"],[3,"src"],[1,"flex","flex-col","items-center","mt-4","space-y-1","text-center","sm:items-start","sm:mt-0","sm:pr-8","sm:text-left","ng-star-inserted"],[1,"text-xl","font-medium","leading-6","ng-star-inserted"],[1,"text-secondary","ng-star-inserted"],["color","primary","aria-label","Select an option",1,"flex","flex-wrap","justify-around","gap-2","pl-8","pr-8","mt-4","mb-6","sm:mt-2","sm:mb-10","sm:pl-22",3,"change","ngModelChange","ngModel"],["value","total"],["value","partial"],[1,"pb-6","pl-8","pr-8","mt-10","sm:mt-0","sm:pl-22",3,"formGroup","autocomplete"],[1,"w-full","mat-fuse-dense"],[1,"w-full","mat-fuse-dense","fuse-mat-textarea"],["matPrefix","","svgIcon","mat_solid:subject",1,"hidden","sm:flex","icon-size-5"],["matInput","",3,"formControlName","placeholder","minLength","maxLength","required"],[1,"text-right"],[1,"flex","flex-wrap","justify-center","px-6","py-4","space-x-3","tems-center","bg-gray-50","dark:bg-black/10","ng-star-inserted"],["mat-stroked-button","",3,"matDialogClose"],["mat-flat-button","","mat-button","",3,"click","color","disabled","ngClass"],[3,"diameter","mode"],["matPrefix","",1,"hidden","sm:flex","icon-size-5",3,"svgIcon"],["type","number","required","","matInput","",3,"placeholder","formControlName","min","max"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),e.nrm(6,"img",7),e.k0s(),e.j41(7,"div",8)(8,"div",9),e.EFF(9,"Reembolso"),e.k0s(),e.j41(10,"div",10),e.EFF(11),e.k0s()()(),e.j41(12,"mat-radio-group",11),e.bIt("change",function(l){return e.eBV(o),e.Njj(a.refundTypeChange(l))}),e.mxI("ngModelChange",function(l){return e.eBV(o),e.DH7(a.refundType,l)||(a.refundType=l),e.Njj(l)}),e.j41(13,"mat-radio-button",12),e.EFF(14,"Total"),e.k0s(),e.j41(15,"span"),e.EFF(16,"......Tipo......"),e.k0s(),e.j41(17,"mat-radio-button",13),e.EFF(18,"Parcial"),e.k0s()(),e.j41(19,"form",14)(20,"div"),e.DNE(21,y7,7,7,"mat-form-field",15),e.j41(22,"mat-form-field",16)(23,"mat-label"),e.EFF(24,"Motivo"),e.k0s(),e.nrm(25,"mat-icon",17)(26,"textarea",18,0),e.j41(28,"mat-hint",19),e.EFF(29),e.k0s(),e.DNE(30,C7,2,0,"mat-error")(31,x7,2,0,"mat-error"),e.k0s()()()()(),e.j41(32,"div",20)(33,"button",21),e.EFF(34,"Cancelar"),e.k0s(),e.j41(35,"button",22),e.bIt("click",function(){return e.eBV(o),e.Njj(a.refund())}),e.DNE(36,F7,2,0,"span")(37,S7,1,2,"mat-progress-spinner",23),e.k0s()()()()}if(2&i){const o=e.sdS(27);e.R7$(6),e.Y8G("src",a.data.invoice.paymentGateway.logo,e.B4B),e.R7$(5),e.SpI("\xbfEsta seguro que desea efectuar el reembolso del pago a la factura # ",a.data.invoice.no," ?"),e.R7$(),e.R50("ngModel",a.refundType),e.R7$(7),e.Y8G("formGroup",a.refundForm)("autocomplete","off"),e.R7$(2),e.vxM(21,"partial"===a.refundType?21:-1),e.R7$(5),e.Y8G("formControlName","refundReason")("placeholder","Escriba el motivo del rechazo")("minLength",3)("maxLength",200)("required",!0),e.R7$(3),e.SpI("Total de caracteres ",o.value.length," / 1000"),e.R7$(),e.vxM(30,a.refundForm.get("refundReason").hasError("required")?30:-1),e.R7$(),e.vxM(31,a.refundForm.get("refundReason").hasError("maxlength")||a.refundForm.get("refundReason").hasError("minlength")?31:-1),e.R7$(2),e.Y8G("matDialogClose",!0),e.R7$(2),e.Y8G("color","primary")("disabled",a.refundForm.invalid)("ngClass",e.eq3(21,b7,a.refundForm.invalid||a.isLoading))("disabled",a.refundForm.invalid||a.isLoading),e.R7$(),e.vxM(36,a.isLoading?-1:36),e.R7$(),e.vxM(37,a.isLoading?37:-1)}},dependencies:[m.YN,m.qT,m.me,m.Q0,m.BC,m.cb,m.YS,m.VZ,m.zX,m.vS,te.Hl,te.$z,mt.g7,se.hM,se.tx,O.RG,O.rl,O.nJ,O.MV,O.TL,O.JW,de.m_,de.An,le.fS,le.fg,ot.D6,ot.LG,g7._g,De.uc,U.YU,m.X1,m.j4,m.JD],encapsulation:2,changeDetection:0})}return t})();var $7=R(65478);const I7=(t,r,n,i,a)=>({"text-teal-800 bg-teal-100 dark:text-teal-50 dark:bg-teal-500":t,"text-green-800 bg-green-100 dark:text-green-50 dark:bg-green-500":r,"text-blue-800 bg-blue-100 dark:text-white dark:bg-blue-500":n,"text-violet-800 bg-violet-100 dark:text-violet-50 dark:bg-violet-500":i,"text-red-800 bg-red-100 dark:text-red-50 dark:bg-red-500":a}),w7=t=>({$implicit:t}),R7=t=>({"pointer-events-none":t}),T7=()=>[10,25,50,100];function E7(t,r){if(1&t&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"uppercase"),e.k0s()),2&t){const n=e.XpG().$implicit;e.R7$(),e.JRh(e.bMT(2,1,n.paymentGateway.name))}}function j7(t,r){1&t&&e.nrm(0,"mat-spinner",28),2&t&&e.Y8G("diameter",20)("color","primary")}function D7(t,r){1&t&&e.eu8(0)}function A7(t,r){if(1&t&&e.DNE(0,D7,1,0,"ng-container",29),2&t){const n=e.XpG(3),i=e.sdS(26);e.Y8G("ngTemplateOutlet",i)("ngTemplateOutletContext",e.eq3(2,w7,n.paymentStatusData))}}function M7(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",18)(1,"div",19),e.EFF(2),e.k0s(),e.j41(3,"div",20),e.EFF(4),e.nI1(5,"date"),e.k0s(),e.j41(6,"div",17),e.EFF(7),e.k0s(),e.j41(8,"div",17),e.EFF(9),e.nI1(10,"number"),e.k0s(),e.j41(11,"div",17),e.DNE(12,E7,3,3,"span"),e.k0s(),e.j41(13,"div",21)(14,"span",22),e.EFF(15),e.nI1(16,"uppercase"),e.k0s()(),e.j41(17,"div",23)(18,"button",24),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.generateTicketCollectionDocument(a))}),e.nrm(19,"mat-icon",25),e.k0s(),e.j41(20,"button",26),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.refund(a))}),e.nrm(21,"mat-icon",27),e.k0s(),e.DNE(22,j7,1,2,"mat-spinner",28),e.k0s()(),e.j41(23,"div",13),e.DNE(24,A7,1,4,"ng-container"),e.k0s()}if(2&t){const n=r.$implicit,i=r.$index,a=e.XpG(2);e.R7$(2),e.SpI(" ",n.no," "),e.R7$(2),e.SpI(" ",e.i5U(5,11,n.createdAt,"dd/MM/YY hh:mm a")," "),e.R7$(3),e.SpI(" ",n.currency.iso," "),e.R7$(2),e.SpI(" ",e.i5U(10,14,n.total,"1.2-2")," "),e.R7$(3),e.vxM(12,n.paymentGateway?12:-1),e.R7$(2),e.Y8G("ngClass",e.s1E(19,I7,"parcial"===n.paymentStatus,"pagada"===n.paymentStatus,"pendiente"===n.paymentStatus,"devuelto"===n.paymentStatus,"cancelado"===n.paymentStatus)),e.R7$(),e.SpI(" ",e.bMT(16,17,n.paymentStatus)," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:visibility"),e.R7$(),e.Y8G("disabled",a.isLoading||"pagada"!==n.paymentStatus),e.R7$(2),e.vxM(22,a.isMarkAsPayedLoading&&a.selectedSlide===i?22:-1),e.R7$(2),e.vxM(24,(null==a.selectedCollection?null:a.selectedCollection.id)===n.id?24:-1)}}function P7(t,r){if(1&t&&(e.j41(0,"div",13)(1,"div",15)(2,"div",16),e.EFF(3," No "),e.k0s(),e.j41(4,"div",17),e.EFF(5," Fecha "),e.k0s(),e.j41(6,"div",16),e.EFF(7," Moneda "),e.k0s(),e.j41(8,"div",16),e.EFF(9," Importe "),e.k0s(),e.j41(10,"div",17),e.EFF(11," M\xe9todo de pago "),e.k0s(),e.j41(12,"div",17),e.EFF(13," Estado "),e.k0s(),e.j41(14,"div",17),e.EFF(15," Acciones "),e.k0s()(),e.Z7z(16,M7,25,25,null,null,e.BUC().trackByFn,!0),e.k0s()),2&t){const n=e.XpG();e.R7$(2),e.Y8G("mat-sort-header","no"),e.R7$(4),e.Y8G("mat-sort-header","currencyId"),e.R7$(2),e.Y8G("mat-sort-header","total"),e.R7$(8),e.Dyx(n.collections)}}function B7(t,r){if(1&t&&(e.j41(0,"div",30),e.EFF(1),e.k0s()),2&t){const n=e.XpG();e.R7$(),e.SpI(" ",n.searchInputControl.value?"\xa1No se han encontrado facturas!":"\xa1No se ha generado ninguna factura a una suscripci\xf3n a\xfan!","")}}function O7(t,r){if(1&t&&(e.j41(0,"div",35)(1,"div",17),e.EFF(2),e.nI1(3,"uppercase"),e.k0s(),e.j41(4,"div",17),e.EFF(5),e.k0s(),e.j41(6,"div",17),e.EFF(7),e.nI1(8,"date"),e.k0s(),e.j41(9,"div",17),e.EFF(10),e.nI1(11,"uppercase"),e.k0s(),e.j41(12,"div",34),e.EFF(13),e.k0s()()),2&t){const n=r.$implicit;e.R7$(2),e.SpI(" ",e.bMT(3,5,n.paymentStatus)," "),e.R7$(3),e.SpI(" ",n.amount," "),e.R7$(2),e.SpI(" ",e.i5U(8,7,n.statusChangeAt,"dd/MM/yyyy HH:mm")," "),e.R7$(3),e.SpI(" ",e.bMT(11,10,n.type)," "),e.R7$(3),e.SpI(" ",n.description," ")}}function N7(t,r){if(1&t&&(e.j41(0,"div",31)(1,"div",32)(2,"div",17),e.EFF(3," Estado "),e.k0s(),e.j41(4,"div",17),e.EFF(5," Monto "),e.k0s(),e.j41(6,"div",17),e.EFF(7," Fecha "),e.k0s(),e.j41(8,"div",33),e.EFF(9," T.Devoluci\xf3n "),e.k0s(),e.j41(10,"div",34),e.EFF(11," Descripci\xf3n "),e.k0s()(),e.Z7z(12,O7,14,12,"div",35,e.fX1),e.k0s()),2&t){const n=e.XpG();e.R7$(12),e.Dyx(n.paymentStatusData)}}function G7(t,r){if(1&t&&e.nrm(0,"mat-paginator",14),2&t){const n=e.XpG();e.Y8G("ngClass",e.eq3(6,R7,n.isLoading))("length",n.pagination.length)("pageIndex",n.pagination.page)("pageSize",n.pagination.size)("pageSizeOptions",e.lJ4(8,T7))("showFirstLastButtons",!0)}}let L7=(()=>{class t{constructor(){this.searchInputControl=new m.MJ(null),this.isMarkAsPayedLoading=!1,this.selectedSlide=null,this.user=null,this.merchantControl=new m.MJ,this.paymentStatusData=[],this.selectedCollection=null,this._changeDetectorRef=(0,e.WQX)(e.gRc),this._collectionsService=(0,e.WQX)(qs),this._documentsService=(0,e.WQX)(hr.Q),this._dialog=(0,e.WQX)(se.bZ),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.store.select(oa).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.collections=n,this._changeDetectorRef.markForCheck()}),this.store.select(Mn.Dz).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.pagination=n,this._changeDetectorRef.markForCheck()}),this.store.select(bn.SW).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.user=n,this._changeDetectorRef.markForCheck()}),this.store.select(At.Xb).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.currentMerchant=n}),this.searchInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,Ne.Z)(null),(0,ce.n)(n=>null!==n?(this.isLoading=!0,this._collectionsService.getCollections(0,10,"createdAt","desc",n)):(0,ie.of)()),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe()}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"no",start:"desc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,An.h)(this._sort.sortChange,this._paginator.page).pipe((0,ce.n)(()=>(this.isLoading=!0,this._collectionsService.getCollections(this._paginator.pageIndex,this._paginator.pageSize,this._sort.active,this._sort.direction))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}refund(n){n.paymentGateway&&this._dialog.open(k7,{data:{invoice:{id:n.id,no:n.no,amount:n.total,paymentGateway:n.paymentGateway}},panelClass:"ath-reject-dialog-panel",maxWidth:"520px"})}generateTicketCollectionDocument(n){var i=this;return(0,Sf.A)(function*(){i._documentsService.generateTicketCollectionDocument(n,i.currentMerchant,i.user)})()}trackByFn(n,i){return i.id||n}togglePaymentStatusData(n){this.paymentStatusData=[],n.paymentAt&&this.paymentStatusData.push({paymentStatus:gr.dX.pagada,amount:n.total,type:"",description:"",statusChangeAt:n.paymentAt});for(const i of n.refunds.map(a=>({paymentStatus:gr.dX.devuelto,amount:a.amount,type:a.type,description:a.description,statusChangeAt:a.refundedAt})))this.paymentStatusData.push(i);this.selectedCollection&&this.selectedCollection.id===n.id?this.closeDetails():(this.selectedCollection=n,this._changeDetectorRef.markForCheck())}closeDetails(){this.selectedCollection=null,this.paymentStatusData=[],this._changeDetectorRef.markForCheck()}showRefund(n){return!!(n.refunds.map(a=>a.amount).reduce((a,o)=>a+o,0)<n.total&&n.paymentAt)}displayFn(n){return(n&&n.name?n.name:"").trim()}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-collections"]],viewQuery:function(i,a){if(1&i&&(e.GBs(Ie.iy,5),e.GBs(pe.B4,5)),2&i){let o;e.mGM(o=e.lsd())&&(a._paginator=o.first),e.mGM(o=e.lsd())&&(a._sort=o.first)}},standalone:!0,features:[e.aNF],decls:28,vars:6,consts:[["rowPaymentStatusDataTemplate",""],["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","flex-auto","min-w-0","overflow-x-auto","overflow-y-auto","bg-card","dark:bg-transparent","lg:overflow-x-hidden"],[1,"relative","flex","flex-col","px-6","py-8","border-b","sm:flex-row","flex-0","sm:items-center","sm:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex-wrap","items-center","hidden","font-medium","sm:flex"],[1,"flex","items-center","ml-1","whitespace-nowrap"],["routerLink","/desktop",1,"ml-1","text-primary-500","hover:underline"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"flex","sm:hidden"],[1,"inline-flex","items-center","-ml-1.5","text-secondary","font-medium",3,"routerLink"],[1,"ml-1"],[1,"flex","flex-col","flex-auto"],[1,"grid"],[1,"z-10","border-b","sm:inset-x-0","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","collections-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],[1,"text-center",3,"mat-sort-header"],[1,"text-center"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","collections-grid","md:px-8"],[1,"truncate"],[1,"text-center","truncate"],[1,"flex","justify-center"],[1,"py-0.5","px-3","rounded-full","text-sm","font-semibold","uppercase",3,"ngClass"],[1,"flex","flex-row","justify-center","gap-2"],["mat-stroked-button","","matTooltip","Ver ticket",1,"hidden","px-2","leading-6","sm:flex","min-w-10","min-h-7","h-7",3,"click"],[1,"icon-size-5",3,"svgIcon"],["matTooltip","Hacer devoluci\xf3n","mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click","disabled"],["svgIcon","mat_solid:undo",1,"icon-size-5"],[1,"self-center","ml-2",3,"diameter","color"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"],[1,"flex","flex-col","w-full","overflow-hidden","border-b"],[1,"z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","subscription-collections-status-detail-table","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],["matTooltip","Tipo de devoluci\xf3n",1,"text-center"],[1,"text-left"],[1,"grid","items-center","w-full","gap-4","px-6","py-3","border-b","subscription-collections-status-detail-table","md:px-8"]],template:function(i,a){1&i&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div")(4,"div",4)(5,"div",5)(6,"a",6),e.EFF(7,"Inicio"),e.k0s()(),e.j41(8,"div",5),e.nrm(9,"mat-icon",7),e.j41(10,"a",8),e.EFF(11,"Ventas"),e.k0s()(),e.j41(12,"div",5),e.nrm(13,"mat-icon",7),e.j41(14,"a",8),e.EFF(15,"Cobros"),e.k0s()()(),e.j41(16,"div",9)(17,"a",10),e.nrm(18,"mat-icon",7),e.j41(19,"span",11),e.EFF(20,"Regresar"),e.k0s()()()()()(),e.j41(21,"div",12)(22,"div",12),e.DNE(23,P7,18,3,"div",13)(24,B7,2,1)(25,N7,14,0,"ng-template",null,0,e.C5r),e.k0s(),e.DNE(27,G7,1,9,"mat-paginator",14),e.k0s()()),2&i&&(e.R7$(9),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("routerLink","./.."),e.R7$(),e.Y8G("svgIcon","mat_solid:chevron_left"),e.R7$(5),e.vxM(23,a.collections.length>0?23:24),e.R7$(4),e.vxM(27,a.collections.length>0?27:-1))},dependencies:[U.vh,U.QX,te.Hl,te.$z,Z.X6,$7.uv,O.RG,de.m_,de.An,le.fS,ve.Cn,Ie.Ou,Ie.iy,ot.D6,ot.LG,pe.NQ,pe.B4,pe.aE,De.uc,De.oV,U.YU,m.X1,ft.Wk,U.Pc],styles:[".collections-grid{grid-template-columns:55px auto}@media (min-width: 960px){.collections-grid{grid-template-columns:150px 200px 100px 150px 200px 150px 250px}}\n"],encapsulation:2,data:{animation:zs.X},changeDetection:0})}return t})(),Y7=(()=>{class t{static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales"]],standalone:!0,features:[e.aNF],decls:1,vars:0,template:function(i,a){1&i&&e.nrm(0,"router-outlet")},dependencies:[ft.n3],encapsulation:2})}return t})();var la=R(96850),kf=R(4626);function V7(){}function Us(t){return null==t?V7:function(){return this.querySelector(t)}}function U7(){return[]}function $f(t){return null==t?U7:function(){return this.querySelectorAll(t)}}function If(t){return function(){return this.matches(t)}}function wf(t){return function(r){return r.matches(t)}}var Q7=Array.prototype.find;function H7(){return this.firstElementChild}var K7=Array.prototype.filter;function eC(){return Array.from(this.children)}function Rf(t){return new Array(t.length)}function ca(t,r){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=r}function oC(t,r,n,i,a,o){for(var l,s=0,c=r.length,u=o.length;s<u;++s)(l=r[s])?(l.__data__=o[s],i[s]=l):n[s]=new ca(t,o[s]);for(;s<c;++s)(l=r[s])&&(a[s]=l)}function sC(t,r,n,i,a,o,s){var l,c,h,u=new Map,d=r.length,f=o.length,p=new Array(d);for(l=0;l<d;++l)(c=r[l])&&(p[l]=h=s.call(c,c.__data__,l,r)+"",u.has(h)?a[l]=c:u.set(h,c));for(l=0;l<f;++l)h=s.call(t,o[l],l,o)+"",(c=u.get(h))?(i[l]=c,c.__data__=o[l],u.delete(h)):n[l]=new ca(t,o[l]);for(l=0;l<d;++l)(c=r[l])&&u.get(p[l])===c&&(a[l]=c)}function lC(t){return t.__data__}function uC(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function gC(t,r){return t<r?-1:t>r?1:t>=r?0:NaN}ca.prototype={constructor:ca,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,r){return this._parent.insertBefore(t,r)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var Xs="http://www.w3.org/1999/xhtml";const Tf={svg:"http://www.w3.org/2000/svg",xhtml:Xs,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ua(t){var r=t+="",n=r.indexOf(":");return n>=0&&"xmlns"!==(r=t.slice(0,n))&&(t=t.slice(n+1)),Tf.hasOwnProperty(r)?{space:Tf[r],local:t}:t}function FC(t){return function(){this.removeAttribute(t)}}function SC(t){return function(){this.removeAttributeNS(t.space,t.local)}}function kC(t,r){return function(){this.setAttribute(t,r)}}function $C(t,r){return function(){this.setAttributeNS(t.space,t.local,r)}}function IC(t,r){return function(){var n=r.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function wC(t,r){return function(){var n=r.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ef(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function TC(t){return function(){this.style.removeProperty(t)}}function EC(t,r,n){return function(){this.style.setProperty(t,r,n)}}function jC(t,r,n){return function(){var i=r.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function br(t,r){return t.style.getPropertyValue(r)||Ef(t).getComputedStyle(t,null).getPropertyValue(r)}function AC(t){return function(){delete this[t]}}function MC(t,r){return function(){this[t]=r}}function PC(t,r){return function(){var n=r.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function jf(t){return t.trim().split(/^|\s+/)}function Ws(t){return t.classList||new Df(t)}function Df(t){this._node=t,this._names=jf(t.getAttribute("class")||"")}function Af(t,r){for(var n=Ws(t),i=-1,a=r.length;++i<a;)n.add(r[i])}function Mf(t,r){for(var n=Ws(t),i=-1,a=r.length;++i<a;)n.remove(r[i])}function OC(t){return function(){Af(this,t)}}function NC(t){return function(){Mf(this,t)}}function GC(t,r){return function(){(r.apply(this,arguments)?Af:Mf)(this,t)}}function YC(){this.textContent=""}function VC(t){return function(){this.textContent=t}}function zC(t){return function(){var r=t.apply(this,arguments);this.textContent=r??""}}function UC(){this.innerHTML=""}function XC(t){return function(){this.innerHTML=t}}function WC(t){return function(){var r=t.apply(this,arguments);this.innerHTML=r??""}}function JC(){this.nextSibling&&this.parentNode.appendChild(this)}function ZC(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ex(t){return function(){var r=this.ownerDocument,n=this.namespaceURI;return n===Xs&&r.documentElement.namespaceURI===Xs?r.createElement(t):r.createElementNS(n,t)}}function tx(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Pf(t){var r=ua(t);return(r.local?tx:ex)(r)}function rx(){return null}function ax(){var t=this.parentNode;t&&t.removeChild(this)}function sx(){var t=this.cloneNode(!1),r=this.parentNode;return r?r.insertBefore(t,this.nextSibling):t}function lx(){var t=this.cloneNode(!0),r=this.parentNode;return r?r.insertBefore(t,this.nextSibling):t}function mx(t){return function(){var r=this.__on;if(r){for(var o,n=0,i=-1,a=r.length;n<a;++n)o=r[n],t.type&&o.type!==t.type||o.name!==t.name?r[++i]=o:this.removeEventListener(o.type,o.listener,o.options);++i?r.length=i:delete this.__on}}}function px(t,r,n){return function(){var a,i=this.__on,o=function dx(t){return function(r){t.call(this,r,this.__data__)}}(r);if(i)for(var s=0,l=i.length;s<l;++s)if((a=i[s]).type===t.type&&a.name===t.name)return this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=o,a.options=n),void(a.value=r);this.addEventListener(t.type,o,n),a={type:t.type,name:t.name,value:r,listener:o,options:n},i?i.push(a):this.__on=[a]}}function Bf(t,r,n){var i=Ef(t),a=i.CustomEvent;"function"==typeof a?a=new a(r,n):(a=i.document.createEvent("Event"),n?(a.initEvent(r,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(r,!1,!1)),t.dispatchEvent(a)}function gx(t,r){return function(){return Bf(this,t,r)}}function bx(t,r){return function(){return Bf(this,t,r.apply(this,arguments))}}Df.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var r=this._names.indexOf(t);r>=0&&(this._names.splice(r,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Of=[null];function vt(t,r){this._groups=t,this._parents=r}function Nf(){return new vt([[document.documentElement]],Of)}vt.prototype=Nf.prototype={constructor:vt,select:function z7(t){"function"!=typeof t&&(t=Us(t));for(var r=this._groups,n=r.length,i=new Array(n),a=0;a<n;++a)for(var c,u,o=r[a],s=o.length,l=i[a]=new Array(s),d=0;d<s;++d)(c=o[d])&&(u=t.call(c,c.__data__,d,o))&&("__data__"in c&&(u.__data__=c.__data__),l[d]=u);return new vt(i,this._parents)},selectAll:function W7(t){t="function"==typeof t?function X7(t){return function(){return function q7(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}(t.apply(this,arguments))}}(t):$f(t);for(var r=this._groups,n=r.length,i=[],a=[],o=0;o<n;++o)for(var c,s=r[o],l=s.length,u=0;u<l;++u)(c=s[u])&&(i.push(t.call(c,c.__data__,u,s)),a.push(c));return new vt(i,a)},selectChild:function Z7(t){return this.select(null==t?H7:function J7(t){return function(){return Q7.call(this.children,t)}}("function"==typeof t?t:wf(t)))},selectChildren:function nC(t){return this.selectAll(null==t?eC:function tC(t){return function(){return K7.call(this.children,t)}}("function"==typeof t?t:wf(t)))},filter:function rC(t){"function"!=typeof t&&(t=If(t));for(var r=this._groups,n=r.length,i=new Array(n),a=0;a<n;++a)for(var c,o=r[a],s=o.length,l=i[a]=[],u=0;u<s;++u)(c=o[u])&&t.call(c,c.__data__,u,o)&&l.push(c);return new vt(i,this._parents)},data:function cC(t,r){if(!arguments.length)return Array.from(this,lC);var n=r?sC:oC,i=this._parents,a=this._groups;"function"!=typeof t&&(t=function aC(t){return function(){return t}}(t));for(var o=a.length,s=new Array(o),l=new Array(o),c=new Array(o),u=0;u<o;++u){var d=i[u],f=a[u],p=f.length,h=uC(t.call(d,d&&d.__data__,u,i)),b=h.length,g=l[u]=new Array(b),_=s[u]=new Array(b);n(d,f,g,_,c[u]=new Array(p),h,r);for(var D,A,S=0,F=0;S<b;++S)if(D=g[S]){for(S>=F&&(F=S+1);!(A=_[F])&&++F<b;);D._next=A||null}}return(s=new vt(s,i))._enter=l,s._exit=c,s},enter:function iC(){return new vt(this._enter||this._groups.map(Rf),this._parents)},exit:function dC(){return new vt(this._exit||this._groups.map(Rf),this._parents)},join:function fC(t,r,n){var i=this.enter(),a=this,o=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=r&&(a=r(a))&&(a=a.selection()),null==n?o.remove():n(o),i&&a?i.merge(a).order():a},merge:function mC(t){for(var r=t.selection?t.selection():t,n=this._groups,i=r._groups,a=n.length,s=Math.min(a,i.length),l=new Array(a),c=0;c<s;++c)for(var h,u=n[c],d=i[c],f=u.length,p=l[c]=new Array(f),b=0;b<f;++b)(h=u[b]||d[b])&&(p[b]=h);for(;c<a;++c)l[c]=n[c];return new vt(l,this._parents)},selection:function yx(){return this},order:function pC(){for(var t=this._groups,r=-1,n=t.length;++r<n;)for(var s,i=t[r],a=i.length-1,o=i[a];--a>=0;)(s=i[a])&&(o&&4^s.compareDocumentPosition(o)&&o.parentNode.insertBefore(s,o),o=s);return this},sort:function hC(t){function r(f,p){return f&&p?t(f.__data__,p.__data__):!f-!p}t||(t=gC);for(var n=this._groups,i=n.length,a=new Array(i),o=0;o<i;++o){for(var u,s=n[o],l=s.length,c=a[o]=new Array(l),d=0;d<l;++d)(u=s[d])&&(c[d]=u);c.sort(r)}return new vt(a,this._parents).order()},call:function bC(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function vC(){return Array.from(this)},node:function _C(){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i=t[r],a=0,o=i.length;a<o;++a){var s=i[a];if(s)return s}return null},size:function yC(){let t=0;for(const r of this)++t;return t},empty:function CC(){return!this.node()},each:function xC(t){for(var r=this._groups,n=0,i=r.length;n<i;++n)for(var l,a=r[n],o=0,s=a.length;o<s;++o)(l=a[o])&&t.call(l,l.__data__,o,a);return this},attr:function RC(t,r){var n=ua(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==r?n.local?SC:FC:"function"==typeof r?n.local?wC:IC:n.local?$C:kC)(n,r))},style:function DC(t,r,n){return arguments.length>1?this.each((null==r?TC:"function"==typeof r?jC:EC)(t,r,n??"")):br(this.node(),t)},property:function BC(t,r){return arguments.length>1?this.each((null==r?AC:"function"==typeof r?PC:MC)(t,r)):this.node()[t]},classed:function LC(t,r){var n=jf(t+"");if(arguments.length<2){for(var i=Ws(this.node()),a=-1,o=n.length;++a<o;)if(!i.contains(n[a]))return!1;return!0}return this.each(("function"==typeof r?GC:r?OC:NC)(n,r))},text:function qC(t){return arguments.length?this.each(null==t?YC:("function"==typeof t?zC:VC)(t)):this.node().textContent},html:function QC(t){return arguments.length?this.each(null==t?UC:("function"==typeof t?WC:XC)(t)):this.node().innerHTML},raise:function HC(){return this.each(JC)},lower:function KC(){return this.each(ZC)},append:function nx(t){var r="function"==typeof t?t:Pf(t);return this.select(function(){return this.appendChild(r.apply(this,arguments))})},insert:function ix(t,r){var n="function"==typeof t?t:Pf(t),i=null==r?rx:"function"==typeof r?r:Us(r);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function ox(){return this.each(ax)},clone:function cx(t){return this.select(t?lx:sx)},datum:function ux(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function hx(t,r,n){var a,s,i=function fx(t){return t.trim().split(/^|\s+/).map(function(r){var n="",i=r.indexOf(".");return i>=0&&(n=r.slice(i+1),r=r.slice(0,i)),{type:r,name:n}})}(t+""),o=i.length;if(!(arguments.length<2)){for(l=r?px:mx,a=0;a<o;++a)this.each(l(i[a],r,n));return this}var l=this.node().__on;if(l)for(var d,c=0,u=l.length;c<u;++c)for(a=0,d=l[c];a<o;++a)if((s=i[a]).type===d.type&&s.name===d.name)return d.value},dispatch:function vx(t,r){return this.each(("function"==typeof r?bx:gx)(t,r))},[Symbol.iterator]:function*_x(){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var s,i=t[r],a=0,o=i.length;a<o;++a)(s=i[a])&&(yield s)}};const Kr=Nf;function da(t){return"string"==typeof t?new vt([[document.querySelector(t)]],[document.documentElement]):new vt([[t]],Of)}function vr(t,r,n){t.prototype=r.prototype=n,n.constructor=t}function ei(t,r){var n=Object.create(t.prototype);for(var i in r)n[i]=r[i];return n}function vn(){}var _r=1/.7,yr="\\s*([+-]?\\d+)\\s*",ti="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Cx=/^#([0-9a-f]{3,8})$/,xx=new RegExp(`^rgb\\(${yr},${yr},${yr}\\)$`),Fx=new RegExp(`^rgb\\(${Pt},${Pt},${Pt}\\)$`),Sx=new RegExp(`^rgba\\(${yr},${yr},${yr},${ti}\\)$`),kx=new RegExp(`^rgba\\(${Pt},${Pt},${Pt},${ti}\\)$`),$x=new RegExp(`^hsl\\(${ti},${Pt},${Pt}\\)$`),Ix=new RegExp(`^hsla\\(${ti},${Pt},${Pt},${ti}\\)$`),Gf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Lf(){return this.rgb().formatHex()}function Yf(){return this.rgb().formatRgb()}function Gn(t){var r,n;return t=(t+"").trim().toLowerCase(),(r=Cx.exec(t))?(n=r[1].length,r=parseInt(r[1],16),6===n?Vf(r):3===n?new Ve(r>>8&15|r>>4&240,r>>4&15|240&r,(15&r)<<4|15&r,1):8===n?fa(r>>24&255,r>>16&255,r>>8&255,(255&r)/255):4===n?fa(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|240&r,((15&r)<<4|15&r)/255):null):(r=xx.exec(t))?new Ve(r[1],r[2],r[3],1):(r=Fx.exec(t))?new Ve(255*r[1]/100,255*r[2]/100,255*r[3]/100,1):(r=Sx.exec(t))?fa(r[1],r[2],r[3],r[4]):(r=kx.exec(t))?fa(255*r[1]/100,255*r[2]/100,255*r[3]/100,r[4]):(r=$x.exec(t))?Uf(r[1],r[2]/100,r[3]/100,1):(r=Ix.exec(t))?Uf(r[1],r[2]/100,r[3]/100,r[4]):Gf.hasOwnProperty(t)?Vf(Gf[t]):"transparent"===t?new Ve(NaN,NaN,NaN,0):null}function Vf(t){return new Ve(t>>16&255,t>>8&255,255&t,1)}function fa(t,r,n,i){return i<=0&&(t=r=n=NaN),new Ve(t,r,n,i)}function Qs(t){return t instanceof vn||(t=Gn(t)),t?new Ve((t=t.rgb()).r,t.g,t.b,t.opacity):new Ve}function ni(t,r,n,i){return 1===arguments.length?Qs(t):new Ve(t,r,n,i??1)}function Ve(t,r,n,i){this.r=+t,this.g=+r,this.b=+n,this.opacity=+i}function zf(){return`#${Yn(this.r)}${Yn(this.g)}${Yn(this.b)}`}function qf(){const t=ma(this.opacity);return`${1===t?"rgb(":"rgba("}${Ln(this.r)}, ${Ln(this.g)}, ${Ln(this.b)}${1===t?")":`, ${t})`}`}function ma(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ln(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Yn(t){return((t=Ln(t))<16?"0":"")+t.toString(16)}function Uf(t,r,n,i){return i<=0?t=r=n=NaN:n<=0||n>=1?t=r=NaN:r<=0&&(t=NaN),new wt(t,r,n,i)}function Xf(t){if(t instanceof wt)return new wt(t.h,t.s,t.l,t.opacity);if(t instanceof vn||(t=Gn(t)),!t)return new wt;if(t instanceof wt)return t;var r=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,a=Math.min(r,n,i),o=Math.max(r,n,i),s=NaN,l=o-a,c=(o+a)/2;return l?(s=r===o?(n-i)/l+6*(n<i):n===o?(i-r)/l+2:(r-n)/l+4,l/=c<.5?o+a:2-o-a,s*=60):l=c>0&&c<1?0:s,new wt(s,l,c,t.opacity)}function Js(t,r,n,i){return 1===arguments.length?Xf(t):new wt(t,r,n,i??1)}function wt(t,r,n,i){this.h=+t,this.s=+r,this.l=+n,this.opacity=+i}function Wf(t){return(t=(t||0)%360)<0?t+360:t}function pa(t){return Math.max(0,Math.min(1,t||0))}function Hs(t,r,n){return 255*(t<60?r+(n-r)*t/60:t<180?n:t<240?r+(n-r)*(240-t)/60:r)}vr(vn,Gn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Lf,formatHex:Lf,formatHex8:function wx(){return this.rgb().formatHex8()},formatHsl:function Rx(){return Xf(this).formatHsl()},formatRgb:Yf,toString:Yf}),vr(Ve,ni,ei(vn,{brighter(t){return t=null==t?_r:Math.pow(_r,t),new Ve(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?.7:Math.pow(.7,t),new Ve(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ve(Ln(this.r),Ln(this.g),Ln(this.b),ma(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zf,formatHex:zf,formatHex8:function Tx(){return`#${Yn(this.r)}${Yn(this.g)}${Yn(this.b)}${Yn(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:qf,toString:qf})),vr(wt,Js,ei(vn,{brighter(t){return t=null==t?_r:Math.pow(_r,t),new wt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?.7:Math.pow(.7,t),new wt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),r=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*r,a=2*n-i;return new Ve(Hs(t>=240?t-240:t+120,a,i),Hs(t,a,i),Hs(t<120?t+240:t-120,a,i),this.opacity)},clamp(){return new wt(Wf(this.h),pa(this.s),pa(this.l),ma(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=ma(this.opacity);return`${1===t?"hsl(":"hsla("}${Wf(this.h)}, ${100*pa(this.s)}%, ${100*pa(this.l)}%${1===t?")":`, ${t})`}`}}));const Qf=Math.PI/180,Jf=180/Math.PI,Hf=.96422,Zf=1,Kf=.82521,em=4/29,Cr=6/29,tm=3*Cr*Cr,Ex=Cr*Cr*Cr;function nm(t){if(t instanceof Rt)return new Rt(t.l,t.a,t.b,t.opacity);if(t instanceof Bt)return im(t);t instanceof Ve||(t=Qs(t));var o,s,r=nl(t.r),n=nl(t.g),i=nl(t.b),a=Ks((.2225045*r+.7168786*n+.0606169*i)/Zf);return r===n&&n===i?o=s=a:(o=Ks((.4360747*r+.3850649*n+.1430804*i)/Hf),s=Ks((.0139322*r+.0971045*n+.7141733*i)/Kf)),new Rt(116*a-16,500*(o-a),200*(a-s),t.opacity)}function Zs(t,r,n,i){return 1===arguments.length?nm(t):new Rt(t,r,n,i??1)}function Rt(t,r,n,i){this.l=+t,this.a=+r,this.b=+n,this.opacity=+i}function Ks(t){return t>Ex?Math.pow(t,1/3):t/tm+em}function el(t){return t>Cr?t*t*t:tm*(t-em)}function tl(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function nl(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ga(t,r,n,i){return 1===arguments.length?function rm(t){if(t instanceof Bt)return new Bt(t.h,t.c,t.l,t.opacity);if(t instanceof Rt||(t=nm(t)),0===t.a&&0===t.b)return new Bt(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var r=Math.atan2(t.b,t.a)*Jf;return new Bt(r<0?r+360:r,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}(t):new Bt(t,r,n,i??1)}function Bt(t,r,n,i){this.h=+t,this.c=+r,this.l=+n,this.opacity=+i}function im(t){if(isNaN(t.h))return new Rt(t.l,0,0,t.opacity);var r=t.h*Qf;return new Rt(t.l,Math.cos(r)*t.c,Math.sin(r)*t.c,t.opacity)}function _n(t,r){return null==t||null==r?NaN:t<r?-1:t>r?1:t>=r?0:NaN}function ba(t,r){return null==t||null==r?NaN:r<t?-1:r>t?1:r>=t?0:NaN}function rl(t,r){let n,i;if(void 0===r)for(const a of t)null!=a&&(void 0===n?a>=a&&(n=i=a):(n>a&&(n=a),i<a&&(i=a)));else{let a=-1;for(let o of t)null!=(o=r(o,++a,t))&&(void 0===n?o>=o&&(n=i=o):(n>o&&(n=o),i<o&&(i=o)))}return[n,i]}function yn(t,r){let n;if(void 0===r)for(const i of t)null!=i&&(n<i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let a of t)null!=(a=r(a,++i,t))&&(n<a||void 0===n&&a>=a)&&(n=a)}return n}function va(t,r){let n;if(void 0===r)for(const i of t)null!=i&&(n>i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let a of t)null!=(a=r(a,++i,t))&&(n>a||void 0===n&&a>=a)&&(n=a)}return n}function am(t=_n){if(t===_n)return _a;if("function"!=typeof t)throw new TypeError("compare is not a function");return(r,n)=>{const i=t(r,n);return i||0===i?i:(0===t(n,n))-(0===t(r,r))}}function _a(t,r){return(null==t||!(t>=t))-(null==r||!(r>=r))||(t<r?-1:t>r?1:0)}function om(t,r,n=0,i=1/0,a){if(r=Math.floor(r),n=Math.floor(Math.max(0,n)),i=Math.floor(Math.min(t.length-1,i)),!(n<=r&&r<=i))return t;for(a=void 0===a?_a:am(a);i>n;){if(i-n>600){const c=i-n+1,u=r-n+1,d=Math.log(c),f=.5*Math.exp(2*d/3),p=.5*Math.sqrt(d*f*(c-f)/c)*(u-c/2<0?-1:1);om(t,r,Math.max(n,Math.floor(r-u*f/c+p)),Math.min(i,Math.floor(r+(c-u)*f/c+p)),a)}const o=t[r];let s=n,l=i;for(ri(t,n,r),a(t[i],o)>0&&ri(t,n,i);s<l;){for(ri(t,s,l),++s,--l;a(t[s],o)<0;)++s;for(;a(t[l],o)>0;)--l}0===a(t[n],o)?ri(t,n,l):(++l,ri(t,l,i)),l<=r&&(n=l+1),r<=l&&(i=l-1)}return t}function ri(t,r,n){const i=t[r];t[r]=t[n],t[n]=i}function sm(t){return null===t?NaN:+t}function il(t,r,n){if(t=Float64Array.from(function*Ax(t,r){if(void 0===r)for(let n of t)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of t)null!=(i=r(i,++n,t))&&(i=+i)>=i&&(yield i)}}(t,n)),(i=t.length)&&!isNaN(r=+r)){if(r<=0||i<2)return va(t);if(r>=1)return yn(t);var i,a=(i-1)*r,o=Math.floor(a),s=yn(om(t,o).subarray(0,o+1));return s+(va(t.subarray(o+1))-s)*(a-o)}}function Mx(t,r,n=sm){if((i=t.length)&&!isNaN(r=+r)){if(r<=0||i<2)return+n(t[0],0,t);if(r>=1)return+n(t[i-1],i-1,t);var i,a=(i-1)*r,o=Math.floor(a),s=+n(t[o],o,t);return s+(+n(t[o+1],o+1,t)-s)*(a-o)}}function lm(t,r){return il(t,.5,r)}function al(t,r,n){t=+t,r=+r,n=(a=arguments.length)<2?(r=t,t=0,1):a<3?1:+n;for(var i=-1,a=0|Math.max(0,Math.ceil((r-t)/n)),o=new Array(a);++i<a;)o[i]=t+i*n;return o}vr(Rt,Zs,ei(vn,{brighter(t){return new Rt(this.l+18*(t??1),this.a,this.b,this.opacity)},darker(t){return new Rt(this.l-18*(t??1),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,r=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new Ve(tl(3.1338561*(r=Hf*el(r))-1.6168667*(t=Zf*el(t))-.4906146*(n=Kf*el(n))),tl(-.9787684*r+1.9161415*t+.033454*n),tl(.0719453*r-.2289914*t+1.4052427*n),this.opacity)}})),vr(Bt,ga,ei(vn,{brighter(t){return new Bt(this.h,this.c,this.l+18*(t??1),this.opacity)},darker(t){return new Bt(this.h,this.c,this.l-18*(t??1),this.opacity)},rgb(){return im(this).rgb()}}));const Px=Math.sqrt(50),Bx=Math.sqrt(10),Ox=Math.sqrt(2);function ya(t,r,n){const i=(r-t)/Math.max(0,n),a=Math.floor(Math.log10(i)),o=i/Math.pow(10,a),s=o>=Px?10:o>=Bx?5:o>=Ox?2:1;let l,c,u;return a<0?(u=Math.pow(10,-a)/s,l=Math.round(t*u),c=Math.round(r*u),l/u<t&&++l,c/u>r&&--c,u=-u):(u=Math.pow(10,a)*s,l=Math.round(t/u),c=Math.round(r/u),l*u<t&&++l,c*u>r&&--c),c<l&&.5<=n&&n<2?ya(t,r,2*n):[l,c,u]}function Ca(t,r,n){if(!((n=+n)>0))return[];if((t=+t)==(r=+r))return[t];const i=r<t,[a,o,s]=i?ya(r,t,n):ya(t,r,n);if(!(o>=a))return[];const l=o-a+1,c=new Array(l);if(i)if(s<0)for(let u=0;u<l;++u)c[u]=(o-u)/-s;else for(let u=0;u<l;++u)c[u]=(o-u)*s;else if(s<0)for(let u=0;u<l;++u)c[u]=(a+u)/-s;else for(let u=0;u<l;++u)c[u]=(a+u)*s;return c}function ol(t,r,n){return ya(t=+t,r=+r,n=+n)[2]}function sl(t,r,n){n=+n;const i=(r=+r)<(t=+t),a=i?ol(r,t,n):ol(t,r,n);return(i?-1:1)*(a<0?1/-a:a)}function xa(t){if("function"!=typeof t[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(t).reverse()}class cm extends Map{constructor(r,n=fm){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),null!=r)for(const[i,a]of r)this.set(i,a)}get(r){return super.get(ll(this,r))}has(r){return super.has(ll(this,r))}set(r,n){return super.set(um(this,r),n)}delete(r){return super.delete(dm(this,r))}}class Nx extends Set{constructor(r,n=fm){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),null!=r)for(const i of r)this.add(i)}has(r){return super.has(ll(this,r))}add(r){return super.add(um(this,r))}delete(r){return super.delete(dm(this,r))}}function ll({_intern:t,_key:r},n){const i=r(n);return t.has(i)?t.get(i):n}function um({_intern:t,_key:r},n){const i=r(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function dm({_intern:t,_key:r},n){const i=r(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function fm(t){return null!==t&&"object"==typeof t?t.valueOf():t}var Gx={value:()=>{}};function mm(){for(var i,t=0,r=arguments.length,n={};t<r;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Fa(n)}function Fa(t){this._=t}function Yx(t,r){for(var a,n=0,i=t.length;n<i;++n)if((a=t[n]).name===r)return a.value}function pm(t,r,n){for(var i=0,a=t.length;i<a;++i)if(t[i].name===r){t[i]=Gx,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:r,value:n}),t}Fa.prototype=mm.prototype={constructor:Fa,on:function(t,r){var a,n=this._,i=function Lx(t,r){return t.trim().split(/^|\s+/).map(function(n){var i="",a=n.indexOf(".");if(a>=0&&(i=n.slice(a+1),n=n.slice(0,a)),n&&!r.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}(t+"",n),o=-1,s=i.length;if(!(arguments.length<2)){if(null!=r&&"function"!=typeof r)throw new Error("invalid callback: "+r);for(;++o<s;)if(a=(t=i[o]).type)n[a]=pm(n[a],t.name,r);else if(null==r)for(a in n)n[a]=pm(n[a],t.name,null);return this}for(;++o<s;)if((a=(t=i[o]).type)&&(a=Yx(n[a],t.name)))return a},copy:function(){var t={},r=this._;for(var n in r)t[n]=r[n].slice();return new Fa(t)},call:function(t,r){if((a=arguments.length-2)>0)for(var a,o,n=new Array(a),i=0;i<a;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=0,a=(o=this._[t]).length;i<a;++i)o[i].value.apply(r,n)},apply:function(t,r,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],a=0,o=i.length;a<o;++a)i[a].value.apply(r,n)}};const Vx=mm;var Sa,oi,xr=0,ii=0,ai=0,hm=1e3,ka=0,Vn=0,$a=0,si="object"==typeof performance&&performance.now?performance:Date,gm="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function cl(){return Vn||(gm(zx),Vn=si.now()+$a)}function zx(){Vn=0}function Ia(){this._call=this._time=this._next=null}function bm(t,r,n){var i=new Ia;return i.restart(t,r,n),i}function vm(){Vn=(ka=si.now())+$a,xr=ii=0;try{!function qx(){cl(),++xr;for(var r,t=Sa;t;)(r=Vn-t._time)>=0&&t._call.call(void 0,r),t=t._next;--xr}()}finally{xr=0,function Xx(){for(var t,n,r=Sa,i=1/0;r;)r._call?(i>r._time&&(i=r._time),t=r,r=r._next):(n=r._next,r._next=null,r=t?t._next=n:Sa=n);oi=t,ul(i)}(),Vn=0}}function Ux(){var t=si.now(),r=t-ka;r>hm&&($a-=r,ka=t)}function ul(t){xr||(ii&&(ii=clearTimeout(ii)),t-Vn>24?(t<1/0&&(ii=setTimeout(vm,t-si.now()-$a)),ai&&(ai=clearInterval(ai))):(ai||(ka=si.now(),ai=setInterval(Ux,hm)),xr=1,gm(vm)))}function _m(t,r,n){var i=new Ia;return i.restart(a=>{i.stop(),t(a+r)},r=null==r?0:+r,n),i}Ia.prototype=bm.prototype={constructor:Ia,restart:function(t,r,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?cl():+n)+(null==r?0:+r),!this._next&&oi!==this&&(oi?oi._next=this:Sa=this,oi=this),this._call=t,this._time=n,ul()},stop:function(){this._call&&(this._call=null,this._time=1/0,ul())}};var Wx=Vx("start","end","cancel","interrupt"),Qx=[],ym=0,wa=3;function Ta(t,r,n,i,a,o){var s=t.__transition;if(s){if(n in s)return}else t.__transition={};!function Jx(t,r,n){var a,i=t.__transition;function s(u){var d,f,p,h;if(1!==n.state)return c();for(d in i)if((h=i[d]).name===n.name){if(h.state===wa)return _m(s);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[d]):+d<r&&(h.state=6,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[d])}if(_m(function(){n.state===wa&&(n.state=4,n.timer.restart(l,n.delay,n.time),l(u))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=wa,a=new Array(p=n.tween.length),d=0,f=-1;d<p;++d)(h=n.tween[d].value.call(t,t.__data__,n.index,n.group))&&(a[++f]=h);a.length=f+1}}function l(u){for(var d=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(c),n.state=5,1),f=-1,p=a.length;++f<p;)a[f].call(t,d);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){for(var u in n.state=6,n.timer.stop(),delete i[r],i)return;delete t.__transition}i[r]=n,n.timer=bm(function o(u){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)},0,n.time)}(t,n,{name:r,index:i,group:a,on:Wx,tween:Qx,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:ym})}function ml(t,r){var n=Tt(t,r);if(n.state>ym)throw new Error("too late; already scheduled");return n}function Ot(t,r){var n=Tt(t,r);if(n.state>wa)throw new Error("too late; already running");return n}function Tt(t,r){var n=t.__transition;if(!n||!(n=n[r]))throw new Error("transition not found");return n}function st(t,r){return t=+t,r=+r,function(n){return t*(1-n)+r*n}}var Ea,Fm=180/Math.PI,pl={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Sm(t,r,n,i,a,o){var s,l,c;return(s=Math.sqrt(t*t+r*r))&&(t/=s,r/=s),(c=t*n+r*i)&&(n-=t*c,i-=r*c),(l=Math.sqrt(n*n+i*i))&&(n/=l,i/=l,c/=l),t*i<r*n&&(t=-t,r=-r,c=-c,s=-s),{translateX:a,translateY:o,rotate:Math.atan2(r,t)*Fm,skewX:Math.atan(c)*Fm,scaleX:s,scaleY:l}}function km(t,r,n,i){function a(u){return u.length?u.pop()+" ":""}return function(u,d){var f=[],p=[];return u=t(u),d=t(d),function o(u,d,f,p,h,b){if(u!==f||d!==p){var g=h.push("translate(",null,r,null,n);b.push({i:g-4,x:st(u,f)},{i:g-2,x:st(d,p)})}else(f||p)&&h.push("translate("+f+r+p+n)}(u.translateX,u.translateY,d.translateX,d.translateY,f,p),function s(u,d,f,p){u!==d?(u-d>180?d+=360:d-u>180&&(u+=360),p.push({i:f.push(a(f)+"rotate(",null,i)-2,x:st(u,d)})):d&&f.push(a(f)+"rotate("+d+i)}(u.rotate,d.rotate,f,p),function l(u,d,f,p){u!==d?p.push({i:f.push(a(f)+"skewX(",null,i)-2,x:st(u,d)}):d&&f.push(a(f)+"skewX("+d+i)}(u.skewX,d.skewX,f,p),function c(u,d,f,p,h,b){if(u!==f||d!==p){var g=h.push(a(h)+"scale(",null,",",null,")");b.push({i:g-4,x:st(u,f)},{i:g-2,x:st(d,p)})}else(1!==f||1!==p)&&h.push(a(h)+"scale("+f+","+p+")")}(u.scaleX,u.scaleY,d.scaleX,d.scaleY,f,p),u=d=null,function(h){for(var _,b=-1,g=p.length;++b<g;)f[(_=p[b]).i]=_.x(h);return f.join("")}}}var tF=km(function Kx(t){const r=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return r.isIdentity?pl:Sm(r.a,r.b,r.c,r.d,r.e,r.f)},"px, ","px)","deg)"),nF=km(function eF(t){return null!=t&&(Ea||(Ea=document.createElementNS("http://www.w3.org/2000/svg","g")),Ea.setAttribute("transform",t),t=Ea.transform.baseVal.consolidate())?Sm((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):pl},", ",")",")");function rF(t,r){var n,i;return function(){var a=Ot(this,t),o=a.tween;if(o!==n)for(var s=0,l=(i=n=o).length;s<l;++s)if(i[s].name===r){(i=i.slice()).splice(s,1);break}a.tween=i}}function iF(t,r,n){var i,a;if("function"!=typeof n)throw new Error;return function(){var o=Ot(this,t),s=o.tween;if(s!==i){a=(i=s).slice();for(var l={name:r,value:n},c=0,u=a.length;c<u;++c)if(a[c].name===r){a[c]=l;break}c===u&&a.push(l)}o.tween=a}}function hl(t,r,n){var i=t._id;return t.each(function(){var a=Ot(this,i);(a.value||(a.value={}))[r]=n.apply(this,arguments)}),function(a){return Tt(a,i).value[r]}}function $m(t,r,n,i,a){var o=t*t,s=o*t;return((1-3*t+3*o-s)*r+(4-6*o+3*s)*n+(1+3*t+3*o-3*s)*i+s*a)/6}const ja=t=>()=>t;function Im(t,r){return function(n){return t+n*r}}function gl(t,r){var n=r-t;return n?Im(t,n>180||n<-180?n-360*Math.round(n/360):n):ja(isNaN(t)?r:t)}function ze(t,r){var n=r-t;return n?Im(t,n):ja(isNaN(t)?r:t)}const zn=function t(r){var n=function cF(t){return 1==(t=+t)?ze:function(r,n){return n-r?function lF(t,r,n){return t=Math.pow(t,n),r=Math.pow(r,n)-t,n=1/n,function(i){return Math.pow(t+i*r,n)}}(r,n,t):ja(isNaN(r)?n:r)}}(r);function i(a,o){var s=n((a=ni(a)).r,(o=ni(o)).r),l=n(a.g,o.g),c=n(a.b,o.b),u=ze(a.opacity,o.opacity);return function(d){return a.r=s(d),a.g=l(d),a.b=c(d),a.opacity=u(d),a+""}}return i.gamma=t,i}(1);function wm(t){return function(r){var s,l,n=r.length,i=new Array(n),a=new Array(n),o=new Array(n);for(s=0;s<n;++s)l=ni(r[s]),i[s]=l.r||0,a[s]=l.g||0,o[s]=l.b||0;return i=t(i),a=t(a),o=t(o),l.opacity=1,function(c){return l.r=i(c),l.g=a(c),l.b=o(c),l+""}}}var uF=wm(function oF(t){var r=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,r-1):Math.floor(n*r),a=t[i],o=t[i+1];return $m((n-i/r)*r,i>0?t[i-1]:2*a-o,a,o,i<r-1?t[i+2]:2*o-a)}}),bl=(wm(function sF(t){var r=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*r);return $m((n-i/r)*r,t[(i+r-1)%r],t[i%r],t[(i+1)%r],t[(i+2)%r])}}),/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g),vl=new RegExp(bl.source,"g");function Rm(t,r){var i,a,o,n=bl.lastIndex=vl.lastIndex=0,s=-1,l=[],c=[];for(t+="",r+="";(i=bl.exec(t))&&(a=vl.exec(r));)(o=a.index)>n&&(o=r.slice(n,o),l[s]?l[s]+=o:l[++s]=o),(i=i[0])===(a=a[0])?l[s]?l[s]+=a:l[++s]=a:(l[++s]=null,c.push({i:s,x:st(i,a)})),n=vl.lastIndex;return n<r.length&&(o=r.slice(n),l[s]?l[s]+=o:l[++s]=o),l.length<2?c[0]?function fF(t){return function(r){return t(r)+""}}(c[0].x):function dF(t){return function(){return t}}(r):(r=c.length,function(u){for(var f,d=0;d<r;++d)l[(f=c[d]).i]=f.x(u);return l.join("")})}function Tm(t,r){var n;return("number"==typeof r?st:r instanceof Gn?zn:(n=Gn(r))?(r=n,zn):Rm)(t,r)}function mF(t){return function(){this.removeAttribute(t)}}function pF(t){return function(){this.removeAttributeNS(t.space,t.local)}}function hF(t,r,n){var i,o,a=n+"";return function(){var s=this.getAttribute(t);return s===a?null:s===i?o:o=r(i=s,n)}}function gF(t,r,n){var i,o,a=n+"";return function(){var s=this.getAttributeNS(t.space,t.local);return s===a?null:s===i?o:o=r(i=s,n)}}function bF(t,r,n){var i,a,o;return function(){var s,c,l=n(this);return null==l?void this.removeAttribute(t):(s=this.getAttribute(t))===(c=l+"")?null:s===i&&c===a?o:(a=c,o=r(i=s,l))}}function vF(t,r,n){var i,a,o;return function(){var s,c,l=n(this);return null==l?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local))===(c=l+"")?null:s===i&&c===a?o:(a=c,o=r(i=s,l))}}function xF(t,r){var n,i;function a(){var o=r.apply(this,arguments);return o!==i&&(n=(i=o)&&function CF(t,r){return function(n){this.setAttributeNS(t.space,t.local,r.call(this,n))}}(t,o)),n}return a._value=r,a}function FF(t,r){var n,i;function a(){var o=r.apply(this,arguments);return o!==i&&(n=(i=o)&&function yF(t,r){return function(n){this.setAttribute(t,r.call(this,n))}}(t,o)),n}return a._value=r,a}function kF(t,r){return function(){ml(this,t).delay=+r.apply(this,arguments)}}function $F(t,r){return r=+r,function(){ml(this,t).delay=r}}function wF(t,r){return function(){Ot(this,t).duration=+r.apply(this,arguments)}}function RF(t,r){return r=+r,function(){Ot(this,t).duration=r}}var zF=Kr.prototype.constructor;function Em(t){return function(){this.style.removeProperty(t)}}var lS=0;function Jt(t,r,n,i){this._groups=t,this._parents=r,this._name=n,this._id=i}function jm(){return++lS}var Ht=Kr.prototype;Jt.prototype=function cS(t){return Kr().transition(t)}.prototype={constructor:Jt,select:function YF(t){var r=this._name,n=this._id;"function"!=typeof t&&(t=Us(t));for(var i=this._groups,a=i.length,o=new Array(a),s=0;s<a;++s)for(var d,f,l=i[s],c=l.length,u=o[s]=new Array(c),p=0;p<c;++p)(d=l[p])&&(f=t.call(d,d.__data__,p,l))&&("__data__"in d&&(f.__data__=d.__data__),u[p]=f,Ta(u[p],r,n,p,u,Tt(d,n)));return new Jt(o,this._parents,r,n)},selectAll:function VF(t){var r=this._name,n=this._id;"function"!=typeof t&&(t=$f(t));for(var i=this._groups,a=i.length,o=[],s=[],l=0;l<a;++l)for(var d,c=i[l],u=c.length,f=0;f<u;++f)if(d=c[f]){for(var h,p=t.call(d,d.__data__,f,c),b=Tt(d,n),g=0,_=p.length;g<_;++g)(h=p[g])&&Ta(h,r,n,g,p,b);o.push(p),s.push(d)}return new Jt(o,s,r,n)},selectChild:Ht.selectChild,selectChildren:Ht.selectChildren,filter:function MF(t){"function"!=typeof t&&(t=If(t));for(var r=this._groups,n=r.length,i=new Array(n),a=0;a<n;++a)for(var c,o=r[a],s=o.length,l=i[a]=[],u=0;u<s;++u)(c=o[u])&&t.call(c,c.__data__,u,o)&&l.push(c);return new Jt(i,this._parents,this._name,this._id)},merge:function PF(t){if(t._id!==this._id)throw new Error;for(var r=this._groups,n=t._groups,i=r.length,o=Math.min(i,n.length),s=new Array(i),l=0;l<o;++l)for(var p,c=r[l],u=n[l],d=c.length,f=s[l]=new Array(d),h=0;h<d;++h)(p=c[h]||u[h])&&(f[h]=p);for(;l<i;++l)s[l]=r[l];return new Jt(s,this._parents,this._name,this._id)},selection:function qF(){return new zF(this._groups,this._parents)},transition:function oS(){for(var t=this._name,r=this._id,n=jm(),i=this._groups,a=i.length,o=0;o<a;++o)for(var c,s=i[o],l=s.length,u=0;u<l;++u)if(c=s[u]){var d=Tt(c,r);Ta(c,t,n,u,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Jt(i,this._parents,t,n)},call:Ht.call,nodes:Ht.nodes,node:Ht.node,size:Ht.size,empty:Ht.empty,each:Ht.each,on:function NF(t,r){var n=this._id;return arguments.length<2?Tt(this.node(),n).on.on(t):this.each(function OF(t,r,n){var i,a,o=function BF(t){return(t+"").trim().split(/^|\s+/).every(function(r){var n=r.indexOf(".");return n>=0&&(r=r.slice(0,n)),!r||"start"===r})}(r)?ml:Ot;return function(){var s=o(this,t),l=s.on;l!==i&&(a=(i=l).copy()).on(r,n),s.on=a}}(n,t,r))},attr:function _F(t,r){var n=ua(t),i="transform"===n?nF:Tm;return this.attrTween(t,"function"==typeof r?(n.local?vF:bF)(n,i,hl(this,"attr."+t,r)):null==r?(n.local?pF:mF)(n):(n.local?gF:hF)(n,i,r))},attrTween:function SF(t,r){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==r)return this.tween(n,null);if("function"!=typeof r)throw new Error;var i=ua(t);return this.tween(n,(i.local?xF:FF)(i,r))},style:function JF(t,r,n){var i="transform"==(t+="")?tF:Tm;return null==r?this.styleTween(t,function UF(t,r){var n,i,a;return function(){var o=br(this,t),s=(this.style.removeProperty(t),br(this,t));return o===s?null:o===n&&s===i?a:a=r(n=o,i=s)}}(t,i)).on("end.style."+t,Em(t)):"function"==typeof r?this.styleTween(t,function WF(t,r,n){var i,a,o;return function(){var s=br(this,t),l=n(this),c=l+"";return null==l&&(this.style.removeProperty(t),c=l=br(this,t)),s===c?null:s===i&&c===a?o:(a=c,o=r(i=s,l))}}(t,i,hl(this,"style."+t,r))).each(function QF(t,r){var n,i,a,l,o="style."+r,s="end."+o;return function(){var c=Ot(this,t),u=c.on,d=null==c.value[o]?l||(l=Em(r)):void 0;(u!==n||a!==d)&&(i=(n=u).copy()).on(s,a=d),c.on=i}}(this._id,t)):this.styleTween(t,function XF(t,r,n){var i,o,a=n+"";return function(){var s=br(this,t);return s===a?null:s===i?o:o=r(i=s,n)}}(t,i,r),n).on("end.style."+t,null)},styleTween:function KF(t,r,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==r)return this.tween(i,null);if("function"!=typeof r)throw new Error;return this.tween(i,function ZF(t,r,n){var i,a;function o(){var s=r.apply(this,arguments);return s!==a&&(i=(a=s)&&function HF(t,r,n){return function(i){this.style.setProperty(t,r.call(this,i),n)}}(t,s,n)),i}return o._value=r,o}(t,r,n??""))},text:function nS(t){return this.tween("text","function"==typeof t?function tS(t){return function(){var r=t(this);this.textContent=r??""}}(hl(this,"text",t)):function eS(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function aS(t){var r="text";if(arguments.length<1)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,function iS(t){var r,n;function i(){var a=t.apply(this,arguments);return a!==n&&(r=(n=a)&&function rS(t){return function(r){this.textContent=t.call(this,r)}}(a)),r}return i._value=t,i}(t))},remove:function LF(){return this.on("end.remove",function GF(t){return function(){var r=this.parentNode;for(var n in this.__transition)if(+n!==t)return;r&&r.removeChild(this)}}(this._id))},tween:function aF(t,r){var n=this._id;if(t+="",arguments.length<2){for(var s,i=Tt(this.node(),n).tween,a=0,o=i.length;a<o;++a)if((s=i[a]).name===t)return s.value;return null}return this.each((null==r?rF:iF)(n,t,r))},delay:function IF(t){var r=this._id;return arguments.length?this.each(("function"==typeof t?kF:$F)(r,t)):Tt(this.node(),r).delay},duration:function TF(t){var r=this._id;return arguments.length?this.each(("function"==typeof t?wF:RF)(r,t)):Tt(this.node(),r).duration},ease:function jF(t){var r=this._id;return arguments.length?this.each(function EF(t,r){if("function"!=typeof r)throw new Error;return function(){Ot(this,t).ease=r}}(r,t)):Tt(this.node(),r).ease},easeVarying:function AF(t){if("function"!=typeof t)throw new Error;return this.each(function DF(t,r){return function(){var n=r.apply(this,arguments);if("function"!=typeof n)throw new Error;Ot(this,t).ease=n}}(this._id,t))},end:function sS(){var t,r,n=this,i=n._id,a=n.size();return new Promise(function(o,s){var l={value:s},c={value:function(){0==--a&&o()}};n.each(function(){var u=Ot(this,i),d=u.on;d!==t&&((r=(t=d).copy())._.cancel.push(l),r._.interrupt.push(l),r._.end.push(c)),u.on=r}),0===a&&o()})},[Symbol.iterator]:Ht[Symbol.iterator]};var dS={time:null,delay:0,duration:250,ease:function uS(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function fS(t,r){for(var n;!(n=t.__transition)||!(n=n[r]);)if(!(t=t.parentNode))throw new Error(`transition ${r} not found`);return n}Kr.prototype.interrupt=function Zx(t){return this.each(function(){!function Hx(t,r){var i,a,s,n=t.__transition,o=!0;if(n){for(s in r=null==r?null:r+"",n)(i=n[s]).name===r?(a=i.state>2&&i.state<5,i.state=6,i.timer.stop(),i.on.call(a?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[s]):o=!1;o&&delete t.__transition}}(this,t)})},Kr.prototype.transition=function mS(t){var r,n;t instanceof Jt?(r=t._id,t=t._name):(r=jm(),(n=dS).time=cl(),t=null==t?null:t+"");for(var i=this._groups,a=i.length,o=0;o<a;++o)for(var c,s=i[o],l=s.length,u=0;u<l;++u)(c=s[u])&&Ta(c,t,r,u,s,n||fS(c,r));return new Jt(i,this._parents,t,r)};Math;function li(t){return{type:t}}function Fl(t,r){return t=+t,r=+r,function(n){return Math.round(t*(1-n)+r*n)}}function Om(t){return function(r,n){var i=t((r=Js(r)).h,(n=Js(n)).h),a=ze(r.s,n.s),o=ze(r.l,n.l),s=ze(r.opacity,n.opacity);return function(l){return r.h=i(l),r.s=a(l),r.l=o(l),r.opacity=s(l),r+""}}}["w","e"].map(li),["n","s"].map(li),["n","w","e","s","nw","ne","sw","se"].map(li);const CS=Om(gl);function Nm(t){return function(r,n){var i=t((r=ga(r)).h,(n=ga(n)).h),a=ze(r.c,n.c),o=ze(r.l,n.l),s=ze(r.opacity,n.opacity);return function(l){return r.h=i(l),r.c=a(l),r.l=o(l),r.opacity=s(l),r+""}}}Om(ze);const FS=Nm(gl);function Gm(t,r){var s,n=r?r.length:0,i=t?Math.min(n,t.length):0,a=new Array(i),o=new Array(n);for(s=0;s<i;++s)a[s]=ci(t[s],r[s]);for(;s<n;++s)o[s]=r[s];return function(l){for(s=0;s<i;++s)o[s]=a[s](l);return o}}function SS(t,r){var n=new Date;return t=+t,r=+r,function(i){return n.setTime(t*(1-i)+r*i),n}}function kS(t,r){var a,n={},i={};for(a in(null===t||"object"!=typeof t)&&(t={}),(null===r||"object"!=typeof r)&&(r={}),r)a in t?n[a]=ci(t[a],r[a]):i[a]=r[a];return function(o){for(a in n)i[a]=n[a](o);return i}}function $S(t,r){r||(r=[]);var a,n=t?Math.min(r.length,t.length):0,i=r.slice();return function(o){for(a=0;a<n;++a)i[a]=t[a]*(1-o)+r[a]*o;return i}}function ci(t,r){var i,n=typeof r;return null==r||"boolean"===n?ja(r):("number"===n?st:"string"===n?(i=Gn(r))?(r=i,zn):Rm:r instanceof Gn?zn:r instanceof Date?SS:function IS(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}(r)?$S:Array.isArray(r)?Gm:"function"!=typeof r.valueOf&&"function"!=typeof r.toString||isNaN(r)?kS:st)(t,r)}function Lm(t,r){void 0===r&&(r=t,t=ci);for(var n=0,i=r.length-1,a=r[0],o=new Array(i<0?0:i);n<i;)o[n]=t(a,a=r[++n]);return function(s){var l=Math.max(0,Math.min(i-1,Math.floor(s*=i)));return o[l](s-l)}}function Nt(t,r){for(var n=new Array(r),i=0;i<r;++i)n[i]=t(i/(r-1));return n}function Gt(t,r){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(r).domain(t)}return this}function Ma(t,r){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof r?this.interpolator(r):this.range(r)}return this}Nm(ze);const Sl=Symbol("implicit");function kl(){var t=new cm,r=[],n=[],i=Sl;function a(o){let s=t.get(o);if(void 0===s){if(i!==Sl)return i;t.set(o,s=r.push(o)-1)}return n[s%n.length]}return a.domain=function(o){if(!arguments.length)return r.slice();r=[],t=new cm;for(const s of o)t.has(s)||t.set(s,r.push(s)-1);return a},a.range=function(o){return arguments.length?(n=Array.from(o),a):n.slice()},a.unknown=function(o){return arguments.length?(i=o,a):i},a.copy=function(){return kl(r,n).unknown(i)},Gt.apply(a,arguments),a}function $l(){var o,s,t=kl().unknown(void 0),r=t.domain,n=t.range,i=0,a=1,l=!1,c=0,u=0,d=.5;function f(){var p=r().length,h=a<i,b=h?a:i,g=h?i:a;o=(g-b)/Math.max(1,p-c+2*u),l&&(o=Math.floor(o)),b+=(g-b-o*(p-c))*d,s=o*(1-c),l&&(b=Math.round(b),s=Math.round(s));var _=al(p).map(function(C){return b+o*C});return n(h?_.reverse():_)}return delete t.unknown,t.domain=function(p){return arguments.length?(r(p),f()):r()},t.range=function(p){return arguments.length?([i,a]=p,i=+i,a=+a,f()):[i,a]},t.rangeRound=function(p){return[i,a]=p,i=+i,a=+a,l=!0,f()},t.bandwidth=function(){return s},t.step=function(){return o},t.round=function(p){return arguments.length?(l=!!p,f()):l},t.padding=function(p){return arguments.length?(c=Math.min(1,u=+p),f()):c},t.paddingInner=function(p){return arguments.length?(c=Math.min(1,p),f()):c},t.paddingOuter=function(p){return arguments.length?(u=+p,f()):u},t.align=function(p){return arguments.length?(d=Math.max(0,Math.min(1,p)),f()):d},t.copy=function(){return $l(r(),[i,a]).round(l).paddingInner(c).paddingOuter(u).align(d)},Gt.apply(f(),arguments)}function Ym(t){var r=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return Ym(r())},t}function wS(){return Ym($l.apply(null,arguments).paddingInner(1))}function Il(t){let r,n,i;function a(l,c,u=0,d=l.length){if(u<d){if(0!==r(c,c))return d;do{const f=u+d>>>1;n(l[f],c)<0?u=f+1:d=f}while(u<d)}return u}return 2!==t.length?(r=_n,n=(l,c)=>_n(t(l),c),i=(l,c)=>t(l)-c):(r=t===_n||t===ba?t:RS,n=t,i=t),{left:a,center:function s(l,c,u=0,d=l.length){const f=a(l,c,u,d-1);return f>u&&i(l[f-1],c)>-i(l[f],c)?f-1:f},right:function o(l,c,u=0,d=l.length){if(u<d){if(0!==r(c,c))return d;do{const f=u+d>>>1;n(l[f],c)<=0?u=f+1:d=f}while(u<d)}return u}}}function RS(){return 0}const TS=Il(_n).right,wl=(Il(sm),TS);function Rl(t){return+t}var zm=[0,1];function Ct(t){return t}function Tl(t,r){return(r-=t=+t)?function(n){return(n-t)/r}:function ES(t){return function(){return t}}(isNaN(r)?NaN:.5)}function DS(t,r,n){var i=t[0],a=t[1],o=r[0],s=r[1];return a<i?(i=Tl(a,i),o=n(s,o)):(i=Tl(i,a),o=n(o,s)),function(l){return o(i(l))}}function AS(t,r,n){var i=Math.min(t.length,r.length)-1,a=new Array(i),o=new Array(i),s=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),r=r.slice().reverse());++s<i;)a[s]=Tl(t[s],t[s+1]),o[s]=n(r[s],r[s+1]);return function(l){var c=wl(t,l,1,i)-1;return o[c](a[c](l))}}function ui(t,r){return r.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Pa(){var i,a,o,l,c,u,t=zm,r=zm,n=ci,s=Ct;function d(){var p=Math.min(t.length,r.length);return s!==Ct&&(s=function jS(t,r){var n;return t>r&&(n=t,t=r,r=n),function(i){return Math.max(t,Math.min(r,i))}}(t[0],t[p-1])),l=p>2?AS:DS,c=u=null,f}function f(p){return null==p||isNaN(p=+p)?o:(c||(c=l(t.map(i),r,n)))(i(s(p)))}return f.invert=function(p){return s(a((u||(u=l(r,t.map(i),st)))(p)))},f.domain=function(p){return arguments.length?(t=Array.from(p,Rl),d()):t.slice()},f.range=function(p){return arguments.length?(r=Array.from(p),d()):r.slice()},f.rangeRound=function(p){return r=Array.from(p),n=Fl,d()},f.clamp=function(p){return arguments.length?(s=!!p||Ct,d()):s!==Ct},f.interpolate=function(p){return arguments.length?(n=p,d()):n},f.unknown=function(p){return arguments.length?(o=p,f):o},function(p,h){return i=p,a=h,d()}}function qm(){return Pa()(Ct,Ct)}var Um,MS=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function di(t){if(!(r=MS.exec(t)))throw new Error("invalid format: "+t);var r;return new El({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}function El(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Ba(t,r){if((n=(t=r?t.toExponential(r-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function kr(t){return(t=Ba(Math.abs(t)))?t[1]:NaN}function Xm(t,r){var n=Ba(t,r);if(!n)return t+"";var i=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+i:i.length>a+1?i.slice(0,a+1)+"."+i.slice(a+1):i+new Array(a-i.length+2).join("0")}di.prototype=El.prototype,El.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Wm={"%":(t,r)=>(100*t).toFixed(r),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function PS(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,r)=>t.toExponential(r),f:(t,r)=>t.toFixed(r),g:(t,r)=>t.toPrecision(r),o:t=>Math.round(t).toString(8),p:(t,r)=>Xm(100*t,r),r:Xm,s:function LS(t,r){var n=Ba(t,r);if(!n)return t+"";var i=n[0],a=n[1],o=a-(Um=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Ba(t,Math.max(0,r+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Qm(t){return t}var Oa,jl,Zm,Jm=Array.prototype.map,Hm=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function fi(t){var r=t.domain;return t.ticks=function(n){var i=r();return Ca(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var a=r();return function US(t,r,n,i){var o,a=sl(t,r,n);switch((i=di(i??",f")).type){case"s":var s=Math.max(Math.abs(t),Math.abs(r));return null==i.precision&&!isNaN(o=function BS(t,r){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(kr(r)/3)))-kr(Math.abs(t)))}(a,s))&&(i.precision=o),Zm(i,s);case"":case"e":case"g":case"p":case"r":null==i.precision&&!isNaN(o=function zS(t,r){return t=Math.abs(t),r=Math.abs(r)-t,Math.max(0,kr(r)-kr(t))+1}(a,Math.max(Math.abs(t),Math.abs(r))))&&(i.precision=o-("e"===i.type));break;case"f":case"%":null==i.precision&&!isNaN(o=function qS(t){return Math.max(0,-kr(Math.abs(t)))}(a))&&(i.precision=o-2*("%"===i.type))}return jl(i)}(a[0],a[a.length-1],n??10,i)},t.nice=function(n){null==n&&(n=10);var c,u,i=r(),a=0,o=i.length-1,s=i[a],l=i[o],d=10;for(l<s&&(u=s,s=l,l=u,u=a,a=o,o=u);d-- >0;){if((u=ol(s,l,n))===c)return i[a]=s,i[o]=l,r(i);if(u>0)s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u;else{if(!(u<0))break;s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u}c=u}return t},t}function Km(){var t=qm();return t.copy=function(){return ui(t,Km())},Gt.apply(t,arguments),fi(t)}function ep(t){var r;function n(i){return null==i||isNaN(i=+i)?r:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(t=Array.from(i,Rl),n):t.slice()},n.unknown=function(i){return arguments.length?(r=i,n):r},n.copy=function(){return ep(t).unknown(r)},t=arguments.length?Array.from(t,Rl):[0,1],fi(n)}function tp(t,r){var s,n=0,i=(t=t.slice()).length-1,a=t[n],o=t[i];return o<a&&(s=n,n=i,i=s,s=a,a=o,o=s),t[n]=r.floor(a),t[i]=r.ceil(o),t}function np(t){return Math.log(t)}function rp(t){return Math.exp(t)}function XS(t){return-Math.log(-t)}function WS(t){return-Math.exp(-t)}function QS(t){return isFinite(t)?+("1e"+t):t<0?0:t}function ip(t){return(r,n)=>-t(-r,n)}function ap(t){const r=t(np,rp),n=r.domain;let a,o,i=10;function s(){return a=function HS(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),r=>Math.log(r)/t)}(i),o=function JS(t){return 10===t?QS:t===Math.E?Math.exp:r=>Math.pow(t,r)}(i),n()[0]<0?(a=ip(a),o=ip(o),t(XS,WS)):t(np,rp),r}return r.base=function(l){return arguments.length?(i=+l,s()):i},r.domain=function(l){return arguments.length?(n(l),s()):n()},r.ticks=l=>{const c=n();let u=c[0],d=c[c.length-1];const f=d<u;f&&([u,d]=[d,u]);let b,g,p=a(u),h=a(d);const _=null==l?10:+l;let C=[];if(!(i%1)&&h-p<_){if(p=Math.floor(p),h=Math.ceil(h),u>0){for(;p<=h;++p)for(b=1;b<i;++b)if(g=p<0?b/o(-p):b*o(p),!(g<u)){if(g>d)break;C.push(g)}}else for(;p<=h;++p)for(b=i-1;b>=1;--b)if(g=p>0?b/o(-p):b*o(p),!(g<u)){if(g>d)break;C.push(g)}2*C.length<_&&(C=Ca(u,d,_))}else C=Ca(p,h,Math.min(h-p,_)).map(o);return f?C.reverse():C},r.tickFormat=(l,c)=>{if(null==l&&(l=10),null==c&&(c=10===i?"s":","),"function"!=typeof c&&(!(i%1)&&null==(c=di(c)).precision&&(c.trim=!0),c=jl(c)),l===1/0)return c;const u=Math.max(1,i*l/r.ticks().length);return d=>{let f=d/o(Math.round(a(d)));return f*i<i-.5&&(f*=i),f<=u?c(d):""}},r.nice=()=>n(tp(n(),{floor:l=>o(Math.floor(a(l))),ceil:l=>o(Math.ceil(a(l)))})),r}function op(){const t=ap(Pa()).domain([1,10]);return t.copy=()=>ui(t,op()).base(t.base()),Gt.apply(t,arguments),t}function sp(t){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/t))}}function lp(t){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*t}}function cp(t){var r=1,n=t(sp(r),lp(r));return n.constant=function(i){return arguments.length?t(sp(r=+i),lp(r)):r},fi(n)}function up(){var t=cp(Pa());return t.copy=function(){return ui(t,up()).constant(t.constant())},Gt.apply(t,arguments)}function dp(t){return function(r){return r<0?-Math.pow(-r,t):Math.pow(r,t)}}function ZS(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function KS(t){return t<0?-t*t:t*t}function fp(t){var r=t(Ct,Ct),n=1;return r.exponent=function(a){return arguments.length?(n=+a,function i(){return 1===n?t(Ct,Ct):.5===n?t(ZS,KS):t(dp(n),dp(1/n))}()):n},fi(r)}function Dl(){var t=fp(Pa());return t.copy=function(){return ui(t,Dl()).exponent(t.exponent())},Gt.apply(t,arguments),t}function mp(){var i,t=[],r=[],n=[];function a(){var s=0,l=Math.max(1,r.length);for(n=new Array(l-1);++s<l;)n[s-1]=Mx(t,s/l);return o}function o(s){return null==s||isNaN(s=+s)?i:r[wl(n,s)]}return o.invertExtent=function(s){var l=r.indexOf(s);return l<0?[NaN,NaN]:[l>0?n[l-1]:t[0],l<n.length?n[l]:t[t.length-1]]},o.domain=function(s){if(!arguments.length)return t.slice();t=[];for(let l of s)null!=l&&!isNaN(l=+l)&&t.push(l);return t.sort(_n),a()},o.range=function(s){return arguments.length?(r=Array.from(s),a()):r.slice()},o.unknown=function(s){return arguments.length?(i=s,o):i},o.quantiles=function(){return n.slice()},o.copy=function(){return mp().domain(t).range(r).unknown(i)},Gt.apply(o,arguments)}function pp(){var n,t=[.5],r=[0,1],i=1;function a(o){return null!=o&&o<=o?r[wl(t,o,0,i)]:n}return a.domain=function(o){return arguments.length?(t=Array.from(o),i=Math.min(t.length,r.length-1),a):t.slice()},a.range=function(o){return arguments.length?(r=Array.from(o),i=Math.min(t.length,r.length-1),a):r.slice()},a.invertExtent=function(o){var s=r.indexOf(o);return[t[s-1],t[s]]},a.unknown=function(o){return arguments.length?(n=o,a):n},a.copy=function(){return pp().domain(t).range(r).unknown(n)},Gt.apply(a,arguments)}!function VS(t){Oa=function YS(t){var r=void 0===t.grouping||void 0===t.thousands?Qm:function OS(t,r){return function(n,i){for(var a=n.length,o=[],s=0,l=t[0],c=0;a>0&&l>0&&(c+l+1>i&&(l=Math.max(1,i-c)),o.push(n.substring(a-=l,a+l)),!((c+=l+1)>i));)l=t[s=(s+1)%t.length];return o.reverse().join(r)}}(Jm.call(t.grouping,Number),t.thousands+""),n=void 0===t.currency?"":t.currency[0]+"",i=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",o=void 0===t.numerals?Qm:function NS(t){return function(r){return r.replace(/[0-9]/g,function(n){return t[+n]})}}(Jm.call(t.numerals,String)),s=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"\u2212":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function u(f){var p=(f=di(f)).fill,h=f.align,b=f.sign,g=f.symbol,_=f.zero,C=f.width,S=f.comma,F=f.precision,D=f.trim,A=f.type;"n"===A?(S=!0,A="g"):Wm[A]||(void 0===F&&(F=12),D=!0,A="g"),(_||"0"===p&&"="===h)&&(_=!0,p="0",h="=");var P="$"===g?n:"#"===g&&/[boxX]/.test(A)?"0"+A.toLowerCase():"",z="$"===g?i:/[%p]/.test(A)?s:"",q=Wm[A],ae=/[defgprs%]/.test(A);function Y(B){var v,x,y,E=P,I=z;if("c"===A)I=q(B)+I,B="";else{var k=(B=+B)<0||1/B<0;if(B=isNaN(B)?c:q(Math.abs(B),F),D&&(B=function GS(t){e:for(var a,r=t.length,n=1,i=-1;n<r;++n)switch(t[n]){case".":i=a=n;break;case"0":0===i&&(i=n),a=n;break;default:if(!+t[n])break e;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(a+1):t}(B)),k&&0==+B&&"+"!==b&&(k=!1),E=(k?"("===b?b:l:"-"===b||"("===b?"":b)+E,I=("s"===A?Hm[8+Um/3]:"")+I+(k&&"("===b?")":""),ae)for(v=-1,x=B.length;++v<x;)if(48>(y=B.charCodeAt(v))||y>57){I=(46===y?a+B.slice(v+1):B.slice(v))+I,B=B.slice(0,v);break}}S&&!_&&(B=r(B,1/0));var $=E.length+B.length+I.length,w=$<C?new Array(C-$+1).join(p):"";switch(S&&_&&(B=r(w+B,w.length?C-I.length:1/0),w=""),h){case"<":B=E+B+I+w;break;case"=":B=E+w+B+I;break;case"^":B=w.slice(0,$=w.length>>1)+E+B+I+w.slice($);break;default:B=w+E+B+I}return o(B)}return F=void 0===F?6:/[gprs]/.test(A)?Math.max(1,Math.min(21,F)):Math.max(0,Math.min(20,F)),Y.toString=function(){return f+""},Y}return{format:u,formatPrefix:function d(f,p){var h=u(((f=di(f)).type="f",f)),b=3*Math.max(-8,Math.min(8,Math.floor(kr(p)/3))),g=Math.pow(10,-b),_=Hm[8+b/3];return function(C){return h(g*C)+_}}}}(t),jl=Oa.format,Zm=Oa.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});const Kt=1e3,xt=6e4,en=60*xt,tn=24*en,Al=7*tn,hp=30*tn,Ml=365*tn,Pl=new Date,Bl=new Date;function Ge(t,r,n,i){function a(o){return t(o=0===arguments.length?new Date:new Date(+o)),o}return a.floor=o=>(t(o=new Date(+o)),o),a.ceil=o=>(t(o=new Date(o-1)),r(o,1),t(o),o),a.round=o=>{const s=a(o),l=a.ceil(o);return o-s<l-o?s:l},a.offset=(o,s)=>(r(o=new Date(+o),null==s?1:Math.floor(s)),o),a.range=(o,s,l)=>{const c=[];if(o=a.ceil(o),l=null==l?1:Math.floor(l),!(o<s&&l>0))return c;let u;do{c.push(u=new Date(+o)),r(o,l),t(o)}while(u<o&&o<s);return c},a.filter=o=>Ge(s=>{if(s>=s)for(;t(s),!o(s);)s.setTime(s-1)},(s,l)=>{if(s>=s)if(l<0)for(;++l<=0;)for(;r(s,-1),!o(s););else for(;--l>=0;)for(;r(s,1),!o(s););}),n&&(a.count=(o,s)=>(Pl.setTime(+o),Bl.setTime(+s),t(Pl),t(Bl),Math.floor(n(Pl,Bl))),a.every=o=>(o=Math.floor(o),isFinite(o)&&o>0?o>1?a.filter(i?s=>i(s)%o==0:s=>a.count(0,s)%o==0):a:null)),a}const Na=Ge(()=>{},(t,r)=>{t.setTime(+t+r)},(t,r)=>r-t);Na.every=t=>(t=Math.floor(t),isFinite(t)&&t>0?t>1?Ge(r=>{r.setTime(Math.floor(r/t)*t)},(r,n)=>{r.setTime(+r+n*t)},(r,n)=>(n-r)/t):Na:null);const nn=Ge(t=>{t.setTime(t-t.getMilliseconds())},(t,r)=>{t.setTime(+t+r*Kt)},(t,r)=>(r-t)/Kt,t=>t.getUTCSeconds()),Ga=Ge(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Kt)},(t,r)=>{t.setTime(+t+r*xt)},(t,r)=>(r-t)/xt,t=>t.getMinutes()),La=Ge(t=>{t.setUTCSeconds(0,0)},(t,r)=>{t.setTime(+t+r*xt)},(t,r)=>(r-t)/xt,t=>t.getUTCMinutes()),Ya=Ge(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Kt-t.getMinutes()*xt)},(t,r)=>{t.setTime(+t+r*en)},(t,r)=>(r-t)/en,t=>t.getHours()),Va=Ge(t=>{t.setUTCMinutes(0,0,0)},(t,r)=>{t.setTime(+t+r*en)},(t,r)=>(r-t)/en,t=>t.getUTCHours()),$r=Ge(t=>t.setHours(0,0,0,0),(t,r)=>t.setDate(t.getDate()+r),(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*xt)/tn,t=>t.getDate()-1),mi=Ge(t=>{t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r)},(t,r)=>(r-t)/tn,t=>t.getUTCDate()-1),gp=Ge(t=>{t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r)},(t,r)=>(r-t)/tn,t=>Math.floor(t/tn));function qn(t){return Ge(r=>{r.setDate(r.getDate()-(r.getDay()+7-t)%7),r.setHours(0,0,0,0)},(r,n)=>{r.setDate(r.getDate()+7*n)},(r,n)=>(n-r-(n.getTimezoneOffset()-r.getTimezoneOffset())*xt)/Al)}const Ir=qn(0),pi=qn(1),bp=qn(2),vp=qn(3),Un=qn(4),_p=qn(5),yp=qn(6);function Xn(t){return Ge(r=>{r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-t)%7),r.setUTCHours(0,0,0,0)},(r,n)=>{r.setUTCDate(r.getUTCDate()+7*n)},(r,n)=>(n-r)/Al)}const wr=Xn(0),hi=Xn(1),Cp=Xn(2),xp=Xn(3),Wn=Xn(4),Fp=Xn(5),Sp=Xn(6),Rr=Ge(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,r)=>{t.setMonth(t.getMonth()+r)},(t,r)=>r.getMonth()-t.getMonth()+12*(r.getFullYear()-t.getFullYear()),t=>t.getMonth()),Tr=Ge(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCMonth(t.getUTCMonth()+r)},(t,r)=>r.getUTCMonth()-t.getUTCMonth()+12*(r.getUTCFullYear()-t.getUTCFullYear()),t=>t.getUTCMonth()),Lt=Ge(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r)},(t,r)=>r.getFullYear()-t.getFullYear(),t=>t.getFullYear());Lt.every=t=>isFinite(t=Math.floor(t))&&t>0?Ge(r=>{r.setFullYear(Math.floor(r.getFullYear()/t)*t),r.setMonth(0,1),r.setHours(0,0,0,0)},(r,n)=>{r.setFullYear(r.getFullYear()+n*t)}):null;const Yt=Ge(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r)},(t,r)=>r.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());function kp(t,r,n,i,a,o){const s=[[nn,1,Kt],[nn,5,5e3],[nn,15,15e3],[nn,30,3e4],[o,1,xt],[o,5,5*xt],[o,15,15*xt],[o,30,30*xt],[a,1,en],[a,3,3*en],[a,6,6*en],[a,12,12*en],[i,1,tn],[i,2,2*tn],[n,1,Al],[r,1,hp],[r,3,3*hp],[t,1,Ml]];function c(u,d,f){const p=Math.abs(d-u)/f,h=Il(([,,_])=>_).right(s,p);if(h===s.length)return t.every(sl(u/Ml,d/Ml,f));if(0===h)return Na.every(Math.max(sl(u,d,f),1));const[b,g]=s[p/s[h-1][2]<s[h][2]/p?h-1:h];return b.every(g)}return[function l(u,d,f){const p=d<u;p&&([u,d]=[d,u]);const h=f&&"function"==typeof f.range?f:c(u,d,f),b=h?h.range(u,+d+1):[];return p?b.reverse():b},c]}Yt.every=t=>isFinite(t=Math.floor(t))&&t>0?Ge(r=>{r.setUTCFullYear(Math.floor(r.getUTCFullYear()/t)*t),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},(r,n)=>{r.setUTCFullYear(r.getUTCFullYear()+n*t)}):null;const[ek,tk]=kp(Yt,Tr,wr,gp,Va,La),[nk,rk]=kp(Lt,Rr,Ir,$r,Ya,Ga);function Ol(t){if(0<=t.y&&t.y<100){var r=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return r.setFullYear(t.y),r}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Nl(t){if(0<=t.y&&t.y<100){var r=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return r.setUTCFullYear(t.y),r}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function gi(t,r,n){return{y:t,m:r,d:n,H:0,M:0,S:0,L:0}}var Er,Gp,Lp,$p={"-":"",_:" ",0:"0"},qe=/^\s*\d+/,ak=/^%/,ok=/[\\^$*+?|[\]().{}]/g;function me(t,r,n){var i=t<0?"-":"",a=(i?-t:t)+"",o=a.length;return i+(o<n?new Array(n-o+1).join(r)+a:a)}function sk(t){return t.replace(ok,"\\$&")}function bi(t){return new RegExp("^(?:"+t.map(sk).join("|")+")","i")}function vi(t){return new Map(t.map((r,n)=>[r.toLowerCase(),n]))}function lk(t,r,n){var i=qe.exec(r.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function ck(t,r,n){var i=qe.exec(r.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function uk(t,r,n){var i=qe.exec(r.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function dk(t,r,n){var i=qe.exec(r.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function fk(t,r,n){var i=qe.exec(r.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function Ip(t,r,n){var i=qe.exec(r.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function wp(t,r,n){var i=qe.exec(r.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function mk(t,r,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function pk(t,r,n){var i=qe.exec(r.slice(n,n+1));return i?(t.q=3*i[0]-3,n+i[0].length):-1}function hk(t,r,n){var i=qe.exec(r.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function Rp(t,r,n){var i=qe.exec(r.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function gk(t,r,n){var i=qe.exec(r.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function Tp(t,r,n){var i=qe.exec(r.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function bk(t,r,n){var i=qe.exec(r.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function vk(t,r,n){var i=qe.exec(r.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function _k(t,r,n){var i=qe.exec(r.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function yk(t,r,n){var i=qe.exec(r.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function Ck(t,r,n){var i=ak.exec(r.slice(n,n+1));return i?n+i[0].length:-1}function xk(t,r,n){var i=qe.exec(r.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function Fk(t,r,n){var i=qe.exec(r.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function Ep(t,r){return me(t.getDate(),r,2)}function Sk(t,r){return me(t.getHours(),r,2)}function kk(t,r){return me(t.getHours()%12||12,r,2)}function $k(t,r){return me(1+$r.count(Lt(t),t),r,3)}function jp(t,r){return me(t.getMilliseconds(),r,3)}function Ik(t,r){return jp(t,r)+"000"}function wk(t,r){return me(t.getMonth()+1,r,2)}function Rk(t,r){return me(t.getMinutes(),r,2)}function Tk(t,r){return me(t.getSeconds(),r,2)}function Ek(t){var r=t.getDay();return 0===r?7:r}function jk(t,r){return me(Ir.count(Lt(t)-1,t),r,2)}function Dp(t){var r=t.getDay();return r>=4||0===r?Un(t):Un.ceil(t)}function Dk(t,r){return t=Dp(t),me(Un.count(Lt(t),t)+(4===Lt(t).getDay()),r,2)}function Ak(t){return t.getDay()}function Mk(t,r){return me(pi.count(Lt(t)-1,t),r,2)}function Pk(t,r){return me(t.getFullYear()%100,r,2)}function Bk(t,r){return me((t=Dp(t)).getFullYear()%100,r,2)}function Ok(t,r){return me(t.getFullYear()%1e4,r,4)}function Nk(t,r){var n=t.getDay();return me((t=n>=4||0===n?Un(t):Un.ceil(t)).getFullYear()%1e4,r,4)}function Gk(t){var r=t.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+me(r/60|0,"0",2)+me(r%60,"0",2)}function Ap(t,r){return me(t.getUTCDate(),r,2)}function Lk(t,r){return me(t.getUTCHours(),r,2)}function Yk(t,r){return me(t.getUTCHours()%12||12,r,2)}function Vk(t,r){return me(1+mi.count(Yt(t),t),r,3)}function Mp(t,r){return me(t.getUTCMilliseconds(),r,3)}function zk(t,r){return Mp(t,r)+"000"}function qk(t,r){return me(t.getUTCMonth()+1,r,2)}function Uk(t,r){return me(t.getUTCMinutes(),r,2)}function Xk(t,r){return me(t.getUTCSeconds(),r,2)}function Wk(t){var r=t.getUTCDay();return 0===r?7:r}function Qk(t,r){return me(wr.count(Yt(t)-1,t),r,2)}function Pp(t){var r=t.getUTCDay();return r>=4||0===r?Wn(t):Wn.ceil(t)}function Jk(t,r){return t=Pp(t),me(Wn.count(Yt(t),t)+(4===Yt(t).getUTCDay()),r,2)}function Hk(t){return t.getUTCDay()}function Zk(t,r){return me(hi.count(Yt(t)-1,t),r,2)}function Kk(t,r){return me(t.getUTCFullYear()%100,r,2)}function e6(t,r){return me((t=Pp(t)).getUTCFullYear()%100,r,2)}function t6(t,r){return me(t.getUTCFullYear()%1e4,r,4)}function n6(t,r){var n=t.getUTCDay();return me((t=n>=4||0===n?Wn(t):Wn.ceil(t)).getUTCFullYear()%1e4,r,4)}function r6(){return"+0000"}function Bp(){return"%"}function Op(t){return+t}function Np(t){return Math.floor(+t/1e3)}function s6(t){return new Date(t)}function l6(t){return t instanceof Date?+t:+new Date(+t)}function Gl(t,r,n,i,a,o,s,l,c,u){var d=qm(),f=d.invert,p=d.domain,h=u(".%L"),b=u(":%S"),g=u("%I:%M"),_=u("%I %p"),C=u("%a %d"),S=u("%b %d"),F=u("%B"),D=u("%Y");function A(P){return(c(P)<P?h:l(P)<P?b:s(P)<P?g:o(P)<P?_:i(P)<P?a(P)<P?C:S:n(P)<P?F:D)(P)}return d.invert=function(P){return new Date(f(P))},d.domain=function(P){return arguments.length?p(Array.from(P,l6)):p().map(s6)},d.ticks=function(P){var z=p();return t(z[0],z[z.length-1],P??10)},d.tickFormat=function(P,z){return null==z?A:u(z)},d.nice=function(P){var z=p();return(!P||"function"!=typeof P.range)&&(P=r(z[0],z[z.length-1],P??10)),P?p(tp(z,P)):d},d.copy=function(){return ui(d,Gl(t,r,n,i,a,o,s,l,c,u))},d}function Cn(t,r){return r.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function qa(){var a,o,s,l,c,d,p,t=0,r=.5,n=1,i=1,u=Ct,f=!1;function h(g){return isNaN(g=+g)?p:(g=.5+((g=+d(g))-o)*(i*g<i*o?l:c),u(f?Math.max(0,Math.min(1,g)):g))}function b(g){return function(_){var C,S,F;return arguments.length?([C,S,F]=_,u=Lm(g,[C,S,F]),h):[u(0),u(.5),u(1)]}}return h.domain=function(g){return arguments.length?([t,r,n]=g,a=d(t=+t),o=d(r=+r),s=d(n=+n),l=a===o?0:.5/(o-a),c=o===s?0:.5/(s-o),i=o<a?-1:1,h):[t,r,n]},h.clamp=function(g){return arguments.length?(f=!!g,h):f},h.interpolator=function(g){return arguments.length?(u=g,h):u},h.range=b(ci),h.rangeRound=b(Fl),h.unknown=function(g){return arguments.length?(p=g,h):p},function(g){return d=g,a=g(t),o=g(r),s=g(n),l=a===o?0:.5/(o-a),c=o===s?0:.5/(s-o),i=o<a?-1:1,h}}function Vp(){var t=fi(qa()(Ct));return t.copy=function(){return Cn(t,Vp())},Ma.apply(t,arguments)}function zp(){var t=ap(qa()).domain([.1,1,10]);return t.copy=function(){return Cn(t,zp()).base(t.base())},Ma.apply(t,arguments)}function qp(){var t=cp(qa());return t.copy=function(){return Cn(t,qp()).constant(t.constant())},Ma.apply(t,arguments)}function Ll(){var t=fp(qa());return t.copy=function(){return Cn(t,Ll()).exponent(t.exponent())},Ma.apply(t,arguments)}function K(t){for(var r=t.length/6|0,n=new Array(r),i=0;i<r;)n[i]="#"+t.slice(6*i,6*++i);return n}!function o6(t){Er=function ik(t){var r=t.dateTime,n=t.date,i=t.time,a=t.periods,o=t.days,s=t.shortDays,l=t.months,c=t.shortMonths,u=bi(a),d=vi(a),f=bi(o),p=vi(o),h=bi(s),b=vi(s),g=bi(l),_=vi(l),C=bi(c),S=vi(c),F={a:function k(G){return s[G.getDay()]},A:function $(G){return o[G.getDay()]},b:function w(G){return c[G.getMonth()]},B:function j(G){return l[G.getMonth()]},c:null,d:Ep,e:Ep,f:Ik,g:Bk,G:Nk,H:Sk,I:kk,j:$k,L:jp,m:wk,M:Rk,p:function N(G){return a[+(G.getHours()>=12)]},q:function L(G){return 1+~~(G.getMonth()/3)},Q:Op,s:Np,S:Tk,u:Ek,U:jk,V:Dk,w:Ak,W:Mk,x:null,X:null,y:Pk,Y:Ok,Z:Gk,"%":Bp},D={a:function H(G){return s[G.getUTCDay()]},A:function ee(G){return o[G.getUTCDay()]},b:function he(G){return c[G.getUTCMonth()]},B:function Ee(G){return l[G.getUTCMonth()]},c:null,d:Ap,e:Ap,f:zk,g:e6,G:n6,H:Lk,I:Yk,j:Vk,L:Mp,m:qk,M:Uk,p:function re(G){return a[+(G.getUTCHours()>=12)]},q:function je(G){return 1+~~(G.getUTCMonth()/3)},Q:Op,s:Np,S:Xk,u:Wk,U:Qk,V:Jk,w:Hk,W:Zk,x:null,X:null,y:Kk,Y:t6,Z:r6,"%":Bp},A={a:function Y(G,V,J){var M=h.exec(V.slice(J));return M?(G.w=b.get(M[0].toLowerCase()),J+M[0].length):-1},A:function B(G,V,J){var M=f.exec(V.slice(J));return M?(G.w=p.get(M[0].toLowerCase()),J+M[0].length):-1},b:function E(G,V,J){var M=C.exec(V.slice(J));return M?(G.m=S.get(M[0].toLowerCase()),J+M[0].length):-1},B:function I(G,V,J){var M=g.exec(V.slice(J));return M?(G.m=_.get(M[0].toLowerCase()),J+M[0].length):-1},c:function v(G,V,J){return q(G,r,V,J)},d:Rp,e:Rp,f:yk,g:wp,G:Ip,H:Tp,I:Tp,j:gk,L:_k,m:hk,M:bk,p:function ae(G,V,J){var M=u.exec(V.slice(J));return M?(G.p=d.get(M[0].toLowerCase()),J+M[0].length):-1},q:pk,Q:xk,s:Fk,S:vk,u:ck,U:uk,V:dk,w:lk,W:fk,x:function x(G,V,J){return q(G,n,V,J)},X:function y(G,V,J){return q(G,i,V,J)},y:wp,Y:Ip,Z:mk,"%":Ck};function P(G,V){return function(J){var dt,Q,Pe,M=[],xe=-1,be=0,ut=G.length;for(J instanceof Date||(J=new Date(+J));++xe<ut;)37===G.charCodeAt(xe)&&(M.push(G.slice(be,xe)),null!=(Q=$p[dt=G.charAt(++xe)])?dt=G.charAt(++xe):Q="e"===dt?" ":"0",(Pe=V[dt])&&(dt=Pe(J,Q)),M.push(dt),be=xe+1);return M.push(G.slice(be,xe)),M.join("")}}function z(G,V){return function(J){var be,ut,M=gi(1900,void 0,1);if(q(M,G,J+="",0)!=J.length)return null;if("Q"in M)return new Date(M.Q);if("s"in M)return new Date(1e3*M.s+("L"in M?M.L:0));if(V&&!("Z"in M)&&(M.Z=0),"p"in M&&(M.H=M.H%12+12*M.p),void 0===M.m&&(M.m="q"in M?M.q:0),"V"in M){if(M.V<1||M.V>53)return null;"w"in M||(M.w=1),"Z"in M?(ut=(be=Nl(gi(M.y,0,1))).getUTCDay(),be=ut>4||0===ut?hi.ceil(be):hi(be),be=mi.offset(be,7*(M.V-1)),M.y=be.getUTCFullYear(),M.m=be.getUTCMonth(),M.d=be.getUTCDate()+(M.w+6)%7):(ut=(be=Ol(gi(M.y,0,1))).getDay(),be=ut>4||0===ut?pi.ceil(be):pi(be),be=$r.offset(be,7*(M.V-1)),M.y=be.getFullYear(),M.m=be.getMonth(),M.d=be.getDate()+(M.w+6)%7)}else("W"in M||"U"in M)&&("w"in M||(M.w="u"in M?M.u%7:"W"in M?1:0),ut="Z"in M?Nl(gi(M.y,0,1)).getUTCDay():Ol(gi(M.y,0,1)).getDay(),M.m=0,M.d="W"in M?(M.w+6)%7+7*M.W-(ut+5)%7:M.w+7*M.U-(ut+6)%7);return"Z"in M?(M.H+=M.Z/100|0,M.M+=M.Z%100,Nl(M)):Ol(M)}}function q(G,V,J,M){for(var dt,Q,xe=0,be=V.length,ut=J.length;xe<be;){if(M>=ut)return-1;if(37===(dt=V.charCodeAt(xe++))){if(dt=V.charAt(xe++),!(Q=A[dt in $p?V.charAt(xe++):dt])||(M=Q(G,J,M))<0)return-1}else if(dt!=J.charCodeAt(M++))return-1}return M}return F.x=P(n,F),F.X=P(i,F),F.c=P(r,F),D.x=P(n,D),D.X=P(i,D),D.c=P(r,D),{format:function(G){var V=P(G+="",F);return V.toString=function(){return G},V},parse:function(G){var V=z(G+="",!1);return V.toString=function(){return G},V},utcFormat:function(G){var V=P(G+="",D);return V.toString=function(){return G},V},utcParse:function(G){var V=z(G+="",!0);return V.toString=function(){return G},V}}}(t),Gp=Er.format,Lp=Er.utcFormat}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});const p6=K("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),h6=K("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),g6=K("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),b6=K("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),v6=K("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),_6=K("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),y6=K("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),C6=K("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),x6=K("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),F6=K("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),Ce=t=>uF(t[t.length-1]);var Up=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(K);const Xp=Ce(Up);var Wp=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(K);const Qp=Ce(Wp);var Jp=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(K);const Hp=Ce(Jp);var Zp=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(K);const Kp=Ce(Zp);var Yl=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(K);const Ua=Ce(Yl);var eh=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(K);const th=Ce(eh);var Vl=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(K);const Xa=Ce(Vl);var nh=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(K);const rh=Ce(nh);var ih=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(K);const ah=Ce(ih);var oh=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(K);const sh=Ce(oh);var lh=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(K);const ch=Ce(lh);var uh=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(K);const dh=Ce(uh);var fh=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(K);const mh=Ce(fh);var ph=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(K);const hh=Ce(ph);var gh=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(K);const bh=Ce(gh);var vh=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(K);const _h=Ce(vh);var yh=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(K);const Ch=Ce(yh);var xh=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(K);const Fh=Ce(xh);var Sh=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(K);const kh=Ce(Sh);var $h=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(K);const Ih=Ce($h);var wh=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(K);const Rh=Ce(wh);var Th=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(K);const Eh=Ce(Th);var jh=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(K);const Dh=Ce(jh);var Ah=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(K);const Mh=Ce(Ah);var Ph=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(K);const Bh=Ce(Ph);var Oh=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(K);const Nh=Ce(Oh);var Gh=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(K);const Lh=Ce(Gh);function Yh(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-2710.57*t)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-67.37*t)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-2475.67*t)))))))+")"}var zl=1.78277,ql=-.29227,Wa=-.90649,_i=1.97294,zh=_i*Wa,qh=_i*zl,Uh=zl*ql- -.14861*Wa;function Vt(t,r,n,i){return 1===arguments.length?function S6(t){if(t instanceof Qn)return new Qn(t.h,t.s,t.l,t.opacity);t instanceof Ve||(t=Qs(t));var n=t.g/255,i=t.b/255,a=(Uh*i+zh*(t.r/255)-qh*n)/(Uh+zh-qh),o=i-a,s=(_i*(n-a)-ql*o)/Wa,l=Math.sqrt(s*s+o*o)/(_i*a*(1-a)),c=l?Math.atan2(s,o)*Jf-120:NaN;return new Qn(c<0?c+360:c,l,a,t.opacity)}(t):new Qn(t,r,n,i??1)}function Qn(t,r,n,i){this.h=+t,this.s=+r,this.l=+n,this.opacity=+i}function Xh(t){return function r(n){function i(a,o){var s=t((a=Vt(a)).h,(o=Vt(o)).h),l=ze(a.s,o.s),c=ze(a.l,o.l),u=ze(a.opacity,o.opacity);return function(d){return a.h=s(d),a.s=l(d),a.l=c(Math.pow(d,n)),a.opacity=u(d),a+""}}return n=+n,i.gamma=r,i}(1)}vr(Qn,Vt,ei(vn,{brighter(t){return t=null==t?_r:Math.pow(_r,t),new Qn(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?.7:Math.pow(.7,t),new Qn(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*Qf,r=+this.l,n=isNaN(this.s)?0:this.s*r*(1-r),i=Math.cos(t),a=Math.sin(t);return new Ve(255*(r+n*(-.14861*i+zl*a)),255*(r+n*(ql*i+Wa*a)),255*(r+n*(_i*i)),this.opacity)}})),Xh(gl);var Ul=Xh(ze);const Wh=Ul(Vt(300,.5,0),Vt(-240,.5,1));var Qh=Ul(Vt(-100,.75,.35),Vt(80,1.5,.8)),Jh=Ul(Vt(260,.75,.35),Vt(80,1.5,.8)),Qa=Vt();function Hh(t){(t<0||t>1)&&(t-=Math.floor(t));var r=Math.abs(t-.5);return Qa.h=360*t-100,Qa.s=1.5-1.5*r,Qa.l=.8-.9*r,Qa+""}var Ja=ni(),k6=Math.PI/3,$6=2*Math.PI/3;function Zh(t){var r;return t=(.5-t)*Math.PI,Ja.r=255*(r=Math.sin(t))*r,Ja.g=255*(r=Math.sin(t+k6))*r,Ja.b=255*(r=Math.sin(t+$6))*r,Ja+""}function Kh(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+t*(1172.33-t*(10793.56-t*(33300.12-t*(38394.49-14825.05*t)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+t*(557.33+t*(1225.33-t*(3574.96-t*(1073.77+707.56*t)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+t*(3211.1-t*(15327.97-t*(27814-t*(22569.18-6838.66*t)))))))+")"}function Ha(t){var r=t.length;return function(n){return t[Math.max(0,Math.min(r-1,Math.floor(n*r)))]}}const e0=Ha(K("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var t0=Ha(K("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),n0=Ha(K("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),r0=Ha(K("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));Math,Math;const i0=Math.cos,Xl=(Math,Math.min),Za=Math.sin,Le=Math.sqrt,jr=Math.PI,Ka=2*jr,I6=Le(3),o0={draw(t,r){const n=.59436*Le(r+Xl(r/28,.75)),i=n/2,a=i*I6;t.moveTo(0,n),t.lineTo(0,-n),t.moveTo(-a,-i),t.lineTo(a,i),t.moveTo(-a,i),t.lineTo(a,-i)}},Wl={draw(t,r){const n=Le(r/jr);t.moveTo(n,0),t.arc(0,0,n,0,Ka)}},s0={draw(t,r){const n=Le(r/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}},l0=Le(1/3),w6=2*l0,c0={draw(t,r){const n=Le(r/w6),i=n*l0;t.moveTo(0,-n),t.lineTo(i,0),t.lineTo(0,n),t.lineTo(-i,0),t.closePath()}},u0={draw(t,r){const n=.62625*Le(r);t.moveTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.lineTo(-n,0),t.closePath()}},d0={draw(t,r){const n=.87559*Le(r-Xl(r/7,2));t.moveTo(-n,0),t.lineTo(n,0),t.moveTo(0,n),t.lineTo(0,-n)}},f0={draw(t,r){const n=Le(r),i=-n/2;t.rect(i,i,n,n)}},m0={draw(t,r){const n=.4431*Le(r);t.moveTo(n,n),t.lineTo(n,-n),t.lineTo(-n,-n),t.lineTo(-n,n),t.closePath()}},p0=Za(jr/10)/Za(7*jr/10),T6=Za(Ka/10)*p0,E6=-i0(Ka/10)*p0,h0={draw(t,r){const n=Le(.8908130915292852*r),i=T6*n,a=E6*n;t.moveTo(0,-n),t.lineTo(i,a);for(let o=1;o<5;++o){const s=Ka*o/5,l=i0(s),c=Za(s);t.lineTo(c*n,-l*n),t.lineTo(l*i-c*a,c*i+l*a)}t.closePath()}},Ql=Le(3),g0={draw(t,r){const n=-Le(r/(3*Ql));t.moveTo(0,2*n),t.lineTo(-Ql*n,-n),t.lineTo(Ql*n,-n),t.closePath()}},j6=Le(3),b0={draw(t,r){const n=.6824*Le(r),i=n/2,a=n*j6/2;t.moveTo(0,-n),t.lineTo(a,i),t.lineTo(-a,i),t.closePath()}},Ft=-.5,St=Le(3)/2,Jl=1/Le(12),D6=3*(Jl/2+1),v0={draw(t,r){const n=Le(r/D6),i=n/2,a=n*Jl,o=i,s=n*Jl+n,l=-o,c=s;t.moveTo(i,a),t.lineTo(o,s),t.lineTo(l,c),t.lineTo(Ft*i-St*a,St*i+Ft*a),t.lineTo(Ft*o-St*s,St*o+Ft*s),t.lineTo(Ft*l-St*c,St*l+Ft*c),t.lineTo(Ft*i+St*a,Ft*a-St*i),t.lineTo(Ft*o+St*s,Ft*s-St*o),t.lineTo(Ft*l+St*c,Ft*c-St*l),t.closePath()}},_0={draw(t,r){const n=.6189*Le(r-Xl(r/6,1.7));t.moveTo(-n,-n),t.lineTo(n,n),t.moveTo(-n,n),t.lineTo(n,-n)}},A6=[Wl,s0,c0,f0,h0,g0,v0],M6=[Wl,d0,_0,b0,o0,m0,u0];function Dr(t,r,n){this.k=t,this.x=r,this.y=n}function V6(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}Dr.prototype={constructor:Dr,scale:function(t){return 1===t?this:new Dr(this.k*t,this.x,this.y)},translate:function(t,r){return 0===t&0===r?this:new Dr(this.k,this.x+this.k*t,this.y+this.k*r)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new Dr(1,0,0);var C0={},Hl={};function x0(t){return new Function("d","return {"+t.map(function(r,n){return JSON.stringify(r)+": d["+n+'] || ""'}).join(",")+"}")}function F0(t){var r=Object.create(null),n=[];return t.forEach(function(i){for(var a in i)a in r||n.push(r[a]=a)}),n}function pt(t,r){var n=t+"",i=n.length;return i<r?new Array(r-i+1).join(0)+n:n}function ec(t){var r=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function a(f,p){var C,h=[],b=f.length,g=0,_=0,S=b<=0,F=!1;function D(){if(S)return Hl;if(F)return F=!1,C0;var P,q,z=g;if(34===f.charCodeAt(z)){for(;g++<b&&34!==f.charCodeAt(g)||34===f.charCodeAt(++g););return(P=g)>=b?S=!0:10===(q=f.charCodeAt(g++))?F=!0:13===q&&(F=!0,10===f.charCodeAt(g)&&++g),f.slice(z+1,P-1).replace(/""/g,'"')}for(;g<b;){if(10===(q=f.charCodeAt(P=g++)))F=!0;else if(13===q)F=!0,10===f.charCodeAt(g)&&++g;else if(q!==n)continue;return f.slice(z,P)}return S=!0,f.slice(z,b)}for(10===f.charCodeAt(b-1)&&--b,13===f.charCodeAt(b-1)&&--b;(C=D())!==Hl;){for(var A=[];C!==C0&&C!==Hl;)A.push(C),C=D();p&&null==(A=p(A,_++))||h.push(A)}return h}function o(f,p){return f.map(function(h){return p.map(function(b){return d(h[b])}).join(t)})}function u(f){return f.map(d).join(t)}function d(f){return null==f?"":f instanceof Date?function X6(t){var r=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds(),a=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function U6(t){return t<0?"-"+pt(-t,6):t>9999?"+"+pt(t,6):pt(t,4)}(t.getUTCFullYear())+"-"+pt(t.getUTCMonth()+1,2)+"-"+pt(t.getUTCDate(),2)+(a?"T"+pt(r,2)+":"+pt(n,2)+":"+pt(i,2)+"."+pt(a,3)+"Z":i?"T"+pt(r,2)+":"+pt(n,2)+":"+pt(i,2)+"Z":n||r?"T"+pt(r,2)+":"+pt(n,2)+"Z":"")}(f):r.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:function i(f,p){var h,b,g=a(f,function(_,C){if(h)return h(_,C-1);b=_,h=p?function q6(t,r){var n=x0(t);return function(i,a){return r(n(i),a,t)}}(_,p):x0(_)});return g.columns=b||[],g},parseRows:a,format:function s(f,p){return null==p&&(p=F0(f)),[p.map(d).join(t)].concat(o(f,p)).join("\n")},formatBody:function l(f,p){return null==p&&(p=F0(f)),o(f,p).join("\n")},formatRows:function c(f){return f.map(u).join("\n")},formatRow:u,formatValue:d}}var W6=ec(",").parse,Q6=ec("\t").parse;function J6(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function tc(t,r){return fetch(t,r).then(J6)}function S0(t){return function(r,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=void 0),tc(r,n).then(function(a){return t(a,i)})}}var Z6=S0(W6);function Zn(){Zn=function(){return t};var t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(E,I,v){E[I]=v.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(E,I,v){return Object.defineProperty(E,I,{value:v,enumerable:!0,configurable:!0,writable:!0}),E[I]}try{c({},"")}catch{c=function(I,v,x){return I[v]=x}}function u(E,I,v,x){var k=Object.create((I&&I.prototype instanceof p?I:p).prototype),$=new ae(x||[]);return i(k,"_invoke",{value:A(E,v,$)}),k}function d(E,I,v){try{return{type:"normal",arg:E.call(I,v)}}catch(x){return{type:"throw",arg:x}}}t.wrap=u;var f={};function p(){}function h(){}function b(){}var g={};c(g,o,function(){return this});var _=Object.getPrototypeOf,C=_&&_(_(Y([])));C&&C!==r&&n.call(C,o)&&(g=C);var S=b.prototype=p.prototype=Object.create(g);function F(E){["next","throw","return"].forEach(function(I){c(E,I,function(v){return this._invoke(I,v)})})}function D(E,I){function v(y,k,$,w){var j=d(E[y],E,k);if("throw"!==j.type){var N=j.arg,L=N.value;return L&&"object"==typeof L&&n.call(L,"__await")?I.resolve(L.__await).then(function(H){v("next",H,$,w)},function(H){v("throw",H,$,w)}):I.resolve(L).then(function(H){N.value=H,$(N)},function(H){return v("throw",H,$,w)})}w(j.arg)}var x;i(this,"_invoke",{value:function(y,k){function $(){return new I(function(w,j){v(y,k,w,j)})}return x=x?x.then($,$):$()}})}function A(E,I,v){var x="suspendedStart";return function(y,k){if("executing"===x)throw new Error("Generator is already running");if("completed"===x){if("throw"===y)throw k;return{value:void 0,done:!0}}for(v.method=y,v.arg=k;;){var $=v.delegate;if($){var w=P($,v);if(w){if(w===f)continue;return w}}if("next"===v.method)v.sent=v._sent=v.arg;else if("throw"===v.method){if("suspendedStart"===x)throw x="completed",v.arg;v.dispatchException(v.arg)}else"return"===v.method&&v.abrupt("return",v.arg);x="executing";var j=d(E,I,v);if("normal"===j.type){if(x=v.done?"completed":"suspendedYield",j.arg===f)continue;return{value:j.arg,done:v.done}}"throw"===j.type&&(x="completed",v.method="throw",v.arg=j.arg)}}}function P(E,I){var v=I.method,x=E.iterator[v];if(void 0===x)return I.delegate=null,"throw"===v&&E.iterator.return&&(I.method="return",I.arg=void 0,P(E,I),"throw"===I.method)||"return"!==v&&(I.method="throw",I.arg=new TypeError("The iterator does not provide a '"+v+"' method")),f;var y=d(x,E.iterator,I.arg);if("throw"===y.type)return I.method="throw",I.arg=y.arg,I.delegate=null,f;var k=y.arg;return k?k.done?(I[E.resultName]=k.value,I.next=E.nextLoc,"return"!==I.method&&(I.method="next",I.arg=void 0),I.delegate=null,f):k:(I.method="throw",I.arg=new TypeError("iterator result is not an object"),I.delegate=null,f)}function z(E){var I={tryLoc:E[0]};1 in E&&(I.catchLoc=E[1]),2 in E&&(I.finallyLoc=E[2],I.afterLoc=E[3]),this.tryEntries.push(I)}function q(E){var I=E.completion||{};I.type="normal",delete I.arg,E.completion=I}function ae(E){this.tryEntries=[{tryLoc:"root"}],E.forEach(z,this),this.reset(!0)}function Y(E){if(E){var I=E[o];if(I)return I.call(E);if("function"==typeof E.next)return E;if(!isNaN(E.length)){var v=-1,x=function y(){for(;++v<E.length;)if(n.call(E,v))return y.value=E[v],y.done=!1,y;return y.value=void 0,y.done=!0,y};return x.next=x}}return{next:B}}function B(){return{value:void 0,done:!0}}return h.prototype=b,i(S,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:h,configurable:!0}),h.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(E){var I="function"==typeof E&&E.constructor;return!!I&&(I===h||"GeneratorFunction"===(I.displayName||I.name))},t.mark=function(E){return Object.setPrototypeOf?Object.setPrototypeOf(E,b):(E.__proto__=b,c(E,l,"GeneratorFunction")),E.prototype=Object.create(S),E},t.awrap=function(E){return{__await:E}},F(D.prototype),c(D.prototype,s,function(){return this}),t.AsyncIterator=D,t.async=function(E,I,v,x,y){void 0===y&&(y=Promise);var k=new D(u(E,I,v,x),y);return t.isGeneratorFunction(I)?k:k.next().then(function($){return $.done?$.value:k.next()})},F(S),c(S,l,"Generator"),c(S,o,function(){return this}),c(S,"toString",function(){return"[object Generator]"}),t.keys=function(E){var I=Object(E),v=[];for(var x in I)v.push(x);return v.reverse(),function y(){for(;v.length;){var k=v.pop();if(k in I)return y.value=k,y.done=!1,y}return y.done=!0,y}},t.values=Y,ae.prototype={constructor:ae,reset:function(E){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(q),!E)for(var I in this)"t"===I.charAt(0)&&n.call(this,I)&&!isNaN(+I.slice(1))&&(this[I]=void 0)},stop:function(){this.done=!0;var E=this.tryEntries[0].completion;if("throw"===E.type)throw E.arg;return this.rval},dispatchException:function(E){if(this.done)throw E;var I=this;function v(j,N){return k.type="throw",k.arg=E,I.next=j,N&&(I.method="next",I.arg=void 0),!!N}for(var x=this.tryEntries.length-1;x>=0;--x){var y=this.tryEntries[x],k=y.completion;if("root"===y.tryLoc)return v("end");if(y.tryLoc<=this.prev){var $=n.call(y,"catchLoc"),w=n.call(y,"finallyLoc");if($&&w){if(this.prev<y.catchLoc)return v(y.catchLoc,!0);if(this.prev<y.finallyLoc)return v(y.finallyLoc)}else if($){if(this.prev<y.catchLoc)return v(y.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<y.finallyLoc)return v(y.finallyLoc)}}}},abrupt:function(E,I){for(var v=this.tryEntries.length-1;v>=0;--v){var x=this.tryEntries[v];if(x.tryLoc<=this.prev&&n.call(x,"finallyLoc")&&this.prev<x.finallyLoc){var y=x;break}}y&&("break"===E||"continue"===E)&&y.tryLoc<=I&&I<=y.finallyLoc&&(y=null);var k=y?y.completion:{};return k.type=E,k.arg=I,y?(this.method="next",this.next=y.finallyLoc,f):this.complete(k)},complete:function(E,I){if("throw"===E.type)throw E.arg;return"break"===E.type||"continue"===E.type?this.next=E.arg:"return"===E.type?(this.rval=this.arg=E.arg,this.method="return",this.next="end"):"normal"===E.type&&I&&(this.next=I),f},finish:function(E){for(var I=this.tryEntries.length-1;I>=0;--I){var v=this.tryEntries[I];if(v.finallyLoc===E)return this.complete(v.completion,v.afterLoc),q(v),f}},catch:function(E){for(var I=this.tryEntries.length-1;I>=0;--I){var v=this.tryEntries[I];if(v.tryLoc===E){var x=v.completion;if("throw"===x.type){var y=x.arg;q(v)}return y}}throw new Error("illegal catch attempt")},delegateYield:function(E,I,v){return this.delegate={iterator:Y(E),resultName:I,nextLoc:v},"next"===this.method&&(this.arg=void 0),f}},t}function Ci(t){return(Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(t)}function nt(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function k0(t,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,w0(i.key),i)}}function rt(t,r,n){return r&&k0(t.prototype,r),n&&k0(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function $0(t,r){return function n5(t){if(Array.isArray(t))return t}(t)||function K6(t,r){var n=null==t?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,a,o,s,l=[],c=!0,u=!1;try{if(o=(n=n.call(t)).next,0===r){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=o.call(n)).done)&&(l.push(i.value),l.length!==r);c=!0);}catch(d){u=!0,a=d}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw a}}return l}}(t,r)||I0(t,r)||function a5(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nc(t){return function t5(t){if(Array.isArray(t))return rc(t)}(t)||function r5(t){if(typeof Symbol<"u"&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||I0(t)||function i5(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I0(t,r){if(t){if("string"==typeof t)return rc(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rc(t,r)}}function rc(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,i=new Array(r);n<r;n++)i[n]=t[n];return i}function w0(t){var r=function o5(t,r){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof r?r:String(r)}S0(Q6);var Ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var xi=function(t){return t&&t.Math===Math&&t},Ae=xi("object"==typeof globalThis&&globalThis)||xi("object"==typeof window&&window)||xi("object"==typeof self&&self)||xi("object"==typeof Ue&&Ue)||xi("object"==typeof Ue&&Ue)||function(){return this}()||Function("return this")(),R0={exports:{}},T0=Ae,s5=Object.defineProperty,ic=function(t,r){try{s5(T0,t,{value:r,configurable:!0,writable:!0})}catch{T0[t]=r}return r},E0="__core-js_shared__",ac=Ae[E0]||ic(E0,{}),j0=ac;(R0.exports=function(t,r){return j0[t]||(j0[t]=void 0!==r?r:{})})("versions",[]).push({version:"3.34.0",mode:"global",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.34.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Et,to,oc=R0.exports,ge=function(t){try{return!!t()}catch{return!0}},eo=!ge(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}),D0=eo,A0=Function.prototype,sc=A0.call,f5=D0&&A0.bind.bind(sc,sc),_e=D0?f5:function(t){return function(){return sc.apply(t,arguments)}},xn=function(t){return null==t},m5=xn,p5=TypeError,Kn=function(t){if(m5(t))throw new p5("Can't call method on "+t);return t},h5=Kn,g5=Object,zt=function(t){return g5(h5(t))},v5=zt,_5=_e({}.hasOwnProperty),kt=Object.hasOwn||function(r,n){return _5(v5(r),n)},y5=_e,C5=0,x5=Math.random(),F5=y5(1..toString),lc=function(t){return"Symbol("+(void 0===t?"":t)+")_"+F5(++C5+x5,36)},er=typeof navigator<"u"&&String(navigator.userAgent)||"",cc=er,P0=Ae.process,B0=Ae.Deno,O0=P0&&P0.versions||B0&&B0.version,N0=O0&&O0.v8;N0&&(to=(Et=N0.split("."))[0]>0&&Et[0]<4?1:+(Et[0]+Et[1])),!to&&cc&&(!(Et=cc.match(/Edge\/(\d+)/))||Et[1]>=74)&&(Et=cc.match(/Chrome\/(\d+)/))&&(to=+Et[1]);var Fi=to,G0=Fi,$5=Ae.String,L0=!!Object.getOwnPropertySymbols&&!ge(function(){var t=Symbol("symbol detection");return!$5(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&G0&&G0<41}),Y0=L0&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,V0=kt,T5=lc,E5=L0,j5=Y0,Ar=Ae.Symbol,uc=oc("wks"),D5=j5?Ar.for||Ar:Ar&&Ar.withoutSetter||T5,Me=function(t){return V0(uc,t)||(uc[t]=E5&&V0(Ar,t)?Ar[t]:D5("Symbol."+t)),uc[t]},z0={};z0[Me("toStringTag")]="z";var dc="[object z]"===String(z0),fc="object"==typeof document&&document.all,q0={all:fc,IS_HTMLDDA:typeof fc>"u"&&void 0!==fc},B5=q0.all,Te=q0.IS_HTMLDDA?function(t){return"function"==typeof t||t===B5}:function(t){return"function"==typeof t},jt={},ht=!ge(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}),X0=Te,N5=q0.all,He=q0.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:X0(t)||t===N5}:function(t){return"object"==typeof t?null!==t:X0(t)},Q0=He,mc=Ae.document,L5=Q0(mc)&&Q0(mc.createElement),no=function(t){return L5?mc.createElement(t):{}},z5=no,J0=!ht&&!ge(function(){return 7!==Object.defineProperty(z5("div"),"a",{get:function(){return 7}}).a}),H0=ht&&ge(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),X5=He,W5=String,Q5=TypeError,ct=function(t){if(X5(t))return t;throw new Q5(W5(t)+" is not an object")},ro=Function.prototype.call,Ze=eo?ro.bind(ro):function(){return ro.apply(ro,arguments)},pc=Ae,H5=Te,tr=function(t,r){return arguments.length<2?function(t){return H5(t)?t:void 0}(pc[t]):pc[t]&&pc[t][r]},hc=_e({}.isPrototypeOf),e8=tr,t8=Te,n8=hc,i8=Object,Z0=Y0?function(t){return"symbol"==typeof t}:function(t){var r=e8("Symbol");return t8(r)&&n8(r.prototype,i8(t))},a8=String,Si=function(t){try{return a8(t)}catch{return"Object"}},o8=Te,s8=Si,l8=TypeError,qt=function(t){if(o8(t))return t;throw new l8(s8(t)+" is not a function")},c8=qt,u8=xn,io=function(t,r){var n=t[r];return u8(n)?void 0:c8(n)},gc=Ze,bc=Te,vc=He,d8=TypeError,m8=Ze,K0=He,e1=Z0,p8=io,b8=TypeError,v8=Me("toPrimitive"),y8=function(t,r){if(!K0(t)||e1(t))return t;var i,n=p8(t,v8);if(n){if(void 0===r&&(r="default"),i=m8(n,t,r),!K0(i)||e1(i))return i;throw new b8("Can't convert object to primitive value")}return void 0===r&&(r="number"),function(t,r){var n,i;if("string"===r&&bc(n=t.toString)&&!vc(i=gc(n,t))||bc(n=t.valueOf)&&!vc(i=gc(n,t))||"string"!==r&&bc(n=t.toString)&&!vc(i=gc(n,t)))return i;throw new d8("Can't convert object to primitive value")}(t,r)},C8=Z0,_c=function(t){var r=y8(t,"string");return C8(r)?r:r+""},F8=J0,ao=ct,t1=_c,k8=TypeError,yc=Object.defineProperty,$8=Object.getOwnPropertyDescriptor,Cc="enumerable",xc="configurable",Fc="writable";jt.f=ht?H0?function(r,n,i){if(ao(r),n=t1(n),ao(i),"function"==typeof r&&"prototype"===n&&"value"in i&&Fc in i&&!i[Fc]){var a=$8(r,n);a&&a[Fc]&&(r[n]=i.value,i={configurable:xc in i?i[xc]:a[xc],enumerable:Cc in i?i[Cc]:a[Cc],writable:!1})}return yc(r,n,i)}:yc:function(r,n,i){if(ao(r),n=t1(n),ao(i),F8)try{return yc(r,n,i)}catch{}if("get"in i||"set"in i)throw new k8("Accessors not supported");return"value"in i&&(r[n]=i.value),r};var n1={exports:{}},Sc=ht,r1=Function.prototype,w8=Sc&&Object.getOwnPropertyDescriptor,kc=kt(r1,"name"),oo={EXISTS:kc,PROPER:kc&&"something"===function(){}.name,CONFIGURABLE:kc&&(!Sc||Sc&&w8(r1,"name").configurable)},j8=Te,$c=ac,D8=_e(Function.toString);j8($c.inspectSource)||($c.inspectSource=function(t){return D8(t)});var co,ki,uo,Ic=$c.inspectSource,i1=Ae.WeakMap,P8=Te(i1)&&/native code/.test(String(i1)),so=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},O8=jt,N8=so,Mr=ht?function(t,r,n){return O8.f(t,r,N8(1,n))}:function(t,r,n){return t[r]=n,t},L8=lc,a1=oc("keys"),wc=function(t){return a1[t]||(a1[t]=L8(t))},lo={},V8=He,z8=Mr,Rc=kt,q8=wc,U8=lo,s1="Object already initialized",Ec=Ae.TypeError;if(P8||ac.state){var Ut=ac.state||(ac.state=new(0,Ae.WeakMap));Ut.get=Ut.get,Ut.has=Ut.has,Ut.set=Ut.set,co=function(t,r){if(Ut.has(t))throw new Ec(s1);return r.facade=t,Ut.set(t,r),r},ki=function(t){return Ut.get(t)||{}},uo=function(t){return Ut.has(t)}}else{var Pr=q8("state");U8[Pr]=!0,co=function(t,r){if(Rc(t,Pr))throw new Ec(s1);return r.facade=t,z8(t,Pr,r),r},ki=function(t){return Rc(t,Pr)?t[Pr]:{}},uo=function(t){return Rc(t,Pr)}}var nr={set:co,get:ki,has:uo,enforce:function(t){return uo(t)?ki(t):co(t,{})},getterFor:function(t){return function(r){var n;if(!V8(r)||(n=ki(r)).type!==t)throw new Ec("Incompatible receiver, "+t+" required");return n}}},jc=_e,J8=ge,H8=Te,fo=kt,Dc=ht,Z8=oo.CONFIGURABLE,K8=Ic,e$=nr.enforce,t$=nr.get,c1=String,mo=Object.defineProperty,n$=jc("".slice),r$=jc("".replace),i$=jc([].join),a$=Dc&&!J8(function(){return 8!==mo(function(){},"length",{value:8}).length}),o$=String(String).split("String"),s$=n1.exports=function(t,r,n){"Symbol("===n$(c1(r),0,7)&&(r="["+r$(c1(r),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(r="get "+r),n&&n.setter&&(r="set "+r),(!fo(t,"name")||Z8&&t.name!==r)&&(Dc?mo(t,"name",{value:r,configurable:!0}):t.name=r),a$&&n&&fo(n,"arity")&&t.length!==n.arity&&mo(t,"length",{value:n.arity});try{n&&fo(n,"constructor")&&n.constructor?Dc&&mo(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch{}var i=e$(t);return fo(i,"source")||(i.source=i$(o$,"string"==typeof r?r:"")),t};Function.prototype.toString=s$(function(){return H8(this)&&t$(this).source||K8(this)},"toString");var u1=n1.exports,l$=Te,c$=jt,u$=u1,d$=ic,rn=function(t,r,n,i){i||(i={});var a=i.enumerable,o=void 0!==i.name?i.name:r;if(l$(n)&&u$(n,o,i),i.global)a?t[r]=n:d$(r,n);else{try{i.unsafe?t[r]&&(a=!0):delete t[r]}catch{}a?t[r]=n:c$.f(t,r,{value:n,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return t},d1=_e,f$=d1({}.toString),m$=d1("".slice),an=function(t){return m$(f$(t),8,-1)},p$=dc,h$=Te,po=an,b$=Me("toStringTag"),v$=Object,_$="Arguments"===po(function(){return arguments}()),ho=p$?po:function(t){var r,n,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,r){try{return t[r]}catch{}}(r=v$(t),b$))?n:_$?po(r):"Object"===(i=po(r))&&h$(r.callee)?"Arguments":i},x$=ho;dc||rn(Object.prototype,"toString",dc?{}.toString:function(){return"[object "+x$(this)+"]"},{unsafe:!0});var $i={},go={},f1={}.propertyIsEnumerable,m1=Object.getOwnPropertyDescriptor,I$=m1&&!f1.call({1:2},1);go.f=I$?function(r){var n=m1(this,r);return!!n&&n.enumerable}:f1;var R$=ge,T$=an,Ac=Object,E$=_e("".split),bo=R$(function(){return!Ac("z").propertyIsEnumerable(0)})?function(t){return"String"===T$(t)?E$(t,""):Ac(t)}:Ac,j$=bo,D$=Kn,on=function(t){return j$(D$(t))},M$=Ze,P$=go,B$=so,O$=on,N$=_c,G$=kt,L$=J0,p1=Object.getOwnPropertyDescriptor;$i.f=ht?p1:function(r,n){if(r=O$(r),n=N$(n),L$)try{return p1(r,n)}catch{}if(G$(r,n))return B$(!M$(P$.f,r,n),r[n])};var vo={},Y$=Math.ceil,V$=Math.floor,q$=Math.trunc||function(r){var n=+r;return(n>0?V$:Y$)(n)},_o=function(t){var r=+t;return r!=r||0===r?0:q$(r)},U$=_o,X$=Math.max,W$=Math.min,yo=function(t,r){var n=U$(t);return n<0?X$(n+r,0):W$(n,r)},Q$=_o,J$=Math.min,Mc=function(t){return t>0?J$(Q$(t),9007199254740991):0},H$=Mc,sn=function(t){return H$(t.length)},Z$=on,K$=yo,eI=sn,h1=function(t){return function(r,n,i){var l,a=Z$(r),o=eI(a),s=K$(i,o);if(t&&n!=n){for(;o>s;)if((l=a[s++])!=l)return!0}else for(;o>s;s++)if((t||s in a)&&a[s]===n)return t||s||0;return!t&&-1}},g1={includes:h1(!0),indexOf:h1(!1)},Pc=kt,nI=on,rI=g1.indexOf,iI=lo,b1=_e([].push),v1=function(t,r){var o,n=nI(t),i=0,a=[];for(o in n)!Pc(iI,o)&&Pc(n,o)&&b1(a,o);for(;r.length>i;)Pc(n,o=r[i++])&&(~rI(a,o)||b1(a,o));return a},Bc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],aI=v1,sI=Bc.concat("length","prototype");vo.f=Object.getOwnPropertyNames||function(r){return aI(r,sI)};var Oc={};Oc.f=Object.getOwnPropertySymbols;var lI=tr,uI=vo,dI=Oc,fI=ct,mI=_e([].concat),pI=lI("Reflect","ownKeys")||function(r){var n=uI.f(fI(r)),i=dI.f;return i?mI(n,i(r)):n},_1=kt,hI=pI,gI=$i,bI=jt,_I=ge,yI=Te,CI=/#|\.prototype\./,Ii=function(t,r){var n=FI[xI(t)];return n===kI||n!==SI&&(yI(r)?_I(r):!!r)},xI=Ii.normalize=function(t){return String(t).replace(CI,".").toLowerCase()},FI=Ii.data={},SI=Ii.NATIVE="N",kI=Ii.POLYFILL="P",Nc=Ii,Gc=Ae,$I=$i.f,II=Mr,wI=rn,RI=ic,TI=function(t,r,n){for(var i=hI(r),a=bI.f,o=gI.f,s=0;s<i.length;s++){var l=i[s];!_1(t,l)&&(!n||!_1(n,l))&&a(t,l,o(r,l))}},EI=Nc,Se=function(t,r){var s,l,c,u,d,n=t.target,i=t.global,a=t.stat;if(s=i?Gc:a?Gc[n]||RI(n,{}):(Gc[n]||{}).prototype)for(l in r){if(u=r[l],c=t.dontCallGetSet?(d=$I(s,l))&&d.value:s[l],!EI(i?l:n+(a?".":"#")+l,t.forced)&&void 0!==c){if(typeof u==typeof c)continue;TI(u,c)}(t.sham||c&&c.sham)&&II(u,"sham",!0),wI(s,l,u,t)}},Co="process"===an(Ae.process),AI=_e,MI=qt,BI=Te,OI=String,NI=TypeError,YI=ct,Lc=Object.setPrototypeOf||("__proto__"in{}?function(){var n,t=!1,r={};try{(n=function(t,r,n){try{return AI(MI(Object.getOwnPropertyDescriptor(t,r)[n]))}catch{}}(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(a,o){return YI(a),function(t){if("object"==typeof t||BI(t))return t;throw new NI("Can't set "+OI(t)+" as a prototype")}(o),t?n(a,o):a.__proto__=o,a}}():void 0),zI=jt.f,qI=kt,y1=Me("toStringTag"),wi=function(t,r,n){t&&!n&&(t=t.prototype),t&&!qI(t,y1)&&zI(t,y1,{configurable:!0,value:r})},C1=u1,XI=jt,Yc=function(t,r,n){return n.get&&C1(n.get,r,{getter:!0}),n.set&&C1(n.set,r,{setter:!0}),XI.f(t,r,n)},WI=tr,QI=Yc,HI=ht,x1=Me("species"),F1=function(t){var r=WI(t);HI&&r&&!r[x1]&&QI(r,x1,{configurable:!0,get:function(){return this}})},ZI=hc,KI=TypeError,xo=function(t,r){if(ZI(r,t))return t;throw new KI("Incorrect invocation")},ew=_e,tw=ge,S1=Te,nw=ho,iw=Ic,k1=function(){},aw=[],$1=tr("Reflect","construct"),Vc=/^\s*(?:class|function)\b/,ow=ew(Vc.exec),sw=!Vc.test(k1),Ri=function(r){if(!S1(r))return!1;try{return $1(k1,aw,r),!0}catch{return!1}},I1=function(r){if(!S1(r))return!1;switch(nw(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return sw||!!ow(Vc,iw(r))}catch{return!0}};I1.sham=!0;var Ei,rr,Qc,Jc,Fo=!$1||tw(function(){var t;return Ri(Ri.call)||!Ri(Object)||!Ri(function(){t=!0})||t})?I1:Ri,lw=Fo,cw=Si,uw=TypeError,w1=ct,mw=xn,hw=Me("species"),R1=Function.prototype,T1=R1.apply,E1=R1.call,j1="object"==typeof Reflect&&Reflect.apply||(eo?E1.bind(T1):function(){return E1.apply(T1,arguments)}),vw=an,_w=_e,zc=function(t){if("Function"===vw(t))return _w(t)},yw=qt,Cw=eo,xw=zc(zc.bind),Br=function(t,r){return yw(t),void 0===r?t:Cw?xw(t,r):function(){return t.apply(r,arguments)}},A1=tr("document","documentElement"),M1=_e([].slice),kw=TypeError,P1=/(?:ipad|iphone|ipod).*applewebkit/i.test(er),_t=Ae,ww=j1,Rw=Br,B1=Te,Tw=kt,O1=ge,N1=A1,Ew=M1,G1=no,Dw=P1,Aw=Co,qc=_t.setImmediate,Uc=_t.clearImmediate,Mw=_t.process,Xc=_t.Dispatch,Pw=_t.Function,L1=_t.MessageChannel,Bw=_t.String,Wc=0,Ti={},Y1="onreadystatechange";O1(function(){Ei=_t.location});var Hc=function(t){if(Tw(Ti,t)){var r=Ti[t];delete Ti[t],r()}},Zc=function(t){return function(){Hc(t)}},V1=function(t){Hc(t.data)},z1=function(t){_t.postMessage(Bw(t),Ei.protocol+"//"+Ei.host)};(!qc||!Uc)&&(qc=function(r){!function(t,r){if(t<r)throw new kw("Not enough arguments")}(arguments.length,1);var n=B1(r)?r:Pw(r),i=Ew(arguments,1);return Ti[++Wc]=function(){ww(n,void 0,i)},rr(Wc),Wc},Uc=function(r){delete Ti[r]},Aw?rr=function(t){Mw.nextTick(Zc(t))}:Xc&&Xc.now?rr=function(t){Xc.now(Zc(t))}:L1&&!Dw?(Jc=(Qc=new L1).port2,Qc.port1.onmessage=V1,rr=Rw(Jc.postMessage,Jc)):_t.addEventListener&&B1(_t.postMessage)&&!_t.importScripts&&Ei&&"file:"!==Ei.protocol&&!O1(z1)?(rr=z1,_t.addEventListener("message",V1,!1)):rr=Y1 in G1("script")?function(t){N1.appendChild(G1("script"))[Y1]=function(){N1.removeChild(this),Hc(t)}}:function(t){setTimeout(Zc(t),0)});var q1={set:qc,clear:Uc},U1=function(){this.head=null,this.tail=null};U1.prototype={add:function(t){var r={item:t,next:null},n=this.tail;n?n.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var Or,nu,ru,ko,K1,X1=U1,Nw=/ipad|iphone|ipod/i.test(er)&&typeof Pebble<"u",Lw=/web0s(?!.*chrome)/i.test(er),ir=Ae,W1=Br,Kc=q1.set,Vw=X1,zw=P1,qw=Nw,Uw=Lw,eu=Co,Q1=ir.MutationObserver||ir.WebKitMutationObserver,J1=ir.document,H1=ir.process,So=ir.Promise,Z1=(0,$i.f)(ir,"queueMicrotask"),tu=Z1&&Z1.value;if(!tu){var $o=new Vw,Io=function(){var t,r;for(eu&&(t=H1.domain)&&t.exit();r=$o.get();)try{r()}catch(n){throw $o.head&&Or(),n}t&&t.enter()};zw||eu||Uw||!Q1||!J1?!qw&&So&&So.resolve?((ko=So.resolve(void 0)).constructor=So,K1=W1(ko.then,ko),Or=function(){K1(Io)}):eu?Or=function(){H1.nextTick(Io)}:(Kc=W1(Kc,ir),Or=function(){Kc(Io)}):(nu=!0,ru=J1.createTextNode(""),new Q1(Io).observe(ru,{characterData:!0}),Or=function(){ru.data=nu=!nu}),tu=function(t){$o.head||Or(),$o.add(t)}}var Xw=tu,wo=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Ro=Ae.Promise,eg="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Zw=!eg&&!Co&&"object"==typeof window&&"object"==typeof document,Kw=Ae,ji=Ro,eR=Te,tR=Nc,nR=Ic,iR=Zw,aR=eg,iu=Fi,oR=Me("species"),au=!1,tg=eR(Kw.PromiseRejectionEvent),sR=tR("Promise",function(){var t=nR(ji),r=t!==String(ji);if(!r&&66===iu)return!0;if(!iu||iu<51||!/native code/.test(t)){var n=new ji(function(o){o(1)}),i=function(o){o(function(){},function(){})};if((n.constructor={})[oR]=i,!(au=n.then(function(){})instanceof i))return!0}return!r&&(iR||aR)&&!tg}),Di={CONSTRUCTOR:sR,REJECTION_EVENT:tg,SUBCLASSING:au},ar={},ng=qt,lR=TypeError,cR=function(t){var r,n;this.promise=new t(function(i,a){if(void 0!==r||void 0!==n)throw new lR("Bad Promise constructor");r=i,n=a}),this.resolve=ng(r),this.reject=ng(n)};ar.f=function(t){return new cR(t)};var Mo,pg,hg,uR=Se,To=Co,Fn=Ae,Nr=Ze,rg=rn,ig=Lc,dR=wi,fR=F1,mR=qt,Eo=Te,pR=He,hR=xo,gR=function(t,r){var i,n=w1(t).constructor;return void 0===n||mw(i=w1(n)[hw])?r:function(t){if(lw(t))return t;throw new uw(cw(t)+" is not a constructor")}(i)},ag=q1.set,ou=Xw,vR=wo,_R=X1,og=nr,jo=Ro,sg=ar,Do="Promise",lg=Di.CONSTRUCTOR,yR=Di.REJECTION_EVENT,CR=Di.SUBCLASSING,lu=og.getterFor(Do),xR=og.set,Gr=jo&&jo.prototype,or=jo,Ao=Gr,cg=Fn.TypeError,cu=Fn.document,uu=Fn.process,du=sg.f,FR=du,SR=!!(cu&&cu.createEvent&&Fn.dispatchEvent),ug="unhandledrejection",gg=function(t){var r;return!(!pR(t)||!Eo(r=t.then))&&r},bg=function(t,r){var c,u,d,n=r.value,i=1===r.state,a=i?t.ok:t.fail,o=t.resolve,s=t.reject,l=t.domain;try{a?(i||(2===r.rejection&&RR(r),r.rejection=1),!0===a?c=n:(l&&l.enter(),c=a(n),l&&(l.exit(),d=!0)),c===t.promise?s(new cg("Promise-chain cycle")):(u=gg(c))?Nr(u,c,o,s):o(c)):s(n)}catch(f){l&&!d&&l.exit(),s(f)}},vg=function(t,r){t.notified||(t.notified=!0,ou(function(){for(var i,n=t.reactions;i=n.get();)bg(i,t);t.notified=!1,r&&!t.rejection&&wR(t)}))},_g=function(t,r,n){var i,a;SR?((i=cu.createEvent("Event")).promise=r,i.reason=n,i.initEvent(t,!1,!0),Fn.dispatchEvent(i)):i={promise:r,reason:n},!yR&&(a=Fn["on"+t])?a(i):t===ug&&function(t,r){try{1===arguments.length?console.error(t):console.error(t,r)}catch{}}("Unhandled promise rejection",n)},wR=function(t){Nr(ag,Fn,function(){var a,r=t.facade,n=t.value;if(yg(t)&&(a=vR(function(){To?uu.emit("unhandledRejection",n,r):_g(ug,r,n)}),t.rejection=To||yg(t)?2:1,a.error))throw a.value})},yg=function(t){return 1!==t.rejection&&!t.parent},RR=function(t){Nr(ag,Fn,function(){var r=t.facade;To?uu.emit("rejectionHandled",r):_g("rejectionhandled",r,t.value)})},Lr=function(t,r,n){return function(i){t(r,i,n)}},Yr=function(t,r,n){t.done||(t.done=!0,n&&(t=n),t.value=r,t.state=2,vg(t,!0))},mu=function(t,r,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===r)throw new cg("Promise can't be resolved itself");var i=gg(r);i?ou(function(){var a={done:!1};try{Nr(i,r,Lr(mu,a,t),Lr(Yr,a,t))}catch(o){Yr(a,o,t)}}):(t.value=r,t.state=1,vg(t,!1))}catch(a){Yr({done:!1},a,t)}}};if(lg&&(or=function(r){hR(this,Ao),mR(r),Nr(Mo,this);var n=lu(this);try{r(Lr(mu,n),Lr(Yr,n))}catch(i){Yr(n,i)}},(Mo=function(r){xR(this,{type:Do,done:!1,notified:!1,parent:!1,reactions:new _R,rejection:!1,state:0,value:void 0})}).prototype=rg(Ao=or.prototype,"then",function(r,n){var i=lu(this),a=du(gR(this,or));return i.parent=!0,a.ok=!Eo(r)||r,a.fail=Eo(n)&&n,a.domain=To?uu.domain:void 0,0===i.state?i.reactions.add(a):ou(function(){bg(a,i)}),a.promise}),pg=function(){var t=new Mo,r=lu(t);this.promise=t,this.resolve=Lr(mu,r),this.reject=Lr(Yr,r)},sg.f=du=function(t){return t===or||void 0===t?new pg(t):FR(t)},Eo(jo)&&Gr!==Object.prototype)){hg=Gr.then,CR||rg(Gr,"then",function(r,n){var i=this;return new or(function(a,o){Nr(hg,i,a,o)}).then(r,n)},{unsafe:!0});try{delete Gr.constructor}catch{}ig&&ig(Gr,Ao)}uR({global:!0,constructor:!0,wrap:!0,forced:lg},{Promise:or}),dR(or,Do,!1),fR(Do);var Ai={},ER=Ai,jR=Me("iterator"),DR=Array.prototype,Cg=function(t){return void 0!==t&&(ER.Array===t||DR[jR]===t)},AR=ho,xg=io,MR=xn,PR=Ai,OR=Me("iterator"),pu=function(t){if(!MR(t))return xg(t,OR)||xg(t,"@@iterator")||PR[AR(t)]},NR=Ze,GR=qt,LR=ct,YR=Si,VR=pu,zR=TypeError,Fg=function(t,r){var n=arguments.length<2?VR(t):r;if(GR(n))return LR(NR(n,t));throw new zR(YR(t)+" is not iterable")},qR=Ze,Sg=ct,UR=io,kg=function(t,r,n){var i,a;Sg(t);try{if(!(i=UR(t,"return"))){if("throw"===r)throw n;return n}i=qR(i,t)}catch(o){a=!0,i=o}if("throw"===r)throw n;if(a)throw i;return Sg(i),n},XR=Br,WR=Ze,QR=ct,JR=Si,HR=Cg,ZR=sn,$g=hc,KR=Fg,eT=pu,Ig=kg,tT=TypeError,Po=function(t,r){this.stopped=t,this.result=r},wg=Po.prototype,Vr=function(t,r,n){var u,d,f,p,h,b,g,a=!(!n||!n.AS_ENTRIES),o=!(!n||!n.IS_RECORD),s=!(!n||!n.IS_ITERATOR),l=!(!n||!n.INTERRUPTED),c=XR(r,n&&n.that),_=function(S){return u&&Ig(u,"normal",S),new Po(!0,S)},C=function(S){return a?(QR(S),l?c(S[0],S[1],_):c(S[0],S[1])):l?c(S,_):c(S)};if(o)u=t.iterator;else if(s)u=t;else{if(!(d=eT(t)))throw new tT(JR(t)+" is not iterable");if(HR(d)){for(f=0,p=ZR(t);p>f;f++)if((h=C(t[f]))&&$g(wg,h))return h;return new Po(!1)}u=KR(t,d)}for(b=o?t.next:u.next;!(g=WR(b,u)).done;){try{h=C(g.value)}catch(S){Ig(u,"throw",S)}if("object"==typeof h&&h&&$g(wg,h))return h}return new Po(!1)},Rg=Me("iterator"),Tg=!1;try{var rT=0,Eg={next:function(){return{done:!!rT++}},return:function(){Tg=!0}};Eg[Rg]=function(){return this},Array.from(Eg,function(){throw 2})}catch{}var hu=function(t,r){try{if(!r&&!Tg)return!1}catch{return!1}var n=!1;try{var i={};i[Rg]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},iT=Ro,gu=Di.CONSTRUCTOR||!hu(function(t){iT.all(t).then(void 0,function(){})}),lT=Ze,cT=qt,uT=ar,dT=wo,fT=Vr;Se({target:"Promise",stat:!0,forced:gu},{all:function(r){var n=this,i=uT.f(n),a=i.resolve,o=i.reject,s=dT(function(){var l=cT(n.resolve),c=[],u=0,d=1;fT(r,function(f){var p=u++,h=!1;d++,lT(l,n,f).then(function(b){h||(h=!0,c[p]=b,--d||a(c))},o)}),--d||a(c)});return s.error&&o(s.value),i.promise}});var bu=Ro,gT=tr,bT=Te,vT=rn,jg=bu&&bu.prototype;if(Se({target:"Promise",proto:!0,forced:Di.CONSTRUCTOR,real:!0},{catch:function(t){return this.then(void 0,t)}}),bT(bu)){var Dg=gT("Promise").prototype.catch;jg.catch!==Dg&&vT(jg,"catch",Dg,{unsafe:!0})}var yT=Ze,CT=qt,xT=ar,FT=wo,ST=Vr;Se({target:"Promise",stat:!0,forced:gu},{race:function(r){var n=this,i=xT.f(n),a=i.reject,o=FT(function(){var s=CT(n.resolve);ST(r,function(l){yT(s,n,l).then(i.resolve,a)})});return o.error&&a(o.value),i.promise}});var IT=Ze,wT=ar;Se({target:"Promise",stat:!0,forced:Di.CONSTRUCTOR},{reject:function(r){var n=wT.f(this);return IT(n.reject,void 0,r),n.promise}});var TT=ct,ET=He,jT=ar,AT=Se,PT=Di.CONSTRUCTOR;tr("Promise"),AT({target:"Promise",stat:!0,forced:PT},{resolve:function(r){return function(t,r){if(TT(t),ET(r)&&r.constructor===t)return r;var n=jT.f(t);return(0,n.resolve)(r),n.promise}(this,r)}});var Ag={},OT=v1,NT=Bc,Bo=Object.keys||function(r){return OT(r,NT)},YT=jt,VT=ct,zT=on,qT=Bo;Ag.f=ht&&!H0?Object.defineProperties:function(r,n){VT(r);for(var l,i=zT(n),a=qT(n),o=a.length,s=0;o>s;)YT.f(r,l=a[s++],i[l]);return r};var Oo,UT=ct,XT=Ag,Mg=Bc,WT=lo,QT=A1,JT=no,vu="prototype",Og=wc("IE_PROTO"),yu=function(){},Ng=function(t){return"<script>"+t+"<\/script>"},Gg=function(t){t.write(Ng("")),t.close();var r=t.parentWindow.Object;return t=null,r},No=function(){try{Oo=new ActiveXObject("htmlfile")}catch{}No=typeof document<"u"?document.domain&&Oo?Gg(Oo):function(){var n,t=JT("iframe");return t.style.display="none",QT.appendChild(t),t.src=String("javascript:"),(n=t.contentWindow.document).open(),n.write(Ng("document.F=Object")),n.close(),n.F}():Gg(Oo);for(var t=Mg.length;t--;)delete No[vu][Mg[t]];return No()};WT[Og]=!0;var Go=Object.create||function(r,n){var i;return null!==r?(yu[vu]=UT(r),i=new yu,yu[vu]=null,i[Og]=r):i=No(),void 0===n?i:XT.f(i,n)},eE=Go,tE=jt.f,Cu=Me("unscopables"),xu=Array.prototype;void 0===xu[Cu]&&tE(xu,Cu,{configurable:!0,value:eE(null)});var sr,Iu,wu,Fu=function(t){xu[Cu][t]=!0},rE=!ge(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),iE=kt,aE=Te,oE=zt,lE=rE,Lg=wc("IE_PROTO"),Su=Object,cE=Su.prototype,ku=lE?Su.getPrototypeOf:function(t){var r=oE(t);if(iE(r,Lg))return r[Lg];var n=r.constructor;return aE(n)&&r instanceof n?n.prototype:r instanceof Su?cE:null},uE=ge,dE=Te,fE=He,Yg=ku,mE=rn,$u=Me("iterator"),Vg=!1;[].keys&&("next"in(wu=[].keys())?(Iu=Yg(Yg(wu)))!==Object.prototype&&(sr=Iu):Vg=!0);var hE=!fE(sr)||uE(function(){var t={};return sr[$u].call(t)!==t});hE&&(sr={}),dE(sr[$u])||mE(sr,$u,function(){return this});var zg={IteratorPrototype:sr,BUGGY_SAFARI_ITERATORS:Vg},gE=zg.IteratorPrototype,bE=Go,vE=so,_E=wi,yE=Ai,CE=function(){return this},FE=Se,SE=Ze,kE=Te,Ug=ku,Xg=Lc,IE=wi,wE=Mr,Ru=rn,TE=Ai,EE=oo.PROPER,jE=oo.CONFIGURABLE,Qg=zg.IteratorPrototype,Lo=zg.BUGGY_SAFARI_ITERATORS,Mi=Me("iterator"),Pi="values",Hg="entries",DE=function(){return this},Tu=function(t,r,n,i,a,o,s){!function(t,r,n,i){var a=r+" Iterator";t.prototype=bE(gE,{next:vE(+!i,n)}),_E(t,a,!1),yE[a]=CE}(n,r,i);var b,g,_,l=function(C){if(C===a&&p)return p;if(!Lo&&C&&C in d)return d[C];switch(C){case"keys":case Pi:case Hg:return function(){return new n(this,C)}}return function(){return new n(this)}},c=r+" Iterator",u=!1,d=t.prototype,f=d[Mi]||d["@@iterator"]||a&&d[a],p=!Lo&&f||l(a),h="Array"===r&&d.entries||f;if(h&&(b=Ug(h.call(new t)))!==Object.prototype&&b.next&&(Ug(b)!==Qg&&(Xg?Xg(b,Qg):kE(b[Mi])||Ru(b,Mi,DE)),IE(b,c,!0)),EE&&a===Pi&&f&&f.name!==Pi&&(jE?wE(d,"name",Pi):(u=!0,p=function(){return SE(f,this)})),a)if(g={values:l(Pi),keys:o?p:l("keys"),entries:l(Hg)},s)for(_ in g)(Lo||u||!(_ in d))&&Ru(d,_,g[_]);else FE({target:r,proto:!0,forced:Lo||u},g);return d[Mi]!==p&&Ru(d,Mi,p,{name:a}),TE[r]=p,g},Eu=function(t,r){return{value:t,done:r}},AE=on,ju=Fu,Zg=Ai,ME=jt.f,PE=Tu,Yo=Eu,BE=ht,eb="Array Iterator",OE=nr.set,NE=nr.getterFor(eb),GE=PE(Array,"Array",function(t,r){OE(this,{type:eb,target:AE(t),index:0,kind:r})},function(){var t=NE(this),r=t.target,n=t.index++;if(!r||n>=r.length)return t.target=void 0,Yo(void 0,!0);switch(t.kind){case"keys":return Yo(n,!1);case"values":return Yo(r[n],!1)}return Yo([n,r[n]],!1)},"values"),tb=Zg.Arguments=Zg.Array;if(ju("keys"),ju("values"),ju("entries"),BE&&"values"!==tb.name)try{ME(tb,"name",{value:"values"})}catch{}var YE=Ze,VE=qt,zE=ar,qE=wo,UE=Vr;Se({target:"Promise",stat:!0,forced:gu},{allSettled:function(r){var n=this,i=zE.f(n),a=i.resolve,o=i.reject,s=qE(function(){var l=VE(n.resolve),c=[],u=0,d=1;UE(r,function(f){var p=u++,h=!1;d++,YE(l,n,f).then(function(b){h||(h=!0,c[p]={status:"fulfilled",value:b},--d||a(c))},function(b){h||(h=!0,c[p]={status:"rejected",reason:b},--d||a(c))})}),--d||a(c)});return s.error&&o(s.value),i.promise}});var WE=ho,QE=String,Sn=function(t){if("Symbol"===WE(t))throw new TypeError("Cannot convert a Symbol value to a string");return QE(t)},Du=_e,JE=_o,HE=Sn,ZE=Kn,KE=Du("".charAt),nb=Du("".charCodeAt),e9=Du("".slice),rb=function(t){return function(r,n){var s,l,i=HE(ZE(r)),a=JE(n),o=i.length;return a<0||a>=o?t?"":void 0:(s=nb(i,a))<55296||s>56319||a+1===o||(l=nb(i,a+1))<56320||l>57343?t?KE(i,a):s:t?e9(i,a,a+2):l-56320+(s-55296<<10)+65536}},ib={codeAt:rb(!1),charAt:rb(!0)},t9=ib.charAt,n9=Sn,r9=Tu,ob=Eu,sb="String Iterator",i9=nr.set,a9=nr.getterFor(sb);r9(String,"String",function(t){i9(this,{type:sb,string:n9(t),index:0})},function(){var a,r=a9(this),n=r.string,i=r.index;return i>=n.length?ob(void 0,!0):(a=t9(n,i),r.index+=a.length,ob(a,!1))});var lb={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Au=no("span").classList,cb=Au&&Au.constructor&&Au.constructor.prototype,ub=cb===Object.prototype?void 0:cb,db=Ae,fb=lb,s9=ub,Bi=GE,mb=Mr,l9=wi,Mu=Me("iterator"),Pu=Bi.values,pb=function(t,r){if(t){if(t[Mu]!==Pu)try{mb(t,Mu,Pu)}catch{t[Mu]=Pu}if(l9(t,r,!0),fb[r])for(var n in Bi)if(t[n]!==Bi[n])try{mb(t,n,Bi[n])}catch{t[n]=Bi[n]}}};for(var Bu in fb)pb(db[Bu]&&db[Bu].prototype,Bu);pb(s9,"DOMTokenList");var u9=zt,hb=yo,d9=sn,h9=Fu;Se({target:"Array",proto:!0},{fill:function(r){for(var n=u9(this),i=d9(n),a=arguments.length,o=hb(a>1?arguments[1]:void 0,i),s=a>2?arguments[2]:void 0,l=void 0===s?i:hb(s,i);l>o;)n[o++]=r;return n}}),h9("fill");var g9=an,Ou=Array.isArray||function(r){return"Array"===g9(r)},b9=_c,v9=jt,_9=so,Vo=function(t,r,n){var i=b9(r);i in t?v9.f(t,i,_9(0,n)):t[i]=n},y9=ge,x9=Fi,F9=Me("species"),zo=function(t){return x9>=51||!y9(function(){var r=[];return(r.constructor={})[F9]=function(){return{foo:1}},1!==r[t](Boolean).foo})},S9=Se,gb=Ou,k9=Fo,$9=He,bb=yo,I9=sn,w9=on,R9=Vo,T9=Me,j9=M1,D9=zo("slice"),A9=T9("species"),Nu=Array,M9=Math.max;function Gu(t,r,n,i){return new(n||(n=Promise))(function(o,s){function l(d){try{u(i.next(d))}catch(f){s(f)}}function c(d){try{u(i.throw(d))}catch(f){s(f)}}function u(d){d.done?o(d.value):function a(o){return o instanceof n?o:new n(function(s){s(o)})}(d.value).then(l,c)}u((i=i.apply(t,r||[])).next())})}function W(t,r,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof r?t!==r||!i:!r.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(t):i?i.value:r.get(t)}S9({target:"Array",proto:!0,forced:!D9},{slice:function(r,n){var l,c,u,i=w9(this),a=I9(i),o=bb(r,a),s=bb(void 0===n?a:n,a);if(gb(i)&&((k9(l=i.constructor)&&(l===Nu||gb(l.prototype))||$9(l)&&null===(l=l[A9]))&&(l=void 0),l===Nu||void 0===l))return j9(i,o,s);for(c=new(void 0===l?Nu:l)(M9(s-o,0)),u=0;o<s;o++,u++)o in i&&R9(c,u,i[o]);return c.length=u,c}});var vb={exports:{}};!function(t){var r=Object.prototype.hasOwnProperty,n="~";function i(){}function a(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function o(c,u,d,f,p){if("function"!=typeof d)throw new TypeError("The listener must be a function");var h=new a(d,f||c,p),b=n?n+u:u;return c._events[b]?c._events[b].fn?c._events[b]=[c._events[b],h]:c._events[b].push(h):(c._events[b]=h,c._eventsCount++),c}function s(c,u){0==--c._eventsCount?c._events=new i:delete c._events[u]}function l(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),l.prototype.eventNames=function(){var d,f,u=[];if(0===this._eventsCount)return u;for(f in d=this._events)r.call(d,f)&&u.push(n?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},l.prototype.listeners=function(u){var f=this._events[n?n+u:u];if(!f)return[];if(f.fn)return[f.fn];for(var p=0,h=f.length,b=new Array(h);p<h;p++)b[p]=f[p].fn;return b},l.prototype.listenerCount=function(u){var f=this._events[n?n+u:u];return f?f.fn?1:f.length:0},l.prototype.emit=function(u,d,f,p,h,b){var g=n?n+u:u;if(!this._events[g])return!1;var S,F,_=this._events[g],C=arguments.length;if(_.fn){switch(_.once&&this.removeListener(u,_.fn,void 0,!0),C){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,d),!0;case 3:return _.fn.call(_.context,d,f),!0;case 4:return _.fn.call(_.context,d,f,p),!0;case 5:return _.fn.call(_.context,d,f,p,h),!0;case 6:return _.fn.call(_.context,d,f,p,h,b),!0}for(F=1,S=new Array(C-1);F<C;F++)S[F-1]=arguments[F];_.fn.apply(_.context,S)}else{var A,D=_.length;for(F=0;F<D;F++)switch(_[F].once&&this.removeListener(u,_[F].fn,void 0,!0),C){case 1:_[F].fn.call(_[F].context);break;case 2:_[F].fn.call(_[F].context,d);break;case 3:_[F].fn.call(_[F].context,d,f);break;case 4:_[F].fn.call(_[F].context,d,f,p);break;default:if(!S)for(A=1,S=new Array(C-1);A<C;A++)S[A-1]=arguments[A];_[F].fn.apply(_[F].context,S)}}return!0},l.prototype.on=function(u,d,f){return o(this,u,d,f,!1)},l.prototype.once=function(u,d,f){return o(this,u,d,f,!0)},l.prototype.removeListener=function(u,d,f,p){var h=n?n+u:u;if(!this._events[h])return this;if(!d)return s(this,h),this;var b=this._events[h];if(b.fn)b.fn===d&&(!p||b.once)&&(!f||b.context===f)&&s(this,h);else{for(var g=0,_=[],C=b.length;g<C;g++)(b[g].fn!==d||p&&!b[g].once||f&&b[g].context!==f)&&_.push(b[g]);_.length?this._events[h]=1===_.length?_[0]:_:s(this,h)}return this},l.prototype.removeAllListeners=function(u){var d;return u?this._events[d=n?n+u:u]&&s(this,d):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,t.exports=l}(vb);var B9=lt(vb.exports),$t=Array.isArray;function qo(){if(!arguments.length)return[];var t=arguments[0];return $t(t)?t:[t]}var _b=Ou,N9=Fo,G9=He,Y9=Me("species"),yb=Array,Cb=function(t,r){return new(function(t){var r;return _b(t)&&(N9(r=t.constructor)&&(r===yb||_b(r.prototype))||G9(r)&&null===(r=r[Y9]))&&(r=void 0),void 0===r?yb:r}(t))(0===r?0:r)},q9=Br,X9=bo,W9=zt,Q9=sn,J9=Cb,xb=_e([].push),kn=function(t){var r=1===t,n=2===t,i=3===t,a=4===t,o=6===t,s=7===t,l=5===t||o;return function(c,u,d,f){for(var F,D,p=W9(c),h=X9(p),b=Q9(h),g=q9(u,d),_=0,C=f||J9,S=r?C(c,b):n||s?C(c,0):void 0;b>_;_++)if((l||_ in h)&&(D=g(F=h[_],_,p),t))if(r)S[_]=D;else if(D)switch(t){case 3:return!0;case 5:return F;case 6:return _;case 2:xb(S,F)}else switch(t){case 4:return!1;case 7:xb(S,F)}return o?-1:i||a?a:S}},Uo={forEach:kn(0),map:kn(1),filter:kn(2),some:kn(3),every:kn(4),find:kn(5),findIndex:kn(6),filterReject:kn(7)},Z9=Uo.map;Se({target:"Array",proto:!0,forced:!zo("map")},{map:function(r){return Z9(this,r,arguments.length>1?arguments[1]:void 0)}});var Fb=ht,nj=Ze,rj=ge,Lu=Bo,ij=Oc,aj=go,oj=zt,sj=bo,zr=Object.assign,Sb=Object.defineProperty,lj=_e([].concat),cj=!zr||rj(function(){if(Fb&&1!==zr({b:1},zr(Sb({},"a",{enumerable:!0,get:function(){Sb(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},r={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(a){r[a]=a}),7!==zr({},t)[n]||Lu(zr({},r)).join("")!==i})?function(r,n){for(var i=oj(r),a=arguments.length,o=1,s=ij.f,l=aj.f;a>o;)for(var p,c=sj(arguments[o++]),u=s?lj(Lu(c),s(c)):Lu(c),d=u.length,f=0;d>f;)p=u[f++],(!Fb||nj(l,c,p))&&(i[p]=c[p]);return i}:zr;Se({target:"Object",stat:!0,arity:2,forced:Object.assign!==cj},{assign:cj});var $b={exports:{}},Ib={},wb=yo,dj=sn,fj=Vo,mj=Array,pj=Math.max,Rb=function(t,r,n){for(var i=dj(t),a=wb(r,i),o=wb(void 0===n?i:n,i),s=mj(pj(o-a,0)),l=0;a<o;a++,l++)fj(s,l,t[a]);return s.length=l,s},hj=an,gj=on,Tb=vo.f,bj=Rb,Eb="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Ib.f=function(r){return Eb&&"Window"===hj(r)?function(t){try{return Tb(t)}catch{return bj(Eb)}}(r):Tb(gj(r))};var yj=ge(function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}}),xj=He,Fj=an,jb=yj,Xo=Object.isExtensible,kj=ge(function(){Xo(1)})||jb?function(r){return!(!xj(r)||jb&&"ArrayBuffer"===Fj(r))&&(!Xo||Xo(r))}:Xo,Ij=!ge(function(){return Object.isExtensible(Object.preventExtensions({}))}),wj=Se,Rj=_e,Tj=lo,Ej=He,Yu=kt,jj=jt.f,Db=vo,Dj=Ib,Vu=kj,Mj=Ij,Ab=!1,ln=lc("meta"),Pj=0,zu=function(t){jj(t,ln,{value:{objectID:"O"+Pj++,weakData:{}}})},Lj=$b.exports={enable:function(){Lj.enable=function(){},Ab=!0;var t=Db.f,r=Rj([].splice),n={};n[ln]=1,t(n).length&&(Db.f=function(i){for(var a=t(i),o=0,s=a.length;o<s;o++)if(a[o]===ln){r(a,o,1);break}return a},wj({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Dj.f}))},fastKey:function(t,r){if(!Ej(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!Yu(t,ln)){if(!Vu(t))return"F";if(!r)return"E";zu(t)}return t[ln].objectID},getWeakData:function(t,r){if(!Yu(t,ln)){if(!Vu(t))return!0;if(!r)return!1;zu(t)}return t[ln].weakData},onFreeze:function(t){return Mj&&Ab&&Vu(t)&&!Yu(t,ln)&&zu(t),t}};Tj[ln]=!0;var qu=$b.exports,Yj=Te,Vj=He,Mb=Lc,qj=Se,Uj=Ae,Xj=_e,Pb=Nc,Wj=rn,Qj=qu,Jj=Vr,Hj=xo,Zj=Te,Kj=xn,Uu=He,Xu=ge,eD=hu,tD=wi,Wu=function(t,r,n){var i=-1!==t.indexOf("Map"),a=-1!==t.indexOf("Weak"),o=i?"set":"add",s=Uj[t],l=s&&s.prototype,c=s,u={},d=function(C){var S=Xj(l[C]);Wj(l,C,"add"===C?function(D){return S(this,0===D?0:D),this}:"delete"===C?function(F){return!(a&&!Uu(F))&&S(this,0===F?0:F)}:"get"===C?function(D){return a&&!Uu(D)?void 0:S(this,0===D?0:D)}:"has"===C?function(D){return!(a&&!Uu(D))&&S(this,0===D?0:D)}:function(D,A){return S(this,0===D?0:D,A),this})};if(Pb(t,!Zj(s)||!(a||l.forEach&&!Xu(function(){(new s).entries().next()}))))c=n.getConstructor(r,t,i,o),Qj.enable();else if(Pb(t,!0)){var p=new c,h=p[o](a?{}:-0,1)!==p,b=Xu(function(){p.has(1)}),g=eD(function(C){new s(C)}),_=!a&&Xu(function(){for(var C=new s,S=5;S--;)C[o](S,S);return!C.has(-0)});g||((c=r(function(C,S){Hj(C,l);var F=function(t,r,n){var i,a;return Mb&&Yj(i=r.constructor)&&i!==n&&Vj(a=i.prototype)&&a!==n.prototype&&Mb(t,a),t}(new s,C,c);return Kj(S)||Jj(S,F[o],{that:F,AS_ENTRIES:i}),F})).prototype=l,l.constructor=c),(b||_)&&(d("delete"),d("has"),i&&d("get")),(_||h)&&d(o),a&&l.clear&&delete l.clear}return u[t]=c,qj({global:!0,constructor:!0,forced:c!==s},u),tD(c,t),a||n.setStrong(c,t,i),c},rD=rn,Bb=function(t,r,n){for(var i in r)rD(t,i,r[i],n);return t},Ob=Bb,Wo=qu.getWeakData,aD=xo,oD=ct,sD=xn,Qu=He,lD=Vr,Gb=kt,cD=nr.set,uD=nr.getterFor,dD=Uo.find,fD=Uo.findIndex,mD=_e([].splice),pD=0,Qo=function(t){return t.frozen||(t.frozen=new Yb)},Yb=function(){this.entries=[]},Ju=function(t,r){return dD(t.entries,function(n){return n[0]===r})};Yb.prototype={get:function(t){var r=Ju(this,t);if(r)return r[1]},has:function(t){return!!Ju(this,t)},set:function(t,r){var n=Ju(this,t);n?n[1]=r:this.entries.push([t,r])},delete:function(t){var r=fD(this.entries,function(n){return n[0]===t});return~r&&mD(this.entries,r,1),!!~r}};var hD={getConstructor:function(t,r,n,i){var a=t(function(c,u){aD(c,o),cD(c,{type:r,id:pD++,frozen:void 0}),sD(u)||lD(u,c[i],{that:c,AS_ENTRIES:n})}),o=a.prototype,s=uD(r),l=function(c,u,d){var f=s(c),p=Wo(oD(u),!0);return!0===p?Qo(f).set(u,d):p[f.id]=d,c};return Ob(o,{delete:function(c){var u=s(this);if(!Qu(c))return!1;var d=Wo(c);return!0===d?Qo(u).delete(c):d&&Gb(d,u.id)&&delete d[u.id]},has:function(u){var d=s(this);if(!Qu(u))return!1;var f=Wo(u);return!0===f?Qo(d).has(u):f&&Gb(f,d.id)}}),Ob(o,n?{get:function(u){var d=s(this);if(Qu(u)){var f=Wo(u);return!0===f?Qo(d).get(u):f?f[d.id]:void 0}},set:function(u,d){return l(this,u,d)}}:{add:function(u){return l(this,u,!0)}}),a}};Wu("WeakSet",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},hD);var Jo,Vb,zb,Ye=function(t){return t[t.SCROLL_NONE=0]="SCROLL_NONE",t[t.SCROLL_BACKWARD=1]="SCROLL_BACKWARD",t[t.SCROLL_FORWARD=2]="SCROLL_FORWARD",t}(Ye||{}),cn=function(t){return t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT",t}(cn||{}),jD=[0,100],DD=function(){function t(r){nt(this,t),Jo.add(this),this.calendar=r,this.maxDomainReached=!1,this.minDomainReached=!1}return rt(t,[{key:"loadNewDomains",value:function(n){var i=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ye.SCROLL_NONE,o=this.calendar.options.options,s=this.calendar.templateCollection,l=o.date.min?s.get(o.domain.type).extractUnit(+o.date.min):void 0,c=o.date.max?s.get(o.domain.type).extractUnit(+o.date.max):void 0,u=this.calendar.domainCollection;return W(this,Jo,"m",Vb).call(this,n,l,c,a)?Ye.SCROLL_NONE:(a!==Ye.SCROLL_NONE&&n.clamp(l,c).slice(o.range,a===Ye.SCROLL_FORWARD),u.merge(n,o.range,function(d,f){var p;return p=n.at(f+1)?n.at(f+1):i.calendar.dateHelper.intervals(o.domain.type,d,2).pop(),s.get(o.subDomain.type).mapping(d,p).map(function(h){return Object.assign(Object.assign({},h),{v:o.data.defaultValue})})}),W(this,Jo,"m",zb).call(this,u.min,u.max,l,c),a===Ye.SCROLL_BACKWARD?this.calendar.eventEmitter.emit("domainsLoaded",[u.min]):a===Ye.SCROLL_FORWARD&&this.calendar.eventEmitter.emit("domainsLoaded",[u.max]),a)}},{key:"jumpTo",value:function(n,i){var a=this.calendar,o=a.domainCollection,s=a.options,l=new Date(o.min),c=new Date(o.max);return n<l?this.loadNewDomains(this.calendar.createDomainCollection(n,l,!1),Ye.SCROLL_BACKWARD):i?this.loadNewDomains(this.calendar.createDomainCollection(n,s.options.range),l<n?Ye.SCROLL_FORWARD:Ye.SCROLL_BACKWARD):n>c?this.loadNewDomains(this.calendar.createDomainCollection(c,n,!1),Ye.SCROLL_FORWARD):Ye.SCROLL_NONE}}]),t}();Jo=new WeakSet,Vb=function(r,n,i,a){return!!(i&&r.max>=i&&this.maxDomainReached&&a===Ye.SCROLL_FORWARD||n&&r.min<=n&&this.minDomainReached&&a===Ye.SCROLL_BACKWARD)},zb=function(r,n,i,a){if(i){var o=r<=i;this.calendar.eventEmitter.emit(o?"minDateReached":"minDateNotReached"),this.minDomainReached=o}if(a){var s=n>=a;this.calendar.eventEmitter.emit(s?"maxDateReached":"maxDateNotReached"),this.maxDomainReached=s}};var AD=TypeError,BD=Se,OD=ge,ND=Ou,GD=He,LD=zt,YD=sn,qb=function(t){if(t>9007199254740991)throw AD("Maximum allowed index exceeded");return t},Ub=Vo,VD=Cb,zD=zo,UD=Fi,Xb=Me("isConcatSpreadable"),XD=UD>=51||!OD(function(){var t=[];return t[Xb]=!1,t.concat()[0]!==t}),WD=function(t){if(!GD(t))return!1;var r=t[Xb];return void 0!==r?!!r:ND(t)};BD({target:"Array",proto:!0,arity:1,forced:!XD||!zD("concat")},{concat:function(r){var o,s,l,c,u,n=LD(this),i=VD(n,0),a=0;for(o=-1,l=arguments.length;o<l;o++)if(WD(u=-1===o?n:arguments[o]))for(c=YD(u),qb(a+c),s=0;s<c;s++,a++)s in u&&Ub(i,a,u[s]);else qb(a+1),Ub(i,a++,u);return i.length=a,i}});var JD=ge,Hu=function(t,r){var n=[][t];return!!n&&JD(function(){n.call(null,r||function(){return 1},1)})},HD=Se,KD=bo,eA=on,tA=Hu,nA=_e([].join);HD({target:"Array",proto:!0,forced:KD!==Object||!tA("join",",")},{join:function(r){return nA(eA(this),void 0===r?",":r)}});var aA=Go,oA=Yc,Wb=Bb,sA=Br,lA=xo,cA=xn,uA=Vr,dA=Tu,Ho=Eu,fA=F1,Oi=ht,Qb=qu.fastKey,Hb=nr.set,Zu=nr.getterFor,Zb={getConstructor:function(t,r,n,i){var a=t(function(u,d){lA(u,o),Hb(u,{type:r,index:aA(null),first:void 0,last:void 0,size:0}),Oi||(u.size=0),cA(d)||uA(d,u[i],{that:u,AS_ENTRIES:n})}),o=a.prototype,s=Zu(r),l=function(u,d,f){var b,g,p=s(u),h=c(u,d);return h?h.value=f:(p.last=h={index:g=Qb(d,!0),key:d,value:f,previous:b=p.last,next:void 0,removed:!1},p.first||(p.first=h),b&&(b.next=h),Oi?p.size++:u.size++,"F"!==g&&(p.index[g]=h)),u},c=function(u,d){var h,f=s(u),p=Qb(d);if("F"!==p)return f.index[p];for(h=f.first;h;h=h.next)if(h.key===d)return h};return Wb(o,{clear:function(){for(var f=s(this),p=f.index,h=f.first;h;)h.removed=!0,h.previous&&(h.previous=h.previous.next=void 0),delete p[h.index],h=h.next;f.first=f.last=void 0,Oi?f.size=0:this.size=0},delete:function(u){var d=this,f=s(d),p=c(d,u);if(p){var h=p.next,b=p.previous;delete f.index[p.index],p.removed=!0,b&&(b.next=h),h&&(h.previous=b),f.first===p&&(f.first=h),f.last===p&&(f.last=b),Oi?f.size--:d.size--}return!!p},forEach:function(d){for(var h,f=s(this),p=sA(d,arguments.length>1?arguments[1]:void 0);h=h?h.next:f.first;)for(p(h.value,h.key,this);h&&h.removed;)h=h.previous},has:function(d){return!!c(this,d)}}),Wb(o,n?{get:function(d){var f=c(this,d);return f&&f.value},set:function(d,f){return l(this,0===d?0:d,f)}}:{add:function(d){return l(this,d=0===d?0:d,d)}}),Oi&&oA(o,"size",{configurable:!0,get:function(){return s(this).size}}),a},setStrong:function(t,r,n){var i=r+" Iterator",a=Zu(r),o=Zu(i);dA(t,r,function(s,l){Hb(this,{type:i,target:s,state:a(s),kind:l,last:void 0})},function(){for(var s=o(this),l=s.kind,c=s.last;c&&c.removed;)c=c.previous;return s.target&&(s.last=c=c?c.next:s.state.first)?Ho("keys"===l?c.key:"values"===l?c.value:[c.key,c.value],!1):(s.target=void 0,Ho(void 0,!0))},n?"entries":"values",!n,!0),fA(r)}};Wu("Map",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Zb);var Kb=Si,hA=TypeError,ev=Rb,bA=Math.floor,Ku=function(t,r){var n=t.length,i=bA(n/2);return n<8?vA(t,r):_A(t,Ku(ev(t,0,i),r),Ku(ev(t,i),r),r)},vA=function(t,r){for(var a,o,n=t.length,i=1;i<n;){for(o=i,a=t[i];o&&r(t[o-1],a)>0;)t[o]=t[--o];o!==i++&&(t[o]=a)}return t},_A=function(t,r,n,i){for(var a=r.length,o=n.length,s=0,l=0;s<a||l<o;)t[s+l]=s<a&&l<o?i(r[s],n[l])<=0?r[s++]:n[l++]:s<a?r[s++]:n[l++];return t},yA=Ku,tv=er.match(/firefox\/(\d+)/i),xA=!!tv&&+tv[1],SA=/MSIE|Trident/.test(er),nv=er.match(/AppleWebKit\/(\d+)\./),IA=Se,rv=_e,wA=qt,RA=zt,iv=sn,TA=function(t,r){if(!delete t[r])throw new hA("Cannot delete property "+Kb(r)+" of "+Kb(t))},av=Sn,ed=ge,EA=yA,jA=Hu,ov=xA,DA=SA,sv=Fi,lv=!!nv&&+nv[1],$n=[],cv=rv($n.sort),AA=rv($n.push),MA=ed(function(){$n.sort(void 0)}),PA=ed(function(){$n.sort(null)}),BA=jA("sort"),uv=!ed(function(){if(sv)return sv<70;if(!(ov&&ov>3)){if(DA)return!0;if(lv)return lv<603;var r,n,i,a,t="";for(r=65;r<76;r++){switch(n=String.fromCharCode(r),r){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(a=0;a<47;a++)$n.push({k:n+a,v:i})}for($n.sort(function(o,s){return s.v-o.v}),a=0;a<$n.length;a++)n=$n[a].k.charAt(0),t.charAt(t.length-1)!==n&&(t+=n);return"DGBEFHACIJK"!==t}});IA({target:"Array",proto:!0,forced:MA||!PA||!BA||!uv},{sort:function(r){void 0!==r&&wA(r);var n=RA(this);if(uv)return void 0===r?cv(n):cv(n,r);var o,s,i=[],a=iv(n);for(s=0;s<a;s++)s in n&&AA(i,n[s]);for(EA(i,function(t){return function(r,n){return void 0===n?-1:void 0===r?1:void 0!==t?+t(r,n)||0:av(r)>av(n)?1:-1}}(r)),o=iv(i),s=0;s<o;)n[s]=i[s++];for(;s<a;)TA(n,s++);return n}});var GA=Uo.forEach,dv=Ae,fv=lb,zA=ub,td=Hu("forEach")?[].forEach:function(r){return GA(this,r,arguments.length>1?arguments[1]:void 0)},qA=Mr,mv=function(t){if(t&&t.forEach!==td)try{qA(t,"forEach",td)}catch{t.forEach=td}};for(var nd in fv)fv[nd]&&mv(dv[nd]&&dv[nd].prototype);function pv(t){return"top"===t||"bottom"===t}function hv(t){return t[cn.LEFT]+t[cn.RIGHT]}function gv(t){return t[cn.TOP]+t[cn.BOTTOM]}mv(zA);var Zo,bv,vv,UA=function(){function t(r,n){nt(this,t),Zo.add(this),this.calendar=r,this.domainPainter=n,this.collection=new Map,this.scrollDirection=Ye.SCROLL_FORWARD}return rt(t,[{key:"get",value:function(n){return this.collection.get(n)}},{key:"update",value:function(n,i){var a=this,o=this.calendar.options.options,s=o.verticalOrientation,l=o.domain;this.scrollDirection=i;var c={width:0,height:0},u=0,d=i===Ye.SCROLL_FORWARD?-1:1,f=n.keys;return"desc"===this.calendar.options.options.domain.sort&&(f.reverse(),d*=-1),n.yankedDomains.forEach(function(p){u+=a.collection.get(p)[s?"height":"width"]}),n.yankedDomains.forEach(function(p){var h=a.collection.get(p);a.collection.set(p,Object.assign(Object.assign({},h),{x:s?h.x:h.x+u*d,y:s?h.y+u*d:h.y}))}),f.forEach(function(p){var h=W(a,Zo,"m",bv).call(a,p),b=W(a,Zo,"m",vv).call(a,p);s?(c.height+=b,c.width=Math.max(h,c.width)):(c.width+=h,c.height=Math.max(b,c.height));var g=c.width-h,_=c.height-b;a.collection.set(p,Object.assign(Object.assign({},a.collection.get(p)),{x:s?0:g,y:s?_:0,pre_x:s?g:g-u*d,pre_y:s?_-u*d:_,width:h,height:b,inner_width:h-(s?0:l.gutter),inner_height:b-(s?l.gutter:0)}))}),c}}]),t}();Zo=new WeakSet,bv=function(r){var n=this.calendar.options.options,i=n.domain,a=n.subDomain,o=n.x,s=n.verticalOrientation,l=this.calendar.templateCollection.get(a.type).columnsCount(r),c=(a.width+a.gutter)*l-a.gutter;return hv(i.padding)+o.domainHorizontalLabelWidth+(s?0:i.gutter)+c},vv=function(r){var n=this.calendar.options.options,i=n.domain,a=n.subDomain,o=n.x,s=n.verticalOrientation,l=this.calendar.templateCollection.get(a.type).rowsCount(r),c=(a.height+a.gutter)*l-a.gutter;return gv(i.padding)+c+(s?i.gutter:0)+o.domainVerticalLabelHeight};var rd,_v,Ko=".ch-domain",XA=function(){function t(r){nt(this,t),rd.add(this),this.calendar=r,this.coordinates=new UA(r,this),this.root=null,this.dimensions={width:0,height:0}}return rt(t,[{key:"paint",value:function(n,i){var a=this,o=this.calendar.options.options.animationDuration,s=i.transition().duration(o),l=this.coordinates;this.dimensions=l.update(this.calendar.domainCollection,n);var c=[];return this.root=i.selectAll(Ko).data(this.calendar.domainCollection.keys,function(u){return u}).join(function(u){return u.append("svg").attr("x",function(d){return l.get(d).pre_x}).attr("y",function(d){return l.get(d).pre_y}).attr("width",function(d){return l.get(d).inner_width}).attr("height",function(d){return l.get(d).inner_height}).attr("class",function(d){return W(a,rd,"m",_v).call(a,d)}).call(function(d){return d.append("rect").attr("width",function(f){return l.get(f).inner_width}).attr("height",function(f){return l.get(f).inner_height}).attr("class","".concat(Ko.slice(1),"-bg"))}).call(function(d){return c.push(d.transition(s).attr("x",function(f){return l.get(f).x}).attr("y",function(f){return l.get(f).y}).end())})},function(u){return u.call(function(d){return c.push(d.transition(s).attr("x",function(f){return l.get(f).x}).attr("y",function(f){return l.get(f).y}).attr("width",function(f){return l.get(f).inner_width}).attr("height",function(f){return l.get(f).inner_height}).end())}).call(function(d){return c.push(d.selectAll("".concat(Ko,"-bg")).transition(s).attr("width",function(f){return l.get(f).inner_width}).attr("height",function(f){return l.get(f).inner_height}).end())})},function(u){return u.call(function(d){return c.push(d.transition(s).attr("x",function(f){return l.get(f).x}).attr("y",function(f){return l.get(f).y}).remove().end())})}),c}}]),t}();rd=new WeakSet,_v=function(r){var n=Ko.slice(1),i=this.calendar.dateHelper.date(r);switch(this.calendar.options.options.domain.type){case"hour":n+=" h_".concat(i.hour());break;case"day":n+=" d_".concat(i.date()," dy_").concat(i.format("d")+1);break;case"week":n+=" w_".concat(i.week());break;case"month":n+=" m_".concat(i.month()+1);break;case"year":n+=" y_".concat(i.year())}return n};var QA=g1.includes,HA=Fu;Se({target:"Array",proto:!0,forced:ge(function(){return!Array(1).includes()})},{includes:function(r){return QA(this,r,arguments.length>1?arguments[1]:void 0)}}),HA("includes");var eM=Uo.filter;Se({target:"Array",proto:!0,forced:!zo("filter")},{filter:function(r){return eM(this,r,arguments.length>1?arguments[1]:void 0)}});var rM=ct,iM=kg,oM=Br,sM=Ze,lM=zt,cM=function(t,r,n,i){try{return i?r(rM(n)[0],n[1]):r(n)}catch(a){iM(t,"throw",a)}},uM=Cg,dM=Fo,fM=sn,yv=Vo,mM=Fg,pM=pu,Cv=Array,gM=Se,_M=!hu(function(t){Array.from(t)});gM({target:"Array",stat:!0,forced:_M},{from:function(r){var n=lM(r),i=dM(this),a=arguments.length,o=a>1?arguments[1]:void 0,s=void 0!==o;s&&(o=oM(o,a>2?arguments[2]:void 0));var u,d,f,p,h,b,l=pM(n),c=0;if(!l||this===Cv&&uM(l))for(u=fM(n),d=i?new this(u):Cv(u);u>c;c++)b=s?o(n[c],c):n[c],yv(d,c,b);else for(h=(p=mM(n,l)).next,d=i?new this:[];!(f=sM(h,p)).done;c++)b=s?cM(p,o,[f.value,c],!0):f.value,yv(d,c,b);return d.length=c,d}});var In,xv,Fv,Ni,yM={year:"YYYY",month:"MMMM",week:"wo [week] YYYY",xDay:"Do MMM",ghDay:"Do MMM",day:"Do MMM",hour:"HH:00",minute:"HH:mm"},Sv=function(){function t(r,n,i,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(nt(this,t),In.add(this),this.collection=new Map,this.dateHelper=r,n&&i&&a){var s=this.dateHelper.intervals(n,i,a,o).map(function(l){return qo(l)});this.collection=new Map(s)}this.min=0,this.max=0,this.keys=[],this.yankedDomains=[],this.collection.size>0&&W(this,In,"m",Ni).call(this)}return rt(t,[{key:"has",value:function(n){return this.collection.has(n)}},{key:"get",value:function(n){return this.collection.get(n)}},{key:"forEach",value:function(n){return this.collection.forEach(n)}},{key:"at",value:function(n){return this.keys[n]}},{key:"clamp",value:function(n,i){var a=this;return n&&this.min<n&&this.keys.filter(function(o){return o<n}).forEach(function(o){return a.collection.delete(o)}),i&&this.max>i&&this.keys.filter(function(o){return o>i}).forEach(function(o){return a.collection.delete(o)}),W(this,In,"m",Ni).call(this),this}},{key:"merge",value:function(n,i,a){var o=this;this.yankedDomains=[],n.keys.forEach(function(s,l){if(!o.has(s)){if(o.collection.size>=i){var c=o.max;s>o.max&&(c=o.min),c&&o.collection.delete(c)&&o.yankedDomains.push(c)}o.collection.set(s,a(s,l)),W(o,In,"m",Ni).call(o)}}),this.yankedDomains=this.yankedDomains.sort(function(s,l){return s-l})}},{key:"slice",value:function(){var n=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.keys.length>i&&((arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?this.keys.slice(i):this.keys.slice(0,-i)).forEach(function(s){n.collection.delete(s)}),W(this,In,"m",Ni).call(this)),this}},{key:"fill",value:function(n,i,a){var o=this,l=i.y,c=i.groupY,u=i.defaultValue,d=this.groupRecords(n,i.x,a);this.keys.forEach(function(f){var p=d.get(f)||{};W(o,In,"m",xv).call(o,f,p,l,c,u)})}},{key:"groupRecords",value:function(n,i,a){var o=this,s=new Map,l=new Map;return this.keys.forEach(function(c){o.get(c).forEach(function(u){l.set(u.t,c)})}),n.forEach(function(c){var u=o.extractTimestamp(c,i,a);if(l.has(u)){var d=l.get(u),f=s.get(d)||{};f[u]||(f[u]=[]),f[u].push(c),s.set(d,f)}}),s}},{key:"groupValues",value:function(n,i){var a=n.filter(function(o){return null!==o});if("string"==typeof i){if(a.every(function(o){return"number"==typeof o}))switch(i){case"sum":return a.reduce(function(o,s){return o+s},0);case"count":return a.length;case"min":return Math.min.apply(Math,nc(a))||null;case"max":return Math.max.apply(Math,nc(a))||null;case"average":return a.length>0?a.reduce(function(o,s){return o+s},0)/a.length:null;default:return null}return"count"===i?a.length:null}return"function"==typeof i?i(a):null}},{key:"extractTimestamp",value:function(n,i,a){var o="function"==typeof i?i(n):n[i];return"string"==typeof o&&(o=+new Date(o)),a(o)}}]),t}();In=new WeakSet,xv=function(r,n,i,a,o){var s=this;this.get(r).forEach(function(l,c){var u=o;n.hasOwnProperty(l.t)&&(u=s.groupValues(W(s,In,"m",Fv).call(s,n[l.t],i),a)),s.get(r)[c].v=u})},Fv=function(r,n){return r.map(function(i){return"function"==typeof n?n(i):i[n]})},Ni=function(){this.keys=Array.from(this.collection.keys()).map(function(n){return parseInt(n,10)}).sort(function(n,i){return n-i});var r=this.keys;return this.min=r[0],this.max=r[r.length-1],this.keys};var Xe,id,ad,od,qr,es,sd,kv=".ch-domain-text",CM=function(){function t(r){nt(this,t),Xe.add(this),this.calendar=r}return rt(t,[{key:"paint",value:function(n){var i=this,a=this.calendar.options.options.domain,o=a.label,l=this.calendar.dateHelper,c=o.text;null===c||""===c||(typeof c>"u"&&(c=yM[a.type]),n.selectAll(kv).data(function(u){return[u]},function(u){return u}).join(function(u){return u.append("text").attr("class",kv.slice(1)).attr("x",function(d){return W(i,Xe,"m",ad).call(i,d)}).attr("y",function(d){return W(i,Xe,"m",od).call(i,d)}).attr("text-anchor",o.textAlign).attr("dominant-baseline",function(){return W(i,Xe,"m",id).call(i)}).text(function(d,f,p){return l.format(d,c,p[f])}).call(function(d){return W(i,Xe,"m",sd).call(i,d)})},function(u){u.attr("x",function(d){return W(i,Xe,"m",ad).call(i,d)}).attr("y",function(d){return W(i,Xe,"m",od).call(i,d)}).attr("text-anchor",o.textAlign).attr("dominant-baseline",function(){return W(i,Xe,"m",id).call(i)}).text(function(d,f,p){return l.format(d,c,p[f])}).call(function(d){return W(i,Xe,"m",sd).call(i,d)})}))}}]),t}();Xe=new WeakSet,id=function(){var r=this.calendar.options.options.domain.label,n=r.position,i=r.rotate;return pv(n)?"middle":"left"===i&&"left"===n||"right"===i&&"right"===n?"bottom":"hanging"},ad=function(r){var n=this.calendar.options.options.domain,a=n.label,o=a.position,s=a.textAlign,l=a.offset,c=this.calendar.options.options.x.domainHorizontalLabelWidth,u=n.padding[cn.LEFT];return"right"===o&&(u+=W(this,Xe,"m",qr).call(this,r)),"middle"===s&&(["top","bottom"].includes(o)?u+=W(this,Xe,"m",qr).call(this,r)/2:u+=c/2),"end"===s&&(pv(o)?u+=W(this,Xe,"m",qr).call(this,r):u+=c),u+l.x},od=function(r){var n=this.calendar.options.options,i=n.domain,a=i.label,s=a.offset,u=i.padding[cn.TOP]+n.x.domainVerticalLabelHeight/2;return"bottom"===a.position&&(u+=W(this,Xe,"m",es).call(this,r)),u+s.y},qr=function(r){var n=this.calendar.options.options,i=n.domain.padding,a=n.x.domainHorizontalLabelWidth;return this.calendar.calendarPainter.domainsContainerPainter.domainPainter.coordinates.get(r).inner_width-a-hv(i)},es=function(r){var n=this.calendar.options.options,i=n.x.domainVerticalLabelHeight,a=n.domain.padding;return this.calendar.calendarPainter.domainsContainerPainter.domainPainter.coordinates.get(r).inner_height-i-gv(a)},sd=function(r){var n=this,i=this.calendar.options.options,a=i.domain.label,s=a.textAlign,l=a.position,u=i.x.domainHorizontalLabelWidth;switch(a.rotate){case"right":r.attr("transform",function(d){var f=W(n,Xe,"m",qr).call(n,d),p=W(n,Xe,"m",es).call(n,d),h=["rotate(90, ".concat("right"===l?f:u,", 0)")];switch(l){case"right":"middle"===s?h.push("translate(".concat(p/2-u/2,")")):"end"===s&&h.push("translate(".concat(p-u,")"));break;case"left":"start"===s?h.push("translate(".concat(u,")")):"middle"===s?h.push("translate(".concat(u/2+p/2,")")):"end"===s&&h.push("translate(".concat(p,")"))}return h.join(",")});break;case"left":r.attr("transform",function(d){var f=W(n,Xe,"m",qr).call(n,d),p=W(n,Xe,"m",es).call(n,d),h=["rotate(270, ".concat("right"===l?f:u,", 0)")];switch(l){case"right":"start"===s?h.push("translate(-".concat(p,")")):"middle"===s?h.push("translate(-".concat(p/2+u/2,")")):"end"===s&&h.push("translate(-".concat(u,")"));break;case"left":"start"===s?h.push("translate(".concat(u-p,")")):"middle"===s&&h.push("translate(".concat(u/2-p/2,")"))}return h.join(",")})}};var $v="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",FM=Kn,SM=Sn,ld=$v,Iv=_e("".replace),kM=RegExp("^["+ld+"]+"),$M=RegExp("(^|[^"+ld+"])["+ld+"]+$"),cd=function(t){return function(r){var n=SM(FM(r));return 1&t&&(n=Iv(n,kM,"")),2&t&&(n=Iv(n,$M,"$1")),n}},IM={start:cd(1),end:cd(2),trim:cd(3)},wM=oo.PROPER,RM=ge,wv=$v,jM=IM.trim;Se({target:"String",proto:!0,forced:function(t){return RM(function(){return!!wv[t]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[t]()||wM&&wv[t].name!==t})}("trim")},{trim:function(){return jM(this)}});var it,ud,ts,Tv,dd,ns,rs,is=".ch-subdomain",MM=function(){function t(r){nt(this,t),it.add(this),this.calendar=r,this.root=null}return rt(t,[{key:"paint",value:function(n){var i=this;this.root=n||this.root;var a="".concat(is,"-container"),o=this.root.selectAll(a).data(function(p){return[p]},function(p){return p}).join(function(p){return p.append("svg").call(function(h){return W(i,it,"m",ud).call(i,h)}).attr("class",a.slice(1))},function(p){return p.call(function(h){return W(i,it,"m",ud).call(i,h)})}),s=this.calendar.options.options.subDomain,l=s.radius,c=s.width,u=s.height,d=s.sort,f=this.calendar.eventEmitter;o.selectAll("g").data(function(p){var h=i.calendar.domainCollection.get(p);if("desc"===d){var b=Math.max.apply(Math,nc(h.map(function(g){return g.x})));h.forEach(function(g,_){h[_].x=Math.abs(g.x-b)})}return h}).join(function(p){return p.append("g").call(function(h){return h.insert("rect").attr("class",function(b){return W(i,it,"m",ts).call(i,b.t,"".concat(is.slice(1),"-bg"))}).attr("width",c).attr("height",u).attr("x",function(b){return W(i,it,"m",ns).call(i,b)}).attr("y",function(b){return W(i,it,"m",rs).call(i,b)}).on("click",function(b,g){return f.emit("click",b,g.t,g.v)}).on("mouseover",function(b,g){return f.emit("mouseover",b,g.t,g.v)}).on("mouseout",function(b,g){return f.emit("mouseout",b,g.t,g.v)}).attr("rx",l>0?l:null).attr("ry",l>0?l:null)}).call(function(h){return W(i,it,"m",Tv).call(i,h)})},function(p){return p.selectAll("rect").attr("class",function(h){return W(i,it,"m",ts).call(i,h.t,"".concat(is.slice(1),"-bg"))}).attr("width",c).attr("height",u).attr("x",function(h){return W(i,it,"m",ns).call(i,h)}).attr("y",function(h){return W(i,it,"m",rs).call(i,h)}).attr("rx",l).attr("ry",l)})}}]),t}();it=new WeakSet,ud=function(r){var n=this.calendar.options.options,i=n.domain,a=i.padding,o=i.label.position;r.attr("x",function(){var s=a[cn.LEFT];return"left"===o&&(s+=n.x.domainHorizontalLabelWidth),s}).attr("y",function(){var s=a[cn.TOP];return"top"===o&&(s+=n.x.domainVerticalLabelHeight),s})},ts=function(r){var n=this,i=this.calendar.options.options,a=i.date.highlight,o=i.subDomain.type,s="";a.length>0&&a.forEach(function(d){var f=n.calendar.templateCollection.get(o).extractUnit;f(+d)===f(r)&&(s="highlight")});for(var l=arguments.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=arguments[u];return[s].concat(c).join(" ").trim()},Tv=function(r){var n=this,i=this.calendar.options.options.subDomain,a=i.width,o=i.height,s=i.label;return s?r.append("text").attr("class",function(l){return W(n,it,"m",ts).call(n,l.t,"".concat(is.slice(1),"-text"))}).attr("x",function(l){return W(n,it,"m",ns).call(n,l)+a/2}).attr("y",function(l){return W(n,it,"m",rs).call(n,l)+o/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(l,c,u){return n.calendar.dateHelper.format(l.t,s,l.v,u[c])}):null},dd=function(r,n){var i=this.calendar.options.options.subDomain;return n[r]*(i["x"===r?"width":"height"]+i.gutter)},ns=function(r){return W(this,it,"m",dd).call(this,"x",r)},rs=function(r){return W(this,it,"m",dd).call(this,"y",r)};var Ur,fd,Ev,jv,Dv=".ch-domain-container",Av="in-transition",PM=function(){function t(r){nt(this,t),Ur.add(this),this.calendar=r,this.domainPainter=new XA(r),this.subDomainPainter=new MM(r),this.domainLabelPainter=new CM(r),this.dimensions={width:0,height:0},this.transitionsQueueCount=0}return rt(t,[{key:"setup",value:function(){this.root=this.calendar.calendarPainter.root.attr("x",0).attr("y",0).append("svg").attr("class",Dv.slice(1)).append("svg").attr("class","".concat(Dv.slice(1),"-animation-wrapper"))}},{key:"paint",value:function(n){var i=this;W(this,Ur,"m",fd).call(this);var a=this.domainPainter.paint(n,this.root);return this.subDomainPainter.paint(this.domainPainter.root),this.domainLabelPainter.paint(this.domainPainter.root),W(this,Ur,"m",jv).call(this),Promise.allSettled(a).then(function(){W(i,Ur,"m",Ev).call(i)}),a}},{key:"updatePosition",value:function(){var n;if(null===(n=this.root)||void 0===n||!n.node())return Promise.resolve();var i=this.calendar.options.options.animationDuration,a=this.calendar.pluginManager.getHeightFromPosition("top"),o=this.calendar.pluginManager.getWidthFromPosition("left");return[da(this.root.node().parentNode).transition().duration(i).call(function(s){s.attr("x",o).attr("y",a)}).end()]}},{key:"width",value:function(){return this.dimensions.width}},{key:"height",value:function(){return this.dimensions.height}},{key:"destroy",value:function(){return W(this,Ur,"m",fd).call(this),Promise.resolve()}}]),t}();Ur=new WeakSet,fd=function(){var r;null!==(r=this.root)&&void 0!==r&&r.node()&&(this.transitionsQueueCount+=1,da(this.root.node().parentNode).classed(Av,!0))},Ev=function(){var r;null!==(r=this.root)&&void 0!==r&&r.node()&&(this.transitionsQueueCount-=1,0===this.transitionsQueueCount&&da(this.root.node().parentNode).classed(Av,!1))},jv=function(){var r=this.calendar.options.options,n=r.animationDuration,i=r.verticalOrientation,a=r.domain.gutter,o=this.domainPainter.dimensions;this.dimensions={width:o.width-(i?0:a),height:o.height-(i?a:0)},this.root.transition().duration(n).attr("width",this.dimensions.width).attr("height",this.dimensions.height)};var Gi,Mv,Pv,Bv,BM=function(){function t(r){nt(this,t),this.calendar=r}return rt(t,[{key:"paint",value:function(){var n=[];return(n=n.concat(this.calendar.pluginManager.paintAll())).concat(this.setPluginsPosition())}},{key:"setPluginsPosition",value:function(){var n=this.calendar.pluginManager,i=this.calendar.options.options.animationDuration,a=this.calendar.calendarPainter.domainsContainerPainter,o=n.getFromPosition("top"),s=n.getFromPosition("right"),l=n.getFromPosition("bottom"),c=n.getFromPosition("left"),u=n.getHeightFromPosition("top"),d=n.getWidthFromPosition("left"),f=[],p=0;o.forEach(function(b){f.push(b.root.transition().duration(i).attr("y",p).attr("x",d).end()),p+=b.options.dimensions.height});var h=0;return c.forEach(function(b){f.push(b.root.transition().duration(i).attr("x",h).attr("y",u).end()),h+=b.options.dimensions.width}),l.forEach(function(b){f.push(b.root.transition().duration(i).attr("x",d).attr("y",u+a.height()).end())}),h+=a.width(),s.forEach(function(b){f.push(b.root.transition().duration(i).attr("x",h).attr("y",u).end()),h+=b.options.dimensions.width}),f}},{key:"insideWidth",value:function(){return this.calendar.pluginManager.getWidthFromPosition("left")+this.calendar.pluginManager.getWidthFromPosition("right")}},{key:"insideHeight",value:function(){return this.calendar.pluginManager.getHeightFromPosition("top")+this.calendar.pluginManager.getHeightFromPosition("bottom")}}]),t}(),NM=function(){function t(r){nt(this,t),Gi.add(this),this.calendar=r,this.dimensions={width:0,height:0},this.root=null,this.domainsContainerPainter=new PM(r),this.pluginPainter=new BM(r)}return rt(t,[{key:"setup",value:function(){var n=this.calendar.options.options,a=n.theme;return this.root||(this.root=da(n.itemSelector).append("svg").attr("data-theme",a).attr("class",".ch-container".slice(1)),this.domainsContainerPainter.setup()),this.calendar.pluginManager.setupAll(),!0}},{key:"paint",value:function(){var i=this.domainsContainerPainter.paint(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ye.SCROLL_NONE).concat(this.pluginPainter.paint()).concat(this.domainsContainerPainter.updatePosition());return W(this,Gi,"m",Bv).call(this),Promise.allSettled(i)}},{key:"destroy",value:function(){var n=this.calendar.pluginManager.destroyAll().concat(this.domainsContainerPainter.destroy());return this.root&&n.push(this.root.transition().duration(this.calendar.options.options.animationDuration).attr("width",0).attr("height",0).remove().end()),Promise.allSettled(n)}}]),t}();Gi=new WeakSet,Mv=function(){return this.domainsContainerPainter.height()+this.pluginPainter.insideHeight()},Pv=function(){return this.domainsContainerPainter.width()+this.pluginPainter.insideWidth()},Bv=function(){var r=this.calendar.options.options,n=W(this,Gi,"m",Pv).call(this),i=W(this,Gi,"m",Mv).call(this);this.root.transition().duration(r.animationDuration).attr("width",n).attr("height",i),(n!==this.dimensions.width||i!==this.dimensions.height)&&this.calendar.eventEmitter.emit("resize",n,i,this.dimensions.width,this.dimensions.height),this.dimensions={width:n,height:i}};var Ov="object"==typeof global&&global&&global.Object===Object&&global,LM="object"==typeof self&&self&&self.Object===Object&&self,Xt=Ov||LM||Function("return this")(),wn=Xt.Symbol,Nv=Object.prototype,zM=Nv.hasOwnProperty,qM=Nv.toString,Li=wn?wn.toStringTag:void 0,WM=Object.prototype.toString,JM="[object Null]",HM="[object Undefined]",Gv=wn?wn.toStringTag:void 0;function Rn(t){return null==t?void 0===t?HM:JM:Gv&&Gv in Object(t)?function UM(t){var r=zM.call(t,Li),n=t[Li];try{t[Li]=void 0;var i=!0}catch{}var a=qM.call(t);return i&&(r?t[Li]=n:delete t[Li]),a}(t):function QM(t){return WM.call(t)}(t)}function un(t){var r=typeof t;return null!=t&&("object"==r||"function"==r)}var ZM="[object AsyncFunction]",KM="[object Function]",eP="[object GeneratorFunction]",tP="[object Proxy]";function Yi(t){if(!un(t))return!1;var r=Rn(t);return r==KM||r==eP||r==ZM||r==tP}var rP=zt,Lv=Bo;Se({target:"Object",stat:!0,forced:ge(function(){Lv(1)})},{keys:function(r){return Lv(rP(r))}});var t,oP=He,sP=an,cP=Me("match"),fP=TypeError,Yv=function(t){if(function(t){var r;return oP(t)&&(void 0!==(r=t[cP])?!!r:"RegExp"===sP(t))}(t))throw new fP("The method doesn't accept regular expressions");return t},pP=Me("match"),Vv=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[pP]=!1,"/./"[t](r)}catch{}}return!1},hP=Se,zv=zc,gP=$i.f,bP=Mc,qv=Sn,vP=Yv,_P=Kn,yP=Vv,Uv=zv("".startsWith),CP=zv("".slice),xP=Math.min,Xv=yP("startsWith");hP({target:"String",proto:!0,forced:!(!Xv&&(t=gP(String.prototype,"startsWith"),t&&!t.writable)||Xv)},{startsWith:function(r){var n=qv(_P(this));vP(r);var i=bP(xP(arguments.length>1?arguments[1]:void 0,n.length)),a=qv(r);return Uv?Uv(n,a,i):CP(n,i,i+a.length)===a}});var Wv=ht,SP=ge,Qv=_e,kP=ku,$P=Bo,IP=on,Jv=Qv(go.f),RP=Qv([].push),TP=Wv&&SP(function(){var t=Object.create(null);return t[2]=2,!Jv(t,2)}),Hv=function(t){return function(r){for(var c,n=IP(r),i=$P(n),a=TP&&null===kP(n),o=i.length,s=0,l=[];o>s;)c=i[s++],(!Wv||(a?c in n:Jv(n,c)))&&RP(l,t?[c,n[c]]:n[c]);return l}},DP=[Hv(!0),Hv(!1)][0];function Zv(t){return null!=t&&!Number.isNaN(t)}function AP(t,r){return+Zv(r)-+Zv(t)||_n(t,r)}function Kv(t){return isFinite(t)?t:NaN}function md(t){return t>0&&isFinite(t)?t:NaN}function e_(t){return t<0&&isFinite(t)?t:NaN}Se({target:"Object",stat:!0},{entries:function(r){return DP(r)}});const MP=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function t_(t,r){return MP.test(t+="")?new Date(t):"function"==typeof r?r(t):r}const PP=new Map([["second",nn],["minute",Ga],["hour",Ya],["day",$r],["week",Ir],["month",Rr],["quarter",Rr.every(3)],["half",Rr.every(6)],["year",Lt],["monday",pi],["tuesday",bp],["wednesday",vp],["thursday",Un],["friday",_p],["saturday",yp],["sunday",Ir]]),BP=new Map([["second",nn],["minute",La],["hour",Va],["day",mi],["week",wr],["month",Tr],["quarter",Tr.every(3)],["half",Tr.every(6)],["year",Yt],["monday",hi],["tuesday",Cp],["wednesday",xp],["thursday",Wn],["friday",Fp],["saturday",Sp],["sunday",wr]]);function OP(t){const r=PP.get(`${t}`.toLowerCase());if(!r)throw new Error(`unknown interval: ${t}`);return r}function NP(t){const r=BP.get(`${t}`.toLowerCase());if(!r)throw new Error(`unknown interval: ${t}`);return r}const n_=Object.getPrototypeOf(Uint8Array),GP=Object.prototype.toString,LP=t=>()=>t;function r_(t){return t instanceof n_?t:as(t,YP,Float64Array)}function YP(t){return null==t?NaN:Number(t)}function VP(t){return as(t,zP)}function zP(t){return t instanceof Date&&!isNaN(t)?t:"string"==typeof t?t_(t):null==t||isNaN(t=+t)?void 0:new Date(t)}function i_(t){return null==t||t instanceof Array||t instanceof n_?t:Array.from(t)}function as(t,r,n=Array){return null==t?t:t instanceof n?t.map(r):n.from(t,r)}function pd(t,r=Array){return t instanceof r?t.slice():r.from(t)}function UP(t){return function qP(t){return t?.toString===GP}(t)&&(void 0!==t.type||void 0!==t.domain)}function XP(t,r){if(null!=t){if("number"==typeof t){0<t&&t<1&&Number.isInteger(1/t)&&(t=-1/t);const n=Math.abs(t);return t<0?{floor:i=>Math.floor(i*n)/n,offset:i=>(i*n+1)/n,range:(i,a)=>al(Math.ceil(i*n),a*n).map(o=>o/n)}:{floor:i=>Math.floor(i/n)*n,offset:i=>i+n,range:(i,a)=>al(Math.ceil(i/n),a/n).map(o=>o*n)}}if("string"==typeof t)return("time"===r?OP:NP)(t);if("function"!=typeof t.floor)throw new Error("invalid interval; missing floor method");if("function"!=typeof t.offset)throw new Error("invalid interval; missing offset method");return t}}function os(t,r){if((t=XP(t,r))&&"function"!=typeof t.range)throw new Error("invalid interval: missing range method");return t}function a_(t){for(const r of t){if(null==r)continue;const n=typeof r;return"string"===n||"boolean"===n}}function hd(t){for(const r of t)if(null!=r)return r instanceof Date}function QP(t){for(const r of t)if(null!=r)return"string"==typeof r&&isNaN(r)&&t_(r)}function JP(t){for(const r of t)if(null!=r){if("string"!=typeof r)return!1;if(r.trim())return!isNaN(r)}}function gd(t){if(null!=t)return ba(t[0],t[t.length-1])}const Tn=Symbol("position"),Wt=Symbol("color"),ss=Symbol("radius"),ls=Symbol("length"),cs=Symbol("opacity"),us=Symbol("symbol"),at=new Map([["x",Tn],["y",Tn],["fx",Tn],["fy",Tn],["r",ss],["color",Wt],["opacity",cs],["symbol",us],["length",ls]]),KP=2/Math.sqrt(3),eB={draw(t,r){const n=Math.sqrt(r/Math.PI),i=n*KP,a=i/2;t.moveTo(0,i),t.lineTo(n,a),t.lineTo(n,-a),t.lineTo(0,-i),t.lineTo(-n,-a),t.lineTo(-n,a),t.closePath()}},tB=new Map([["asterisk",o0],["circle",Wl],["cross",s0],["diamond",c0],["diamond2",u0],["hexagon",eB],["plus",d0],["square",f0],["square2",m0],["star",h0],["times",_0],["triangle",g0],["triangle2",b0],["wye",v0]]);function o_(t){if(null==t||function nB(t){return t&&"function"==typeof t.draw}(t))return t;const r=tB.get(`${t}`.toLowerCase());if(r)return r;throw new Error(`invalid symbol: ${t}`)}function bd(t){console.warn(t)}const s_=new Map([["accent",h6],["category10",p6],["dark2",g6],["paired",b6],["pastel1",v6],["pastel2",_6],["set1",y6],["set2",C6],["set3",x6],["tableau10",F6],["brbg",dn(Up,Xp)],["prgn",dn(Wp,Qp)],["piyg",dn(Jp,Hp)],["puor",dn(Zp,Kp)],["rdbu",dn(Yl,Ua)],["rdgy",dn(eh,th)],["rdylbu",dn(Vl,Xa)],["rdylgn",dn(nh,rh)],["spectral",dn(ih,ah)],["burd",l_(Yl,Ua)],["buylrd",l_(Vl,Xa)],["blues",We(Th,Eh)],["greens",We(jh,Dh)],["greys",We(Ah,Mh)],["oranges",We(Gh,Lh)],["purples",We(Ph,Bh)],["reds",We(Oh,Nh)],["turbo",fn(Kh)],["viridis",fn(e0)],["magma",fn(t0)],["inferno",fn(n0)],["plasma",fn(r0)],["cividis",fn(Yh)],["cubehelix",fn(Wh)],["warm",fn(Qh)],["cool",fn(Jh)],["bugn",We(oh,sh)],["bupu",We(lh,ch)],["gnbu",We(uh,dh)],["orrd",We(fh,mh)],["pubu",We(gh,bh)],["pubugn",We(ph,hh)],["purd",We(vh,_h)],["rdpu",We(yh,Ch)],["ylgn",We(Sh,kh)],["ylgnbu",We(xh,Fh)],["ylorbr",We($h,Ih)],["ylorrd",We(wh,Rh)],["rainbow",c_(Hh)],["sinebow",c_(Zh)]]);function We(t,r){return({length:n})=>1===n?[t[3][1]]:2===n?[t[3][1],t[3][2]]:(n=Math.max(3,Math.floor(n)))>9?Nt(r,n):t[n]}function dn(t,r){return({length:n})=>2===n?[t[3][0],t[3][2]]:(n=Math.max(3,Math.floor(n)))>11?Nt(r,n):t[n]}function l_(t,r){return({length:n})=>2===n?[t[3][2],t[3][0]]:(n=Math.max(3,Math.floor(n)))>11?Nt(i=>r(1-i),n):t[n].slice().reverse()}function fn(t){return({length:r})=>Nt(t,Math.max(2,Math.floor(r)))}function c_(t){return({length:r})=>Nt(t,Math.floor(r)+1).slice(0,-1)}function u_(t){const r=`${t}`.toLowerCase();if(!s_.has(r))throw new Error(`unknown ordinal scheme: ${r}`);return s_.get(r)}function ds(t,r){const n=u_(t),i="function"==typeof n?n({length:r}):n;return i.length!==r?i.slice(0,r):i}const d_=new Map([["brbg",Xp],["prgn",Qp],["piyg",Hp],["puor",Kp],["rdbu",Ua],["rdgy",th],["rdylbu",Xa],["rdylgn",rh],["spectral",ah],["burd",t=>Ua(1-t)],["buylrd",t=>Xa(1-t)],["blues",Eh],["greens",Dh],["greys",Mh],["purples",Bh],["reds",Nh],["oranges",Lh],["turbo",Kh],["viridis",e0],["magma",t0],["inferno",n0],["plasma",r0],["cividis",Yh],["cubehelix",Wh],["warm",Qh],["cool",Jh],["bugn",sh],["bupu",ch],["gnbu",dh],["orrd",mh],["pubugn",hh],["pubu",bh],["purd",_h],["rdpu",Ch],["ylgnbu",Fh],["ylgn",kh],["ylorbr",Ih],["ylorrd",Rh],["rainbow",Hh],["sinebow",Zh]]);function vd(t){const r=`${t}`.toLowerCase();if(!d_.has(r))throw new Error(`unknown quantitative scheme: ${r}`);return d_.get(r)}const iB=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function f_(t){return null!=t&&iB.has(`${t}`.toLowerCase())}const m_=t=>r=>t(1-r),_d=[0,1],p_=new Map([["number",st],["rgb",zn],["hsl",CS],["hcl",FS],["lab",function xS(t,r){var n=ze((t=Zs(t)).l,(r=Zs(r)).l),i=ze(t.a,r.a),a=ze(t.b,r.b),o=ze(t.opacity,r.opacity);return function(s){return t.l=n(s),t.a=i(s),t.b=a(s),t.opacity=o(s),t+""}}]]);function h_(t){const r=`${t}`.toLowerCase();if(!p_.has(r))throw new Error(`unknown interpolator: ${r}`);return p_.get(r)}function Vi(t,r,n,{type:i,nice:a,clamp:o,zero:s,domain:l=b_(t,n),unknown:c,round:u,scheme:d,interval:f,range:p=(at.get(t)===ss?hB(n,l):at.get(t)===ls?gB(n,l):at.get(t)===cs?_d:void 0),interpolate:h=(at.get(t)===Wt?null==d&&void 0!==p?zn:vd(void 0!==d?d:"cyclical"===i?"rainbow":"turbo"):u?Fl:st),reverse:b}){if(f=os(f,i),("cyclical"===i||"sequential"===i)&&(i="linear"),b=!!b,"function"!=typeof h&&(h=h_(h)),1===h.length?(b&&(h=m_(h),b=!1),void 0===p&&2===(p=Float64Array.from(l,(g,_)=>_/(l.length-1))).length&&(p=_d),r.interpolate((p===_d?LP:v_)(h))):r.interpolate(h),s){const[g,_]=rl(l);(g>0||_<0)&&(gd(l=pd(l))!==Math.sign(g)?l[l.length-1]=0:l[0]=0)}return b&&(l=xa(l)),r.domain(l).unknown(c),a&&(r.nice(function aB(t,r){return!0===t?void 0:"number"==typeof t?t:function WP(t,r){if((t=os(t,r))&&"function"!=typeof t.ceil)throw new Error("invalid interval: missing ceil method");return t}(t,r)}(a,i)),l=r.domain()),void 0!==p&&r.range(p),o&&r.clamp(o),{type:i,domain:l,range:p,scale:r,interpolate:h,interval:f}}function oB(t,r,n){return Vi(t,Km(),r,n)}function g_(t,r,{exponent:n=1,...i}){return Vi(t,Dl().exponent(n),r,{...i,type:"pow"})}function lB(t,r,{base:n=10,domain:i=bB(r),...a}){return Vi(t,op().base(n),r,{...a,domain:i})}function cB(t,r,{constant:n=1,...i}){return Vi(t,up().constant(n),r,i)}function uB(t,r,{range:n,quantiles:i=(void 0===n?5:(n=[...n]).length),n:a=i,scheme:o="rdylbu",domain:s=vB(r),unknown:l,interpolate:c,reverse:u}){return void 0===n&&(n=void 0!==c?Nt(c,a):at.get(t)===Wt?ds(o,a):void 0),s.length>0&&(s=mp(s,void 0===n?{length:a}:n).quantiles()),yd(t,0,{domain:s,range:n,reverse:u,unknown:l})}function yd(t,r,{domain:n=[0],unknown:i,scheme:a="rdylbu",interpolate:o,range:s=(void 0!==o?Nt(o,n.length+1):at.get(t)===Wt?ds(a,n.length+1):void 0),reverse:l}){const c=gd(n=i_(n));if(!isNaN(c)&&!function fB(t,r){for(let n=1,i=t.length,a=t[0];n<i;++n){const o=ba(a,a=t[n]);if(0!==o&&o!==r)return!1}return!0}(n,c))throw new Error(`the ${t} scale has a non-monotonic domain`);return l&&(s=xa(s)),{type:"threshold",scale:pp(c<0?xa(n):n,void 0===s?[]:s).unknown(i),domain:n,range:s}}function zi(t,r=Kv){return t.length?[va(t,({value:n})=>void 0===n?n:va(n,r)),yn(t,({value:n})=>void 0===n?n:yn(n,r))]:[0,1]}function b_(t,r){const n=at.get(t);return(n===ss||n===cs||n===ls?pB:zi)(r)}function pB(t){return[0,t.length?yn(t,({value:r})=>void 0===r?r:yn(r,Kv)):1]}function hB(t,r){const n=t.find(({radius:s})=>void 0!==s);if(void 0!==n)return[0,n.radius];const i=il(t,.5,({value:s})=>void 0===s?NaN:il(s,.25,md)),a=r.map(s=>3*Math.sqrt(s/i)),o=30/yn(a);return o<1?a.map(s=>s*o):a}function gB(t,r){const n=lm(t,({value:o})=>void 0===o?NaN:lm(o,Math.abs)),i=r.map(o=>12*o/n),a=60/yn(i);return a<1?i.map(o=>o*a):i}function bB(t){for(const{value:r}of t)if(void 0!==r)for(let n of r){if(n>0)return zi(t,md);if(n<0)return zi(t,e_)}return[1,10]}function vB(t){const r=[];for(const{value:n}of t)if(void 0!==n)for(const i of n)r.push(i);return r}function v_(t){return(r,n)=>i=>t(r+i*(n-r))}function fs(t,r,n,i,{type:a,nice:o,clamp:s,domain:l=zi(i),unknown:c,pivot:u=0,scheme:d,range:f,symmetric:p=!0,interpolate:h=(at.get(t)===Wt?null==d&&void 0!==f?zn:vd(void 0!==d?d:"rdbu"):st),reverse:b}){u=+u;let[g,_]=l;if(ba(g,_)<0&&([g,_]=[_,g],b=!b),g=Math.min(g,u),_=Math.max(_,u),"function"!=typeof h&&(h=h_(h)),void 0!==f&&(h=1===h.length?v_(h)(...f):Lm(h,f)),b&&(h=m_(h)),p){const C=n.apply(u),S=C-n.apply(g),F=n.apply(_)-C;S<F?g=n.invert(C-F):S>F&&(_=n.invert(C+S))}return r.domain([g,u,_]).unknown(c).interpolator(h),s&&r.clamp(s),o&&r.nice(o),{type:a,domain:[g,_],pivot:u,interpolate:h,scale:r}}function _B(t,r,n){return fs(t,Vp(),FB,r,n)}function __(t,r,{exponent:n=1,...i}){return fs(t,Ll().exponent(n=+n),function $B(t){return.5===t?kB:{apply:r=>Math.sign(r)*Math.pow(Math.abs(r),t),invert:r=>Math.sign(r)*Math.pow(Math.abs(r),1/t)}}(n),r,{...i,type:"diverging-pow"})}function CB(t,r,{base:n=10,pivot:i=1,domain:a=zi(r,i<0?e_:md),...o}){return fs(t,zp().base(n=+n),SB,r,{domain:a,pivot:i,...o})}function xB(t,r,{constant:n=1,...i}){return fs(t,qp().constant(n=+n),function IB(t){return{apply:r=>Math.sign(r)*Math.log1p(Math.abs(r/t)),invert:r=>Math.sign(r)*Math.expm1(Math.abs(r))*t}}(n),r,i)}const FB={apply:t=>t,invert:t=>t},SB={apply:Math.log,invert:Math.exp},kB={apply:t=>Math.sign(t)*Math.sqrt(Math.abs(t)),invert:t=>Math.sign(t)*(t*t)};function y_(t,r,n,i){return Vi(t,r,n,i)}const qi=Symbol("ordinal");function C_(t,r,n,{type:i,interval:a,domain:o,range:s,reverse:l,hint:c}){return a=os(a,i),void 0===o&&(o=F_(n,a,t)),("categorical"===i||i===qi)&&(i="ordinal"),l&&(o=xa(o)),r.domain(o),void 0!==s&&("function"==typeof s&&(s=s(o)),r.range(s)),{type:i,domain:o,range:s,scale:r,hint:c,interval:a}}function x_(t,r,n,i){let{round:a}=n;return void 0!==a&&t.round(a=!!a),(t=C_(i,t,r,n)).round=a,t}function F_(t,r,n){const i=new Nx;for(const{value:a,domain:o}of t){if(void 0!==o)return o();if(void 0!==a)for(const s of a)i.add(s)}if(void 0!==r){const[a,o]=rl(i).map(r.floor,r);return r.range(a,r.offset(o))}if(i.size>1e4&&at.get(n)===Tn)throw new Error(`implicit ordinal domain of ${n} scale has more than 10,000 values`);return function Dx(t,...r){if("function"!=typeof t[Symbol.iterator])throw new TypeError("values is not iterable");t=Array.from(t);let[n]=r;if(n&&2!==n.length||r.length>1){const i=Uint32Array.from(t,(a,o)=>o);return r.length>1?(r=r.map(a=>t.map(a)),i.sort((a,o)=>{for(const s of r){const l=_a(s[a],s[o]);if(l)return l}})):(n=t.map(n),i.sort((a,o)=>_a(n[a],n[o]))),function jx(t,r){return Array.from(r,n=>t[n])}(t,i)}return t.sort(am(n))}(i,AP)}function S_(t,r){let n;for(const{hint:i}of t){const a=i?.[r];if(void 0!==a)if(void 0===n)n=a;else if(n!==a)return}return n}function MB(t,r,n){return function PB(t,r=[],n={}){const i=function BB(t,r,{type:n,domain:i,range:a,scheme:o,pivot:s,projection:l}){if("fx"===t||"fy"===t)return"band";("x"===t||"y"===t)&&null!=l&&(n=k_);for(const{type:d}of r)if(void 0!==d)if(void 0===n)n=d;else if(n!==d)throw new Error(`scale incompatible with channel: ${n} !== ${d}`);if(n===k_)return;if(void 0!==n)return n;if(void 0===i&&!r.some(({value:d})=>void 0!==d))return;const c=at.get(t);if(c===ss)return"sqrt";if(c===cs||c===ls)return"linear";if(c===us)return"ordinal";if((i||a||[]).length>2)return Cd(c);if(void 0!==i)return a_(i)?Cd(c):hd(i)?"utc":c!==Wt||null==s&&!f_(o)?"linear":"diverging";const u=r.map(({value:d})=>d).filter(d=>void 0!==d);return u.some(a_)?Cd(c):u.some(hd)?"utc":c!==Wt||null==s&&!f_(o)?"linear":"diverging"}(t,r,n);if(void 0===n.type&&void 0===n.domain&&void 0===n.range&&null==n.interval&&"fx"!==t&&"fy"!==t&&function OB({type:t}){return"ordinal"===t||"point"===t||"band"===t||t===qi}({type:i})){const a=r.map(({value:o})=>o).filter(o=>void 0!==o);a.some(hd)?bd(`Warning: some data associated with the ${t} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${Xr(i)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${t} scale to "${Xr(i)}".`):a.some(QP)?bd(`Warning: some data associated with the ${t} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${Xr(i)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${t} scale to "${Xr(i)}".`):a.some(JP)&&bd(`Warning: some data associated with the ${t} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${Xr(i)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${t} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${t} scale to "${Xr(i)}".`)}switch(n.type=i,i){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":n=ms(r,n,r_);break;case"identity":switch(at.get(t)){case Tn:n=ms(r,n,r_);break;case us:n=ms(r,n,NB)}break;case"utc":case"time":n=ms(r,n,VP)}switch(i){case"diverging":return _B(t,r,n);case"diverging-sqrt":return function yB(t,r,n){return __(t,r,{...n,exponent:.5})}(t,r,n);case"diverging-pow":return __(t,r,n);case"diverging-log":return CB(t,r,n);case"diverging-symlog":return xB(t,r,n);case"categorical":case"ordinal":case qi:return function TB(t,r,{type:n,interval:i,domain:a,range:o,scheme:s,unknown:l,...c}){let u;if(i=os(i,n),void 0===a&&(a=F_(r,i,t)),at.get(t)===us)u=function DB(t){return{fill:S_(t,"fill"),stroke:S_(t,"stroke")}}(r),o=void 0===o?function AB(t){return function HP(t){return null==t||function ZP(t){return/^\s*none\s*$/i.test(t)}(t)}(t.fill)?M6:A6}(u):as(o,o_);else if(at.get(t)===Wt&&(void 0===o&&("ordinal"===n||n===qi)&&(o=function rB(t,r="greys"){const n=new Set,[i,a]=ds(r,2);for(const o of t)if(null!=o)if(!0===o)n.add(a);else{if(!1!==o)return;n.add(i)}return[...n]}(a,s),void 0!==o&&(s=void 0)),void 0===s&&void 0===o&&(s="ordinal"===n?"turbo":"tableau10"),void 0!==s))if(void 0!==o){const d=vd(s),f=o[0],p=o[1]-o[0];o=({length:h})=>Nt(b=>d(f+p*b),h)}else o=u_(s);if(l===Sl)throw new Error(`implicit unknown on ${t} scale is not supported`);return C_(t,kl().unknown(l),r,{...c,type:n,domain:a,range:o,hint:u})}(t,r,n);case"cyclical":case"sequential":case"linear":return oB(t,r,n);case"sqrt":return function sB(t,r,n){return g_(t,r,{...n,exponent:.5})}(t,r,n);case"threshold":return yd(t,0,n);case"quantile":return uB(t,r,n);case"quantize":return function dB(t,r,{range:n,n:i=(void 0===n?5:(n=[...n]).length),scheme:a="rdylbu",domain:o=b_(t,r),unknown:s,interpolate:l,reverse:c}){const[u,d]=rl(o);let f;return void 0===n?(f=Ca(u,d,i),f[0]<=u&&f.splice(0,1),f[f.length-1]>=d&&f.pop(),i=f.length+1,n=void 0!==l?Nt(l,i):at.get(t)===Wt?ds(a,i):void 0):(f=Nt(st(u,d),i+1).slice(1,-1),u instanceof Date&&(f=f.map(p=>new Date(p)))),gd(i_(o))<0&&f.reverse(),yd(t,0,{domain:f,range:n,reverse:c,unknown:s})}(t,r,n);case"pow":return g_(t,r,n);case"log":return lB(t,r,n);case"symlog":return cB(t,r,n);case"utc":return function RB(t,r,n){return y_(t,function u6(){return Gt.apply(Gl(ek,tk,Yt,Tr,wr,mi,Va,La,nn,Lp).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}(),r,n)}(t,r,n);case"time":return function wB(t,r,n){return y_(t,function c6(){return Gt.apply(Gl(nk,rk,Lt,Rr,Ir,$r,Ya,Ga,nn,Gp).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}(),r,n)}(t,r,n);case"point":return function EB(t,r,{align:n=.5,padding:i=.5,...a}){return x_(wS().align(n).padding(i),r,a,t)}(t,r,n);case"band":return function jB(t,r,{align:n=.5,padding:i=.1,paddingInner:a=i,paddingOuter:o=("fx"===t||"fy"===t?0:i),...s}){return x_($l().align(n).paddingInner(a).paddingOuter(o),r,s,t)}(t,r,n);case"identity":return at.get(t)===Tn?function mB(){return{type:"identity",scale:ep()}}():{type:"identity"};case void 0:return;default:throw new Error(`unknown scale type: ${i}`)}}(t,void 0===n?void 0:[{hint:n}],{...r})}function Xr(t){return"symbol"==typeof t?t.description:t}const k_={toString:()=>"projection"};function Cd(t){switch(t){case Tn:return"point";case Wt:return qi;default:return"ordinal"}}function ms(t,{domain:r,...n},i){for(const a of t)void 0!==a.value&&(a.value=i(a.value));return{domain:void 0===r?r:i(r),...n}}function NB(t){return as(t,o_)}function LB({scale:t,type:r,domain:n,range:i,interpolate:a,interval:o,transform:s,percent:l,pivot:c}){if("identity"===r)return{type:"identity",apply:d=>d,invert:d=>d};const u=t.unknown?t.unknown():void 0;return{type:r,domain:pd(n),...void 0!==i&&{range:pd(i)},...void 0!==s&&{transform:s},...l&&{percent:l},...void 0!==u&&{unknown:u},...void 0!==o&&{interval:o},...void 0!==a&&{interpolate:a},...t.clamp&&{clamp:t.clamp()},...void 0!==c&&{pivot:c,symmetric:!1},...t.base&&{base:t.base()},...t.exponent&&{exponent:t.exponent()},...t.constant&&{constant:t.constant()},...t.align&&{align:t.align(),round:t.round()},...t.padding&&(t.paddingInner?{paddingInner:t.paddingInner(),paddingOuter:t.paddingOuter()}:{padding:t.padding()}),...t.bandwidth&&{bandwidth:t.bandwidth(),step:t.step()},apply:d=>t(d),...t.invert&&{invert:d=>t.invert(d)}}}var qB=function(){function t(r){nt(this,t),this.calendar=r}return rt(t,[{key:"populate",value:function(){var n=this.calendar,i=n.options.options,a=i.scale,o=i.subDomain,s=function YB(t){try{var r=Object.keys(t)[0];return function GB(t={}){let r;for(const n in t)if(at.has(n)&&UP(t[n])){if(void 0!==r)throw new Error("ambiguous scale definition; multiple scales found");r=LB(MB(n,t[n]))}if(void 0===r)throw new Error("invalid scale definition; no scale found");return r}(function e5(t,r,n){return(r=w0(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}({},r,Object.assign(Object.assign({},t[r]),{clamp:!0})))}catch{return null}}(a);n.calendarPainter.root.selectAll(".ch-domain").selectAll("svg").selectAll("g").data(function(l){return n.domainCollection.get(l)||[]}).call(function(l){!function zB(t,r,n,i){Object.entries(function VB(t,r){var n={};return r.hasOwnProperty("opacity")?(n.fill=function(){return r.opacity.baseColor||"red"},n["fill-opacity"]=function(i){return t?.apply(i)}):n.fill=function(i){return"string"==typeof i&&i?.startsWith("#")?i:t?.apply(i)},n}(r,n)).forEach(function(a){var o=$0(a,2),l=o[1];return t.style(o[0],function(c){return l(i?c[i]:c)})})}(l.select("rect"),s,a,"v")}).call(function(l){l.select("text").attr("style",function(c){var u=ga(s?.apply(c.v)).l>60?"#000":"#fff",d=o.color||(c.v?u:null);return Yi(d)&&(d=d(c.t,c.v,s?.apply(c.v))),d?"fill: ".concat(d,";"):null}).text(function(c,u,d){return n.dateHelper.format(c.t,o.label,c.v,d[u])})}).call(function(){n.eventEmitter.emit("fill")})}}]),t}();function Ui(t,r){return t===r||t!=t&&r!=r}function ps(t,r){for(var n=t.length;n--;)if(Ui(t[n][0],r))return n;return-1}var WB=Array.prototype.splice;function mn(t){var r=-1,n=null==t?0:t.length;for(this.clear();++r<n;){var i=t[r];this.set(i[0],i[1])}}mn.prototype.clear=function UB(){this.__data__=[],this.size=0},mn.prototype.delete=function QB(t){var r=this.__data__,n=ps(r,t);return!(n<0||(n==r.length-1?r.pop():WB.call(r,n,1),--this.size,0))},mn.prototype.get=function JB(t){var r=this.__data__,n=ps(r,t);return n<0?void 0:r[n][1]},mn.prototype.has=function HB(t){return ps(this.__data__,t)>-1},mn.prototype.set=function ZB(t,r){var n=this.__data__,i=ps(n,t);return i<0?(++this.size,n.push([t,r])):n[i][1]=r,this};var xd=Xt["__core-js_shared__"],$_=function(){var t=/[^.]+$/.exec(xd&&xd.keys&&xd.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),oO=Function.prototype.toString;function lr(t){if(null!=t){try{return oO.call(t)}catch{}try{return t+""}catch{}}return""}var lO=/^\[object .+?Constructor\]$/,mO=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function cr(t,r){var n=function hO(t,r){return t?.[r]}(t,r);return function pO(t){return!(!un(t)||function iO(t){return!!$_&&$_ in t}(t))&&(Yi(t)?mO:lO).test(lr(t))}(n)?n:void 0}var Xi=cr(Xt,"Map"),Wi=cr(Object,"create"),xO=Object.prototype.hasOwnProperty,kO=Object.prototype.hasOwnProperty;function ur(t){var r=-1,n=null==t?0:t.length;for(this.clear();++r<n;){var i=t[r];this.set(i[0],i[1])}}function hs(t,r){var n=t.__data__;return function TO(t){var r=typeof t;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t}(r)?n["string"==typeof r?"string":"hash"]:n.map}function pn(t){var r=-1,n=null==t?0:t.length;for(this.clear();++r<n;){var i=t[r];this.set(i[0],i[1])}}function hn(t){var r=this.__data__=new mn(t);this.size=r.size}ur.prototype.clear=function vO(){this.__data__=Wi?Wi(null):{},this.size=0},ur.prototype.delete=function _O(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},ur.prototype.get=function FO(t){var r=this.__data__;if(Wi){var n=r[t];return"__lodash_hash_undefined__"===n?void 0:n}return xO.call(r,t)?r[t]:void 0},ur.prototype.has=function $O(t){var r=this.__data__;return Wi?void 0!==r[t]:kO.call(r,t)},ur.prototype.set=function wO(t,r){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Wi&&void 0===r?"__lodash_hash_undefined__":r,this},pn.prototype.clear=function RO(){this.size=0,this.__data__={hash:new ur,map:new(Xi||mn),string:new ur}},pn.prototype.delete=function EO(t){var r=hs(this,t).delete(t);return this.size-=r?1:0,r},pn.prototype.get=function jO(t){return hs(this,t).get(t)},pn.prototype.has=function DO(t){return hs(this,t).has(t)},pn.prototype.set=function AO(t,r){var n=hs(this,t),i=n.size;return n.set(t,r),this.size+=n.size==i?0:1,this},hn.prototype.clear=function KB(){this.__data__=new mn,this.size=0},hn.prototype.delete=function eO(t){var r=this.__data__,n=r.delete(t);return this.size=r.size,n},hn.prototype.get=function tO(t){return this.__data__.get(t)},hn.prototype.has=function nO(t){return this.__data__.has(t)},hn.prototype.set=function PO(t,r){var n=this.__data__;if(n instanceof mn){var i=n.__data__;if(!Xi||i.length<199)return i.push([t,r]),this.size=++n.size,this;n=this.__data__=new pn(i)}return n.set(t,r),this.size=n.size,this};var BO=function(){try{var t=cr(Object,"defineProperty");return t({},"",{}),t}catch{}}(),gs=BO;function Fd(t,r,n){"__proto__"==r&&gs?gs(t,r,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[r]=n}function Sd(t,r,n){(void 0!==n&&!Ui(t[r],n)||void 0===n&&!(r in t))&&Fd(t,r,n)}var NO=function OO(t){return function(r,n,i){for(var a=-1,o=Object(r),s=i(r),l=s.length;l--;){var c=s[t?l:++a];if(!1===n(o[c],c,o))break}return r}}(),GO=NO,I_="object"==typeof exports&&exports&&!exports.nodeType&&exports,w_=I_&&"object"==typeof module&&module&&!module.nodeType&&module,R_=w_&&w_.exports===I_?Xt.Buffer:void 0,T_=R_?R_.allocUnsafe:void 0,bs=Xt.Uint8Array;var E_=Object.create,XO=function(){function t(){}return function(r){if(!un(r))return{};if(E_)return E_(r);t.prototype=r;var n=new t;return t.prototype=void 0,n}}(),WO=XO;function j_(t,r){return function(n){return t(r(n))}}var D_=j_(Object.getPrototypeOf,Object),JO=Object.prototype;function kd(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||JO)}function gn(t){return null!=t&&"object"==typeof t}function A_(t){return gn(t)&&"[object Arguments]"==Rn(t)}var M_=Object.prototype,KO=M_.hasOwnProperty,eN=M_.propertyIsEnumerable,tN=A_(function(){return arguments}())?A_:function(t){return gn(t)&&KO.call(t,"callee")&&!eN.call(t,"callee")},vs=tN,nN=9007199254740991;function $d(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=nN}function _s(t){return null!=t&&$d(t.length)&&!Yi(t)}var P_="object"==typeof exports&&exports&&!exports.nodeType&&exports,B_=P_&&"object"==typeof module&&module&&!module.nodeType&&module,O_=B_&&B_.exports===P_?Xt.Buffer:void 0,ys=(O_?O_.isBuffer:void 0)||function iN(){return!1},lN="[object Object]",N_=Function.prototype.toString,dN=Object.prototype.hasOwnProperty,fN=N_.call(Object),ke={};ke["[object Float32Array]"]=ke["[object Float64Array]"]=ke["[object Int8Array]"]=ke["[object Int16Array]"]=ke["[object Int32Array]"]=ke["[object Uint8Array]"]=ke["[object Uint8ClampedArray]"]=ke["[object Uint16Array]"]=ke["[object Uint32Array]"]=!0,ke["[object Arguments]"]=ke["[object Array]"]=ke["[object ArrayBuffer]"]=ke["[object Boolean]"]=ke["[object DataView]"]=ke["[object Date]"]=ke["[object Error]"]=ke["[object Function]"]=ke["[object Map]"]=ke["[object Number]"]=ke["[object Object]"]=ke["[object RegExp]"]=ke["[object Set]"]=ke["[object String]"]=ke["[object WeakMap]"]=!1;var G_="object"==typeof exports&&exports&&!exports.nodeType&&exports,Qi=G_&&"object"==typeof module&&module&&!module.nodeType&&module,Id=Qi&&Qi.exports===G_&&Ov.process,LN=function(){try{return Qi&&Qi.require&&Qi.require("util").types||Id&&Id.binding&&Id.binding("util")}catch{}}(),Y_=LN&&LN.isTypedArray,YN=Y_?function NN(t){return function(r){return t(r)}}(Y_):function ON(t){return gn(t)&&$d(t.length)&&!!ke[Rn(t)]},wd=YN;function Rd(t,r){if(("constructor"!==r||"function"!=typeof t[r])&&"__proto__"!=r)return t[r]}var zN=Object.prototype.hasOwnProperty;function V_(t,r,n){var i=t[r];(!zN.call(t,r)||!Ui(i,n)||void 0===n&&!(r in t))&&Fd(t,r,n)}var XN=9007199254740991,WN=/^(?:0|[1-9]\d*)$/;function Cs(t,r){var n=typeof t;return!!(r=r??XN)&&("number"==n||"symbol"!=n&&WN.test(t))&&t>-1&&t%1==0&&t<r}var JN=Object.prototype.hasOwnProperty;function z_(t,r){var n=$t(t),i=!n&&vs(t),a=!n&&!i&&ys(t),o=!n&&!i&&!a&&wd(t),s=n||i||a||o,l=s?function UN(t,r){for(var n=-1,i=Array(t);++n<t;)i[n]=r(n);return i}(t.length,String):[],c=l.length;for(var u in t)(r||JN.call(t,u))&&(!s||!("length"==u||a&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Cs(u,c)))&&l.push(u);return l}var KN=Object.prototype.hasOwnProperty;function q_(t){return _s(t)?z_(t,!0):function eG(t){if(!un(t))return function HN(t){var r=[];if(null!=t)for(var n in Object(t))r.push(n);return r}(t);var r=kd(t),n=[];for(var i in t)"constructor"==i&&(r||!KN.call(t,i))||n.push(i);return n}(t)}function nG(t,r,n,i,a,o,s){var l=Rd(t,n),c=Rd(r,n),u=s.get(c);if(u)Sd(t,n,u);else{var d=o?o(l,c,n+"",t,r,s):void 0,f=void 0===d;if(f){var p=$t(c),h=!p&&ys(c),b=!p&&!h&&wd(c);d=c,p||h||b?$t(l)?d=l:function rN(t){return gn(t)&&_s(t)}(l)?d=function UO(t,r){var n=-1,i=t.length;for(r||(r=Array(i));++n<i;)r[n]=t[n];return r}(l):h?(f=!1,d=function YO(t,r){if(r)return t.slice();var n=t.length,i=T_?T_(n):new t.constructor(n);return t.copy(i),i}(c,!0)):b?(f=!1,d=function qO(t,r){var n=r?function zO(t){var r=new t.constructor(t.byteLength);return new bs(r).set(new bs(t)),r}(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(c,!0)):d=[]:function mN(t){if(!gn(t)||Rn(t)!=lN)return!1;var r=D_(t);if(null===r)return!0;var n=dN.call(r,"constructor")&&r.constructor;return"function"==typeof n&&n instanceof n&&N_.call(n)==fN}(c)||vs(c)?(d=l,vs(l)?d=function tG(t){return function qN(t,r,n,i){var a=!n;n||(n={});for(var o=-1,s=r.length;++o<s;){var l=r[o],c=i?i(n[l],t[l],l,n,t):void 0;void 0===c&&(c=t[l]),a?Fd(n,l,c):V_(n,l,c)}return n}(t,q_(t))}(l):(!un(l)||Yi(l))&&(d=function HO(t){return"function"!=typeof t.constructor||kd(t)?{}:WO(D_(t))}(c))):f=!1}f&&(s.set(c,d),a(d,c,i,o,s),s.delete(c)),Sd(t,n,d)}}function U_(t,r,n,i,a){t!==r&&GO(r,function(o,s){if(a||(a=new hn),un(o))nG(t,r,s,n,U_,i,a);else{var l=i?i(Rd(t,s),o,s+"",t,r,a):void 0;void 0===l&&(l=o),Sd(t,s,l)}},q_)}function X_(t){return t}var W_=Math.max;function aG(t){return function(){return t}}var oG=gs?function(t,r){return gs(t,"toString",{configurable:!0,enumerable:!1,value:aG(r),writable:!0})}:X_,uG=Date.now,fG=function dG(t){var r=0,n=0;return function(){var i=uG(),a=16-(i-n);if(n=i,a>0){if(++r>=800)return arguments[0]}else r=0;return t.apply(void 0,arguments)}}(oG),mG=fG;var bG=function gG(t){return function pG(t,r){return mG(function iG(t,r,n){return r=W_(void 0===r?t.length-1:r,0),function(){for(var i=arguments,a=-1,o=W_(i.length-r,0),s=Array(o);++a<o;)s[a]=i[r+a];a=-1;for(var l=Array(r+1);++a<r;)l[a]=i[a];return l[r]=n(s),function rG(t,r,n){switch(n.length){case 0:return t.call(r);case 1:return t.call(r,n[0]);case 2:return t.call(r,n[0],n[1]);case 3:return t.call(r,n[0],n[1],n[2])}return t.apply(r,n)}(t,this,l)}}(t,r,X_),t+"")}(function(r,n){var i=-1,a=n.length,o=a>1?n[a-1]:void 0,s=a>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(a--,o):void 0,s&&function hG(t,r,n){if(!un(n))return!1;var i=typeof r;return!!("number"==i?_s(n)&&Cs(r,n.length):"string"==i&&r in n)&&Ui(n[r],t)}(n[0],n[1],s)&&(o=a<3?void 0:o,a=1),r=Object(r);++i<a;){var l=n[i];l&&t(r,l,i,o)}return r})}(function(t,r,n,i){U_(t,r,n,i)}),vG=bG;function xs(t){var r=-1,n=null==t?0:t.length;for(this.__data__=new pn;++r<n;)this.add(t[r])}function xG(t,r){for(var n=-1,i=null==t?0:t.length;++n<i;)if(r(t[n],n,t))return!0;return!1}function FG(t,r){return t.has(r)}xs.prototype.add=xs.prototype.push=function yG(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},xs.prototype.has=function CG(t){return this.__data__.has(t)};var SG=1,kG=2;function Q_(t,r,n,i,a,o){var s=n&SG,l=t.length,c=r.length;if(l!=c&&!(s&&c>l))return!1;var u=o.get(t),d=o.get(r);if(u&&d)return u==r&&d==t;var f=-1,p=!0,h=n&kG?new xs:void 0;for(o.set(t,r),o.set(r,t);++f<l;){var b=t[f],g=r[f];if(i)var _=s?i(g,b,f,r,t,o):i(b,g,f,t,r,o);if(void 0!==_){if(_)continue;p=!1;break}if(h){if(!xG(r,function(C,S){if(!FG(h,S)&&(b===C||a(b,C,n,i,o)))return h.push(S)})){p=!1;break}}else if(b!==g&&!a(b,g,n,i,o)){p=!1;break}}return o.delete(t),o.delete(r),p}function $G(t){var r=-1,n=Array(t.size);return t.forEach(function(i,a){n[++r]=[a,i]}),n}function IG(t){var r=-1,n=Array(t.size);return t.forEach(function(i){n[++r]=i}),n}var wG=1,RG=2,TG="[object Boolean]",EG="[object Date]",jG="[object Error]",DG="[object Map]",AG="[object Number]",MG="[object RegExp]",PG="[object Set]",BG="[object String]",OG="[object Symbol]",NG="[object ArrayBuffer]",GG="[object DataView]",J_=wn?wn.prototype:void 0,Td=J_?J_.valueOf:void 0,XG=Object.prototype.propertyIsEnumerable,H_=Object.getOwnPropertySymbols,WG=H_?function(t){return null==t?[]:(t=Object(t),function zG(t,r){for(var n=-1,i=null==t?0:t.length,a=0,o=[];++n<i;){var s=t[n];r(s,n,t)&&(o[a++]=s)}return o}(H_(t),function(r){return XG.call(t,r)}))}:function qG(){return[]},QG=WG,HG=j_(Object.keys,Object),KG=Object.prototype.hasOwnProperty;function tL(t){return _s(t)?z_(t):function eL(t){if(!kd(t))return HG(t);var r=[];for(var n in Object(t))KG.call(t,n)&&"constructor"!=n&&r.push(n);return r}(t)}function Z_(t){return function VG(t,r,n){var i=r(t);return $t(t)?i:function YG(t,r){for(var n=-1,i=r.length,a=t.length;++n<i;)t[a+n]=r[n];return t}(i,n(t))}(t,tL,QG)}var nL=1,iL=Object.prototype.hasOwnProperty,Ed=cr(Xt,"DataView"),jd=cr(Xt,"Promise"),Dd=cr(Xt,"Set"),Ad=cr(Xt,"WeakMap"),K_="[object Map]",ey="[object Promise]",ty="[object Set]",ny="[object WeakMap]",ry="[object DataView]",dL=lr(Ed),fL=lr(Xi),mL=lr(jd),pL=lr(Dd),hL=lr(Ad),dr=Rn;(Ed&&dr(new Ed(new ArrayBuffer(1)))!=ry||Xi&&dr(new Xi)!=K_||jd&&dr(jd.resolve())!=ey||Dd&&dr(new Dd)!=ty||Ad&&dr(new Ad)!=ny)&&(dr=function(t){var r=Rn(t),n="[object Object]"==r?t.constructor:void 0,i=n?lr(n):"";if(i)switch(i){case dL:return ry;case fL:return K_;case mL:return ey;case pL:return ty;case hL:return ny}return r});var iy=dr,gL=1,ay="[object Arguments]",oy="[object Array]",Fs="[object Object]",sy=Object.prototype.hasOwnProperty;function ly(t,r,n,i,a){return t===r||(null==t||null==r||!gn(t)&&!gn(r)?t!=t&&r!=r:function vL(t,r,n,i,a,o){var s=$t(t),l=$t(r),c=s?oy:iy(t),u=l?oy:iy(r),d=(c=c==ay?Fs:c)==Fs,f=(u=u==ay?Fs:u)==Fs,p=c==u;if(p&&ys(t)){if(!ys(r))return!1;s=!0,d=!1}if(p&&!d)return o||(o=new hn),s||wd(t)?Q_(t,r,n,i,a,o):function LG(t,r,n,i,a,o,s){switch(n){case GG:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)return!1;t=t.buffer,r=r.buffer;case NG:return!(t.byteLength!=r.byteLength||!o(new bs(t),new bs(r)));case TG:case EG:case AG:return Ui(+t,+r);case jG:return t.name==r.name&&t.message==r.message;case MG:case BG:return t==r+"";case DG:var l=$G;case PG:if(l||(l=IG),t.size!=r.size&&!(i&wG))return!1;var u=s.get(t);if(u)return u==r;i|=RG,s.set(t,r);var d=Q_(l(t),l(r),i,a,o,s);return s.delete(t),d;case OG:if(Td)return Td.call(t)==Td.call(r)}return!1}(t,r,c,n,i,a,o);if(!(n&gL)){var h=d&&sy.call(t,"__wrapped__"),b=f&&sy.call(r,"__wrapped__");if(h||b){var g=h?t.value():t,_=b?r.value():r;return o||(o=new hn),a(g,_,n,i,o)}}return!!p&&(o||(o=new hn),function aL(t,r,n,i,a,o){var s=n&nL,l=Z_(t),c=l.length;if(c!=Z_(r).length&&!s)return!1;for(var f=c;f--;){var p=l[f];if(!(s?p in r:iL.call(r,p)))return!1}var h=o.get(t),b=o.get(r);if(h&&b)return h==r&&b==t;var g=!0;o.set(t,r),o.set(r,t);for(var _=s;++f<c;){var C=t[p=l[f]],S=r[p];if(i)var F=s?i(S,C,p,r,t,o):i(C,S,p,t,r,o);if(!(void 0===F?C===S||a(C,S,n,i,o):F)){g=!1;break}_||(_="constructor"==p)}if(g&&!_){var D=t.constructor,A=r.constructor;D!=A&&"constructor"in t&&"constructor"in r&&!("function"==typeof D&&D instanceof D&&"function"==typeof A&&A instanceof A)&&(g=!1)}return o.delete(t),o.delete(r),g}(t,r,n,i,a,o))}(t,r,n,i,ly,a))}function cy(t,r){return ly(t,r)}var yL=Object.prototype.hasOwnProperty;function CL(t,r){return null!=t&&yL.call(t,r)}var xL="[object Symbol]";function Md(t){return"symbol"==typeof t||gn(t)&&Rn(t)==xL}var FL=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,SL=/^\w*$/;function Pd(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError("Expected a function");var n=function(){var i=arguments,a=r?r.apply(this,i):i[0],o=n.cache;if(o.has(a))return o.get(a);var s=t.apply(this,i);return n.cache=o.set(a,s)||o,s};return n.cache=new(Pd.Cache||pn),n}Pd.Cache=pn;var RL=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,TL=/\\(\\)?/g,EL=function wL(t){var r=Pd(t,function(i){return 500===n.size&&n.clear(),i}),n=r.cache;return r}(function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(RL,function(n,i,a,o){r.push(a?o.replace(TL,"$1"):i||n)}),r}),jL=EL,AL=1/0,uy=wn?wn.prototype:void 0,dy=uy?uy.toString:void 0;function fy(t){if("string"==typeof t)return t;if($t(t))return function DL(t,r){for(var n=-1,i=null==t?0:t.length,a=Array(i);++n<i;)a[n]=r(t[n],n,t);return a}(t,fy)+"";if(Md(t))return dy?dy.call(t):"";var r=t+"";return"0"==r&&1/t==-AL?"-0":r}function Bd(t,r){return $t(t)?t:function kL(t,r){if($t(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Md(t))||SL.test(t)||!FL.test(t)||null!=r&&t in Object(r)}(t,r)?[t]:jL(function ML(t){return null==t?"":fy(t)}(t))}var PL=1/0;function Od(t){if("string"==typeof t||Md(t))return t;var r=t+"";return"0"==r&&1/t==-PL?"-0":r}function my(t,r){return null!=t&&function BL(t,r,n){for(var i=-1,a=(r=Bd(r,t)).length,o=!1;++i<a;){var s=Od(r[i]);if(!(o=null!=t&&n(t,s)))break;t=t[s]}return o||++i!=a?o:!!(a=null==t?0:t.length)&&$d(a)&&Cs(s,a)&&($t(t)||vs(t))}(t,r,CL)}function Ss(t,r,n){var i=null==t?void 0:function OL(t,r){for(var n=0,i=(r=Bd(r,t)).length;null!=t&&n<i;)t=t[Od(r[n++])];return n&&n==i?t:void 0}(t,r);return void 0===i?n:i}function py(t,r,n){return null==t?t:function NL(t,r,n,i){if(!un(t))return t;for(var a=-1,o=(r=Bd(r,t)).length,s=o-1,l=t;null!=l&&++a<o;){var c=Od(r[a]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(a!=s){var d=l[c];void 0===(u=i?i(d,c,l):void 0)&&(u=un(d)?d:Cs(r[a+1])?[]:{})}V_(l,c,u),l=l[c]}return t}(t,r,n)}var YL={range:function(r){return Math.max(+r,1)},"date.highlight":function(r){return qo(r)},"subDomain.label":function(r){return function LL(t){return"string"==typeof t||!$t(t)&&gn(t)&&"[object String]"==Rn(t)}(r)&&""!==r||Yi(r)?r:null}},VL=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:YL;nt(this,t),this.preProcessors=r,this.options={itemSelector:"#cal-heatmap",range:12,domain:{type:"hour",gutter:4,padding:[0,0,0,0],dynamicDimension:!0,sort:"asc",label:{text:void 0,position:"bottom",textAlign:"middle",offset:{x:0,y:0},rotate:null,width:100,height:25}},subDomain:{type:"minute",width:10,height:10,gutter:2,radius:0,label:null,color:void 0,sort:"asc"},date:{start:new Date,min:void 0,max:void 0,highlight:[],locale:"en",timezone:void 0},verticalOrientation:!1,data:{source:"",type:"json",requestInit:{},x:"",y:"",groupY:"sum",defaultValue:null},scale:void 0,animationDuration:200,theme:"light",x:{domainHorizontalLabelWidth:0,domainVerticalLabelHeight:0}}}return rt(t,[{key:"set",value:function(n,i){return!(!my(this.options,n)||cy(Ss(this.options,n),i)||(py(this.options,n,my(this.preProcessors,n)?Ss(this.preProcessors,n)(i):i),0))}},{key:"init",value:function(n){var i=this;this.options=Object.assign({},vG(this.options,n,function(o,s){return Array.isArray(s)?s:void 0}));var a=this.options;Object.keys(this.preProcessors).forEach(function(o){py(a,o,Ss(i.preProcessors,o)(Ss(a,o)))}),typeof a.scale>"u"&&this.initScale(),a.x.domainVerticalLabelHeight=a.domain.label.height,"top"===a.domain.label.position||"bottom"===a.domain.label.position?a.x.domainHorizontalLabelWidth=0:(a.x.domainVerticalLabelHeight=0,a.x.domainHorizontalLabelWidth=a.domain.label.width),(null===a.domain.label.text||""===a.domain.label.text)&&(a.x.domainVerticalLabelHeight=0,a.x.domainHorizontalLabelWidth=0)}},{key:"initScale",value:function(){this.options.scale={color:{scheme:"YlOrBr",type:"quantize",domain:jD}}}}]),t}(),zL=ct,Nd=ge,Gd=Ae.RegExp,Ld=Nd(function(){var t=Gd("a","y");return t.lastIndex=2,null!==t.exec("abcd")}),XL=Ld||Nd(function(){return!Gd("a","y").sticky}),WL=Ld||Nd(function(){var t=Gd("^r","gy");return t.lastIndex=2,null!==t.exec("str")}),QL={BROKEN_CARET:WL,MISSED_STICKY:XL,UNSUPPORTED_Y:Ld},ZL=Ae.RegExp,KL=ge(function(){var t=ZL(".","s");return!(t.dotAll&&t.test("\n")&&"s"===t.flags)}),nY=Ae.RegExp,rY=ge(function(){var t=nY("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")}),Wr=Ze,ks=_e,iY=Sn,aY=function(){var t=zL(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},oY=QL,lY=Go,cY=nr.get,uY=KL,dY=rY,fY=oc("native-string-replace",String.prototype.replace),$s=RegExp.prototype.exec,Yd=$s,mY=ks("".charAt),pY=ks("".indexOf),hY=ks("".replace),Vd=ks("".slice),zd=function(){var t=/a/,r=/b*/g;return Wr($s,t,"a"),Wr($s,r,"a"),0!==t.lastIndex||0!==r.lastIndex}(),hy=oY.BROKEN_CARET,qd=void 0!==/()??/.exec("")[1];(zd||qd||hy||uY||dY)&&(Yd=function(r){var s,l,c,u,d,f,p,n=this,i=cY(n),a=iY(r),o=i.raw;if(o)return o.lastIndex=n.lastIndex,s=Wr(Yd,o,a),n.lastIndex=o.lastIndex,s;var h=i.groups,b=hy&&n.sticky,g=Wr(aY,n),_=n.source,C=0,S=a;if(b&&(g=hY(g,"y",""),-1===pY(g,"g")&&(g+="g"),S=Vd(a,n.lastIndex),n.lastIndex>0&&(!n.multiline||n.multiline&&"\n"!==mY(a,n.lastIndex-1))&&(_="(?: "+_+")",S=" "+S,C++),l=new RegExp("^(?:"+_+")",g)),qd&&(l=new RegExp("^"+_+"$(?!\\s)",g)),zd&&(c=n.lastIndex),u=Wr($s,b?l:n,S),b?u?(u.input=Vd(u.input,C),u[0]=Vd(u[0],C),u.index=n.lastIndex,n.lastIndex+=u[0].length):n.lastIndex=0:zd&&u&&(n.lastIndex=n.global?u.index+u[0].length:c),qd&&u&&u.length>1&&Wr(fY,u[0],l,function(){for(d=1;d<arguments.length-2;d++)void 0===arguments[d]&&(u[d]=void 0)}),u&&h)for(u.groups=f=lY(null),d=0;d<h.length;d++)f[(p=h[d])[0]]=u[p[1]];return u});var Ud=Yd;Se({target:"RegExp",proto:!0,forced:/./.exec!==Ud},{exec:Ud});var by=zc,vy=rn,vY=Ud,_y=ge,yy=Me,_Y=Mr,yY=yy("species"),Xd=RegExp.prototype,xY=ib.charAt,Wd=_e,SY=zt,kY=Math.floor,Qd=Wd("".charAt),$Y=Wd("".replace),Jd=Wd("".slice),IY=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,wY=/\$([$&'`]|\d{1,2})/g,Cy=Ze,TY=ct,EY=Te,jY=an,DY=Ud,AY=TypeError,PY=j1,xy=Ze,Is=_e,OY=ge,NY=ct,GY=Te,LY=xn,YY=_o,VY=Mc,Qr=Sn,zY=Kn,qY=function(t,r,n){return r+(n?xY(t,r).length:1)},UY=io,XY=function(t,r,n,i,a,o){var s=n+t.length,l=i.length,c=wY;return void 0!==a&&(a=SY(a),c=IY),$Y(o,c,function(u,d){var f;switch(Qd(d,0)){case"$":return"$";case"&":return t;case"`":return Jd(r,0,n);case"'":return Jd(r,s);case"<":f=a[Jd(d,1,-1)];break;default:var p=+d;if(0===p)return u;if(p>l){var h=kY(p/10);return 0===h?u:h<=l?void 0===i[h-1]?Qd(d,1):i[h-1]+Qd(d,1):u}f=i[p-1]}return void 0===f?"":f})},WY=function(t,r){var n=t.exec;if(EY(n)){var i=Cy(n,t,r);return null!==i&&TY(i),i}if("RegExp"===jY(t))return Cy(DY,t,r);throw new AY("RegExp#exec called on incompatible receiver")},Hd=Me("replace"),JY=Math.max,HY=Math.min,ZY=Is([].concat),Zd=Is([].push),Fy=Is("".indexOf),Sy=Is("".slice),KY=function(t){return void 0===t?t:String(t)},eV="$0"==="a".replace(/./,"$0"),ky=!!/./[Hd]&&""===/./[Hd]("a","$0"),tV=!OY(function(){var t=/./;return t.exec=function(){var r=[];return r.groups={a:"7"},r},"7"!=="".replace(t,"$<a>")});!function(t,r,n,i){var a=yy(t),o=!_y(function(){var u={};return u[a]=function(){return 7},7!==""[t](u)}),s=o&&!_y(function(){var u=!1,d=/a/;return"split"===t&&((d={}).constructor={},d.constructor[yY]=function(){return d},d.flags="",d[a]=/./[a]),d.exec=function(){return u=!0,null},d[a](""),!u});if(!o||!s||n){var l=by(/./[a]),c=r(a,""[t],function(u,d,f,p,h){var b=by(u),g=d.exec;return g===vY||g===Xd.exec?o&&!h?{done:!0,value:l(d,f,p)}:{done:!0,value:b(f,d,p)}:{done:!1}});vy(String.prototype,t,c[0]),vy(Xd,a,c[1])}i&&_Y(Xd[a],"sham",!0)}("replace",function(t,r,n){var i=ky?"$":"$0";return[function(o,s){var l=zY(this),c=LY(o)?void 0:UY(o,Hd);return c?xy(c,o,l,s):xy(r,Qr(l),o,s)},function(a,o){var s=NY(this),l=Qr(a);if("string"==typeof o&&-1===Fy(o,i)&&-1===Fy(o,"$<")){var c=n(r,s,l,o);if(c.done)return c.value}var u=GY(o);u||(o=Qr(o));var f,d=s.global;d&&(f=s.unicode,s.lastIndex=0);for(var h,p=[];null!==(h=WY(s,l))&&(Zd(p,h),d);)""===Qr(h[0])&&(s.lastIndex=qY(l,VY(s.lastIndex),f));for(var g="",_=0,C=0;C<p.length;C++){for(var A,S=Qr((h=p[C])[0]),F=JY(HY(YY(h.index),l.length),0),D=[],P=1;P<h.length;P++)Zd(D,KY(h[P]));var z=h.groups;if(u){var q=ZY([S],D,F,l);void 0!==z&&Zd(q,z),A=Qr(PY(o,void 0,q))}else A=XY(S,l,F,D,z,o);F>=_&&(g+=Sy(l,_,F)+A,_=F+S.length)}return g+Sy(l,_)}]},!tV||!eV||ky);var Kd,$y,nV=function(){function t(r){nt(this,t),Kd.add(this),this.calendar=r}return rt(t,[{key:"getDatas",value:function(n,i,a){return Gu(this,void 0,void 0,Zn().mark(function o(){var s;return Zn().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!("string"==typeof n&&n.length>0)){c.next=2;break}return c.abrupt("return",W(this,Kd,"m",$y).call(this,n,i,a));case 2:return s=[],Array.isArray(n)&&(s=n),c.abrupt("return",new Promise(function(u){u(s)}));case 5:case"end":return c.stop()}},o,this)}))}},{key:"parseURI",value:function(n,i,a){var o=this,s=n.replace(/\{\{start=(.*?)\}\}/g,function(l,c){return o.calendar.dateHelper.date(i).format(c)});return s.replace(/\{\{end=(.*?)\}\}/g,function(l,c){return o.calendar.dateHelper.date(a).format(c)})}}]),t}();Kd=new WeakSet,$y=function(r,n,i){var a=this.calendar.options.options.data,o=a.type,s=a.requestInit,l=this.parseURI(r,n,i);switch(o){case"json":return function z6(t,r){return fetch(t,r).then(V6)}(l,s);case"csv":return Z6(l,s);case"tsv":return function H6(t,r,n,i){3===arguments.length&&"function"==typeof n&&(i=n,n=void 0);var a=ec(t);return tc(r,n).then(function(o){return a.parse(o,i)})}("\t",l,s);case"txt":return tc(l,s);default:return new Promise(function(c){c([])})}};var rV=ht,iV=oo.EXISTS,Iy=_e,aV=Yc,wy=Function.prototype,oV=Iy(wy.toString),Ry=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,sV=Iy(Ry.exec);rV&&!iV&&aV(wy,"name",{configurable:!0,get:function(){try{return sV(Ry,oV(this))[1]}catch{return""}}});var Ty={exports:{}};!function(t,r){t.exports=function(){var i=6e4,a=36e5,o="millisecond",s="second",l="minute",c="hour",u="day",d="week",f="month",p="quarter",h="year",b="date",g="Invalid Date",_=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,C=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,S={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(v){var x=["th","st","nd","rd"],y=v%100;return"["+v+(x[(y-20)%10]||x[y]||x[0])+"]"}},F=function(v,x,y){var k=String(v);return!k||k.length>=x?v:""+Array(x+1-k.length).join(y)+v},D={s:F,z:function(v){var x=-v.utcOffset(),y=Math.abs(x),k=Math.floor(y/60),$=y%60;return(x<=0?"+":"-")+F(k,2,"0")+":"+F($,2,"0")},m:function v(x,y){if(x.date()<y.date())return-v(y,x);var k=12*(y.year()-x.year())+(y.month()-x.month()),$=x.clone().add(k,f),w=y-$<0,j=x.clone().add(k+(w?-1:1),f);return+(-(k+(y-$)/(w?$-j:j-$))||0)},a:function(v){return v<0?Math.ceil(v)||0:Math.floor(v)},p:function(v){return{M:f,y:h,w:d,d:u,D:b,h:c,m:l,s,ms:o,Q:p}[v]||String(v||"").toLowerCase().replace(/s$/,"")},u:function(v){return void 0===v}},A="en",P={};P[A]=S;var z="$isDayjsObject",q=function(v){return v instanceof E||!(!v||!v[z])},ae=function v(x,y,k){var $;if(!x)return A;if("string"==typeof x){var w=x.toLowerCase();P[w]&&($=w),y&&(P[w]=y,$=w);var j=x.split("-");if(!$&&j.length>1)return v(j[0])}else{var N=x.name;P[N]=x,$=N}return!k&&$&&(A=$),$||!k&&A},Y=function(v,x){if(q(v))return v.clone();var y="object"==typeof x?x:{};return y.date=v,y.args=arguments,new E(y)},B=D;B.l=ae,B.i=q,B.w=function(v,x){return Y(v,{locale:x.$L,utc:x.$u,x:x.$x,$offset:x.$offset})};var E=function(){function v(y){this.$L=ae(y.locale,null,!0),this.parse(y),this.$x=this.$x||y.x||{},this[z]=!0}var x=v.prototype;return x.parse=function(y){this.$d=function(k){var $=k.date,w=k.utc;if(null===$)return new Date(NaN);if(B.u($))return new Date;if($ instanceof Date)return new Date($);if("string"==typeof $&&!/Z$/i.test($)){var j=$.match(_);if(j){var N=j[2]-1||0,L=(j[7]||"0").substring(0,3);return w?new Date(Date.UTC(j[1],N,j[3]||1,j[4]||0,j[5]||0,j[6]||0,L)):new Date(j[1],N,j[3]||1,j[4]||0,j[5]||0,j[6]||0,L)}}return new Date($)}(y),this.init()},x.init=function(){var y=this.$d;this.$y=y.getFullYear(),this.$M=y.getMonth(),this.$D=y.getDate(),this.$W=y.getDay(),this.$H=y.getHours(),this.$m=y.getMinutes(),this.$s=y.getSeconds(),this.$ms=y.getMilliseconds()},x.$utils=function(){return B},x.isValid=function(){return this.$d.toString()!==g},x.isSame=function(y,k){var $=Y(y);return this.startOf(k)<=$&&$<=this.endOf(k)},x.isAfter=function(y,k){return Y(y)<this.startOf(k)},x.isBefore=function(y,k){return this.endOf(k)<Y(y)},x.$g=function(y,k,$){return B.u(y)?this[k]:this.set($,y)},x.unix=function(){return Math.floor(this.valueOf()/1e3)},x.valueOf=function(){return this.$d.getTime()},x.startOf=function(y,k){var $=this,w=!!B.u(k)||k,j=B.p(y),N=function(G,V){var J=B.w($.$u?Date.UTC($.$y,V,G):new Date($.$y,V,G),$);return w?J:J.endOf(u)},L=function(G,V){return B.w($.toDate()[G].apply($.toDate("s"),(w?[0,0,0,0]:[23,59,59,999]).slice(V)),$)},H=this.$W,ee=this.$M,he=this.$D,Ee="set"+(this.$u?"UTC":"");switch(j){case h:return w?N(1,0):N(31,11);case f:return w?N(1,ee):N(0,ee+1);case d:var re=this.$locale().weekStart||0,je=(H<re?H+7:H)-re;return N(w?he-je:he+(6-je),ee);case u:case b:return L(Ee+"Hours",0);case c:return L(Ee+"Minutes",1);case l:return L(Ee+"Seconds",2);case s:return L(Ee+"Milliseconds",3);default:return this.clone()}},x.endOf=function(y){return this.startOf(y,!1)},x.$set=function(y,k){var $,w=B.p(y),j="set"+(this.$u?"UTC":""),N=($={},$[u]=j+"Date",$[b]=j+"Date",$[f]=j+"Month",$[h]=j+"FullYear",$[c]=j+"Hours",$[l]=j+"Minutes",$[s]=j+"Seconds",$[o]=j+"Milliseconds",$)[w],L=w===u?this.$D+(k-this.$W):k;if(w===f||w===h){var H=this.clone().set(b,1);H.$d[N](L),H.init(),this.$d=H.set(b,Math.min(this.$D,H.daysInMonth())).$d}else N&&this.$d[N](L);return this.init(),this},x.set=function(y,k){return this.clone().$set(y,k)},x.get=function(y){return this[B.p(y)]()},x.add=function(y,k){var $,w=this;y=Number(y);var j=B.p(k),N=function(ee){var he=Y(w);return B.w(he.date(he.date()+Math.round(ee*y)),w)};if(j===f)return this.set(f,this.$M+y);if(j===h)return this.set(h,this.$y+y);if(j===u)return N(1);if(j===d)return N(7);var L=($={},$[l]=i,$[c]=a,$[s]=1e3,$)[j]||1,H=this.$d.getTime()+y*L;return B.w(H,this)},x.subtract=function(y,k){return this.add(-1*y,k)},x.format=function(y){var k=this,$=this.$locale();if(!this.isValid())return $.invalidDate||g;var w=y||"YYYY-MM-DDTHH:mm:ssZ",j=B.z(this),N=this.$H,L=this.$m,H=this.$M,ee=$.weekdays,he=$.months,re=function(V,J,M,xe){return V&&(V[J]||V(k,w))||M[J].slice(0,xe)},je=function(V){return B.s(N%12||12,V,"0")},G=$.meridiem||function(V,J,M){var xe=V<12?"AM":"PM";return M?xe.toLowerCase():xe};return w.replace(C,function(V,J){return J||function(M){switch(M){case"YY":return String(k.$y).slice(-2);case"YYYY":return B.s(k.$y,4,"0");case"M":return H+1;case"MM":return B.s(H+1,2,"0");case"MMM":return re($.monthsShort,H,he,3);case"MMMM":return re(he,H);case"D":return k.$D;case"DD":return B.s(k.$D,2,"0");case"d":return String(k.$W);case"dd":return re($.weekdaysMin,k.$W,ee,2);case"ddd":return re($.weekdaysShort,k.$W,ee,3);case"dddd":return ee[k.$W];case"H":return String(N);case"HH":return B.s(N,2,"0");case"h":return je(1);case"hh":return je(2);case"a":return G(N,L,!0);case"A":return G(N,L,!1);case"m":return String(L);case"mm":return B.s(L,2,"0");case"s":return String(k.$s);case"ss":return B.s(k.$s,2,"0");case"SSS":return B.s(k.$ms,3,"0");case"Z":return j}return null}(V)||j.replace(":","")})},x.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},x.diff=function(y,k,$){var w,j=this,N=B.p(k),L=Y(y),H=(L.utcOffset()-this.utcOffset())*i,ee=this-L,he=function(){return B.m(j,L)};switch(N){case h:w=he()/12;break;case f:w=he();break;case p:w=he()/3;break;case d:w=(ee-H)/6048e5;break;case u:w=(ee-H)/864e5;break;case c:w=ee/a;break;case l:w=ee/i;break;case s:w=ee/1e3;break;default:w=ee}return $?w:B.a(w)},x.daysInMonth=function(){return this.endOf(f).$D},x.$locale=function(){return P[this.$L]},x.locale=function(y,k){if(!y)return this.$L;var $=this.clone(),w=ae(y,k,!0);return w&&($.$L=w),$},x.clone=function(){return B.w(this.$d,this)},x.toDate=function(){return new Date(this.valueOf())},x.toJSON=function(){return this.isValid()?this.toISOString():null},x.toISOString=function(){return this.$d.toISOString()},x.toString=function(){return this.$d.toUTCString()},v}(),I=E.prototype;return Y.prototype=I,[["$ms",o],["$s",s],["$m",l],["$H",c],["$W",u],["$M",f],["$y",h],["$D",b]].forEach(function(v){I[v[1]]=function(x){return this.$g(x,v[0],v[1])}}),Y.extend=function(v,x){return v.$i||(v(x,E,Y),v.$i=!0),Y},Y.locale=ae,Y.isDayjs=q,Y.unix=function(v){return Y(1e3*v)},Y.en=P[A],Y.Ls=P,Y.p={},Y}()}(Ty);var $e=lt(Ty.exports),Ey={exports:{}};!function(t,r){var n,i;t.exports=(n="week",i="year",function(a,o,s){var l=o.prototype;l.week=function(c){if(void 0===c&&(c=null),null!==c)return this.add(7*(c-this.week()),"day");var u=this.$locale().yearStart||1;if(11===this.month()&&this.date()>25){var d=s(this).startOf(i).add(1,i).date(u),f=s(this).endOf(n);if(d.isBefore(f))return 1}var p=s(this).startOf(i).date(u).startOf(n).subtract(1,"millisecond"),h=this.diff(p,n,!0);return h<0?s(this).startOf("week").week():Math.ceil(h)},l.weeks=function(c){return void 0===c&&(c=null),this.week(c)}})}(Ey);var dV=lt(Ey.exports),jy={exports:{}};!function(t,r){t.exports=function(n,i,a){i.prototype.dayOfYear=function(o){var s=Math.round((a(this).startOf("day")-a(this).startOf("year"))/864e5)+1;return null==o?s:this.add(o-s,"day")}}}(jy);var mV=lt(jy.exports),Dy={exports:{}};!function(t,r){t.exports=function(n,i){i.prototype.weekday=function(a){var o=this.$locale().weekStart||0,s=this.$W,l=(s<o?s+7:s)-o;return this.$utils().u(a)?l:this.subtract(l,"day").add(a,"day")}}}(Dy);var hV=lt(Dy.exports),Ay={exports:{}};!function(t,r){t.exports=function(n,i,a){var o=function(s,l){if(!l||!l.length||1===l.length&&!l[0]||1===l.length&&Array.isArray(l[0])&&!l[0].length)return null;var c;1===l.length&&l[0].length>0&&(l=l[0]),c=(l=l.filter(function(d){return d}))[0];for(var u=1;u<l.length;u+=1)l[u].isValid()&&!l[u][s](c)||(c=l[u]);return c};a.max=function(){var s=[].slice.call(arguments,0);return o("isAfter",s)},a.min=function(){var s=[].slice.call(arguments,0);return o("isBefore",s)}}}(Ay);var bV=lt(Ay.exports),My={exports:{}};!function(t,r){t.exports=function(n,i){i.prototype.isoWeeksInYear=function(){var a=this.isLeapYear(),o=this.endOf("y").day();return 4===o||a&&5===o?53:52}}}(My);var _V=lt(My.exports),Py={exports:{}};!function(t,r){var n;t.exports=(n="day",function(i,a,o){var s=function(u){return u.add(4-u.isoWeekday(),n)},l=a.prototype;l.isoWeekYear=function(){return s(this).year()},l.isoWeek=function(u){if(!this.$utils().u(u))return this.add(7*(u-this.isoWeek()),n);var d,p,h,b=s(this),g=(d=this.isoWeekYear(),h=4-(p=(this.$u?o.utc:o)().year(d).startOf("year")).isoWeekday(),p.isoWeekday()>4&&(h+=7),p.add(h,n));return b.diff(g,"week")+1},l.isoWeekday=function(u){return this.$utils().u(u)?this.day()||7:this.day(this.day()%7?u:u-7)};var c=l.startOf;l.startOf=function(u,d){var f=this.$utils(),p=!!f.u(d)||d;return"isoweek"===f.p(u)?p?this.date(this.date()-(this.isoWeekday()-1)).startOf("day"):this.date(this.date()-1-(this.isoWeekday()-1)+7).endOf("day"):c.bind(this)(u,d)}})}(Py);var CV=lt(Py.exports),By={exports:{}};!function(t,r){t.exports=function(n,i){i.prototype.isLeapYear=function(){return this.$y%4==0&&this.$y%100!=0||this.$y%400==0}}}(By);var FV=lt(By.exports),Oy={exports:{}};!function(t,r){t.exports=function(n,i){var a=i.prototype,o=a.format;a.format=function(s){var l=this,c=this.$locale();if(!this.isValid())return o.bind(this)(s);var u=this.$utils(),d=(s||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(f){switch(f){case"Q":return Math.ceil((l.$M+1)/3);case"Do":return c.ordinal(l.$D);case"gggg":return l.weekYear();case"GGGG":return l.isoWeekYear();case"wo":return c.ordinal(l.week(),"W");case"w":case"ww":return u.s(l.week(),"w"===f?1:2,"0");case"W":case"WW":return u.s(l.isoWeek(),"W"===f?1:2,"0");case"k":case"kk":return u.s(String(0===l.$H?24:l.$H),"k"===f?1:2,"0");case"X":return Math.floor(l.$d.getTime()/1e3);case"x":return l.$d.getTime();case"z":return"["+l.offsetName()+"]";case"zzz":return"["+l.offsetName("long")+"]";default:return f}});return o.bind(this)(d)}}}(Oy);var kV=lt(Oy.exports),Ny={exports:{}};!function(t,r){var n,i,a;t.exports=(n="minute",i=/[+-]\d\d(?::?\d\d)?/g,a=/([+-]|\d\d)/g,function(o,s,l){var c=s.prototype;l.utc=function(g){return new s({date:g,utc:!0,args:arguments})},c.utc=function(g){var _=l(this.toDate(),{locale:this.$L,utc:!0});return g?_.add(this.utcOffset(),n):_},c.local=function(){return l(this.toDate(),{locale:this.$L,utc:!1})};var u=c.parse;c.parse=function(g){g.utc&&(this.$u=!0),this.$utils().u(g.$offset)||(this.$offset=g.$offset),u.call(this,g)};var d=c.init;c.init=function(){if(this.$u){var g=this.$d;this.$y=g.getUTCFullYear(),this.$M=g.getUTCMonth(),this.$D=g.getUTCDate(),this.$W=g.getUTCDay(),this.$H=g.getUTCHours(),this.$m=g.getUTCMinutes(),this.$s=g.getUTCSeconds(),this.$ms=g.getUTCMilliseconds()}else d.call(this)};var f=c.utcOffset;c.utcOffset=function(g,_){var C=this.$utils().u;if(C(g))return this.$u?0:C(this.$offset)?f.call(this):this.$offset;if("string"==typeof g&&null===(g=function(A){void 0===A&&(A="");var P=A.match(i);if(!P)return null;var z=(""+P[0]).match(a)||["-",0,0],ae=60*+z[1]+ +z[2];return 0===ae?0:"+"===z[0]?ae:-ae}(g)))return this;var S=Math.abs(g)<=16?60*g:g,F=this;if(_)return F.$offset=S,F.$u=0===g,F;if(0!==g){var D=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(F=this.local().add(S+D,n)).$offset=S,F.$x.$localOffset=D}else F=this.utc();return F};var p=c.format;c.format=function(g){return p.call(this,g||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":""))},c.valueOf=function(){var g=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*g},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var h=c.toDate;c.toDate=function(g){return"s"===g&&this.$offset?l(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():h.call(this)};var b=c.diff;c.diff=function(g,_,C){if(g&&this.$u===g.$u)return b.call(this,g,_,C);var S=this.local(),F=l(g).local();return b.call(S,F,_,C)}})}(Ny);var IV=lt(Ny.exports),Gy={exports:{}};!function(t,r){var n,i;t.exports=(n={year:0,month:1,day:2,hour:3,minute:4,second:5},i={},function(a,o,s){var l,c=function(p,h,b){void 0===b&&(b={});var g=new Date(p);return function(C,S){void 0===S&&(S={});var F=S.timeZoneName||"short",D=C+"|"+F,A=i[D];return A||(A=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:C,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:F}),i[D]=A),A}(h,b).formatToParts(g)},u=function(p,h){for(var b=c(p,h),g=[],_=0;_<b.length;_+=1){var C=b[_],D=n[C.type];D>=0&&(g[D]=parseInt(C.value,10))}var A=g[3],q=+p;return(s.utc(g[0]+"-"+g[1]+"-"+g[2]+" "+(24===A?0:A)+":"+g[4]+":"+g[5]+":000").valueOf()-(q-=q%1e3))/6e4},d=o.prototype;d.tz=function(p,h){void 0===p&&(p=l);var b=this.utcOffset(),g=this.toDate(),_=g.toLocaleString("en-US",{timeZone:p}),C=Math.round((g-new Date(_))/1e3/60),S=s(_,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(15*-Math.round(g.getTimezoneOffset()/15)-C,!0);if(h){var F=S.utcOffset();S=S.add(b-F,"minute")}return S.$x.$timezone=p,S},d.offsetName=function(p){var h=this.$x.$timezone||s.tz.guess(),b=c(this.valueOf(),h,{timeZoneName:p}).find(function(g){return"timezonename"===g.type.toLowerCase()});return b&&b.value};var f=d.startOf;d.startOf=function(p,h){if(!this.$x||!this.$x.$timezone)return f.call(this,p,h);var b=s(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return f.call(b,p,h).tz(this.$x.$timezone,!0)},s.tz=function(p,h,b){var g=b&&h,_=b||h||l,C=u(+s(),_);if("string"!=typeof p)return s(p).tz(_);var S=function(P,z,q){var ae=P-60*z*1e3,Y=u(ae,q);if(z===Y)return[ae,z];var B=u(ae-=60*(Y-z)*1e3,q);return Y===B?[ae,Y]:[P-60*Math.min(Y,B)*1e3,Math.max(Y,B)]}(s.utc(p,g).valueOf(),C,_),D=S[1],A=s(S[0]).utcOffset(D);return A.$x.$timezone=_,A},s.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},s.tz.setDefault=function(p){l=p}})}(Gy);var RV=lt(Gy.exports),Ly={exports:{}};!function(t,r){t.exports=function(n,i,a){var s=function(f){return f&&(f.indexOf?f:f.s)},l=function(f,p,h,b,g){var _=f.name?f:f.$locale(),C=s(_[p]),S=s(_[h]),F=C||S.map(function(A){return A.slice(0,b)});if(!g)return F;var D=_.weekStart;return F.map(function(A,P){return F[(P+(D||0))%7]})},c=function(){return a.Ls[a.locale()]},u=function(f,p){return f.formats[p]||f.formats[p.toUpperCase()].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(b,g,_){return g||_.slice(1)})},d=function(){var f=this;return{months:function(p){return p?p.format("MMMM"):l(f,"months")},monthsShort:function(p){return p?p.format("MMM"):l(f,"monthsShort","months",3)},firstDayOfWeek:function(){return f.$locale().weekStart||0},weekdays:function(p){return p?p.format("dddd"):l(f,"weekdays")},weekdaysMin:function(p){return p?p.format("dd"):l(f,"weekdaysMin","weekdays",2)},weekdaysShort:function(p){return p?p.format("ddd"):l(f,"weekdaysShort","weekdays",3)},longDateFormat:function(p){return u(f.$locale(),p)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};i.prototype.localeData=function(){return d.bind(this)()},a.localeData=function(){var f=c();return{firstDayOfWeek:function(){return f.weekStart||0},weekdays:function(){return a.weekdays()},weekdaysShort:function(){return a.weekdaysShort()},weekdaysMin:function(){return a.weekdaysMin()},months:function(){return a.months()},monthsShort:function(){return a.monthsShort()},longDateFormat:function(p){return u(f,p)},meridiem:f.meridiem,ordinal:f.ordinal}},a.months=function(){return l(c(),"months")},a.monthsShort=function(){return l(c(),"monthsShort","months",3)},a.weekdays=function(f){return l(c(),"weekdays",null,null,f)},a.weekdaysShort=function(f){return l(c(),"weekdaysShort","weekdays",3,f)},a.weekdaysMin=function(f){return l(c(),"weekdaysMin","weekdays",2,f)}}}(Ly);var EV=lt(Ly.exports),Yy={exports:{}};!function(t,r){var n;t.exports=(n={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},function(i,a,o){var s=a.prototype,l=s.format;o.en.formats=n,s.format=function(c){void 0===c&&(c="YYYY-MM-DDTHH:mm:ssZ");var p,u=this.$locale().formats,d=(p=void 0===u?{}:u,c.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(h,b,g){var _=g&&g.toUpperCase();return b||p[g]||n[g]||p[_].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(C,S,F){return S||F.slice(1)})}));return l.call(this,d)}})}(Yy);var DV=lt(Yy.exports),Vy={exports:{}};!function(t,r){t.exports=function(n,i,a){a.updateLocale=function(o,s){var l=a.Ls[o];if(l)return(s?Object.keys(s):[]).forEach(function(c){l[c]=s[c]}),l}}}(Vy);var MV=lt(Vy.exports);$e.extend(dV),$e.extend(_V),$e.extend(CV),$e.extend(FV),$e.extend(mV),$e.extend(hV),$e.extend(bV),$e.extend(kV),$e.extend(IV),$e.extend(RV),$e.extend(EV),$e.extend(DV),$e.extend(MV);var PV=function(){function t(){var r;nt(this,t),this.locale="en",this.timezone=$e.tz.guess(),"object"===(typeof window>"u"?"undefined":Ci(window))&&((r=window).dayjs||(r.dayjs=$e))}return rt(t,[{key:"setup",value:function(n){var i=n.options;return Gu(this,void 0,void 0,Zn().mark(function a(){var o,s;return Zn().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.timezone=i.date.timezone||$e.tz.guess(),"string"!=typeof(o=i.date.locale)||"en"===o){c.next=17;break}if("object"!==(typeof window>"u"?"undefined":Ci(window))){c.next=12;break}if(c.t0=window["dayjs_locale_".concat(o)],c.t0){c.next=9;break}return c.next=8,this.loadBrowserLocale(o);case 8:c.t0=c.sent;case 9:s=c.t0,c.next=15;break;case 12:return c.next=14,this.loadNodeLocale(o);case 14:s=c.sent;case 15:$e.locale(o),this.locale=s;case 17:"object"===Ci(o)&&(o.hasOwnProperty("name")?($e.locale(o.name,o),this.locale=o):this.locale=$e.updateLocale("en",o));case 18:case"end":return c.stop()}},a,this)}))}},{key:"extend",value:function(n){return $e.extend(n)}},{key:"getMonthWeekNumber",value:function(n){var i=this.date(n),a=i.startOf("day"),o=i.startOf("month").endOf("week");return a<=o?1:Math.ceil(a.diff(o,"weeks",!0))+1}},{key:"getWeeksCountInMonth",value:function(n){var i=this.date(n);return this.getLastWeekOfMonth(i).diff(this.getFirstWeekOfMonth(i),"week")+1}},{key:"getFirstWeekOfMonth",value:function(n){var i=this.date(n).startOf("month"),a=i.startOf("week");return i.weekday()>4&&(a=a.add(1,"week")),a}},{key:"getLastWeekOfMonth",value:function(n){var i=this.date(n).endOf("month"),a=i.endOf("week");return i.weekday()<4&&(a=a.subtract(1,"week")),a}},{key:"date",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return $e.isDayjs(n)?n:$e(n).tz(this.timezone).utcOffset(0).locale(this.locale)}},{key:"format",value:function(n,i){if("function"==typeof i){for(var a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];return i.apply(void 0,[n].concat(o))}return"string"==typeof i?this.date(n).format(i):null}},{key:"intervals",value:function(n,i,a){var l,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=this.date(i);l="number"==typeof a?s.add(a,n):$e.isDayjs(a)?a:this.date(a),s=s.startOf(n),l=l.startOf(n);var c=$e.min(s,l);l=$e.max(s,l);var u=[];o||(l=l.add(1,"second"));do{u.push(+c),c=c.add(1,n)}while(c<l);return u}},{key:"loadBrowserLocale",value:function(n){return new Promise(function(i,a){var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/".concat(n,".js"),o.onerror=function(s){a(s)},o.onload=function(){i(window["dayjs_locale_".concat(n)])},document.head.appendChild(o)})}},{key:"loadNodeLocale",value:function(n){return R(22417)("./".concat(n,".js"))}}]),t}(),BV=Se,NV=Yv,GV=Kn,zy=Sn,LV=Vv,YV=_e("".indexOf);BV({target:"String",proto:!0,forced:!LV("includes")},{includes:function(r){return!!~YV(zy(GV(this)),zy(NV(r)),arguments.length>1?arguments[1]:void 0)}});var VV=["json","csv","tsv","txt"];function zV(t,r){var a=r.data,o=r.domain.type,s=r.subDomain.type;if(!t.has(o))throw new Error("'".concat(o,"' is not a valid domain type'"));if(!t.has(s))throw new Error("'".concat(s,"' is not a valid subDomain type'"));if(a.type&&!VV.includes(a.type))throw new Error("The data type '".concat(a.type,"' is not valid data type"));if(!(t.get(s).allowedDomainType||[]).includes(o))throw new Error("The subDomain.type '".concat(s,"' can not be used together ")+"with the domain type ".concat(o));return!0}Wu("Set",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Zb);var QV=function(){function t(r){nt(this,t),this.calendar=r,this.settings=new Map,this.plugins=new Map,this.pendingPaint=new Set}return rt(t,[{key:"add",value:function(n){var i=this;n.forEach(function(a){var o=$0(a,2),s=o[0],l=o[1],c=function WV(t,r){return"".concat((new t).name).concat(r?.key||"")}(s,l);i.plugins.get(c)&&i.settings.get(c)&&cy(i.settings.get(c).options,l)||(i.settings.set(c,{options:l,dirty:!0}),i.plugins.has(c)||i.plugins.set(c,function XV(t,r){return new t(r)}(s,i.calendar)),i.pendingPaint.add(i.plugins.get(c)))})}},{key:"setupAll",value:function(){var n=this;this.plugins.forEach(function(i,a){var o=n.settings.get(a);typeof o<"u"&&o.dirty&&(i.setup(o.options),o.dirty=!1,n.settings.set(a,o))})}},{key:"paintAll",value:function(){return Array.from(this.pendingPaint.values()).map(function(n){return n.paint()})}},{key:"destroyAll",value:function(){return this.allPlugins().map(function(n){return n.destroy()})}},{key:"getFromPosition",value:function(n){return this.allPlugins().filter(function(i){var a;return(null===(a=i.options)||void 0===a?void 0:a.position)===n})}},{key:"getHeightFromPosition",value:function(n){return this.getFromPosition(n).map(function(i){return i.options.dimensions.height}).reduce(function(i,a){return i+a},0)}},{key:"getWidthFromPosition",value:function(n){return this.getFromPosition(n).map(function(i){return i.options.dimensions.width}).reduce(function(i,a){return i+a},0)}},{key:"allPlugins",value:function(){return Array.from(this.plugins.values())}}]),t}(),az=[function(r){return{name:"minute",allowedDomainType:["day","hour"],rowsCount:function(){return 10},columnsCount:function(){return 6},mapping:function(s,l){return r.intervals("minute",s,r.date(l)).map(function(c,u){return{t:c,x:Math.floor(u/10),y:u%10}})},extractUnit:function(s){return r.date(s).startOf("minute").valueOf()}}},function(r,n){var i=n.domain;return{name:"hour",allowedDomainType:["month","week","day"],rowsCount:function(){return 6},columnsCount:function(c){switch(i.type){case"week":return 28;case"month":return 4*(i.dynamicDimension?r.date(c).daysInMonth():31);default:return 4}},mapping:function(c,u){return r.intervals("hour",c,r.date(u)).map(function(d){var f=r.date(d),p=f.hour(),h=f.date(),b=Math.floor(p/6);return"month"===i.type&&(b+=4*(h-1)),"week"===i.type&&(b+=4*+f.format("d")),{t:d,x:b,y:Math.floor(p%6)}})},extractUnit:function(c){return r.date(c).startOf("hour").valueOf()}}},function(r,n){var i=n.domain,a=n.verticalOrientation;return{name:"day",allowedDomainType:["year","month","week"],rowsCount:function(){return"week"===i.type?1:7},columnsCount:function(c){switch(i.type){case"month":return Math.ceil(i.dynamicDimension&&!a?r.getMonthWeekNumber(r.date(c).endOf("month")):6);case"year":return Math.ceil(i.dynamicDimension?r.date(c).endOf("year").dayOfYear()/7:54);default:return 7}},mapping:function(c,u){var d=0,f=-1;return r.intervals("day",c,r.date(u)).map(function(p){var h=r.date(p);switch(i.type){case"month":f=r.getMonthWeekNumber(p)-1;break;case"year":d!==h.week()&&(d=h.week(),f+=1);break;case"week":f=h.weekday()}return{t:p,x:f,y:"week"===i.type?0:h.weekday()}})},extractUnit:function(c){return r.date(c).startOf("day").valueOf()}}},function(r,n){var i=n.domain,a=n.verticalOrientation;return{name:"xDay",allowedDomainType:["year","month","week"],rowsCount:function(c){switch(i.type){case"month":return Math.ceil(i.dynamicDimension&&!a?r.getMonthWeekNumber(r.date(c).endOf("month")):6);case"year":return Math.ceil(i.dynamicDimension?r.date(c).endOf("year").dayOfYear()/7:54);default:return 7}},columnsCount:function(){return"week"===i.type?1:7},mapping:function(c,u){return r.intervals("day",c,r.date(u)).map(function(d){var f=r.date(d),p=f.endOf("year").week(),h=0;switch(i.type){case"month":h=r.getMonthWeekNumber(d)-1;break;case"year":1===p&&f.week()===p&&(h=f.subtract(1,"week").week()+1),h=f.week()-1;break;case"week":h=f.weekday()}return{t:d,y:h,x:"week"===i.type?0:f.weekday()}})},extractUnit:function(c){return r.date(c).startOf("day").valueOf()}}},function(r){return{name:"ghDay",allowedDomainType:["month"],rowsCount:function(){return 7},columnsCount:function(o){return r.getWeeksCountInMonth(o)},mapping:function(o,s){var l=r.getFirstWeekOfMonth(o),c=r.getFirstWeekOfMonth(s),u=-1,d=l.weekday();return r.intervals("day",l,c).map(function(f){var p=r.date(f).weekday();return p===d&&(u+=1),{t:f,x:u,y:p}})},extractUnit:function(o){return r.date(o).startOf("day").valueOf()}}},function(r,n){var i=n.domain;return{name:"week",allowedDomainType:["year","month"],rowsCount:function(){return 1},columnsCount:function(s){switch(i.type){case"year":return i.dynamicDimension?r.date(s).endOf("year").isoWeeksInYear():53;case"month":return i.dynamicDimension?r.getWeeksCountInMonth(s):5;default:return 1}},mapping:function(s,l){var c=r.getFirstWeekOfMonth(s),u=r.getFirstWeekOfMonth(l);return r.intervals("week",c,u).map(function(d,f){return{t:d,x:f,y:0}})},extractUnit:function(s){return r.date(s).startOf("week").valueOf()}}},function(r){return{name:"month",allowedDomainType:["year"],rowsCount:function(){return 1},columnsCount:function(){return 12},mapping:function(a,o){return r.intervals("month",a,r.date(o)).map(function(s){return{t:s,x:r.date(s).month(),y:0}})},extractUnit:function(a){return r.date(a).startOf("month").valueOf()}}},function(r){return{name:"year",allowedDomainType:[],rowsCount:function(){return 1},columnsCount:function(){return 1},mapping:function(a,o){return r.intervals("year",a,r.date(o)).map(function(s,l){return{t:s,x:l,y:0}})},extractUnit:function(a){return r.date(a).startOf("year").valueOf()}}}],oz=function(){function t(r,n){nt(this,t),this.settings=new Map,this.dateHelper=r,this.options=n,this.initiated=!1}return rt(t,[{key:"get",value:function(n){return this.settings.get(n)}},{key:"has",value:function(n){return this.settings.has(n)}},{key:"init",value:function(){this.initiated||(this.initiated=!0,this.add(az))}},{key:"add",value:function(n){var i=this;this.init();var a=[];qo(n).forEach(function(o){var s=o(i.dateHelper,i.options.options);i.settings.set(s.name,s),s.hasOwnProperty("parent")&&a.push(s.name)}),a.forEach(function(o){var s=i.settings.get(i.settings.get(o).parent);s&&i.settings.set(o,Object.assign(Object.assign({},s),i.settings.get(o)))})}}]),t}(),qy=function(){function t(){nt(this,t),this.options=new VL,this.dateHelper=new PV,this.templateCollection=new oz(this.dateHelper,this.options),this.dataFetcher=new nV(this),this.navigator=new DD(this),this.populator=new qB(this),this.calendarPainter=new NM(this),this.eventEmitter=new B9,this.pluginManager=new QV(this)}return rt(t,[{key:"createDomainCollection",value:function(n,i){return new Sv(this.dateHelper,this.options.options.domain.type,n,i,!(arguments.length>2&&void 0!==arguments[2])||arguments[2])}},{key:"paint",value:function(n,i){return Gu(this,void 0,void 0,Zn().mark(function a(){return Zn().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return this.options.init(n),s.next=3,this.dateHelper.setup(this.options);case 3:this.templateCollection.init(),s.prev=4,zV(this.templateCollection,this.options.options),s.next=11;break;case 8:return s.prev=8,s.t0=s.catch(4),s.abrupt("return",Promise.reject(s.t0));case 11:return i&&this.pluginManager.add(qo(i)),this.calendarPainter.setup(),this.domainCollection=new Sv(this.dateHelper),this.navigator.loadNewDomains(this.createDomainCollection(this.options.options.date.start,this.options.options.range)),s.abrupt("return",Promise.allSettled([this.calendarPainter.paint(),this.fill()]));case 16:case"end":return s.stop()}},a,this,[[4,8]])}))}},{key:"addTemplates",value:function(n){this.templateCollection.add(n)}},{key:"next",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=this.navigator.loadNewDomains(this.createDomainCollection(this.domainCollection.max,n+1).slice(n),Ye.SCROLL_FORWARD);return Promise.allSettled([this.calendarPainter.paint(i),this.fill()])}},{key:"previous",value:function(){var i=this.navigator.loadNewDomains(this.createDomainCollection(this.domainCollection.min,-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)),Ye.SCROLL_BACKWARD);return Promise.allSettled([this.calendarPainter.paint(i),this.fill()])}},{key:"jumpTo",value:function(n){return Promise.allSettled([this.calendarPainter.paint(this.navigator.jumpTo(n,arguments.length>1&&void 0!==arguments[1]&&arguments[1])),this.fill()])}},{key:"fill",value:function(){var n=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.options.data.source,a=this.options.options,o=this.templateCollection,s=this.dateHelper.intervals(a.domain.type,this.domainCollection.max,2)[1],l=this.dataFetcher.getDatas(i,this.domainCollection.min,s);return new Promise(function(c,u){l.then(function(d){n.domainCollection.fill(d,a.data,o.get(a.subDomain.type).extractUnit),n.populator.populate(),c(null)},function(d){u(d)})})}},{key:"on",value:function(n,i){this.eventEmitter.on(n,i)}},{key:"dimensions",value:function(){return this.calendarPainter.dimensions}},{key:"destroy",value:function(){return this.calendarPainter.destroy()}},{key:"extendDayjs",value:function(n){return this.dateHelper.extend(n)}}]),t}();qy.VERSION="4.2.4";var Uy=R(44549),Xy=R(98292),Wy=R(11781);const tf=t=>t.salesDashboardStats,sz=(0,fe.Mz)(tf,t=>t.salesDashboardStats);(0,fe.Mz)(tf,t=>t.salesDashboardStats.wholesalesStats.billsSummary),(0,fe.Mz)(tf,t=>t.salesDashboardStats.retailStats.salesSummary);var ws=R(47305),lz=R(71365),cz=R(62884);const uz=X.J1`
    query GetSalesDashboardStats($initDate: DateTime, $endDate: DateTime) {
        salesDashboardStats(initDate: $initDate, endDate: $endDate) {

            retailStats {
                salesSummary {
                    cancels
                    cash
                    cashSales
                    categories
                    locations
                    products
                    returns
                    sales
                    terminals
                    ticketAverage
                    ticketAverageCancels
                    ticketAverageCash
                    ticketAverageReturns
                    ticketAverageTransfer
                    ticketAverageChange
                    transfer
                    transferSales
                    mixSales
                    totalCash
                    totalTransfer

                    salesByDate {
                        date
                        value
                    }
                }

                salesBalance {
                    revenue
                    profit
                    series {
                        name
                        data {
                            x
                            y
                        }
                    }
                }

                salesByCategories {
                    revenue
                    profit
                    data {
                        category
                        revenue
                        profit
                    }
                }
            }

            wholesalesStats {
                totalQuantity
                totalQuantityAdded

                billsBalance {
                    billed
                    collected
                    series {
                        name
                        data {
                            x
                            y
                        }
                    }
                }

                billIndicators {
                    totalBills
                    totalBillsCreatedToday
                    totalBillsDelivered
                    totalBillsCollected
                    totalBillsCanceled
                }

                billsSummary {
                    labels
                    serie
                    newSerie
                    collectedSerie
                    partialSerie
                    rejectedSerie
                    receivedSerie
                    canceledSerie
                    new
                    collected
                    partial
                    rejected
                    received
                    canceled
                }
            }
        }
    }
`,dz=X.J1`
    query GetBillsByCustomersAndCurrency($initDate: DateTime, $endDate: DateTime, $currencyId: String! $customerId: String!) {
        getBillsByCustomersAndCurrency(initDate: $initDate, endDate: $endDate, currencyId: $currencyId, customerId: $customerId) {
            ok
            message

            billsByCustomersAndCurrency {
                _id
                customer
                totalBills
                totalAmount
                totalCollected
                totalCollectedAmount
                totalPending
                totalPendingAmount
                currency
                bills {
                    no
                    total
                    status
                    paymentStatus
                    date
                }
            }


        }
    }
`,fz=X.J1`
    query GetProductsBoughtByCustomer($initDate: DateTime, $endDate: DateTime, $customerId: String!) {
        getProductsBoughtByCustomer(initDate: $initDate, endDate: $endDate, customerId: $customerId) {
            ok
            message

            productsBoughtByCustomer {
                customer
                products {
                    name
                    price
                    quantity
                    uom
                }
            }


        }
    }
`,mz=X.J1`
    query getBillsCollectedByCustomersAndCurrency($initDate: DateTime, $endDate: DateTime, $paymentStatus: PaymentStatus, $customerId: String!, $currencyId: String!) {
        getBillsCollectedByCustomersAndCurrency(initDate: $initDate, endDate: $endDate, paymentStatus: $paymentStatus, customerId: $customerId, currencyId: $currencyId) {
            ok
            message

            billsCollectedByCustomersAndCurrency {
                currency
                customer
                totalAmount
                totalBills

                bills {
                    no
                    total
                    status
                    paymentStatus
                    date
                    collectedAt
                }
            }


        }
    }
`;let Qy=(()=>{class t{constructor(n,i){this.apolloProvider=n,this.store=i,this._apollo=this.apolloProvider.use("BALANC")}getSalesDashboardStatsData(n,i){return this._apollo.query({query:uz,variables:{initDate:n,endDate:i},errorPolicy:"all"}).pipe((0,oe.M)(({data:a})=>{this.store.dispatch((0,Xy.yr)({salesDashboardStats:a.salesDashboardStats}))}))}getBillsByCustomersAndCurrency(n,i,a,o){return this._apollo.query({query:dz,variables:{initDate:n,endDate:i,currencyId:a,customerId:o},errorPolicy:"all"})}getProductsBoughtByCustomer(n,i,a){return this._apollo.query({query:fz,variables:{initDate:n,endDate:i,customerId:a},errorPolicy:"all"})}getBillsCollectedByCustomersAndCurrency(n,i,a="",o,s){return this._apollo.query({query:mz,errorPolicy:"all",variables:{initDate:n,endDate:i,paymentStatus:a,currencyId:o,customerId:s}})}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(X.Ic),e.KVO(fe.il))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Rs=R(23083),pz=R(25903),nf=R(65571);function hz(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-icon",38),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.range.reset())}),e.k0s()}}function gz(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," Fecha de inicio no v\xe1lida "),e.k0s())}function bz(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," Fecha de final no v\xe1lida "),e.k0s())}function vz(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",24),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.generateSalesByPeriodReport(!0))}),e.EFF(1," Productos vendidos (Consolidado) "),e.k0s(),e.j41(2,"button",24),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.getSalesGroupedByLocation(!0))}),e.EFF(3,"Reporte de Ventas (Consolidado)"),e.k0s()}}function _z(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",24),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.selectedLocation=null)}),e.EFF(1),e.k0s()}2&t&&(e.R7$(),e.SpI(" ","Todas las Unidades Comerciales"," "))}function yz(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",24),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.selectedLocation=a)}),e.EFF(1),e.k0s()}if(2&t){const n=r.$implicit;e.R7$(),e.SpI(" ",n.name," ")}}function Cz(t,r){if(1&t&&(e.j41(0,"div",39)(1,"div",40)(2,"div",41)(3,"div",42)(4,"div",43)(5,"div",44),e.EFF(6," Ventas "),e.k0s()(),e.j41(7,"div",45)(8,"div",46),e.EFF(9),e.k0s()()(),e.j41(10,"div",42)(11,"div",43)(12,"div",44),e.EFF(13," Devoluciones "),e.k0s()(),e.j41(14,"div",45)(15,"div",47),e.EFF(16),e.k0s()()(),e.j41(17,"div",42)(18,"div",43)(19,"div",44),e.EFF(20," Cancelaciones "),e.k0s()(),e.j41(21,"div",45)(22,"div",48),e.EFF(23),e.k0s()()(),e.j41(24,"div",42)(25,"div",43)(26,"div",44),e.EFF(27," Ventas en Efectivo "),e.k0s()(),e.j41(28,"div",45)(29,"div",49),e.EFF(30),e.k0s()()(),e.j41(31,"div",42)(32,"div",43)(33,"div",44),e.EFF(34," Ventas por Transferencia "),e.k0s()(),e.j41(35,"div",45)(36,"div",49),e.EFF(37),e.k0s()()(),e.j41(38,"div",42)(39,"div",43)(40,"div",44),e.EFF(41," Ventas con pagos mixtos "),e.k0s()(),e.j41(42,"div",45)(43,"div",49),e.EFF(44),e.k0s()()()(),e.j41(45,"div",41)(46,"div",50)(47,"div",43)(48,"div",51),e.EFF(49," Valor Promedio de Ventas "),e.k0s()(),e.j41(50,"div",52)(51,"div",53),e.EFF(52),e.nI1(53,"number"),e.k0s()()(),e.j41(54,"div",54)(55,"div",43)(56,"div",51),e.EFF(57," Valor Promedio de Devoluciones "),e.k0s()(),e.j41(58,"div",52)(59,"div",53),e.EFF(60),e.nI1(61,"number"),e.k0s()()(),e.j41(62,"div",55)(63,"div",43)(64,"div",51),e.EFF(65," Valor Promedio de Cancelaciones "),e.k0s()(),e.j41(66,"div",52)(67,"div",53),e.EFF(68),e.nI1(69,"number"),e.k0s()()(),e.j41(70,"div",56)(71,"div",43)(72,"div",51),e.EFF(73," Valor Promedio de Ventas en Efectivo "),e.k0s()(),e.j41(74,"div",52)(75,"div",53),e.EFF(76),e.nI1(77,"number"),e.k0s()()(),e.j41(78,"div",57)(79,"div",43)(80,"div",51),e.EFF(81," Valor Promedio de Ventas en Transferencia "),e.k0s()(),e.j41(82,"div",52)(83,"div",53),e.EFF(84),e.nI1(85,"number"),e.k0s()()(),e.j41(86,"div",58)(87,"div",43)(88,"div",51),e.EFF(89," Cambio Promedio por Ventas "),e.k0s()(),e.j41(90,"div",52)(91,"div",53),e.EFF(92),e.nI1(93,"number"),e.k0s()()()(),e.j41(94,"div",59)(95,"div",60)(96,"div",61)(97,"div",62)(98,"div",63)(99,"div",64),e.EFF(100," Balance de ventas "),e.k0s(),e.j41(101,"div",65),e.EFF(102," Comparaci\xf3n ventas vs beneficios "),e.k0s()(),e.j41(103,"div",22)(104,"button",66)(105,"span",67),e.EFF(106),e.k0s()()()(),e.j41(107,"div",68)(108,"div",69)(109,"div",70),e.EFF(110),e.k0s(),e.j41(111,"div",71),e.EFF(112," Importe vendido "),e.k0s()(),e.j41(113,"div",69)(114,"div",70),e.EFF(115),e.k0s(),e.j41(116,"div",71),e.EFF(117," Utilidad "),e.k0s()()()(),e.j41(118,"div",72),e.nrm(119,"apx-chart",73),e.k0s()(),e.j41(120,"div",74)(121,"div",75)(122,"div",43)(123,"div",51),e.EFF(124," Importe vendido en Efectivo "),e.k0s()(),e.j41(125,"div",52)(126,"div",53),e.EFF(127),e.nI1(128,"number"),e.k0s()()(),e.j41(129,"div",76)(130,"div",43)(131,"div",51),e.EFF(132," Importe vendido por Transferencia "),e.k0s()(),e.j41(133,"div",52)(134,"div",53),e.EFF(135),e.nI1(136,"number"),e.k0s()()()()()(),e.j41(137,"div",77)(138,"div",78)(139,"div",44),e.EFF(140," Cantidad de ventas por d\xedas "),e.k0s(),e.j41(141,"div",72),e.nrm(142,"div",79),e.k0s()(),e.j41(143,"div",42)(144,"div",44),e.EFF(145," Ventas por M\xe9todo de Pago "),e.k0s(),e.j41(146,"div",72),e.nrm(147,"apx-chart",80),e.k0s()(),e.j41(148,"div",42)(149,"div",81)(150,"div",44),e.EFF(151," Ventas por Categor\xedas "),e.k0s(),e.j41(152,"div",82)(153,"mat-button-toggle-group",83,4)(155,"mat-button-toggle",83),e.EFF(156,"Ventas"),e.k0s(),e.j41(157,"mat-button-toggle",84),e.EFF(158,"Beneficio"),e.k0s()()()(),e.j41(159,"div",85),e.nrm(160,"apx-chart",86),e.k0s(),e.j41(161,"div",87)(162,"div",88)(163,"div",89),e.EFF(164),e.nI1(165,"number"),e.k0s(),e.j41(166,"div",90),e.EFF(167,"Ingreso Total"),e.k0s()(),e.j41(168,"div",88)(169,"div",89),e.EFF(170),e.nI1(171,"number"),e.k0s(),e.j41(172,"div",90),e.EFF(173,"Beneficio Total"),e.k0s()()()()()()),2&t){const n=e.sdS(154),i=e.XpG();e.R7$(9),e.SpI(" ",i.largeNumber(i.salesSummary.sales,0)," "),e.R7$(7),e.SpI(" ",i.largeNumber(i.salesSummary.returns,0),""),e.R7$(7),e.SpI(" ",i.largeNumber(i.salesSummary.cancels,0)," "),e.R7$(7),e.SpI(" ",i.largeNumber(i.salesSummary.cashSales,0)," "),e.R7$(7),e.SpI(" ",i.largeNumber(i.salesSummary.transferSales,0)," "),e.R7$(7),e.SpI(" ",i.largeNumber(i.salesSummary.mixSales,0)," "),e.R7$(8),e.SpI(" $ ",e.i5U(53,46,i.salesSummary.ticketAverage,"1.2-2")," "),e.R7$(8),e.SpI(" $ ",e.i5U(61,49,i.salesSummary.ticketAverageReturns,"1.2-2")," "),e.R7$(8),e.SpI(" $ ",e.i5U(69,52,i.salesSummary.ticketAverageCancels,"1.2-2")," "),e.R7$(8),e.SpI(" $ ",e.i5U(77,55,i.salesSummary.ticketAverageCash,"1.2-2")," "),e.R7$(8),e.SpI(" $ ",e.i5U(85,58,i.salesSummary.ticketAverageTransfer,"1.2-2")," "),e.R7$(8),e.SpI(" $ ",e.i5U(93,61,i.salesSummary.ticketAverageChange,"1.2-2")," "),e.R7$(14),e.SpI(" ",i.rangeDays," d\xedas "),e.R7$(4),e.SpI(" $ ",i.largeNumber(i.salesBalance.revenue,2)," "),e.R7$(5),e.SpI(" $ ",i.largeNumber(i.salesBalance.profit,2)," "),e.R7$(4),e.Y8G("chart",i.salesBalanceOptions.chart)("colors",i.salesBalanceOptions.colors)("fill",i.salesBalanceOptions.fill)("series",i.salesBalanceOptions.series)("stroke",i.salesBalanceOptions.stroke)("tooltip",i.salesBalanceOptions.tooltip)("xaxis",i.salesBalanceOptions.xaxis),e.R7$(8),e.SpI(" $ ",e.i5U(128,64,i.salesSummary.cash,"1.2-2")," "),e.R7$(8),e.SpI(" $ ",e.i5U(136,67,i.salesSummary.transfer,"1.2-2")," "),e.R7$(12),e.Y8G("chart",i.salesByPaymentMethodDistribution.chart)("colors",i.salesByPaymentMethodDistribution.colors)("dataLabels",i.salesByPaymentMethodDistribution.dataLabels)("markers",i.salesByPaymentMethodDistribution.markers)("plotOptions",i.salesByPaymentMethodDistribution.plotOptions)("series",i.salesByPaymentMethodDistribution.series)("stroke",i.salesByPaymentMethodDistribution.stroke)("tooltip",i.salesByPaymentMethodDistribution.tooltip)("xaxis",i.salesByPaymentMethodDistribution.xaxis)("yaxis",i.salesByPaymentMethodDistribution.yaxis),e.R7$(13),e.Y8G("chart",i.salesByCategoriesOptions.chart)("labels",i.salesByCategoriesOptions.labels)("legend",i.salesByCategoriesOptions.legend)("plotOptions",i.salesByCategoriesOptions.plotOptions)("series",i.salesByCategoriesChartData.series[n.value])("states",i.salesByCategoriesOptions.states)("stroke",i.salesByCategoriesOptions.stroke)("theme",i.salesByCategoriesOptions.theme)("tooltip",i.salesByCategoriesOptions.tooltip)("yaxis",i.salesByCategoriesOptions.yaxis),e.R7$(4),e.SpI(" $ ",e.i5U(165,70,i.salesByCategories.revenue,"1.2-2")," "),e.R7$(6),e.SpI(" $ ",e.i5U(171,73,i.salesByCategories.profit,"1.2-2")," ")}}function xz(t,r){if(1&t&&(e.j41(0,"div",39)(1,"div",91)(2,"div",92)(3,"div",42)(4,"div",43)(5,"div",44),e.EFF(6,"Facturas realizadas"),e.k0s(),e.j41(7,"div",93)(8,"button",94),e.nrm(9,"mat-icon",21),e.k0s()()(),e.j41(10,"div",45)(11,"div",95),e.EFF(12),e.k0s(),e.j41(13,"div",96),e.EFF(14),e.nI1(15,"i18nPlural"),e.k0s()()(),e.j41(16,"div",42)(17,"div",43)(18,"div",44),e.EFF(19,"Facturas entregadas"),e.k0s(),e.j41(20,"div",93)(21,"button",94),e.nrm(22,"mat-icon",21),e.k0s()()(),e.j41(23,"div",45)(24,"div",49),e.EFF(25),e.k0s(),e.j41(26,"div",97),e.EFF(27),e.nI1(28,"i18nPlural"),e.k0s()()(),e.j41(29,"div",42)(30,"div",43)(31,"div",44),e.EFF(32,"Facturas Cobradas"),e.k0s(),e.j41(33,"div",93)(34,"button",94),e.nrm(35,"mat-icon",21),e.k0s()()(),e.j41(36,"div",45)(37,"div",46),e.EFF(38),e.k0s(),e.j41(39,"div",98),e.EFF(40),e.nI1(41,"i18nPlural"),e.k0s()()(),e.j41(42,"div",42)(43,"div",43)(44,"div",44),e.EFF(45,"Facturas Cancelas"),e.k0s(),e.j41(46,"div",93)(47,"button",94),e.nrm(48,"mat-icon",21),e.k0s()()(),e.j41(49,"div",45)(50,"div",48),e.EFF(51),e.k0s(),e.j41(52,"div",99),e.EFF(53),e.nI1(54,"i18nPlural"),e.k0s()()()(),e.j41(55,"div",100)(56,"div",101)(57,"div",61)(58,"div",62)(59,"div",63)(60,"div",64),e.EFF(61," Balance de ventas"),e.k0s(),e.j41(62,"div",65),e.EFF(63,"Comparaci\xf3n facturado vs cobrado "),e.k0s()(),e.j41(64,"div",22)(65,"button",66)(66,"span",67),e.EFF(67),e.k0s()()()(),e.j41(68,"div",68)(69,"div",69)(70,"div",70),e.EFF(71),e.k0s(),e.j41(72,"div",71),e.EFF(73,"Importe facturado"),e.k0s()(),e.j41(74,"div",69)(75,"div",70),e.EFF(76),e.k0s(),e.j41(77,"div",71),e.EFF(78,"Importe cobrado"),e.k0s()()()(),e.j41(79,"div",72),e.nrm(80,"apx-chart",73),e.k0s()()()(),e.j41(81,"div",77)(82,"div",42)(83,"div",81)(84,"div",44),e.EFF(85," Facturas por d\xeda de la semana "),e.k0s()(),e.j41(86,"div",102)(87,"div",103)(88,"div",65),e.EFF(89,"Realizadas vs. Cobradas"),e.k0s(),e.j41(90,"div",72),e.nrm(91,"apx-chart",104),e.k0s()()()(),e.j41(92,"div",42)(93,"div",44),e.EFF(94,"Facturas por M\xe9todo de Pago"),e.k0s(),e.j41(95,"div",72),e.nrm(96,"apx-chart",80),e.k0s()()()()),2&t){const n=e.XpG();e.R7$(9),e.Y8G("svgIcon","mat_solid:more_vert"),e.R7$(3),e.SpI(" ",n.largeNumber(n.billIndicators.totalBills,0)," "),e.R7$(2),e.SpI(" ",e.i5U(15,45,n.billIndicators.totalBills,n.billsMapping)," "),e.R7$(8),e.Y8G("svgIcon","mat_solid:more_vert"),e.R7$(3),e.SpI(" ",n.largeNumber(n.billIndicators.totalBillsDelivered,0),""),e.R7$(2),e.SpI(" ",e.i5U(28,48,n.billIndicators.totalBillsDelivered,n.billsMapping)," "),e.R7$(8),e.Y8G("svgIcon","mat_solid:more_vert"),e.R7$(3),e.SpI(" ",n.largeNumber(n.billIndicators.totalBillsCollected,0)," "),e.R7$(2),e.SpI(" ",e.i5U(41,51,n.billIndicators.totalBillsCollected,n.billsMapping)," "),e.R7$(8),e.Y8G("svgIcon","mat_solid:more_vert"),e.R7$(3),e.SpI(" ",n.largeNumber(n.billIndicators.totalBillsCanceled,0)," "),e.R7$(2),e.SpI(" ",e.i5U(54,54,n.billIndicators.totalBillsCanceled,n.billsMapping)," "),e.R7$(14),e.SpI("",n.rangeDays," d\xedas"),e.R7$(4),e.SpI("$ ",n.largeNumber(n.billsBalance.billed,2),""),e.R7$(5),e.SpI("$ ",n.largeNumber(n.billsBalance.collected,2),""),e.R7$(4),e.Y8G("chart",n.billsBalanceOptions.chart)("colors",n.billsBalanceOptions.colors)("fill",n.billsBalanceOptions.fill)("series",n.billsBalanceOptions.series)("stroke",n.billsBalanceOptions.stroke)("tooltip",n.billsBalanceOptions.tooltip)("xaxis",n.billsBalanceOptions.xaxis),e.R7$(11),e.Y8G("chart",n.chartSalesStats.chart)("colors",n.chartSalesStats.colors)("dataLabels",n.chartSalesStats.dataLabels)("grid",n.chartSalesStats.grid)("labels",n.chartSalesStats.labels)("legend",n.chartSalesStats.legend)("plotOptions",n.chartSalesStats.plotOptions)("series",n.chartSalesStats.series)("states",n.chartSalesStats.states)("stroke",n.chartSalesStats.stroke)("tooltip",n.chartSalesStats.tooltip)("xaxis",n.chartSalesStats.xaxis)("yaxis",n.chartSalesStats.yaxis),e.R7$(5),e.Y8G("chart",n.billsByPaymentMethodDistribution.chart)("colors",n.billsByPaymentMethodDistribution.colors)("dataLabels",n.billsByPaymentMethodDistribution.dataLabels)("markers",n.billsByPaymentMethodDistribution.markers)("plotOptions",n.billsByPaymentMethodDistribution.plotOptions)("series",n.billsByPaymentMethodDistribution.series)("stroke",n.billsByPaymentMethodDistribution.stroke)("tooltip",n.billsByPaymentMethodDistribution.tooltip)("xaxis",n.billsByPaymentMethodDistribution.xaxis)("yaxis",n.billsByPaymentMethodDistribution.yaxis)}}let Fz=(()=>{class t{constructor(){this.billIndicators=null,this.chartSalesStats={},this.billsBalanceOptions={},this.salesBalanceOptions={},this.salesByCategoriesOptions={},this.billsByPaymentMethodDistribution={},this.salesByPaymentMethodDistribution={},this.billsMapping={"=1":"Factura",other:"Facturas"},this.salesMapping={"=1":"Venta",other:"Ventas"},this.initDate=Uy.c9.now().minus({days:7}).set({hour:0,minute:0,second:0,millisecond:0}),this.endDate=Uy.c9.now(),this.merchant=null,this.range=null,this.salesDashboardStats=null,this.billsSummary=null,this.billsBalance=null,this.salesBalance=null,this.salesByCategories=null,this.salesByCategoriesChartData=null,this.paymentMethodDistribution={categories:["Transferencia","Efectivo","Mixta"],series:[{name:"Facturas",data:[12,20,5]}]},this.salesPaymentMethodDistribution=null,this.rangeDays=0,this.user=null,this.maxDate=new Date,this.selectedLocation=null,this.selectedTapIndex=0,this.locations$=(0,ie.of)([]),this.salesSummary=null,this.cal=new qy,this._billsService=(0,e.WQX)(ia),this._changeDetectorRef=(0,e.WQX)(e.gRc),this._dialog=(0,e.WQX)(se.bZ),this._elementRef=(0,e.WQX)(e.aKT),this._router=(0,e.WQX)(ft.Ix),this._salesDashboardStatsService=(0,e.WQX)(Qy),this._salesReportsService=(0,e.WQX)(Vs),this._periodsService=(0,e.WQX)(cz.w),this._documentsService=(0,e.WQX)(hr.Q),this._snackBar=(0,e.WQX)(Oe.UG),this._salesService=(0,e.WQX)(Rs.w),this._boxService=(0,e.WQX)(lz.R),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.locations$=this.store.select(Wy.BF),this.store.select(sz).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.billsSummary=n.wholesalesStats.billsSummary,this.billIndicators=n.wholesalesStats.billIndicators,this.billsBalance=n.wholesalesStats.billsBalance,this.salesSummary=n.retailStats.salesSummary,this.salesBalance=n.retailStats.salesBalance,this.salesPaymentMethodDistribution={categories:["Transferencia","Efectivo","Mixta"],series:[{name:"Ventas",data:[this.salesSummary.transferSales,this.salesSummary.cashSales,this.salesSummary.mixSales]}]},this.salesByCategories=n.retailStats.salesByCategories,this._transformSalesByCategoriesChartData(n.retailStats.salesByCategories),this._prepareChartData(),this._prepareSalesBalanceChartData(),this._changeDetectorRef.markForCheck()}),this.store.select(At.Xb).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.merchant=n,this._changeDetectorRef.markForCheck()}),this.store.select(bn.SW).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.user=n,this._changeDetectorRef.markForCheck()}),this.range=new m.gE({start:new m.MJ({disabled:!1,value:this.initDate},[Je.t.futureDateValidator()]),end:new m.MJ({disabled:!1,value:this.endDate},[Je.t.futureDateValidator()])}),this.rangeDays=this.getDaysBetweenDates(),this.range.get("end").valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{const i=this.range.getRawValue();!i.start||!i.end||(this.rangeDays=this.getDaysBetweenDates(),this._salesDashboardStatsService.getSalesDashboardStatsData(i.start.toISO(),i.end.toISO()).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"Datos actualizados correctamente.",title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"mat_solid:done"}})}),this._changeDetectorRef.markForCheck())}),window.Apex={chart:{events:{mounted:(n,i)=>{this._fixSvgFill(n.el)},updated:(n,i)=>{this._fixSvgFill(n.el)}}}}}ngAfterViewInit(){this.cal.paint({itemSelector:"#cal-heatmap",range:12,domain:{type:"month",gutter:4,label:{text:"MMM",textAlign:"start",position:"top"},padding:[0,5,0,5]},subDomain:{type:"ghDay",radius:2,width:17,height:17,gutter:4,label:"D"},data:{type:"json",source:[...this.salesSummary.salesByDate],x:"date",y:"value"},date:{start:new Date("2024-01-01"),locale:{weekStart:1}},scale:{color:{type:"threshold",range:["#14432a","#166b34","#37a446","#4dd05a"],domain:this._getQuarters(this.salesSummary.salesByDate)}},animationDuration:500,theme:"light"})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete(),this.store.dispatch((0,Xy.z9)())}onTabChanged(n){this.selectedTapIndex=n}generateBillsReport(n=null){const i=this.range.getRawValue();!i.start||!i.end||this._billsService.getBillsByDateRangeAndStatus(i.start,i.end,n).pipe((0,Be.s)(1)).subscribe(({data:a})=>{Re.H.IsNullOrEmpty(a.getBillsByDateRangeAndStatus.bills)?this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"No existen facturas para el rango de fecha seleccionado.",title:"Sin datos",type:"warning",appearance:"fill"}}):this._salesReportsService.generateBillsReport(i.start,i.end,this.user,this.merchant,a.getBillsByDateRangeAndStatus.bills,this.getTotalCUP(a.getBillsByDateRangeAndStatus.bills),this.getTotalUSD(a.getBillsByDateRangeAndStatus.bills),this.generateBillsSummary(a.getBillsByDateRangeAndStatus.bills))})}generateBillsCollectedByCustomerAndCurrencyReport(n){const{start:i,end:a}=this.range.getRawValue();!i||!a||this._dialog.open(ws.K,{data:{filterProperties:["customer","currency"]},width:"450px",panelClass:"ath-dialog-panel",disableClose:!0}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({currencyId:o,customer:s})=>{Re.H.IsNullOrEmpty(o)&&Re.H.IsNullOrEmpty(s)||this._salesDashboardStatsService.getBillsCollectedByCustomersAndCurrency(i,a,n,o,s.id).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:l})=>{Re.H.IsNullOrEmpty(l.getBillsCollectedByCustomersAndCurrency.billsCollectedByCustomersAndCurrency)?this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"No existen facturas cobradas, para la moneda y el rango de fecha seleccionado.",title:"Sin datos",type:"warning",appearance:"fill"}}):this._salesReportsService.generateBillsByCustomersReport(i,a,this.user,this.merchant,l.getBillsCollectedByCustomersAndCurrency.billsCollectedByCustomersAndCurrency,n)})})}getDaysBetweenDates(){const n=this.range.getRawValue().start;return+this.range.getRawValue().end.diff(n,"days").days.toFixed(0)}getTotalCUP(n){return n.filter(a=>"CUP"===a.currency.iso).reduce((a,o)=>a+(o.total||0),0)}getTotalUSD(n){return n.filter(a=>"USD"===a.currency.iso).reduce((a,o)=>a+(o.total||0),0)}generateBillsSummary(n){const i={nueva:0,recibida:0,rechazada:0,cancelada:0};return n.forEach(a=>{i[a.status||On.ih.nueva]++}),i}generateBillsByCustomersReport(){const{start:n,end:i}=this.range.getRawValue();this._dialog.open(ws.K,{data:{filterProperties:["customer","currency"]},width:"450px",panelClass:"ath-dialog-panel",disableClose:!0}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({currencyId:a,customer:o})=>{Re.H.IsNullOrEmpty(a)&&Re.H.IsNullOrEmpty(o)||this._salesDashboardStatsService.getBillsByCustomersAndCurrency(n,i,a,o.id).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:s})=>{Re.H.IsNullOrEmpty(s.getBillsByCustomersAndCurrency.billsByCustomersAndCurrency)?this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"No existen facturas, para la moneda y el rango de fecha seleccionado.",title:"Sin datos",type:"warning",appearance:"fill"}}):this._salesReportsService.generateBillsByCustomersReport(n,i,this.user,this.merchant,s.getBillsByCustomersAndCurrency.billsByCustomersAndCurrency)})})}generateProductsBoughtByCustomerReport(){const{start:n,end:i}=this.range.getRawValue();this._dialog.open(ws.K,{data:{filterProperties:["customer","currency"]},width:"450px",panelClass:"ath-dialog-panel",disableClose:!0}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({customer:a})=>{Re.H.IsNullOrEmpty(a)?this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"Debe seleccionar un cliente.",title:"Sin datos",type:"warning",appearance:"fill"}}):this._salesDashboardStatsService.getProductsBoughtByCustomer(n,i,a.id).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:o})=>{Re.H.IsNullOrEmpty(o.getProductsBoughtByCustomer.productsBoughtByCustomer)?this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:"No existen productos facturados para el cliente seleccionado.",title:"Sin datos",type:"warning",appearance:"fill"}}):this._salesReportsService.generateProductsBoughtByCustomerReport(n,i,this.user,this.merchant,o.getProductsBoughtByCustomer.productsBoughtByCustomer)})})}getIpvByDateRange(){const{start:n,end:i}=this.range.getRawValue();!n||!i||this._dialog.open(ws.K,{data:{filterProperties:["depot"]},width:"450px",panelClass:"ath-dialog-panel",disableClose:!0}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{Re.H.IsNullOrEmpty(a.depot)||"cancelled"===a||this._periodsService.getIpvByDateRange(a.depot.id,n,i).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(o=>{this._documentsService.generatePeriodCloseDocument(o,this.merchant,this.user,null,{start:o.openedAt,end:o.closedAT},a.depot)})})}generateBoxesReport(){const{start:n,end:i}=this.range.getRawValue();!n||!i||this._boxService.getAllBoxes(null,this.selectedLocation?.id,null,n,i).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:a})=>{a&&this._documentsService.generateBoxesReport(a.getBoxes.boxes,{start:a.getBoxes.startDate,end:a.getBoxes.endDate},this.merchant,this.user)})}generateSalesByPeriodReport(n){const{start:i,end:a}=this.range.getRawValue();!i||!a||this._salesService.getSalesProductsGroupedByLocation(i,a,this.selectedLocation?this.selectedLocation.id:null).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(o=>{o&&this._salesReportsService.generateSalesByPeriodReport(o,this.merchant,this.user,n,!0)})}getSalesGroupedByLocation(n){const{start:i,end:a}=this.range.getRawValue();!i||!a||this._salesService.getSalesGroupedByLocation(i,a,this.selectedLocation?this.selectedLocation.id:null).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(o=>{o&&this._documentsService.generateSalesGroupedByLocation(o,this.merchant,this.user,n,!0)})}largeNumber(n,i){return(0,pz.s)(n,i)}trackByFn(n,i){return i.id||n}_getQuarters(n){const i=n.map(u=>u.value),a=i.sort((u,d)=>u-d),o=Math.max(...i);return[Math.min(...i),a[Math.floor(.25*a.length)],a[Math.floor(.75*a.length)],o]}_fixSvgFill(n){const i=this._router.url;Array.from(n.querySelectorAll("*[fill]")).filter(a=>-1!==a.getAttribute("fill").indexOf("url(")).forEach(a=>{const o=a.getAttribute("fill");a.setAttribute("fill",`url(${i}${o.slice(o.indexOf("#"))}`)})}_prepareChartData(){this.chartSalesStats={chart:{fontFamily:"inherit",foreColor:"inherit",height:"100%",type:"line",toolbar:{show:!1},zoom:{enabled:!1}},colors:["#f59e0b","#22c55e"],dataLabels:{enabled:!0,enabledOnSeries:[0],background:{borderWidth:0}},grid:{borderColor:"var(--fuse-border)"},labels:this.billsSummary.labels,legend:{show:!1},plotOptions:{bar:{columnWidth:"50%"}},series:[{name:"Total",type:"line",data:this.billsSummary.serie},{name:"Cobradas",type:"bar",data:this.billsSummary.collectedSerie}],states:{hover:{filter:{type:"darken",value:.75}}},stroke:{width:[3,0]},tooltip:{followCursor:!0,theme:"dark"},xaxis:{axisBorder:{show:!1},axisTicks:{color:"var(--fuse-border)"},labels:{style:{colors:"var(--fuse-text-secondary)"}},tooltip:{enabled:!1}},yaxis:{labels:{offsetX:-16,style:{colors:"var(--fuse-text-secondary)"}}}},this.billsByPaymentMethodDistribution={chart:{fontFamily:"inherit",foreColor:"inherit",height:"100%",type:"radar",sparkline:{enabled:!0}},colors:["#209569"],dataLabels:{enabled:!0,formatter:n=>`${n}`,textAnchor:"start",style:{fontSize:"13px",fontWeight:500},background:{borderWidth:0,padding:4},offsetY:-15},markers:{strokeColors:"#209569",strokeWidth:4},plotOptions:{radar:{polygons:{strokeColors:"var(--fuse-border)",connectorColors:"var(--fuse-border)"}}},series:this.paymentMethodDistribution.series,stroke:{width:2},tooltip:{theme:"dark",y:{formatter:n=>`${n}`}},xaxis:{labels:{show:!0,style:{fontSize:"14px",fontWeight:"600"}},categories:this.paymentMethodDistribution.categories},yaxis:{max:n=>parseInt((n+10).toFixed(0),10),tickAmount:7}},this.salesByPaymentMethodDistribution={chart:{fontFamily:"inherit",foreColor:"inherit",height:"100%",type:"radar",sparkline:{enabled:!0}},colors:["#209569"],dataLabels:{enabled:!0,formatter:n=>`${n}`,textAnchor:"start",style:{fontSize:"13px",fontWeight:500},background:{borderWidth:0,padding:4},offsetY:-15},markers:{strokeColors:"#209569",strokeWidth:4},plotOptions:{radar:{polygons:{strokeColors:"var(--fuse-border)",connectorColors:"var(--fuse-border)"}}},series:this.salesPaymentMethodDistribution.series,stroke:{width:2},tooltip:{theme:"dark",y:{formatter:n=>`${n}`}},xaxis:{labels:{show:!0,style:{fontSize:"14px",fontWeight:"600"}},categories:this.salesPaymentMethodDistribution.categories},yaxis:{max:n=>parseInt((n+10).toFixed(0),10),tickAmount:7}},this.salesByCategoriesOptions={chart:{fontFamily:"inherit",foreColor:"inherit",height:"100%",type:"polarArea",toolbar:{show:!1},zoom:{enabled:!1}},labels:this.salesByCategoriesChartData.labels,legend:{position:"bottom"},plotOptions:{polarArea:{spokes:{connectorColors:"var(--fuse-border)"},rings:{strokeColor:"var(--fuse-border)"}}},series:this.salesByCategoriesChartData.series.revenue,states:{hover:{filter:{type:"darken",value:.75}}},stroke:{width:2},theme:{monochrome:{enabled:!0,color:"#209569",shadeIntensity:.75,shadeTo:"dark"}},tooltip:{followCursor:!0,theme:"dark"},yaxis:{labels:{style:{colors:"var(--fuse-text-secondary)"}}}}}_prepareSalesBalanceChartData(){this.billsBalanceOptions={chart:{animations:{speed:400,animateGradually:{enabled:!1}},fontFamily:"inherit",foreColor:"inherit",width:"100%",height:"100%",type:"area",sparkline:{enabled:!0}},colors:["#A3BFFA","#667EEA"],fill:{colors:["#CED9FB","#AECDFD"],opacity:.5,type:"solid"},series:this.billsBalance.series,stroke:{curve:"straight",width:2},tooltip:{followCursor:!0,theme:"dark",x:{format:"dd/MM/yyyy"},y:{formatter:n=>n.toFixed(2)}},xaxis:{type:"datetime"}},this.salesBalanceOptions={chart:{animations:{speed:400,animateGradually:{enabled:!1}},fontFamily:"inherit",foreColor:"inherit",width:"100%",height:"100%",type:"area",sparkline:{enabled:!0}},colors:["#166b34","#f59e0b"],fill:{colors:["#14432a","#ffc40b"],opacity:.5,type:"solid"},series:this.salesBalance.series,stroke:{curve:"straight",width:2},tooltip:{followCursor:!0,theme:"dark",x:{format:"dd/MM/yyyy"},y:{formatter:n=>n.toFixed(2)}},xaxis:{type:"datetime"}}}_transformSalesByCategoriesChartData(n){this.salesByCategoriesChartData={labels:n.data.map(i=>i.category),series:{revenue:n.data.map(i=>i.revenue),profit:n.data.map(i=>i.profit)}}}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-dashboard"]],standalone:!0,features:[e.aNF],decls:66,vars:22,consts:[["picker",""],["reportsMenu1","matMenu"],["reportsMenu2","matMenu"],["projectsMenu","matMenu"],["salesByCategorySelector","matButtonToggleGroup"],[1,"flex","flex-col","flex-auto","min-w-0"],[1,"bg-card"],[1,"flex","flex-col","w-full","max-w-screen-xl","px-6","mx-auto","sm:px-8"],[1,"flex","flex-col","flex-auto","min-w-0","my-8","sm:flex-row","sm:items-center","sm:my-12"],[1,"flex","items-center","flex-auto","min-w-0"],[1,"text-3xl","font-semibold","leading-8","tracking-tight"],[1,"font-medium","tracking-tight","text-secondary"],[1,"flex","items-center","mt-6","space-x-3","sm:mt-0","sm:ml-2"],[1,"min-w-72","fuse-mat-dense","fuse-mat-rounded",3,"subscriptSizing"],[3,"formGroup","rangePicker","max"],["matStartDate","","formControlName","start","placeholder","Fecha de inicio"],["matEndDate","","formControlName","end","placeholder","Fecha final"],["matSuffix","",3,"for"],["disabled","false"],["svgIcon","mat_solid:cancel","matSuffix","",1,"cursor-pointer"],["mat-stroked-button","",1,"hidden","mx-3","sm:inline-flex",3,"matMenuTriggerFor","disabled"],[1,"icon-size-5",3,"svgIcon"],[1,"ml-2"],["xPosition","before"],["mat-menu-item","",3,"click"],["matRipple","",1,"relative","flex","self-start","pt-2","pb-1","pl-5","pr-4","overflow-hidden","border","border-b-0","cursor-pointer","rounded-t-xl","bg-default",3,"matMenuTriggerFor"],[1,"flex","items-center"],[1,"overflow-hidden"],[1,"font-medium","leading-6","truncate"],[1,"flex","items-center","justify-center","pl-2"],[3,"xPosition"],["mat-menu-item",""],[1,"flex-auto","pt-4","-mt-px","border-t","sm:pt-6"],[1,"w-full","max-w-screen-xl","mx-auto"],["mat-stretch-tabs","false",1,"w-full",3,"selectedIndexChange","animationDuration"],["label","Minorista",1,"max-w-screen-xl","p-6","md:p-8"],["matTabContent",""],["label","Mayorista",1,"p-6","md:p-8"],["svgIcon","mat_solid:cancel","matSuffix","",1,"cursor-pointer",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-full"],[1,"grid","w-full","max-w-screen-lg","gap-8"],[1,"grid","grid-cols-2","gap-6","mt-8","md:grid-cols-4","lg:grid-cols-6","sm:grid-flow-col","xl:grid-flow-row"],[1,"flex","flex-col","flex-auto","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],[1,"flex","items-start","justify-between"],[1,"text-lg","font-medium","leading-6","tracking-tight","truncate"],[1,"flex","flex-col","items-center","mt-2"],[1,"font-bold","leading-none","tracking-tight","text-green-500","text-7xl","sm:text-8xl"],[1,"font-bold","leading-none","tracking-tight","text-amber-500","text-7xl","sm:text-8xl"],[1,"font-bold","leading-none","tracking-tight","text-red-500","text-7xl","sm:text-8xl"],[1,"font-bold","leading-none","tracking-tight","text-blue-500","text-7xl","sm:text-8xl"],["matTooltip","Valor Promedio de Ventas",1,"flex","flex-col","justify-around","flex-auto","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],[1,"text-lg","font-medium","leading-6","tracking-tight","text-center","line-clamp-2"],[1,"flex","flex-col","items-center","justify-center","mt-1"],[1,"text-3xl","font-semibold","leading-tight","tracking-tight"],["matTooltip","Valor Promedio de Devoluciones",1,"flex","flex-col","justify-around","flex-auto","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],["matTooltip","Valor Promedio de Cancelaciones",1,"flex","flex-col","justify-around","flex-auto","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],[1,"flex","flex-col","justify-around","flex-auto","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],["matTooltip","Valor Promedio de Ventas en Transferencia",1,"flex","flex-col","justify-around","flex-auto","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],["matTooltip","Solo se tienen en cuentas las ventas en efectivo y mixta",1,"flex","flex-col","justify-around","flex-auto","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],[1,"grid","w-full","min-w-0","grid-cols-1","gap-6","sm:grid-cols-6"],[1,"flex","flex-col","flex-auto","p-6","overflow-hidden","shadow","sm:col-span-3","lg:col-span-4","bg-card","rounded-2xl"],[1,"flex","flex-col","p-6","pb-4"],[1,"flex","items-center","justify-between"],[1,"flex","flex-col"],[1,"mr-4","text-lg","font-medium","leading-6","tracking-tight","truncate"],[1,"font-medium","text-secondary"],["mat-button","","disabled","",1,"h-6","px-2","rounded-full","min-h-6","bg-hover"],[1,"text-sm","font-medium","text-secondary"],[1,"flex","items-start","mt-6","mr-2"],[1,"flex","flex-col","ml-8","md:ml-16"],[1,"text-3xl","font-semibold","tracking-tighter","md:text-5xl"],[1,"text-sm","font-medium","leading-none","text-secondary"],[1,"flex","flex-col","flex-auto"],[1,"flex-auto","w-full","h-full",3,"chart","colors","fill","series","stroke","tooltip","xaxis"],[1,"grid","grid-cols-1","sm:col-span-3","lg:col-span-2","gap-y-6"],["matTooltip","Importe vendido en Efectivo",1,"flex","flex-col","justify-around","flex-auto","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],["matTooltip","Importe vendido por Transferencia",1,"flex","flex-col","justify-around","flex-auto","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],[1,"grid","w-full","max-w-screen-lg","min-w-0","grid-cols-1","gap-6","mt-8","sm:grid-cols-2"],[1,"flex","flex-col","flex-auto","col-span-2","p-6","overflow-hidden","shadow","bg-card","rounded-2xl"],["id","cal-heatmap"],[1,"flex-auto","w-full","h-80",3,"chart","colors","dataLabels","markers","plotOptions","series","stroke","tooltip","xaxis","yaxis"],[1,"flex","flex-col","items-start","justify-between","sm:flex-row"],[1,"mt-3","sm:mt-0","sm:ml-2"],["value","revenue"],["value","profit"],[1,"flex","flex-col","flex-auto","mt-6"],[1,"flex-auto","w-full","h-80",3,"chart","labels","legend","plotOptions","series","states","stroke","theme","tooltip","yaxis"],[1,"grid","grid-cols-2","mt-4","-m-6","border-t","divide-x","bg-gray-50","dark:bg-transparent"],[1,"flex","flex-col","items-center","justify-center","p-6","sm:p-8"],[1,"text-5xl","font-semibold","leading-none","tracking-tighter"],[1,"mt-1","text-center","text-secondary"],[1,"grid","w-full","max-w-screen-lg","grid-cols-1","gap-8","xl:grid-cols-2"],[1,"grid","grid-cols-1","gap-8","mt-8","xl:grid-cols-2","sm:grid-flow-col","xl:grid-flow-row"],[1,"ml-2","-mt-2","-mr-3"],["mat-icon-button","","disabled",""],[1,"font-bold","leading-none","tracking-tight","text-7xl","sm:text-8xl","text-amber-500"],[1,"text-lg","font-medium","text-amber-600","dark:text-amber-500"],[1,"text-lg","font-medium","text-blue-600","dark:text-blue-500"],[1,"text-lg","font-medium","text-green-600","dark:text-green-500"],[1,"text-lg","font-medium","text-red-600","dark:text-red-500"],[1,"grid","w-full","grid-cols-1","gap-8","mt-8"],[1,"flex","flex-col","flex-auto","overflow-hidden","shadow","bg-card","rounded-2xl"],[1,"grid","w-full","grid-flow-row","grid-cols-1","gap-6","mt-8","sm:col-span-2","sm:mt-4"],[1,"flex","flex-col","flex-auto","w-full"],[1,"flex-auto","w-full","h-80",3,"chart","colors","dataLabels","grid","labels","legend","plotOptions","series","states","stroke","tooltip","xaxis","yaxis"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"div",9)(5,"div")(6,"h2",10),e.EFF(7,"Panel de Ventas"),e.k0s(),e.j41(8,"div",11),e.EFF(9,"Seguimiento del estados de tus ventas "),e.k0s()()(),e.j41(10,"div",12)(11,"mat-form-field",13)(12,"mat-date-range-input",14),e.nrm(13,"input",15)(14,"input",16),e.k0s(),e.nrm(15,"mat-datepicker-toggle",17)(16,"mat-date-range-picker",18,0),e.DNE(18,hz,1,0,"mat-icon",19)(19,gz,2,0,"mat-error")(20,bz,2,0,"mat-error"),e.k0s(),e.j41(21,"button",20),e.nrm(22,"mat-icon",21),e.j41(23,"span",22),e.EFF(24,"Reportes"),e.k0s()(),e.j41(25,"mat-menu",23,1)(27,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(a.getIpvByDateRange())}),e.EFF(28,"Ingreso por ventas (IPVs)"),e.k0s(),e.DNE(29,vz,4,0),e.j41(30,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateSalesByPeriodReport(!1))}),e.EFF(31),e.k0s(),e.j41(32,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(a.getSalesGroupedByLocation(!1))}),e.EFF(33),e.k0s(),e.j41(34,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateBoxesReport())}),e.EFF(35,"Resumen de cajas"),e.k0s()(),e.j41(36,"mat-menu",23,2)(38,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateBillsReport())}),e.EFF(39,"Facturas realizadas"),e.k0s(),e.j41(40,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateBillsByCustomersReport())}),e.EFF(41,"Facturas por clientes"),e.k0s(),e.j41(42,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateBillsCollectedByCustomerAndCurrencyReport("cobrada"))}),e.EFF(43,"Facturas cobradas por clientes"),e.k0s(),e.j41(44,"button",24),e.bIt("click",function(){return e.eBV(o),e.Njj(a.generateProductsBoughtByCustomerReport())}),e.EFF(45,"Productos facturados por clientes"),e.k0s()()()(),e.j41(46,"div",25)(47,"div",26)(48,"div",27)(49,"div",28),e.EFF(50),e.k0s()(),e.j41(51,"div",29),e.nrm(52,"mat-icon",21),e.k0s()(),e.j41(53,"mat-menu",30,3),e.DNE(55,_z,2,1,"button",31),e.Z7z(56,yz,2,1,"button",31,e.fX1),e.nI1(58,"async"),e.k0s()()()(),e.j41(59,"div",32)(60,"div",33)(61,"mat-tab-group",34),e.bIt("selectedIndexChange",function(l){return e.eBV(o),e.Njj(a.onTabChanged(l))}),e.j41(62,"mat-tab",35),e.DNE(63,Cz,174,76,"ng-template",36),e.k0s(),e.j41(64,"mat-tab",37),e.DNE(65,xz,97,57,"ng-template",36),e.k0s()()()()()}if(2&i){const o=e.sdS(17),s=e.sdS(26),l=e.sdS(37),c=e.sdS(54);e.R7$(11),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("formGroup",a.range)("rangePicker",o)("max",a.maxDate),e.R7$(3),e.Y8G("for",o),e.R7$(3),e.vxM(18,a.range.get("start").value||a.range.get("end").value?18:-1),e.R7$(),e.vxM(19,a.range.controls.start.hasError("matStartDateInvalid")?19:-1),e.R7$(),e.vxM(20,a.range.controls.end.hasError("matEndDateInvalid")?20:-1),e.R7$(),e.Y8G("matMenuTriggerFor",0===a.selectedTapIndex?s:l)("disabled",a.range.invalid||!a.range.get("start").value||!a.range.get("end").value),e.R7$(),e.Y8G("svgIcon","mat_solid:plagiarism"),e.R7$(7),e.vxM(29,a.selectedLocation?-1:29),e.R7$(2),e.SpI("Productos Vendidos ",a.selectedLocation?"":"(Agrupado)"," "),e.R7$(2),e.SpI(" Reporte de Ventas ",a.selectedLocation?"":"(Agrupado)"," "),e.R7$(13),e.Y8G("matMenuTriggerFor",c),e.R7$(4),e.SpI(" ",a.selectedLocation?a.selectedLocation.name:"Todas las Unidades Comerciales"," "),e.R7$(2),e.Y8G("svgIcon","mat_solid:expand_more"),e.R7$(),e.Y8G("xPosition","before"),e.R7$(2),e.vxM(55,a.selectedLocation?55:-1),e.R7$(),e.Dyx(e.bMT(58,20,a.locations$)),e.R7$(5),e.Y8G("animationDuration",0)}},dependencies:[U.Jj,U.QX,U.jo,te.Hl,te.$z,te.iY,nf.Vg,nf.ec,nf.pc,Z.X6,Z.bU,Z.el,Z.xR,Z.IG,Z.SG,O.RG,O.rl,O.TL,O.yw,de.m_,de.An,ve.Cn,ve.kk,ve.fb,ve.Cp,la.RI,la.$L,la.mq,la.T8,De.uc,De.oV,kf.J,kf.Q,m.X1,m.me,m.BC,m.cb,m.j4,m.JD],encapsulation:2,changeDetection:0})}return t})();const kz=(0,fe.Mz)(t=>t.sales,t=>t.sales),Iz=t=>({"cursor-not-allowed":t});function wz(t,r){1&t&&(e.j41(0,"mat-error",33),e.EFF(1," Valor m\xednimo 0 "),e.k0s())}function Rz(t,r){if(1&t&&(e.j41(0,"mat-error",33),e.EFF(1),e.k0s()),2&t){const n=e.XpG().$implicit;e.R7$(),e.SpI(" Valor m\xe1ximo ",n.quantityPreviews," ")}}function Tz(t,r){1&t&&(e.j41(0,"mat-error",33),e.EFF(1," Patr\xf3n no v\xe1lido "),e.k0s())}function Ez(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",16)(1,"div",25),e.EFF(2),e.k0s(),e.j41(3,"div",26)(4,"div",27)(5,"button",28),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.decrementProductQty(a))}),e.nrm(6,"mat-icon",29),e.k0s(),e.j41(7,"mat-form-field",30)(8,"span",31),e.EFF(9),e.k0s(),e.nrm(10,"input",32),e.k0s(),e.j41(11,"button",28),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.incrementProductQty(a))}),e.nrm(12,"mat-icon",29),e.k0s()(),e.DNE(13,wz,2,0,"mat-error",33)(14,Rz,2,1,"mat-error",33)(15,Tz,2,0,"mat-error",33),e.k0s()()}if(2&t){const n=r.$implicit;e.R7$(),e.Y8G("matTooltip",n.get("name").value),e.R7$(),e.SpI(" ",n.get("name").value," "),e.R7$(3),e.Y8G("disabled",n.get("quantity").value<=0||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:remove"),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(2),e.JRh(n.get("uom").value),e.R7$(),e.Y8G("min",0)("max",n.get("quantityPreviews").value)("formControl",n.get("quantity")),e.R7$(),e.Y8G("disabled",n.get("quantity").value>=n.get("quantityPreviews").value||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:add"),e.R7$(),e.vxM(13,n.get("quantity").hasError("min")?13:-1),e.R7$(),e.vxM(14,n.get("quantity").hasError("max")?14:-1),e.R7$(),e.vxM(15,n.get("quantity").hasError("pattern")&&!n.get("quantity").hasError("min")?15:-1)}}function jz(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," EL motivo del rechazo es obligatorio "),e.k0s())}function Dz(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," EL motivo del rechazo debe contener entre 3 y 200 caracteres. "),e.k0s())}function Az(t,r){1&t&&(e.j41(0,"span"),e.EFF(1," Aceptar "),e.k0s())}function Mz(t,r){1&t&&e.nrm(0,"mat-progress-spinner",24),2&t&&e.Y8G("diameter",24)("mode","indeterminate")}let Pz=(()=>{class t{constructor(n){this.data=n,this.isLoading=!1,this.sale=null,this.checkOutControl=new m.MJ(!1),this.salesProducts=[],this.products=[],this.receipts=[],this.totalAmount=(0,e.vPA)(0),this._changeDetectorRef=(0,e.WQX)(e.gRc),this._salesService=(0,e.WQX)(Rs.w),this._dialogRef=(0,e.WQX)(se.CP),this._formBuilder=(0,e.WQX)(m.ok),this._snackBar=(0,e.WQX)(Oe.UG),this._unsubscribeAll=new Ke.B,this.sale=n,this.products=this.sale.products.map(o=>({...o,type:"product"})),[...n.returns].map(o=>o.products).flat().forEach(o=>{const s=this.products.find(l=>l.productId===o.productId);s&&(s.quantity=s.quantity-o.quantity)}),this.salesProducts=[...this.products],this.receipts=this.sale.receipts.map(o=>({...o,type:"receipt"})),[...n.returns].map(o=>o.receipts).flat().forEach(o=>{const s=this.receipts.find(l=>l.productId===o.productId);s&&(s.quantity=s.quantity-o.quantity)}),this.products.push(...this.receipts),this.totalAmount.set(Number(this.sale.products.reduce((o,s)=>o+s.quantity*s.price,0).toFixed(2)))}ngOnInit(){const n=this.salesProducts.map(a=>this.createProductFormGroup(a)),i=this.receipts.map(a=>this.createReceiptsFormGroup(a));n.push(...i),this.returnForm=this._formBuilder.group({saleId:[this.sale.id],products:new m.Yp(n),reason:["",[m.k0.required,m.k0.maxLength(1e3)]]}),this.returnForm.get("products").valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{this.totalAmount.set(Number(a.reduce((o,s)=>o+Number(s.quantity)*Number(s.price),0).toFixed(2)))}),this.checkOutControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{a?(this.returnForm.get("products").controls.forEach((o,s)=>{const l=this.products.findIndex(c=>c.productId===o.get("productId").value);o.get("quantity").setValue(this.products[l].quantity)}),this.products=this.returnForm.get("products").getRawValue()):(this.products=this.returnForm.get("products").getRawValue(),this.returnForm.get("products").controls.forEach((o,s)=>{o.get("quantity").setValue(0)}))})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}returnSale(n){if("Enter"===n.key&&n.target instanceof HTMLTextAreaElement||this.returnForm.invalid)return;const i=this.returnForm.getRawValue();if(!i.products.some(c=>c.quantity>0))return;const o=i.products.filter(c=>c.quantity>0&&"product"===c.type).map(c=>({productId:c.productId,quantity:Number(c.quantity),price:c.price})),s=i.products.filter(c=>c.quantity>0&&"receipt"===c.type).map(c=>({productId:c.productId,quantity:Number(c.quantity),price:c.price}));this._salesService.returnSale({saleId:i.saleId,reason:i.reason,products:o,receipts:s}).pipe((0,T.Q)(this._unsubscribeAll),(0,bt.j)(()=>{this.isLoading=!1,this._changeDetectorRef.markForCheck()})).subscribe(({data:c})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:c.returnSale.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this._changeDetectorRef.markForCheck(),this.closeDialog()})}incrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(Number(i)+1);const a=this.products.findIndex(o=>o.productId===n.get("productId").value);this.products[a].quantity=Number(i)+1}decrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(Number(i)-1);const a=this.products.findIndex(o=>o.productId===n.get("productId").value);this.products[a].quantity=Number(i)-1}closeDialog(){this._dialogRef.close()}trackByFn(n,i){return i.productId||n}createProductFormGroup(n){return this._formBuilder.group({productId:[n.productId,[m.k0.required]],name:[n.product.name],quantityPreviews:[n.quantity],quantity:[0,[Je.t.onlyNumbersPattern(),m.k0.required,m.k0.min(0),m.k0.max(n.quantity)]],price:[n.price,[m.k0.required]],uom:[n.product.uom.abbr],type:["product"]})}createReceiptsFormGroup(n){return this._formBuilder.group({productId:[n.productId,[m.k0.required]],name:[n.receipt.name],quantityPreviews:[n.quantity],quantity:[0,[Je.t.onlyNumbersPattern(),m.k0.required,m.k0.min(0),m.k0.max(n.quantity)]],price:[n.price,[m.k0.required]],uom:[n.receipt.uom.abbr],type:["receipt"]})}static#e=this.\u0275fac=function(i){return new(i||t)(e.rXU(se.Vh))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sale-return-dialog"]],standalone:!0,features:[e.aNF],decls:38,vars:22,consts:[["refundT",""],[1,"h-full","ng-star-inserted",3,"keydown.enter"],[1,"relative","flex","flex-col","w-full","h-full"],[1,"flex","items-center","h-full"],[1,"block","w-full"],[1,"flex","flex-col","items-center","flex-auto","p-8","pb-4","sm:flex-row","sm:items-start","sm:pb-6"],[1,"flex","flex-col","items-center","mt-4","space-y-1","text-center","sm:items-start","sm:mt-0","sm:pr-8","sm:text-left","ng-star-inserted"],[1,"text-xl","font-medium","leading-6","ng-star-inserted"],[1,"text-secondary","ng-star-inserted"],[1,"flex","flex-col","gap-6","pb-6","pl-8","pr-8","mt-10","sm:mt-0","sm:pl-22",3,"formGroup","autocomplete"],[1,"flex","flex-col"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","grid-cols-2","gap-4","pr-6","pl-2","py-2","font-semibold","shadow","md:pr-8","md:pl-3","text-md","text-secondary","bg-gray-50","dark:bg-black/10"],["color","primary",3,"formControl"],[1,"font-medium"],[1,"flex","items-center","justify-end","mr-9","h-full"],[1,"overflow-auto","border-b",2,"max-height","40vh"],[1,"flex","items-center","justify-between","border-t","py-2","pr-3"],[1,"w-full","mat-fuse-dense","fuse-mat-textarea"],["matPrefix","","svgIcon","mat_solid:subject",1,"hidden","sm:flex","icon-size-5"],["matInput","",3,"formControlName","placeholder","minLength","maxLength","required"],[1,"text-right"],[1,"flex","flex-wrap","justify-center","px-6","py-4","space-x-3","tems-center","bg-gray-50","dark:bg-black/10","ng-star-inserted"],["mat-stroked-button","",3,"matDialogClose"],["mat-flat-button","","mat-button","",3,"click","color","disabled","ngClass"],[3,"diameter","mode"],[1,"truncate",3,"matTooltip"],[1,"flex","flex-col","justify-center"],[1,"flex","flex-row","items-center","justify-center","gap-2"],["mat-stroked-button","",1,"p-2","leading-6","min-w-7","min-h-7","h-7",3,"click","disabled"],[1,"icon-size-5",3,"svgIcon"],[1,"fuse-mat-dense","fuse-mat-rounded","max-w-22",3,"subscriptSizing"],["matSuffix",""],["matInput","","type","text","name","quantity",1,"font-mono","font-semibold","text-center",3,"min","max","formControl"],[1,"w-full","text-sm","text-center"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",1),e.bIt("keydown.enter",function(l){return e.eBV(o),e.Njj(a.returnSale(l))}),e.j41(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7),e.EFF(7,"Devoluci\xf3n"),e.k0s(),e.j41(8,"div",8),e.EFF(9),e.k0s()()(),e.j41(10,"form",9)(11,"div",10)(12,"div",11)(13,"mat-checkbox",12)(14,"span",13),e.EFF(15,"Productos*"),e.k0s()(),e.j41(16,"div",14)(17,"span"),e.EFF(18,"Cantidades"),e.k0s()()(),e.j41(19,"div",15),e.Z7z(20,Ez,16,14,"div",16,a.trackByFn,!0),e.k0s()(),e.j41(22,"mat-form-field",17)(23,"mat-label"),e.EFF(24,"Motivo"),e.k0s(),e.nrm(25,"mat-icon",18)(26,"textarea",19,0),e.j41(28,"mat-hint",20),e.EFF(29),e.k0s(),e.DNE(30,jz,2,0,"mat-error")(31,Dz,2,0,"mat-error"),e.k0s()()()(),e.j41(32,"div",21)(33,"button",22),e.EFF(34,"Cancelar"),e.k0s(),e.j41(35,"button",23),e.bIt("click",function(l){return e.eBV(o),e.Njj(a.returnSale(l))}),e.DNE(36,Az,2,0,"span")(37,Mz,1,2,"mat-progress-spinner",24),e.k0s()()()()}if(2&i){const o=e.sdS(27);e.R7$(9),e.Lme("\xbfEsta seguro que desea efectuar la devoluci\xf3n de las cantidades de la venta # ",a.sale.no," por $",a.totalAmount," ? "),e.R7$(),e.Y8G("formGroup",a.returnForm)("autocomplete","off"),e.R7$(3),e.Y8G("formControl",a.checkOutControl),e.R7$(7),e.Dyx(a.returnForm.get("products").controls),e.R7$(6),e.Y8G("formControlName","reason")("placeholder","Escriba el motivo del rechazo")("minLength",3)("maxLength",200)("required",!0),e.R7$(3),e.SpI("Total de caracteres ",o.value.length," / 1000"),e.R7$(),e.vxM(30,a.returnForm.get("reason").hasError("required")?30:-1),e.R7$(),e.vxM(31,a.returnForm.get("reason").hasError("maxlength")||a.returnForm.get("reason").hasError("minlength")?31:-1),e.R7$(2),e.Y8G("matDialogClose",!0),e.R7$(2),e.Y8G("color","primary")("disabled",a.returnForm.invalid)("ngClass",e.eq3(20,Iz,a.returnForm.invalid||a.isLoading))("disabled",a.returnForm.invalid||a.isLoading),e.R7$(),e.vxM(36,a.isLoading?-1:36),e.R7$(),e.vxM(37,a.isLoading?37:-1)}},dependencies:[te.Hl,te.$z,mt.g7,mt.So,se.hM,se.tx,O.RG,O.rl,O.nJ,O.MV,O.TL,O.JW,O.yw,de.m_,de.An,le.fS,le.fg,ot.D6,ot.LG,De.uc,De.oV,U.YU,m.X1,m.qT,m.me,m.BC,m.cb,m.YS,m.l_,m.j4,m.JD],encapsulation:2,changeDetection:0})}return t})();const Bz=t=>({"cursor-not-allowed":t});function Oz(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El motivo es obligatorio "),e.k0s())}function Nz(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El motivo debe contener entre 3 y 1000 caracteres. "),e.k0s())}let Gz=(()=>{class t{constructor(n,i){this.data=n,this._dialogRef=i,this.reasonControl=new m.MJ("")}ngOnInit(){this.reasonControl.setValidators([m.k0.required,m.k0.minLength(3),m.k0.maxLength(1e3)])}accept(){this._dialogRef.close({reason:this.reasonControl.value})}static#e=this.\u0275fac=function(i){return new(i||t)(e.rXU(se.Vh),e.rXU(se.CP))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-cancel-dialog"]],standalone:!0,features:[e.aNF],decls:25,vars:15,consts:[[1,"ng-star-inserted","h-full"],[1,"relative","flex","flex-col","w-full","h-full"],[1,"h-full","flex","items-center"],[1,"block","w-full"],[1,"flex","flex-col","sm:flex-row","flex-auto","items-center","sm:items-start","p-8","pb-4","sm:pb-6"],[1,"flex","flex-0","items-center","justify-center","w-10","h-10","sm:mr-4","rounded-full","text-blue-600","bg-blue-100","dark:bg-blue-300","ng-star-inserted"],["svgIcon","mat_solid:question_mark",1,"text-blue-600"],[1,"text-xl","font-medium","leading-6","ng-star-inserted"],[1,"text-sm","text-secondary","ng-star-inserted"],[1,"pr-8","pl-8","mt-10","sm:mt-0","sm:pl-22","pb-6",3,"autocomplete"],[1,"w-full","fuse-mat-textarea",3,"subscriptSizing"],["matPrefix","","svgIcon","mat_solid:edit_note",1,"hidden","sm:flex","icon-size-5"],["matInput","","required","",3,"formControl","placeholder"],[1,"flex","flex-wrap","tems-center","justify-center","md:justify-end","px-6","py-4","space-x-3","bg-gray-50","dark:bg-black/10","ng-star-inserted"],["mat-button","",3,"color","matDialogClose"],["mat-flat-button","","mat-button","",3,"click","color","disabled","ngClass"]],template:function(i,a){1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),e.nrm(6,"mat-icon",6),e.k0s(),e.j41(7,"div")(8,"div",7),e.EFF(9),e.k0s(),e.j41(10,"div",8),e.EFF(11),e.k0s()()(),e.j41(12,"form",9)(13,"mat-form-field",10)(14,"mat-label"),e.EFF(15,"Motivo"),e.k0s(),e.nrm(16,"mat-icon",11)(17,"textarea",12),e.DNE(18,Oz,2,0,"mat-error")(19,Nz,2,0,"mat-error"),e.k0s()()()(),e.j41(20,"div",13)(21,"button",14),e.EFF(22,"Cancelar"),e.k0s(),e.j41(23,"button",15),e.bIt("click",function(){return a.accept()}),e.EFF(24," Aceptar "),e.k0s()()()()),2&i&&(e.R7$(9),e.JRh(a.data.title),e.R7$(2),e.JRh(a.data.message),e.R7$(),e.Y8G("autocomplete","off"),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(4),e.Y8G("formControl",a.reasonControl)("placeholder","Escriba el motivo"),e.R7$(),e.vxM(18,a.reasonControl.hasError("required")?18:-1),e.R7$(),e.vxM(19,a.reasonControl.hasError("maxlength")||a.reasonControl.hasError("minlength")?19:-1),e.R7$(2),e.Y8G("color","warn")("matDialogClose",!0),e.R7$(2),e.Y8G("color","primary")("disabled",a.reasonControl.invalid)("ngClass",e.eq3(13,Bz,a.reasonControl.invalid)))},dependencies:[te.Hl,te.$z,mt.g7,se.hM,se.tx,O.RG,O.rl,O.nJ,O.TL,O.JW,de.m_,de.An,le.fS,le.fg,ot.D6,De.uc,U.YU,m.X1,m.qT,m.me,m.BC,m.cb,m.YS,m.l_],encapsulation:2,data:{animation:zs.X},changeDetection:0})}return t})();var Lz=R(7997),Yz=R(49098),Vz=R(82341),zz=R(14715),rf=R(74892);const qz=["locationFilter"],Uz=["terminalFilter"],Xz=["currencyFilter"],Wz=["paymentMethodFilter"],Qz=()=>({wheelPropagation:!1}),Jy=(t,r,n)=>({"sales-grid-1":t,"sales-grid-2":r,"sales-grid-3":n}),Ts=t=>({hidden:t}),Jz=(t,r)=>({"pointer-events-none":t,hidden:r}),Hz=()=>[10,25,50,100],Zz=(t,r,n,i,a,o)=>({" bg-teal-100  dark:bg-teal-700":t," bg-green-100  dark:bg-green-700":r," bg-blue-100  dark:bg-blue-700":n," bg-violet-50  dark:bg-violet-700":i," bg-violet-100  dark:bg-violet-700 ":a," bg-amber-100  dark:bg-amber-700":o}),Kz=(t,r,n,i,a,o)=>({"bg-teal-800 dark:bg-teal-50":t,"bg-green-800 dark:bg-green-50  ":r,"bg-blue-800  dark:bg-white ":n,"bg-violet-800  dark:bg-violet-50 ":i,"bg-violet-500  dark:bg-violet-50 ":a,"bg-amber-800  dark:bg-black ":o}),eq=(t,r,n,i,a,o)=>({"text-teal-800 bg-teal-100 dark:text-teal-50 ":t,"text-green-800  dark:text-green-50 ":r,"text-blue-800  dark:text-white ":n,"text-violet-800  dark:text-violet-50 ":i,"text-violet-500  dark:text-violet-50 ":a,"text-amber-800  dark:text-black ":o}),tq=t=>({$implicit:t});function nq(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-icon",51),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.range.reset())}),e.k0s()}}function rq(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1,"Fecha de inicio no v\xe1lida "),e.k0s())}function iq(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1,"Fecha de final no v\xe1lida "),e.k0s())}function aq(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",50),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.getSalesByPeriodReport(!0))}),e.EFF(1," Productos vendidos (Consolidado) "),e.k0s(),e.j41(2,"button",50),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.getSalesGroupedByLocation(!0))}),e.EFF(3,"Reporte de Ventas (Consolidado)"),e.k0s()}}function oq(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-form-field",38)(1,"mat-date-range-input",39),e.nrm(2,"input",40)(3,"input",41),e.k0s(),e.nrm(4,"mat-datepicker-toggle",42)(5,"mat-date-range-picker",43,5),e.DNE(7,nq,1,0,"mat-icon",44)(8,rq,2,0,"mat-error")(9,iq,2,0,"mat-error"),e.k0s(),e.j41(10,"div",45)(11,"button",46),e.nrm(12,"mat-icon",47),e.j41(13,"span",48),e.EFF(14,"Reportes"),e.k0s()(),e.j41(15,"mat-menu",49,6)(17,"button",50),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.exportSalesByPeriodReport())}),e.EFF(18,"Exportar Productos Vendidos"),e.k0s(),e.j41(19,"button",50),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.exportSalesGroupedByLocation())}),e.EFF(20,"Exportar Ventas"),e.k0s(),e.DNE(21,aq,4,0),e.j41(22,"button",50),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.getSalesByPeriodReport(!1))}),e.EFF(23),e.k0s(),e.j41(24,"button",50),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.getSalesGroupedByLocation(!1))}),e.EFF(25),e.k0s()()()}if(2&t){const n=e.sdS(6),i=e.sdS(16),a=e.XpG();e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("formGroup",a.range)("rangePicker",n)("max",a.maxDate),e.R7$(3),e.Y8G("for",n),e.R7$(3),e.vxM(7,a.range.get("start").value||a.range.get("end").value?7:-1),e.R7$(),e.vxM(8,a.range.controls.start.hasError("matStartDateInvalid")?8:-1),e.R7$(),e.vxM(9,a.range.controls.end.hasError("matEndDateInvalid")?9:-1),e.R7$(2),e.Y8G("disabled",!a.range.get("start").value||!a.range.get("end").value||a.range.invalid)("matMenuTriggerFor",i),e.R7$(),e.Y8G("svgIcon","mat_solid:plagiarism"),e.R7$(9),e.vxM(21,a.selectedLocation?-1:21),e.R7$(2),e.SpI("Productos Vendidos ",a.selectedLocation?"":"(Agrupado)"," "),e.R7$(2),e.SpI(" Reporte de Ventas ",a.selectedLocation?"":"(Agrupado)"," ")}}function sq(t,r){if(1&t&&(e.j41(0,"div",65)(1,"span",66),e.nrm(2,"span",67),e.k0s(),e.j41(3,"span",68),e.EFF(4),e.nI1(5,"uppercase"),e.k0s()(),e.j41(6,"span",58),e.EFF(7),e.k0s()),2&t){const n=e.XpG().$implicit;e.R7$(4),e.SpI(" ",e.bMT(5,2,n.status)," "),e.R7$(3),e.JRh(n.statusChangeAgo)}}function lq(t,r){if(1&t&&(e.j41(0,"div",65)(1,"span",69),e.nrm(2,"span",70),e.k0s(),e.j41(3,"span",71),e.EFF(4),e.nI1(5,"uppercase"),e.k0s()(),e.j41(6,"span",58),e.EFF(7),e.k0s()),2&t){const n=e.XpG().$implicit;e.R7$(),e.Y8G("ngClass",e.l4e(7,Zz,"parcial"===n.paymentStatus,"pagada"===n.paymentStatus,"pendiente"===n.paymentStatus,"devueltoParcial"===n.paymentStatus,"devuelto"===n.paymentStatus,"dPendiente"===n.paymentStatus)),e.R7$(),e.Y8G("ngClass",e.l4e(14,Kz,"parcial"===n.paymentStatus,"pagada"===n.paymentStatus,"pendiente"===n.paymentStatus,"devuelto"===n.paymentStatus,"devueltoParcial"===n.paymentStatus,"dPendiente"===n.paymentStatus)),e.R7$(),e.Y8G("ngClass",e.l4e(21,eq,"parcial"===n.paymentStatus,"pagada"===n.paymentStatus,"pendiente"===n.paymentStatus,"devuelto"===n.paymentStatus,"devueltoParcial"===n.paymentStatus,"dPendiente"===n.paymentStatus)),e.R7$(),e.SpI(" ",e.bMT(5,5,"cancelada"!==n.status?"devueltoParcial"===n.paymentStatus?"devuelto":n.paymentStatus:n.status)," "),e.R7$(3),e.JRh(n.paymentStatusChangeAgo)}}function cq(t,r){1&t&&e.nrm(0,"mat-icon",63)}function uq(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",72),e.bIt("click",function(){e.eBV(n);const a=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.return(a))}),e.nrm(1,"mat-icon",73),e.k0s(),e.j41(2,"button",74),e.bIt("click",function(){e.eBV(n);const a=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.cancelSale(a))}),e.nrm(3,"mat-icon",75),e.k0s(),e.j41(4,"button",76),e.bIt("click",function(){e.eBV(n);const a=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.printTicket(a))}),e.nrm(5,"mat-icon",77),e.k0s()}if(2&t){const n=e.XpG().$implicit,i=e.XpG(2);e.Y8G("disabled",i.isLoading||"devuelto"===n.paymentStatus||"cancelada"===n.status),e.R7$(2),e.Y8G("disabled",i.isLoading||"devuelto"===n.paymentStatus||"cancelada"===n.status),e.R7$(3),e.Y8G("svgIcon","mat_solid:receipt")}}function dq(t,r){1&t&&e.nrm(0,"mat-spinner",64),2&t&&e.Y8G("diameter",20)("color","primary")}function fq(t,r){1&t&&e.eu8(0)}function mq(t,r){if(1&t&&e.DNE(0,fq,1,0,"ng-container",78),2&t){const n=e.XpG(3),i=e.sdS(71);e.Y8G("ngTemplateOutlet",i)("ngTemplateOutletContext",e.eq3(2,tq,n.paymentStatusData))}}function pq(t,r){if(1&t&&(e.j41(0,"div",52)(1,"div",53),e.EFF(2),e.k0s(),e.j41(3,"div",54),e.EFF(4),e.k0s(),e.j41(5,"div",54),e.EFF(6),e.k0s(),e.j41(7,"div",55),e.EFF(8),e.nI1(9,"date"),e.k0s(),e.j41(10,"div",56)(11,"span",57),e.EFF(12),e.nI1(13,"number"),e.k0s(),e.j41(14,"span",58),e.EFF(15),e.k0s()(),e.j41(16,"div",59),e.EFF(17),e.nI1(18,"uppercase"),e.k0s(),e.j41(19,"div",60)(20,"div",61),e.DNE(21,sq,8,4)(22,lq,8,28),e.k0s()(),e.j41(23,"div",62),e.DNE(24,cq,1,0,"mat-icon",63)(25,uq,6,3)(26,dq,1,2,"mat-spinner",64),e.k0s()(),e.j41(27,"div",23),e.DNE(28,mq,1,4,"ng-container"),e.k0s()),2&t){const n=r.$implicit,i=r.$index,a=e.XpG(2);e.Y8G("ngClass",e.sMw(23,Jy,1===a.user.accessLevel,2===a.user.accessLevel,3===a.user.accessLevel)),e.R7$(2),e.SpI(" ",n.no," "),e.R7$(),e.Y8G("ngClass",e.eq3(27,Ts,a.user.accessLevel<3)),e.R7$(),e.SpI(" ",null==n.location?null:n.location.name," "),e.R7$(),e.Y8G("ngClass",e.eq3(29,Ts,1===a.user.accessLevel)),e.R7$(),e.SpI(" ",null==n.terminal?null:n.terminal.name," "),e.R7$(2),e.SpI(" ",e.i5U(9,15,n.createdAt,"dd/MM/YY hh:mm a")," "),e.R7$(4),e.JRh(e.i5U(13,18,n.total,"1.2-2")),e.R7$(3),e.JRh(null==n||null==n.currency?null:n.currency.iso),e.R7$(2),e.SpI(" ",e.bMT(18,21,n.paymentMethod.name)," "),e.R7$(4),e.vxM(21,"cancelada"===n.status?21:22),e.R7$(3),e.vxM(24,n.isPromotion?24:-1),e.R7$(),e.vxM(25,n.isPromotion?-1:25),e.R7$(),e.vxM(26,a.isMarkAsPayedLoading&&a.selectedSlide===i?26:-1),e.R7$(2),e.vxM(28,(null==a.selectedSale?null:a.selectedSale.id)===n.id?28:-1)}}function hq(t,r){if(1&t&&e.Z7z(0,pq,29,31,null,null,e.BUC().trackByFn,!0),2&t){const n=e.XpG();e.Dyx(n.sales)}}function gq(t,r){1&t&&(e.j41(0,"div",79),e.EFF(1," \xa1No se ha encontrado ninguna venta! "),e.k0s())}function bq(t,r){if(1&t&&(e.j41(0,"div",84)(1,"div",59),e.EFF(2),e.nI1(3,"uppercase"),e.k0s(),e.j41(4,"div",59),e.EFF(5),e.k0s(),e.j41(6,"div",59),e.EFF(7),e.nI1(8,"date"),e.k0s(),e.j41(9,"div",59),e.EFF(10),e.nI1(11,"uppercase"),e.k0s(),e.j41(12,"div",83),e.EFF(13),e.k0s()()),2&t){const n=r.$implicit;e.R7$(2),e.SpI(" ",e.bMT(3,5,n.paymentStatus)," "),e.R7$(3),e.SpI(" ",n.amount," "),e.R7$(2),e.SpI(" ",e.i5U(8,7,n.statusChangeAt,"dd/MM/yyyy HH:mm")," "),e.R7$(3),e.SpI(" ",e.bMT(11,10,n.type)," "),e.R7$(3),e.SpI(" ",n.description," ")}}function vq(t,r){if(1&t&&(e.j41(0,"div",80)(1,"div",81)(2,"div",59),e.EFF(3," Estado "),e.k0s(),e.j41(4,"div",59),e.EFF(5," Monto "),e.k0s(),e.j41(6,"div",59),e.EFF(7," Fecha "),e.k0s(),e.j41(8,"div",82),e.EFF(9," T.Devoluci\xf3n "),e.k0s(),e.j41(10,"div",83),e.EFF(11," Descripci\xf3n "),e.k0s()(),e.Z7z(12,bq,14,12,"div",84,e.fX1),e.k0s()),2&t){const n=e.XpG();e.R7$(12),e.Dyx(n.paymentStatusData)}}let _q=(()=>{class t{constructor(){this.isMarkAsPayedLoading=!1,this.currencies$=(0,ie.of)([]),this.maxDate=new Date,this.merchant=null,this.posSettings=null,this.paymentMethods$=(0,ie.of)([]),this.merchantControl=new m.hs(""),this.paymentStatusData=[],this.range=new m.gE({start:new m.MJ({disabled:!1,value:null},[Je.t.futureDateValidator()]),end:new m.MJ({disabled:!1,value:null},[Je.t.futureDateValidator()])}),this.searchLocationsControl=new m.MJ(null),this.searchTerminalsControl=new m.MJ(null),this.filterInputControl=new m.MJ,this.searchInputControl=new m.MJ(null),this.selectedSale=null,this.selectedSlide=null,this.user=null,this.selectedLocation=null,this.selectedTerminal=null,this.selectedCurrenciesId=[],this.selectedPaymentMethodsId=[],this._changeDetectorRef=(0,e.WQX)(e.gRc),this._dialog=(0,e.WQX)(se.bZ),this._documentsService=(0,e.WQX)(hr.Q),this._fileSaverService=(0,e.WQX)(As.f),this._locationsService=(0,e.WQX)(Yz.O),this._terminalsService=(0,e.WQX)(rf.T),this._printerService=(0,e.WQX)(Lz.k),this._salesService=(0,e.WQX)(Rs.w),this._snackBar=(0,e.WQX)(Oe.UG),this._unsubscribeAll=new Ke.B,this._salesReportsService=(0,e.WQX)(Vs),this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.store.select(bn.SW).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.user=n,this._changeDetectorRef.markForCheck()}),this.currencies$=this.store.select(Pn.y$),this.paymentMethods$=this.store.select(Gs.xi),this.store.select(At.Xb).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.merchant=n,this._changeDetectorRef.markForCheck()}),this.store.select(kz).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.sales=n,this._changeDetectorRef.markForCheck()}),this.store.select(Mn.Dz).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.pagination=n,this._changeDetectorRef.markForCheck()}),this.searchInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,Ne.Z)(null),(0,ce.n)(n=>null!==n?(this.isLoading=!0,this._salesService.getSales(this._paginator.pageIndex,this._paginator.pageSize,this._sort.active,this._sort.direction,n,this.selectedLocation?.id,this.selectedTerminal?.id,this.selectedCurrenciesId,this.selectedPaymentMethodsId,this.range.get("start").value,this.range.get("end").value)):(0,ie.of)()),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe(),this.range.get("end").valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this._salesService.getSales(this._paginator.pageIndex,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value,this.selectedLocation?.id,this.selectedTerminal?.id,this.selectedCurrenciesId,this.selectedPaymentMethodsId,this.range.get("start").value,n).pipe((0,T.Q)(this._unsubscribeAll)).subscribe()}),this.locationsFiltered=this.searchLocationsControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,bt.j)(()=>{this.isLoading=!1}),(0,Qe.Z)(n=>null!==n&&"string"==typeof n&&(this.selectedLocation&&n!==this.selectedLocation.name||!this.selectedLocation)?(this.isLoading=!0,this._locationsService.findActiveLocations(n.trim())):(0,ie.of)())),this.terminalsFiltered=this.searchTerminalsControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,bt.j)(()=>{this.isLoading=!1}),(0,Qe.Z)(n=>null!==n&&"string"==typeof n&&(this.selectedTerminal&&n!==this.selectedTerminal.name||!this.selectedTerminal)?(this.isLoading=!0,this._terminalsService.findTerminalsActiveByUser().pipe((0,Fe.T)(i=>i.data.findTerminalsActiveByUser.terminals))):(0,ie.of)())),this.filterInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,ce.n)(n=>(this.isLoading=!0,this._salesService.getSales(this._paginator.pageIndex,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value,this.selectedLocation?.id,this.selectedTerminal?.id,this.selectedCurrenciesId,this.selectedPaymentMethodsId,this.range.get("start").value,this.range.get("end").value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe(),this.store.select(zz.J0).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{n&&(this.posSettings=n.getObjectType(),this._changeDetectorRef.markForCheck())})}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"no",start:"desc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,An.h)(this._sort.sortChange,this._paginator.page).pipe((0,ce.n)(()=>(this.isLoading=!0,this._salesService.getSales(this._paginator.pageIndex,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value,this.selectedLocation?.id,this.selectedTerminal?.id,this.selectedCurrenciesId,this.selectedPaymentMethodsId,this.range.get("start").value,this.range.get("end").value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}resetLocation(){this.selectedLocation=null,this.searchInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addLocation(n){this.selectedLocation=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addTerminal(n){this.selectedTerminal=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addCurrencies(n){this.selectedCurrenciesId=n.map(i=>i.id),this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addPaymentMethod(n){this.selectedPaymentMethodsId=n.map(i=>i.id),this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}exportSalesByPeriodReport(){const{start:n,end:i}=this.range.getRawValue();!n||!i||this._salesService.getSalesProductsGroupedByLocation(n,i,this.selectedLocation?.id,this.selectedCurrenciesId,this.selectedPaymentMethodsId).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{if(a){const o=a.products.map(s=>({Producto:s?.product.name,C\u00f3digo:s?.product.bCode,Cantidad:s.quantity,"Precio Promedio":s.priceAvg,Total:s.revenue,"Unidad Comercial":s.location.name}));this._fileSaverService.exportAsExcelFile(o,`IPV_${ne(this.range.get("end").value).format("YYYYMMDD")}`,[["Producto","C\xf3digo","Cantidad","Precio Promedio","Total","Unidad Comercial"]],[{wch:30},{wch:15},{wch:10},{wch:15},{wch:15},{wch:30}])}})}exportSalesGroupedByLocation(){const{start:n,end:i}=this.range.getRawValue();!n||!i||this._salesService.getSalesGroupedByLocation(n,i,this.selectedLocation?.id,this.selectedCurrenciesId,this.selectedPaymentMethodsId).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{if(a){const o=a.salesPeriodLocation.map(s=>s.sales.map(l=>({...l,location:s.location}))).flat().map(s=>({Fecha:ne(s.createdAt).format("DD/MM/YYYY HH:mm:ss"),No:s.no,Importe:s.revenue,Pago:s.paymentMethod.name,"Unidad Comercial":s.location?.name,Cajero:`${s.employee.name} ${s.employee.lastname1} ${s.employee.lastname2?s.employee.lastname2:""}`,"C\xf3digo de Transferencia":s.paymentConfirmationCode}));this._fileSaverService.exportAsExcelFile(o,`IPV_${ne(this.range.get("end").value).format("YYYYMMDD")}`,[["Fecha","No","Importe","Pago","Unidad Comercial","Cajero","C\xf3digo de Transferencia"]],[{wch:20},{wch:20},{wch:10},{wch:15},{wch:30},{wch:25},{wch:25}])}})}getSalesByPeriodReport(n){const{start:i,end:a}=this.range.getRawValue();!i||!a||this._salesService.getSalesProductsGroupedByLocation(i,a,this.selectedLocation?.id,this.selectedCurrenciesId,this.selectedPaymentMethodsId).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(o=>{o&&this._salesReportsService.generateSalesByPeriodReport(o,this.merchant,this.user,n)})}getSalesGroupedByLocation(n){const{start:i,end:a}=this.range.getRawValue();!i||!a||this._salesService.getSalesGroupedByLocation(i,a,this.selectedLocation?.id,this.selectedCurrenciesId,this.selectedPaymentMethodsId).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(o=>{o&&this._documentsService.generateSalesGroupedByLocation(o,this.merchant,this.user,n)})}printTicket(n){let i=structuredClone(n);i.products=[...i.products,...i.receipts.map(a=>({...a,product:{name:a.receipt.name,uom:a.receipt.uom}}))],this._printerService.printSaleTicket(i,this.posSettings?.ticketFooter).pipe((0,T.Q)(this._unsubscribeAll)).subscribe()}generateTicketDocument(n){var i=this;return(0,Sf.A)(function*(){i._documentsService.generateTicketDocument(n,i.merchant,i.user)})()}return(n){this._dialog.open(Pz,{data:n,panelClass:"ath-dialog-panel",maxWidth:"550px"})}cancelSale(n){this._dialog.open(Gz,{data:{title:"Cancelar venta",message:`\xbfEst\xe1 seguro que desea cancelar la venta No. ${n.no}?`},panelClass:"ath-dialog-panel",maxWidth:"600px"}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{Re.H.IsNullOrEmpty(a.reason)||this._salesService.cancelSale(n.id,a.reason).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:o})=>{o&&this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.cancelSale.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}})})})}trackByFn(n,i){return i.id||n}closeDetails(){this.selectedSale=null,this.paymentStatusData=[],this._changeDetectorRef.markForCheck()}displayFn(n){return(n&&n.name?n.name:"").trim()}existTableFilter(){return this.currencyFilter?.hasFilter||this.locationFilter?.hasFilter||this.paymentMethodDateFilter?.hasFilter||this.terminalFilter?.hasFilter}clearTableFilters(){this.currencyFilter?.hasFilter&&this.currencyFilter.clearFilter(),this.locationFilter?.hasFilter&&this.locationFilter.clearFilter(),this.terminalFilter?.hasFilter&&this.terminalFilter.clearFilter(),this.paymentMethodDateFilter?.hasFilter&&this.paymentMethodDateFilter.clearFilter()}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-sales"]],viewQuery:function(i,a){if(1&i&&(e.GBs(Ie.iy,5),e.GBs(pe.B4,5),e.GBs(qz,5),e.GBs(Uz,5),e.GBs(Xz,5),e.GBs(Wz,5)),2&i){let o;e.mGM(o=e.lsd())&&(a._paginator=o.first),e.mGM(o=e.lsd())&&(a._sort=o.first),e.mGM(o=e.lsd())&&(a.locationFilter=o.first),e.mGM(o=e.lsd())&&(a.terminalFilter=o.first),e.mGM(o=e.lsd())&&(a.currencyFilter=o.first),e.mGM(o=e.lsd())&&(a.paymentMethodDateFilter=o.first)}},standalone:!0,features:[e.aNF],decls:72,vars:57,consts:[["locationFilter",""],["terminalFilter",""],["currencyFilter",""],["paymentMethodFilter",""],["rowPaymentStatusDataTemplate",""],["picker",""],["reportsMenu","matMenu"],["fuseScrollbar","",1,"absolute","inset-0","flex","flex-col","flex-auto","min-w-0","bg-card","dark:bg-transparent",3,"fuseScrollbarOptions"],[1,"relative","flex","flex-col","px-6","py-8","border-b","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex-wrap","items-center","hidden","font-medium","sm:flex"],[1,"flex","items-center","ml-1","whitespace-nowrap"],["routerLink","/desktop",1,"ml-1","text-primary-500","hover:underline"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"flex","sm:hidden"],[1,"inline-flex","items-center","-ml-1.5","text-secondary","font-medium",3,"routerLink"],[1,"ml-1"],[1,"flex","flex-wrap","items-center","w-full","gap-2","mt-6","right-8","shrink-0","lg:mt-0","lg:ml-4","lg:w-auto","sm:w-1/2"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],[1,"flex","flex-col","flex-auto"],[1,"grid"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-slate-900",3,"ngClass"],[1,"flex","items-center","justify-center",3,"mat-sort-header"],[1,"flex","items-center","justify-start",3,"ngClass"],[3,"dataChange","filterType","searchEntityControl","entitiesFiltered"],[1,"flex","items-center","justify-center","min-w-40",3,"mat-sort-header"],[1,"flex","items-center","justify-end"],[3,"mat-sort-header"],[3,"dataChange","filterType","entityPropertyName","useUpperCase","data"],[1,"flex","items-center","justify-center"],["matTooltip","M\xe9todo de pago"],[1,"flex","items-center","justify-end","mr-4"],["color","warn","mat-icon-button","","matTooltip","Limpiar filtros",1,"w-6","h-6","min-h-6","min-w-6",3,"click","disabled"],[1,"icon-size-4",3,"svgIcon"],[1,"border-b","first-letter:z-10","sm:inset-x-0","sm:sticky","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-slate-900",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],[1,"sm:mx-4","min-w-64","fuse-mat-dense","fuse-mat-rounded",3,"subscriptSizing"],[3,"formGroup","rangePicker","max"],["matStartDate","","formControlName","start","placeholder","Fecha de inicio"],["matEndDate","","formControlName","end","placeholder","Fecha final"],["matPrefix","",3,"for"],["disabled","false"],["svgIcon","mat_solid:cancel","matSuffix","",1,"cursor-pointer"],[1,""],["mat-raised-button","",1,"text-white","bg-gradient-to-r","from-yellow-500","to-yellow-600",3,"disabled","matMenuTriggerFor"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],["xPosition","before"],["mat-menu-item","",3,"click"],["svgIcon","mat_solid:cancel","matSuffix","",1,"cursor-pointer",3,"click"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","md:px-8",3,"ngClass"],[1,"truncate"],[1,"text-left",3,"ngClass"],[1,"text-center","min-w-40"],[1,"flex","flex-row","justify-end","space-x-1"],[1,"font-mono"],[1,"text-xs","text-secondary"],[1,"text-center"],[1,"relative","flex"],[1,"absolute","h-full","flex","justify-center","flex-col"],[1,"flex","flex-row","justify-end","gap-2"],["svgIcon","mat_solid:redeem","matTooltip","Venta por promoci\xf3n",1,"icon-size-7"],[1,"self-center","ml-2",3,"diameter","color"],[1,"flex","items-center"],[1,"flex","justify-center","items-center","h-3","w-3","rounded-full","bg-red-100","dark:bg-red-500"],[1,"h-[40%]","w-[40%]","rounded-full","bg-red-800","dark:bg-red-50"],[1,"py-0.5","pl-1","pr-3","rounded-full","text-sm","font-semibold","uppercase","text-red-800","dark:text-red-50"],[1,"flex","justify-center","items-center","h-3","w-3","rounded-full",3,"ngClass"],[1,"h-[40%]","w-[40%]","rounded-full",3,"ngClass"],[1,"py-0.5","pl-1","pr-3","rounded-full","text-sm","font-semibold","uppercase",3,"ngClass"],["matTooltip","Hacer devoluci\xf3n","mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click","disabled"],["svgIcon","mat_solid:undo",1,"icon-size-5"],["matTooltip","Cancelar venta","mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click","disabled"],["svgIcon","mat_solid:cancel",1,"icon-size-5"],["mat-stroked-button","","matTooltip","Imprimir Ticket",1,"hidden","px-2","leading-6","sm:flex","min-w-10","min-h-7","h-7",3,"click"],[1,"icon-size-5",3,"svgIcon"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"],[1,"flex","flex-col","w-full","overflow-hidden","border-b"],[1,"z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","subscription-sales-status-detail-table","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],["matTooltip","Tipo de devoluci\xf3n",1,"text-center"],[1,"text-left"],[1,"grid","items-center","w-full","gap-4","px-6","py-3","border-b","subscription-sales-status-detail-table","md:px-8"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",7)(1,"div",8)(2,"div",9)(3,"div")(4,"div",10)(5,"div",11)(6,"a",12),e.EFF(7,"Inicio"),e.k0s()(),e.j41(8,"div",11),e.nrm(9,"mat-icon",13),e.j41(10,"a",14),e.EFF(11,"Ventas"),e.k0s()(),e.j41(12,"div",11),e.nrm(13,"mat-icon",13),e.j41(14,"a",14),e.EFF(15,"Registro de Ventas"),e.k0s()()(),e.j41(16,"div",15)(17,"a",16),e.nrm(18,"mat-icon",13),e.j41(19,"span",17),e.EFF(20,"Regresar"),e.k0s()()()()(),e.j41(21,"div",18)(22,"mat-form-field",19),e.nrm(23,"mat-icon",20)(24,"input",21),e.k0s(),e.DNE(25,oq,26,14),e.k0s()(),e.j41(26,"div",22)(27,"div",22),e.qex(28),e.j41(29,"div",23)(30,"div",24)(31,"div",25)(32,"span"),e.EFF(33,"No."),e.k0s()(),e.j41(34,"div",26)(35,"span"),e.EFF(36," Unidad Comercial"),e.k0s(),e.j41(37,"table-filter",27,0),e.bIt("dataChange",function(l){return e.eBV(o),e.Njj(a.addLocation(l))}),e.k0s()(),e.j41(39,"div",26)(40,"span"),e.EFF(41,"Terminal (Caja)"),e.k0s(),e.j41(42,"table-filter",27,1),e.bIt("dataChange",function(l){return e.eBV(o),e.Njj(a.addTerminal(l))}),e.k0s()(),e.j41(44,"div",28)(45,"span"),e.EFF(46,"Fecha"),e.k0s()(),e.j41(47,"div",29)(48,"span",30),e.EFF(49,"Importe"),e.k0s(),e.j41(50,"table-filter",31,2),e.nI1(52,"async"),e.bIt("dataChange",function(l){return e.eBV(o),e.Njj(a.addCurrencies(l))}),e.k0s()(),e.j41(53,"div",32)(54,"span",33),e.EFF(55,"M\xe9todo de pago"),e.k0s(),e.j41(56,"table-filter",31,3),e.nI1(58,"async"),e.bIt("dataChange",function(l){return e.eBV(o),e.Njj(a.addPaymentMethod(l))}),e.k0s()(),e.j41(59,"div",32)(60,"span"),e.EFF(61,"Estado"),e.k0s()(),e.j41(62,"div",34)(63,"span"),e.EFF(64,"Acciones"),e.k0s(),e.j41(65,"button",35),e.bIt("click",function(){return e.eBV(o),e.Njj(a.clearTableFilters())}),e.nrm(66,"mat-icon",36),e.k0s()()(),e.DNE(67,hq,2,0)(68,gq,2,0),e.nrm(69,"mat-paginator",37),e.k0s(),e.bVm(),e.DNE(70,vq,14,0,"ng-template",null,4,e.C5r),e.k0s()()()}2&i&&(e.Y8G("fuseScrollbarOptions",e.lJ4(44,Qz)),e.R7$(9),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("routerLink","./.."),e.R7$(),e.Y8G("svgIcon","mat_solid:chevron_left"),e.R7$(4),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",a.searchInputControl)("autocomplete","off")("placeholder","Escriba para buscar..."),e.R7$(),e.vxM(25,a.user.accessLevel>=3?25:-1),e.R7$(5),e.Y8G("ngClass",e.sMw(45,Jy,1===a.user.accessLevel,2===a.user.accessLevel,3===a.user.accessLevel)),e.R7$(),e.Y8G("mat-sort-header","no"),e.R7$(3),e.Y8G("ngClass",e.eq3(49,Ts,a.user.accessLevel<3)),e.R7$(3),e.Y8G("filterType","filterEntity")("searchEntityControl",a.searchLocationsControl)("entitiesFiltered",a.locationsFiltered),e.R7$(2),e.Y8G("ngClass",e.eq3(51,Ts,1===a.user.accessLevel)),e.R7$(3),e.Y8G("filterType","filterEntity")("searchEntityControl",a.searchTerminalsControl)("entitiesFiltered",a.terminalsFiltered),e.R7$(2),e.Y8G("mat-sort-header","createdAt"),e.R7$(4),e.Y8G("mat-sort-header","total"),e.R7$(2),e.Y8G("filterType","multiSelectEntity")("entityPropertyName","iso")("useUpperCase",!0)("data",e.bMT(52,40,a.currencies$)),e.R7$(6),e.Y8G("filterType","multiSelectEntity")("entityPropertyName","name")("useUpperCase",!1)("data",e.bMT(58,42,a.paymentMethods$)),e.R7$(9),e.Y8G("disabled",!a.existTableFilter()),e.R7$(),e.Y8G("svgIcon","mat_solid:filter_list_off"),e.R7$(),e.vxM(67,a.sales.length>0?67:68),e.R7$(2),e.Y8G("ngClass",e.l_i(53,Jz,a.isLoading,a.pagination.length<10&&a.pagination.page<1))("length",a.pagination.length)("pageIndex",a.pagination.page)("pageSize",a.pagination.size)("pageSizeOptions",e.lJ4(56,Hz))("showFirstLastButtons",!0))},dependencies:[U.Jj,U.vh,U.QX,mr.p,te.Hl,te.$z,te.iY,Z.X6,Z.bU,Z.el,Z.xR,Z.IG,Z.SG,O.RG,O.rl,O.TL,O.JW,O.yw,de.m_,de.An,le.fS,le.fg,ve.Cn,ve.kk,ve.fb,ve.Cp,Ie.Ou,Ie.iy,ot.D6,ot.LG,pe.NQ,pe.B4,pe.aE,De.uc,De.oV,U.YU,Vz.Ov,m.X1,m.me,m.BC,m.cb,m.l_,m.j4,m.JD,ft.Wk,Ys.i,U.Pc],encapsulation:2,data:{animation:zs.X},changeDetection:0})}return t})();const Hy=t=>t.offers,Es=((0,fe.Mz)(Hy,t=>t.offer),(0,fe.Mz)(Hy,t=>t.offers));var Ji=R(67797);let Zy=(()=>{class t{constructor(n,i){this.apolloProvider=n,this.store=i,this._apollo=this.apolloProvider.use("BALANC")}getOffers(n=1,i=50,a="no",o="desc",s=""){return this._apollo.query({query:z2,errorPolicy:"all",variables:{offset:i*(n-1),limit:i,sort:a,order:o,search:s}}).pipe((0,oe.M)(({data:l})=>{this.store.dispatch((0,Ji.qw)({offers:l.findAllOffers.offers})),this.store.dispatch((0,Jr.Bp)({pagination:l.findAllOffers.pagination}))}))}findOfferById(n){return this._apollo.query({query:q2,variables:{findOfferByIdId:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:i})=>{this.store.dispatch((0,Ji.rU)({offer:i.findOfferById.offer}))}))}updateOffer(n){return this.store.select(Es).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:Y2,variables:{updateOfferInput:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:a})=>{const o=(0,ra.A)(i);o[i.findIndex(l=>l.id===n.id)]=a.updateOffer.offer,this.store.dispatch((0,Ji.qw)({offers:o}))}))))}updateOfferStatus(n,i){return this.store.select(Es).pipe((0,Be.s)(1),(0,ce.n)(a=>this._apollo.mutate({mutation:U2,variables:{updateOfferStatusInput:{id:n,status:i}},errorPolicy:"all"}).pipe((0,oe.M)(({data:o})=>{const s=structuredClone(a);s[a.findIndex(c=>c.id===n)]=o.updateOfferStatus.offer,this.store.dispatch((0,Ji.qw)({offers:s}))}))))}removeOffer(n){return this.store.select(Es).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:V2,variables:{removeOfferId:n},errorPolicy:"all"}).pipe((0,oe.M)(()=>{const a=(0,ra.A)(i),o=i.findIndex(s=>s.id===n);a.splice(o,1),this.store.dispatch((0,Ji.qw)({offers:a}))}))))}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(X.Ic),e.KVO(fe.il))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const yq=(t,r)=>r.id,Cq=()=>["/modules/sales/bid"],xq=t=>({"pointer-events-none":t}),Fq=()=>[5,10,25,100],Sq=(t,r,n,i)=>({"bg-amber-50 text-amber-700":t,"text-red-700 bg-red-50":r,"text-orange-700 bg-orange-50":n,"text-green-700 bg-green-50":i});function kq(t,r){1&t&&e.nrm(0,"mat-icon",33),2&t&&e.Y8G("svgIcon","mat_solid:done")}function $q(t,r){1&t&&e.nrm(0,"mat-icon",33),2&t&&e.Y8G("svgIcon","mat_solid:done")}function Iq(t,r){1&t&&e.nrm(0,"mat-icon",33),2&t&&e.Y8G("svgIcon","mat_solid:done")}function wq(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",26)(1,"div",28),e.EFF(2),e.k0s(),e.j41(3,"div",24),e.EFF(4),e.k0s(),e.j41(5,"div",25),e.EFF(6),e.k0s(),e.j41(7,"div",28),e.EFF(8),e.nI1(9,"number"),e.k0s(),e.j41(10,"div",29)(11,"span",30),e.EFF(12),e.nI1(13,"uppercase"),e.k0s()(),e.j41(14,"div",31)(15,"button",32),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.generateOfferDocument(a))}),e.nrm(16,"mat-icon",33),e.k0s(),e.j41(17,"button",34),e.nrm(18,"mat-icon",17),e.k0s(),e.j41(19,"mat-menu",null,0)(21,"div",35),e.EFF(22," Actualizar Estado "),e.k0s(),e.j41(23,"button",36),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.updateStatus(a.id,"aprobada"))}),e.j41(24,"div",37),e.DNE(25,kq,1,1,"mat-icon",33),e.k0s(),e.j41(26,"span",38),e.EFF(27,"Aprobada"),e.k0s()(),e.j41(28,"button",36),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.updateStatus(a.id,"rechazada"))}),e.j41(29,"div",37),e.DNE(30,$q,1,1,"mat-icon",33),e.k0s(),e.j41(31,"span",38),e.EFF(32,"Rechazada"),e.k0s()(),e.j41(33,"button",36),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.updateStatus(a.id,"cancelada"))}),e.j41(34,"div",37),e.DNE(35,Iq,1,1,"mat-icon",33),e.k0s(),e.j41(36,"span",38),e.EFF(37,"Cancelada"),e.k0s()()(),e.j41(38,"button",39),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.removeOffer(a.id))}),e.nrm(39,"mat-icon",33),e.k0s()()()}if(2&t){const n=r.$implicit,i=e.sdS(20);e.R7$(2),e.SpI(" ",n.no," "),e.R7$(2),e.SpI(" ",n.customer.name," "),e.R7$(2),e.SpI(" ",n.currency.iso," "),e.R7$(2),e.SpI(" ",e.i5U(9,16,n.total,"1.2-2")," "),e.R7$(2),e.Y8G("ngClass",e.ziG(21,Sq,"nueva"===n.status,"cancelada"===n.status,"rechazada"===n.status,"aprobada"===n.status)),e.R7$(2),e.SpI(" ",e.bMT(13,19,n.status)," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:description"),e.R7$(),e.Y8G("matMenuTriggerFor",i),e.R7$(),e.Y8G("svgIcon","mat_solid:update"),e.R7$(5),e.Y8G("disabled",n.status.includes("aprobada")||n.status.includes("cancelada")||n.status.includes("rechazada")),e.R7$(2),e.vxM(25,n.status.includes("aprobada")?25:-1),e.R7$(3),e.Y8G("disabled",n.status.includes("aprobada")||n.status.includes("cancelada")||n.status.includes("rechazada")),e.R7$(2),e.vxM(30,n.status.includes("aprobada")?30:-1),e.R7$(3),e.Y8G("disabled",n.status.includes("aprobada")||n.status.includes("cancelada")||n.status.includes("rechazada")),e.R7$(2),e.vxM(35,n.status.includes("aprobada")?35:-1),e.R7$(4),e.Y8G("svgIcon","mat_solid:delete")}}function Rq(t,r){if(1&t&&(e.j41(0,"div",21)(1,"div",22)(2,"div",23),e.EFF(3," N\xfamero "),e.k0s(),e.j41(4,"div",24),e.EFF(5," Cliente "),e.k0s(),e.j41(6,"div",25),e.EFF(7," Moneda "),e.k0s(),e.j41(8,"div",23),e.EFF(9," Importe "),e.k0s(),e.j41(10,"div",25),e.EFF(11," Estado "),e.k0s(),e.j41(12,"div",25),e.EFF(13," Acciones "),e.k0s()(),e.Z7z(14,wq,40,26,"div",26,yq),e.k0s(),e.nrm(16,"mat-paginator",27)),2&t){const n=e.XpG();e.R7$(2),e.Y8G("mat-sort-header","no"),e.R7$(6),e.Y8G("mat-sort-header","total"),e.R7$(6),e.Dyx(n.offers),e.R7$(2),e.Y8G("ngClass",e.eq3(8,xq,n.isLoading))("length",n.pagination.length)("pageIndex",n.pagination.page)("pageSize",n.pagination.size)("pageSizeOptions",e.lJ4(10,Fq))("showFirstLastButtons",!0)}}function Tq(t,r){1&t&&(e.j41(0,"div",40),e.EFF(1," \xa1No se ha registrado ninguna oferta! "),e.k0s())}let Eq=(()=>{class t{constructor(){this.isLoading=!1,this.isSlideLoading=!1,this.merchant=null,this.offers=[],this.searchInputControl=new m.MJ,this.selectedSlide=null,this.user=null,this._changeDetectorRef=(0,e.WQX)(e.gRc),this._documentsService=(0,e.WQX)(hr.Q),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._offersService=(0,e.WQX)(Zy),this._snackBar=(0,e.WQX)(Oe.UG),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.store.select(bn.SW).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.user=n,this._changeDetectorRef.markForCheck()}),this.store.select(At.Xb).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.merchant=n,this._changeDetectorRef.markForCheck()}),this.store.select(Es).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.offers=n,this._changeDetectorRef.markForCheck()}),this.store.select(Mn.Dz).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.pagination=n,this._changeDetectorRef.markForCheck()}),this.searchInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,ce.n)(n=>(this.isLoading=!0,this._offersService.getOffers(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,n))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe()}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"no",start:"desc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,An.h)(this._sort.sortChange,this._paginator.page).pipe((0,ce.n)(()=>(this.isLoading=!0,this._offersService.getOffers(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}updateStatus(n,i){this._fuseConfirmationService.open({title:"Actualizar Estado de la Factura",message:"\xbfEsta seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(o=>{"confirmed"===o&&this._offersService.updateOfferStatus(n,i).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:s})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:s.updateOfferStatus.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}})}),this._changeDetectorRef.markForCheck()})}removeOffer(n){this._fuseConfirmationService.open({title:"Eliminar oferta",message:"\xbfEst\xe1s seguro de que deseas eliminar esta oferta?",actions:{confirm:{label:"S\xed",color:"warn"},cancel:{label:"No"}}}).afterClosed().subscribe(a=>{a&&this._offersService.removeOffer(n).subscribe(({data:o})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:3e3,data:{message:o.removeOffer.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}})})})}generateOfferDocument(n){this._documentsService.generateOfferDocument(n,aa.oferta,this.merchant,this.user)}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-offers"]],viewQuery:function(i,a){if(1&i&&(e.GBs(Ie.iy,5),e.GBs(pe.B4,5)),2&i){let o;e.mGM(o=e.lsd())&&(a._paginator=o.first),e.mGM(o=e.lsd())&&(a._sort=o.first)}},standalone:!0,features:[e.aNF],decls:31,vars:11,consts:[["listStatusMenu","matMenu"],[1,"flex","flex-col","flex-auto","min-w-0","sm:absolute","sm:inset-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","px-6","py-8","border-b","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/desktop",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","sm:leading-10"],[1,"flex","items-center","gap-2","mt-6","shrink-0","lg:mt-0","lg:ml-4"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],[1,""],["mat-raised-button","",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700",3,"routerLink"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[1,"grid"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","offers-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-slate-900"],[1,"hiddem","sm:block",3,"mat-sort-header"],[1,"hiddem","sm:block"],[1,"text-center","hiddem","sm:block"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","offers-grid","md:px-8"],[1,"z-10","border-b","sm:absolute","sm:inset-x-0","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],[1,"font-mono","hiddem","sm:block"],[1,"flex","items-center","justify-center","mr-4","text-center","truncate","delay-100","rounded-full","h-7","lock","dark:bg-white","dark:bg-opacity-5",3,"ngClass"],[1,"w-full","px-2","text-sm","font-medium","text-center"],[1,"flex","flex-row","justify-center","gap-2"],["mat-stroked-button","","matTooltip","Ver oferta",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"icon-size-5",3,"svgIcon"],["mat-stroked-button","","aria-label","Menu de estados","matTooltip","Actualizar Estado",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"matMenuTriggerFor"],[1,"w-full","p-2","text-lg","font-semibold","text-center","text-secondary"],["mat-menu-item","",1,"grid","w-full","grid-cols-4",3,"click","disabled"],[1,"col-span-1"],[1,"col-span-3","text-center"],["mat-stroked-button","","matTooltip","Descargar oferta",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"]],template:function(i,a){1&i&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"a",5),e.EFF(6,"Inicio"),e.k0s()(),e.j41(7,"div",6),e.nrm(8,"mat-icon",7),e.j41(9,"a",8),e.EFF(10,"Ventas"),e.k0s()(),e.j41(11,"div",6),e.nrm(12,"mat-icon",7),e.j41(13,"a",8),e.EFF(14,"Ofertas"),e.k0s()()(),e.j41(15,"div",9)(16,"h2",10),e.EFF(17," Ofertas "),e.k0s()()(),e.j41(18,"div",11)(19,"mat-form-field",12),e.nrm(20,"mat-icon",13)(21,"input",14),e.k0s(),e.nrm(22,"div",15),e.j41(23,"button",16),e.nrm(24,"mat-icon",17),e.j41(25,"span",18),e.EFF(26,"Crear oferta"),e.k0s()()()(),e.j41(27,"div",19)(28,"div",20),e.DNE(29,Rq,17,11)(30,Tq,2,0),e.k0s()()()),2&i&&(e.R7$(8),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(7),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",a.searchInputControl)("autocomplete","off")("placeholder","Escriba para filtrar..."),e.R7$(2),e.Y8G("routerLink",e.lJ4(10,Cq)),e.R7$(),e.Y8G("svgIcon","mat_solid:add"),e.R7$(5),e.vxM(29,a.offers.length>0?29:30))},dependencies:[U.QX,te.Hl,te.$z,O.RG,O.rl,O.JW,de.m_,de.An,le.fS,le.fg,Ie.Ou,Ie.iy,pe.NQ,pe.B4,pe.aE,ve.Cn,ve.kk,ve.fb,ve.Cp,U.YU,m.X1,m.me,m.BC,m.l_,ft.Wk,U.Pc],styles:[".offers-grid{grid-template-columns:150px auto 150px 150px 150px 150px}\n"],encapsulation:2,changeDetection:0})}return t})();const jq=X.J1`
    query FindAllPrebills(
        $page: Int,
        $size: Int,
        $sort: String,
        $order: Order,
        $search: String,
        $customerId: String,
        $currenciesId: [String!],
        $status: [PrebillStatus!],
        $paymentStatus: [PaymentStatus!],
        $billDate: DateTime,
        $startDate: DateTime,
        $endDate: DateTime
    ) {
        findAllPrebills(
            page: $page,
            size: $size,
            sort: $sort,
            order: $order,
            search: $search,
            customerId: $customerId,
            currenciesId: $currenciesId,
            status: $status,
            paymentStatus: $paymentStatus,
            billDate: $billDate,
            startDate: $startDate,
            endDate: $endDate
        ) {
            ok
            message

            pagination {
                length
                size
                page
                lastPage
                startIndex
                endIndex
            }

            prebills {
                id
                no
                createdAt
                currencyId
                isDispatched
                currency {
                    iso
                    namev
                }
                currenciesPercents {
                    cup
                    usd
                }
                operationTypeId
                operationType {
                    name
                }
                paymentMethodId
                paymentMethod {
                    name
                }
                paymentStatus

                ratesId
                rates {
                    name
                    value
                }

                status
                status
                billId

                bill {
                    id
                    no
                }

                customerId
                customer {
                    name
                    code
                    address
                    city
                    state
                   phoneNumber {
                        phoneNumber
                        label
                    }

                    email {
                        email
                        label
                    }
                    nit
                }
                commercial {
                    name
                    lastname1
                    lastname2
                }

                surcharge
                discount
                obs
                subtotal
                total
                totalCup
                totalUsd

                billDate
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                products {
                    productId
                    quantity
                    price

                    product {
                        name
                        uom {
                            name
                            abbr
                        }
                    }
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                vehicle {
                    brand {
                        name
                    }
                    model
                    registrationNumber
                }

                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                    no
                    currencyId
                    currency {
                        iso
                    }
                    beneficiary
                }
            }
        }
    }
`,Dq=X.J1`
    query FindAllPrebillsByDate($date: String!) {
        findAllPrebillsByDate(date: $date) {
            ok
            message

            prebills {
                id
                no
                createdAt
                currencyId
                currency {
                    iso
                    namev
                }
                currenciesPercents {
                    cup
                    usd
                }

                operationTypeId
                operationType {
                    name
                }

                paymentMethodId
                paymentMethod {
                    name
                }
                paymentStatus

                ratesId

                status
                status
                billId

                bill {
                    id
                    no
                }

                customerId
                customer {
                    name
                    code
                    address
                    city
                    state
                   phoneNumber {
                        phoneNumber
                        label
                    }

                    email {
                        email
                        label
                    }
                    nit
                }
                commercial {
                    name
                    lastname1
                    lastname2
                }
                total
                totalCup
                totalUsd
                billDate
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                products {
                    productId
                    quantity
                    price
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }

                services {
                    serviceId
                    quantity
                }
                servicesInBill {
                    id
                    description
                    minPrice
                    maxPrice
                }

                vehicle {
                    model
                    registrationNumber
                }

                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                    no
                    currencyId
                    currency {
                        iso
                    }
                    beneficiary
                }
            }
        }
    }
`,Aq=X.J1`
    query FindBillById($findBillById: String!) {
        findBillById(id: $findBillById) {
            ok
            message

            prebill {
                id
                no
                createdAt
                currencyId
                paymentMethodId
                paymentStatus
                products {
                    productId
                    quantity
                    price
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                status
                status
                billId

                bill {
                    id
                    no
                }

                status
                status
                customerId
                total
                billDate

                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                    no
                    currencyId
                    currency {
                        iso
                    }
                    beneficiary
                }
            }
        }
    }
`,Mq=X.J1`
    mutation CreatePrebill($createPrebillInput: CreateBillInput!) {
        createPrebill(createPrebillInput: $createPrebillInput) {
            ok
            message

            prebill {
                id
                no
                createdAt
                currencyId
                paymentMethodId
                paymentStatus
                products {
                    productId
                    quantity
                    price
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                status
                status
                billId

                bill {
                    id
                    no
                }

                customerId
                total
                userId
                billDate

                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                    no
                    currencyId
                    currency {
                        iso
                    }
                    beneficiary
                }
            }
        }
    }
`,Pq=X.J1`
    mutation UpdatePrebill($updateBillInput: UpdateBillInput!) {
        updatePrebill(updateBillInput: $updateBillInput) {
            ok
            message

            prebill {
                id
                no
                createdAt
                currencyId
                paymentMethodId
                paymentStatus
                products {
                    productId
                    quantity
                    price
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                status
                status
                billId

                bill {
                    id
                    no
                }

                customerId
                total
                userId
                billDate

                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                    no
                    currencyId
                    currency {
                        iso
                    }
                    beneficiary
                }
            }
        }
    }
`,Bq=X.J1`
    mutation UpdatePrebillStatus(
        $updatePrebillStatusInput: UpdateBillStatusInput!
    ) {
        updatePrebillStatus(updatePrebillStatusInput: $updatePrebillStatusInput) {
            ok
            message

            prebill {
                id
                no
                createdAt
                currencyId
                isDispatched
                currency {
                    iso
                    namev
                }
                currenciesPercents {
                    cup
                    usd
                }
                operationTypeId
                operationType {
                    name
                }
                paymentMethodId
                paymentMethod {
                    name
                }
                paymentStatus

                ratesId
                rates {
                    name
                    value
                }

                status
                status
                billId

                bill {
                    id
                    no
                }

                customerId
                customer {
                    name
                    code
                    address
                    city
                    state
                   phoneNumber {
                        phoneNumber
                        label
                    }

                    email {
                        email
                        label
                    }
                    nit
                }
                commercial {
                    name
                    lastname1
                    lastname2
                }

                surcharge
                discount
                obs
                subtotal
                total
                totalCup
                totalUsd

                billDate
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                products {
                    productId
                    quantity
                    price

                    product {
                        name
                        uom {
                            name
                            abbr
                        }
                    }
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                    no
                    currencyId
                    currency {
                        iso
                    }
                    beneficiary
                }
            }
        }
    }
`,Oq=X.J1`
    mutation RemovePrebill($removeBillId: String!) {
        removePrebill(id: $removeBillId) {
            ok
            message
        }
    }
`,Nq=X.J1`
    mutation DispatchPrebill($billId: String!) {
        dispatchPrebill(id: $billId) {
            ok
            message

            prebill {
                id
                no
                createdAt
                isDispatched
                currencyId
                currency {
                    iso
                    namev
                }
                currenciesPercents {
                    cup
                    usd
                }
                operationTypeId
                operationType {
                    name
                }
                paymentMethodId
                paymentMethod {
                    name
                }
                paymentStatus

                ratesId
                rates {
                    name
                    value
                }

                status
                status
                billId

                bill {
                    id
                    no
                }

                customerId
                customer {
                    name
                    code
                    address
                    city
                    state
                   phoneNumber {
                        phoneNumber
                        label
                    }

                    email {
                        email
                        label
                    }
                    nit
                }
                commercial {
                    name
                    lastname1
                    lastname2
                }

                surcharge
                discount
                obs
                subtotal
                total
                totalCup
                totalUsd

                billDate
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                products {
                    productId
                    quantity
                    price

                    product {
                        name
                        uom {
                            name
                            abbr
                        }
                    }
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                    no
                    currencyId
                    currency {
                        iso
                    }
                    beneficiary
                }
            }
        }
    }
`,Gq=X.J1`
    mutation GeneratePrebill($billId: String!) {
        generateBillFromPrebill(id: $billId) {
            ok
            message

            prebill {
                id
                no
                createdAt
                isDispatched
                currencyId
                currency {
                    iso
                    namev
                }
                currenciesPercents {
                    cup
                    usd
                }
                operationTypeId
                operationType {
                    name
                }
                paymentMethodId
                paymentMethod {
                    name
                }
                paymentStatus

                ratesId
                rates {
                    name
                    value
                }

                status
                status
                billId

                bill {
                    id
                    no
                }

                customerId
                customer {
                    name
                    code
                    address
                    city
                    state
                   phoneNumber {
                        phoneNumber
                        label
                    }

                    email {
                        email
                        label
                    }
                    nit
                }
                commercial {
                    name
                    lastname1
                    lastname2
                }

                surcharge
                discount
                obs
                subtotal
                total
                totalCup
                totalUsd

                billDate
                user {
                    name
                    lastname1
                    lastname2
                    fullname
                }
                products {
                    productId
                    quantity
                    price

                    product {
                        name
                        uom {
                            name
                            abbr
                        }
                    }
                }
                assistances {
                    assistanceId
                    quantity
                    price

                    assistance {
                        description
                        uom {
                            name
                            abbr
                        }
                    }
                }
                courierId
                courier {
                    id
                    name
                    fullname
                    idNumber
                }

                bankAccount {
                    no
                    currencyId
                    currency {
                        iso
                    }
                    beneficiary
                }
            }
        }
    }
`;let Lq=(()=>{class t{constructor(n,i){this.apolloProvider=n,this._snackBar=i,this._apollo=this.apolloProvider.use("BALANC")}createPrebill(n){return this._apollo.mutate({mutation:Mq,variables:{createPrebillInput:n},errorPolicy:"all"}).pipe((0,oe.M)(({errors:i})=>{if(i){let a="";i.forEach(o=>a+=`\n ${o.message}.`),this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:a,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}}))}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(X.Ic),e.KVO(Oe.UG))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const Hi=(t,r)=>r.id,Yq=()=>({suppressScrollX:!0}),Ky=()=>({suppressScrollY:!0}),e2=t=>({"text-warn":t}),t2=()=>["$"],n2=t=>({"cursor-pointer shadow":t});function Vq(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-checkbox",16),e.mxI("ngModelChange",function(a){e.eBV(n);const o=e.XpG();return e.DH7(o.billProducts,a)||(o.billProducts=a),e.Njj(a)}),e.EFF(1,"Productos"),e.k0s(),e.j41(2,"mat-checkbox",16),e.mxI("ngModelChange",function(a){e.eBV(n);const o=e.XpG();return e.DH7(o.billAssistances,a)||(o.billAssistances=a),e.Njj(a)}),e.EFF(3,"Servicios"),e.k0s()}if(2&t){const n=e.XpG();e.R50("ngModel",n.billProducts),e.R7$(2),e.R50("ngModel",n.billAssistances)}}function zq(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",39),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.selectCustomer(a))}),e.EFF(1),e.k0s()}if(2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",n.name," ")}}function qq(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," La fecha de la Prefactura es obligatoria "),e.k0s())}function Uq(t,r){1&t&&(e.j41(0,"mat-option",25),e.EFF(1," x1 "),e.k0s()),2&t&&e.Y8G("value",1)}function Xq(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.value),e.R7$(),e.SpI(" x",n.value," ")}}function Wq(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El multiplicador es obligatorio "),e.k0s())}function Qq(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function Jq(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El tipo de comprobante es obligatorio "),e.k0s())}function Hq(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function Zq(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El tipo de operaci\xf3n es obligatorio "),e.k0s())}function Kq(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",39),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG();return e.Njj(o.selectedCurrencyIso=a.iso)}),e.EFF(1),e.k0s()}if(2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.iso," ")}}function eU(t,r){if(1&t&&(e.j41(0,"span",32),e.EFF(1),e.k0s()),2&t){let n;const i=e.XpG();e.R7$(),e.Lme(" (+ ",2===(null==(n=i.prebillingForm.get("rates").value)?null:n.length)?"otro":"otros"," ",i.prebillingForm.get("rates").value.length>2?i.prebillingForm.get("rates").value.length-1:"",") ")}}function tU(t,r){if(1&t&&(e.j41(0,"mat-option",25)(1,"span",40),e.EFF(2),e.nI1(3,"number"),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(2),e.JRh(e.i5U(3,3,n.value,"1.4-4")),e.R7$(3),e.SpI(" ",n.name,"")}}function nU(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," Las tasas de cambio son requeridas "),e.k0s())}function rU(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.Lme(" ",n.no," ",n.currency.iso," ")}}function iU(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," La cuenta bancaria es obligatorio "),e.k0s())}function aU(t,r){if(1&t&&(e.j41(0,"mat-option",25),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function oU(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",49),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addProductToBill(o),e.Njj(a.stopPropagation())}),e.j41(1,"div",50),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addProductToBill(o),e.Njj(a.stopPropagation())}),e.j41(2,"span",51),e.nrm(3,"mat-checkbox",52),e.EFF(4),e.k0s(),e.j41(5,"span",53),e.EFF(6),e.k0s(),e.j41(7,"span",54),e.EFF(8),e.nI1(9,"number"),e.k0s()()()}if(2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(3),e.Y8G("checked",n.checked),e.R7$(),e.SpI(" ",n.name," "),e.R7$(2),e.JRh(n.depot),e.R7$(2),e.Lme("",e.i5U(9,6,n.quantity,"1.2-2")," ",n.uom,"")}}function sU(t,r){1&t&&(e.j41(0,"mat-error",68),e.EFF(1," Valor m\xednimo 0.1 "),e.k0s())}function lU(t,r){if(1&t&&(e.j41(0,"mat-error",68),e.EFF(1),e.k0s()),2&t){const n=e.XpG().$implicit;e.R7$(),e.SpI(" Valor m\xe1ximo ",n.quantity," ")}}function cU(t,r){1&t&&(e.j41(0,"mat-error",68),e.EFF(1," Patr\xf3n no v\xe1lido "),e.k0s())}function uU(t,r){1&t&&(e.j41(0,"mat-error",68),e.EFF(1," Valor m\xednimo 0 "),e.k0s())}function dU(t,r){1&t&&(e.j41(0,"mat-error",68),e.EFF(1," Valor requerido "),e.k0s())}function fU(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",59)(1,"div"),e.EFF(2),e.k0s(),e.j41(3,"div",60),e.EFF(4),e.k0s(),e.j41(5,"div",61),e.EFF(6),e.k0s(),e.j41(7,"div",57),e.EFF(8),e.nI1(9,"number"),e.k0s(),e.j41(10,"div",62)(11,"div",63)(12,"button",64),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.decrementProductQty(a))}),e.nrm(13,"mat-icon",65),e.k0s(),e.j41(14,"mat-form-field",66),e.nrm(15,"input",67),e.k0s(),e.j41(16,"button",64),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.incrementProductQty(a))}),e.nrm(17,"mat-icon",65),e.k0s()(),e.DNE(18,sU,2,0,"mat-error",68)(19,lU,2,1,"mat-error",68)(20,cU,2,0,"mat-error",68),e.k0s(),e.j41(21,"div",69)(22,"mat-form-field",66),e.nrm(23,"input",70),e.k0s(),e.DNE(24,uU,2,0,"mat-error",68)(25,dU,2,0,"mat-error",68),e.k0s(),e.j41(26,"div",71),e.EFF(27),e.k0s(),e.j41(28,"div",72),e.EFF(29),e.nI1(30,"currency"),e.k0s(),e.j41(31,"div",73)(32,"button",74),e.bIt("click",function(){const a=e.eBV(n).$index,o=e.XpG(3);return e.Njj(o.removeProductToBill(a))}),e.nrm(33,"mat-icon",65),e.k0s()()()}if(2&t){const n=r.$implicit,i=r.$index,a=e.XpG(3);e.R7$(2),e.SpI(" ",i+1," "),e.R7$(),e.Y8G("matTooltip",n.get("name").value),e.R7$(),e.SpI(" ",n.get("name").value," "),e.R7$(2),e.SpI(" ",n.get("depot").value," "),e.R7$(2),e.Lme(" ",e.i5U(9,27,n.get("stock").value,"1.2-2")," ",n.get("uom").value," "),e.R7$(4),e.Y8G("disabled",n.get("quantity").value<=.1||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:remove"),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",.1)("max",n.get("stock").value)("formControl",n.get("quantity")),e.R7$(),e.Y8G("disabled",n.get("quantity").value>=n.get("stock").value||n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:add"),e.R7$(),e.vxM(18,n.get("quantity").hasError("min")?18:-1),e.R7$(),e.vxM(19,n.get("quantity").hasError("max")?19:-1),e.R7$(),e.vxM(20,n.get("quantity").hasError("pattern")&&!n.get("quantity").hasError("min")?20:-1),e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",0)("max",9999999)("formControl",n.get("price")),e.R7$(),e.vxM(24,n.get("price").hasError("min")?24:-1),e.R7$(),e.vxM(25,n.get("price").hasError("required")?25:-1),e.R7$(),e.Y8G("ngClass",e.eq3(33,e2,!n.get("rate").value)),e.R7$(),e.SpI(" ",n.get("rate").value?a.selectedCurrencyIso:n.get("currency").value," "),e.R7$(2),e.SpI(" ",e.i5U(30,30,n.get("pt").value,e.lJ4(35,t2))," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:close")}}function mU(t,r){if(1&t&&(e.j41(0,"div",47)(1,"div",55),e.nrm(2,"div"),e.j41(3,"div",56),e.EFF(4," Producto "),e.k0s(),e.j41(5,"div",56),e.EFF(6," Almac\xe9n "),e.k0s(),e.j41(7,"div",57),e.EFF(8," Disponibilidad "),e.k0s(),e.j41(9,"div",57),e.EFF(10," Cantidad "),e.k0s(),e.j41(11,"div",57),e.EFF(12," Precio "),e.k0s(),e.j41(13,"div",57),e.EFF(14," Moneda "),e.k0s(),e.j41(15,"div",58),e.EFF(16," Total "),e.k0s(),e.j41(17,"div",57),e.EFF(18," Quitar "),e.k0s()(),e.Z7z(19,fU,34,36,"div",59,Hi),e.k0s()),2&t){const n=e.XpG(2);e.R7$(19),e.Dyx(n.prebillingForm.get("products").controls)}}function pU(t,r){1&t&&(e.j41(0,"div",75),e.EFF(1," \xa1No ha seleccionado ning\xfan producto a\xfan! "),e.k0s())}function hU(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",76),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.createPrebill())}),e.EFF(1),e.nI1(2,"number"),e.k0s()}if(2&t){const n=e.XpG(2);e.Y8G("ngClass",e.eq3(6,n2,n.prebillingForm.valid&&n.prebillingForm.get("products").controls.length>0)),e.R7$(),e.Lme(" ",e.i5U(2,3,n.total-n.prebillingForm.get("discount").value+n.prebillingForm.get("surcharge").value,"1.2-2")," ",n.selectedCurrencyIso," ")}}function gU(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",38)(1,"div",41)(2,"mat-form-field",42),e.nrm(3,"mat-icon",22)(4,"input",43),e.j41(5,"mat-autocomplete",44,3),e.bIt("closed",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.searchProductControl.reset())}),e.Z7z(7,oU,10,9,"mat-option",45,e.fX1),e.nI1(9,"async"),e.k0s()(),e.j41(10,"div",46),e.DNE(11,mU,21,0,"div",47)(12,pU,2,0),e.k0s()(),e.DNE(13,hU,3,8,"div",48),e.k0s()}if(2&t){const n=e.sdS(6),i=e.XpG();e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",i.searchProductControl)("matAutocomplete",n)("placeholder","Buscar existencia de productos en inventario"),e.R7$(),e.Y8G("displayWith",i.displayFn),e.R7$(2),e.Dyx(e.bMT(9,9,i.productsFiltered)),e.R7$(3),e.Y8G("fuseScrollbarOptions",e.lJ4(11,Ky)),e.R7$(),e.vxM(11,i.prebillingForm.get("products").controls.length>0?11:12),e.R7$(2),e.vxM(13,i.billAssistances?-1:13)}}function bU(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-option",49),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addAssistanceToBill(o),e.Njj(a.stopPropagation())}),e.j41(1,"div",50),e.bIt("click",function(a){const o=e.eBV(n).$implicit;return e.XpG(2).addAssistanceToBill(o),e.Njj(a.stopPropagation())}),e.j41(2,"span",51),e.nrm(3,"mat-checkbox",52),e.EFF(4),e.k0s()()()}if(2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(3),e.Y8G("checked",n.checked),e.R7$(),e.SpI(" ",n.description," ")}}function vU(t,r){1&t&&(e.j41(0,"mat-error",68),e.EFF(1," Valor m\xednimo 1 "),e.k0s())}function _U(t,r){1&t&&(e.j41(0,"mat-error",68),e.EFF(1," Patr\xf3n no v\xe1lido "),e.k0s())}function yU(t,r){1&t&&(e.j41(0,"mat-error",68),e.EFF(1," Valor m\xednimo 0 "),e.k0s())}function CU(t,r){1&t&&(e.j41(0,"mat-error",68),e.EFF(1," Valor requerido "),e.k0s())}function xU(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",79)(1,"div"),e.EFF(2),e.k0s(),e.j41(3,"div",60),e.EFF(4),e.k0s(),e.j41(5,"div",62)(6,"div",63)(7,"button",80),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.decrementAssistanceQty(a))}),e.nrm(8,"mat-icon",65),e.k0s(),e.j41(9,"mat-form-field",66),e.nrm(10,"input",81),e.k0s(),e.j41(11,"button",64),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.incrementAssistanceQty(a))}),e.nrm(12,"mat-icon",65),e.k0s()(),e.DNE(13,vU,2,0,"mat-error",68)(14,_U,2,0,"mat-error",68),e.k0s(),e.j41(15,"div",69)(16,"mat-form-field",66),e.nrm(17,"input",70),e.k0s(),e.DNE(18,yU,2,0,"mat-error",68)(19,CU,2,0,"mat-error",68),e.k0s(),e.j41(20,"div",71),e.EFF(21),e.k0s(),e.j41(22,"div",72),e.EFF(23),e.nI1(24,"currency"),e.k0s(),e.j41(25,"div",73)(26,"button",74),e.bIt("click",function(){const a=e.eBV(n).$index,o=e.XpG(3);return e.Njj(o.removeAssistanceToBill(a))}),e.nrm(27,"mat-icon",65),e.k0s()()()}if(2&t){const n=r.$implicit,i=r.$index,a=e.XpG(3);e.R7$(2),e.SpI(" ",i+1," "),e.R7$(),e.Y8G("matTooltip",n.get("description").value),e.R7$(),e.SpI(" ",n.get("description").value," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:remove"),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",1)("formControl",n.get("quantity")),e.R7$(),e.Y8G("disabled",n.get("quantity").hasError("pattern")),e.R7$(),e.Y8G("svgIcon","mat_solid:add"),e.R7$(),e.vxM(13,n.get("quantity").hasError("min")?13:-1),e.R7$(),e.vxM(14,n.get("quantity").hasError("pattern")&&!n.get("quantity").hasError("min")?14:-1),e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("min",0)("max",9999999)("formControl",n.get("price")),e.R7$(),e.vxM(18,n.get("price").hasError("min")?18:-1),e.R7$(),e.vxM(19,n.get("price").hasError("required")?19:-1),e.R7$(),e.Y8G("ngClass",e.eq3(24,e2,!n.get("rate").value)),e.R7$(),e.SpI(" ",n.get("rate").value?a.selectedCurrencyIso:n.get("currency").value," "),e.R7$(2),e.SpI(" ",e.i5U(24,21,n.get("pt").value,e.lJ4(26,t2))," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:close")}}function FU(t,r){if(1&t&&(e.j41(0,"div",47)(1,"div",78),e.nrm(2,"div"),e.j41(3,"div",56),e.EFF(4," Servicio "),e.k0s(),e.j41(5,"div",57),e.EFF(6," Cantidad "),e.k0s(),e.j41(7,"div",57),e.EFF(8," Precio "),e.k0s(),e.j41(9,"div",57),e.EFF(10," Moneda "),e.k0s(),e.j41(11,"div",58),e.EFF(12," Total "),e.k0s(),e.j41(13,"div",57),e.EFF(14," Quitar "),e.k0s()(),e.Z7z(15,xU,28,27,"div",79,Hi),e.k0s()),2&t){const n=e.XpG(2);e.R7$(15),e.Dyx(n.prebillingForm.get("assistances").controls)}}function SU(t,r){1&t&&(e.j41(0,"div",75),e.EFF(1," \xa1No ha seleccionado ning\xfan servicio a\xfan! "),e.k0s())}function kU(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",38)(1,"div",41)(2,"mat-form-field",42),e.nrm(3,"mat-icon",22)(4,"input",43),e.j41(5,"mat-autocomplete",44,4),e.bIt("closed",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.searchAssistanceControl.reset())}),e.Z7z(7,bU,5,3,"mat-option",45,e.fX1),e.nI1(9,"async"),e.k0s()(),e.j41(10,"div",77),e.DNE(11,FU,17,0,"div",47)(12,SU,2,0),e.k0s()(),e.j41(13,"div",76),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.createPrebill())}),e.EFF(14),e.nI1(15,"number"),e.k0s()()}if(2&t){const n=e.sdS(6),i=e.XpG();e.R7$(2),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",i.searchAssistanceControl)("matAutocomplete",n)("placeholder","Buscar servicios en el cat\xe1logo del negocio"),e.R7$(),e.Y8G("displayWith",i.displayFnAssistance),e.R7$(2),e.Dyx(e.bMT(9,11,i.assistancesFiltered)),e.R7$(3),e.Y8G("fuseScrollbarOptions",e.lJ4(16,Ky)),e.R7$(),e.vxM(11,i.prebillingForm.get("assistances").controls.length>0?11:12),e.R7$(2),e.Y8G("ngClass",e.eq3(17,n2,i.prebillingForm.valid)),e.R7$(),e.Lme(" ",e.i5U(15,13,i.total-i.prebillingForm.get("discount").value+i.prebillingForm.get("surcharge").value,"1.2-2")," ",i.selectedCurrencyIso," ")}}let $U=(()=>{class t{constructor(){this.assistances=[],this.assistances$=(0,ie.of)([]),this.audio=new Audio("./assets/sounds/caja.mp3"),this.bankAccounts=[],this.billAssistances=!1,this.billProducts=!1,this.currencies=[],this.employees$=(0,ie.of)([]),this.maxDate=new Date,this.merchant=null,this.multipliers$=(0,ie.of)([]),this.operationTypes=[],this.paymentMethods=[],this.previewsAssistancesFormData=[],this.previewsProductsFormData=[],this.productsInStock=[],this.rates=[],this.searchAssistanceControl=new m.MJ(""),this.searchCustomerControl=new m.MJ(null),this.searchProductControl=new m.MJ(null),this.selectedCurrencyIso="",this.selectedCustomerName="",this.stayHere=!1,this.total=0,this._changeDetectorRef=(0,e.WQX)(e.gRc),this._customersService=(0,e.WQX)(Zr.h),this._destroyRef=(0,e.WQX)(e.abz),this._formBuilder=(0,e.WQX)(m.ok),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._prebillingService=(0,e.WQX)(Lq),this._ratesService=(0,e.WQX)(Os.f),this._router=(0,e.WQX)(ft.Ix),this._snackBar=(0,e.WQX)(Oe.UG),this._stocksService=(0,e.WQX)(Bs.t),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.prebillingForm=this._formBuilder.group({id:new m.MJ,billDate:new m.MJ(new Date,[m.k0.required]),multiplier:new m.MJ(1,[m.k0.required,m.k0.min(1)]),currencyId:new m.MJ(null,[m.k0.required]),courierId:new m.MJ(null),customerId:new m.MJ("",[m.k0.required]),bankAccountId:new m.MJ(null,[m.k0.required]),operationTypeId:new m.MJ(null,[m.k0.required]),paymentMethodId:new m.MJ(null,[m.k0.required]),rates:new m.MJ([],[m.k0.required]),surcharge:new m.MJ(0,[m.k0.required,m.k0.min(0)]),discount:new m.MJ(0,[m.k0.required,m.k0.min(0)]),obs:new m.MJ("",[m.k0.maxLength(5e4)]),products:new m.Yp([]),assistances:new m.Yp([])}),this.store.select(At.Xb).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.merchant=n,this.bankAccounts=n.bankAccounts,Re.H.IsNullOrEmpty(n.bankAccounts)||this.prebillingForm.get("bankAccountId").setValue(n.bankAccounts[0].id),this._changeDetectorRef.markForCheck()}),this.prebillingForm.get("products").valueChanges.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this._verifyChanges(n,this.previewsProductsFormData)&&this.calcAllProductPrice(this.prebillingForm.get("multiplier").value),this.previewsProductsFormData=[...n],this._calculateBillTotal(),this._changeDetectorRef.markForCheck()}),this.prebillingForm.get("assistances").valueChanges.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this._verifyChanges(n,this.previewsAssistancesFormData)&&this._calcAllAssistancePrice(this.prebillingForm.get("multiplier").value),this.previewsAssistancesFormData=[...n],this._calculateBillTotal(),this._changeDetectorRef.markForCheck()}),this.store.select(Pn.y$).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.currencies=n,Re.H.IsNullOrEmpty(n)||setTimeout(()=>{const i=n.find(a=>a.id===this.merchant.currencyId);this.prebillingForm.get("currencyId").setValue(i.id)},500),this._changeDetectorRef.markForCheck()}),this.employees$=this.store.select(Ns.OB),this.multipliers$=this.store.select(Ps.DC),this.customers$=this.store.select(Ms.wQ),this.store.select(Gs.xi).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{if(this.paymentMethods=n,!Re.H.IsNullOrEmpty(n)){const i=n.find(a=>"Efectivo"===a.name);this.prebillingForm.get("paymentMethodId").setValue(i?i.id:n[0].id)}this._changeDetectorRef.markForCheck()}),this.store.select(vf.nK).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.operationTypes=n,Re.H.IsNullOrEmpty(n)||this.prebillingForm.get("operationTypeId").setValue(n[0].id),this._changeDetectorRef.markForCheck()}),this.productsInStock$=this.store.select(fr.IP),this.store.select(fr.IP).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.productsInStock=n,n.length>0&&(this.billProducts=!0),this._changeDetectorRef.markForCheck()}),this.assistances$=this.store.select(It),this.store.select(It).pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.assistances=n,n.length>0&&(this.billAssistances=!0),this._changeDetectorRef.markForCheck()}),this.ratesFiltered=this.prebillingForm.get("currencyId").valueChanges.pipe((0,Ne.Z)(null),(0,Qe.Z)(n=>{if(n){const i=this.currencies.find(a=>a.id===n);return this.selectedCurrencyIso=i.iso,i&&(this.bankAccounts=this.merchant.bankAccounts.filter(a=>a.currencyId===i.id)),this.bankAccounts.length>0&&this.prebillingForm.get("bankAccountId").setValue(this.bankAccounts[0].id),this._ratesService.findActiveByBaseId(n)}return(0,ie.of)([])})),this.ratesFiltered.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.rates=n,this._resetSelectedProductsRates(),this._resetSelectedAssistancesRates(),this.updateSelectedRates()}),this.prebillingForm.get("rates").valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(500)).subscribe(n=>{this._resetSelectedProductsRates(),this._resetSelectedAssistancesRates()}),this.prebillingForm.get("multiplier").valueChanges.pipe((0,we.pQ)(this._destroyRef)).subscribe(n=>{this.calcAllProductPrice(n),this._calculateBillTotal()}),this.productsFiltered=this.searchProductControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>this._mapChecked(null!==n&&"string"==typeof n?this._stocksService.getProductsInStockAvailable(n,10):this.productsInStock$))),this.assistancesFiltered=this.searchAssistanceControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>{const i=this.assistances.filter(a=>a.description.includes(n));return this._mapCheckedAssistances(null!==n&&"string"==typeof n?(0,ie.of)(i):this.assistances$)})),this.customersFiltered=this.searchCustomerControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>null!==n&&"string"==typeof n&&n!==this.selectedCustomerName?this._customersService.findActiveCustomers(n.trim()):this.customers$))}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}displayFn(n){return n&&n.name?n.name:""}displayFnAssistance(n){return n&&n.description?n.description:""}selectCustomer(n){this.prebillingForm.get("customerId").setValue(n.id),this.selectedCustomerName=n.name}addStockProduct(n){const i=this.prebillingForm.get("currencyId").value,a=structuredClone(this.prebillingForm.get("rates").value);let o=a.find(c=>c.currencyBaseId===i&&c.currencyRefId===n.currencyId);!o&&i!==n.currencyId&&(o=a.find(c=>c.currencyRefId===i&&c.currencyRefId!==c.currencyBaseId),o&&(o.value=1/o.value));const s=this.prebillingForm.get("multiplier").value,l=this._formBuilder.group({productId:new m.MJ(n.productId,[m.k0.required]),currencyId:new m.MJ(n.currencyId,[m.k0.required]),name:new m.MJ(n.name,[m.k0.required]),staticPrice:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),price:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),multiplier:new m.MJ(s),pt:new m.MJ(0),uom:new m.MJ(n.uom,[m.k0.required]),depotId:new m.MJ(n.depotId,[m.k0.required]),depot:new m.MJ(n.depot,[m.k0.required]),currency:new m.MJ(n.currency,[m.k0.required]),stock:new m.MJ(n.quantity,[m.k0.required]),rateId:new m.MJ(o?o.id:null,[m.k0.required]),rate:new m.MJ(o?o.value:null,[m.k0.required]),quantity:new m.MJ(1,[Je.t.onlyNumbersPattern(),m.k0.required,m.k0.min(.1),m.k0.max(n.quantity)])});this.prebillingForm.get("products").push(l),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}removeStockProduct(n){this.prebillingForm.get("products").removeAt(n),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}addProductToBill(n){const i=this.prebillingForm.get("products").getRawValue().findIndex(a=>a.productId===n.productId&&a.depotId===n.depotId);n.checked?(this.removeStockProduct(i),n.checked=!1):n.checked=!0,!(i>-1)&&this.addStockProduct(n)}incrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(+i+1)}decrementProductQty(n){const i=n.get("quantity").value;n.get("quantity").setValue(+i-1)}removeProductToBill(n){this.removeStockProduct(n),this.searchProductControl.reset()}addAssistance(n){const i=this.prebillingForm.get("currencyId").value,a=structuredClone(this.prebillingForm.get("rates").value);let o=a.find(c=>c.currencyBaseId===i&&c.currencyRefId===n.currencyId);!o&&i!==n.currencyId&&(o=a.find(c=>c.currencyRefId===i&&c.currencyRefId!==c.currencyBaseId),o&&(o.value=1/o.value));const s=this.prebillingForm.get("multiplier").value,l=this._formBuilder.group({assistanceId:new m.MJ(n.id,[m.k0.required]),currencyId:new m.MJ(n.currencyId,[m.k0.required]),description:new m.MJ(n.description,[m.k0.required]),staticPrice:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),price:new m.MJ(Number(((o?o.value:1)*n.price).toFixed(2)),[m.k0.required,m.k0.min(0),m.k0.max(99999999)]),multiplier:new m.MJ(s),quantity:new m.MJ(1,[Je.t.onlyNumbersPattern(),m.k0.required,m.k0.min(1)]),pt:new m.MJ(0),currency:new m.MJ(n.currency.iso,[m.k0.required]),rateId:new m.MJ(o?o.id:null,[m.k0.required]),rate:new m.MJ(o?o.value:null,[m.k0.required])});this.prebillingForm.get("assistances").push(l),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}removeAssistance(n){this.prebillingForm.get("assistances").removeAt(n),this.updateSelectedRates(),this._changeDetectorRef.markForCheck()}addAssistanceToBill(n){const i=this.prebillingForm.get("assistances").getRawValue().findIndex(a=>a.assistanceId===n.id);n.checked?(this.removeAssistance(i),n.checked=!1):n.checked=!0,!(i>-1)&&this.addAssistance(n)}incrementAssistanceQty(n){let i=n.get("quantity").value;n.get("quantity").setValue(++i)}decrementAssistanceQty(n){let i=n.get("quantity").value;n.get("quantity").setValue(--i)}removeAssistanceToBill(n){this.removeAssistance(n),this.searchAssistanceControl.reset()}createPrebill(){if(this.prebillingForm.invalid)return;const n=this.prebillingForm.getRawValue();delete n.id;const i=[],a=[];n.ratesId=n.products.map(s=>s.rateId).filter((s,l,c)=>c.indexOf(s)===l);for(const s of n.products)i.push(this._mapProductToBill(s));for(const s of n.assistances)a.push(this._mapAssistanceToBill(s));n.products=i,n.assistances=a,n.subtotal=this.total,delete n.rates,this._fuseConfirmationService.open({title:"Generar prefactura",message:"\xbfEst\xe1 seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,we.pQ)(this._destroyRef)).subscribe(s=>{"confirmed"===s&&this._prebillingService.createPrebill(n).pipe((0,T.Q)(this._unsubscribeAll),(0,bt.j)(()=>{this._changeDetectorRef.markForCheck()})).subscribe(({data:l})=>{l&&(this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{title:"Confirmaci\xf3n",message:l.createPrebill.message,type:"success",svgIcon:"mat_solid:done"}}),this.audio.play(),this.stayHere?this.restoreForm():this._router.navigateByUrl("/modules/sales/prebills"))})})}restoreForm(){const n=this.prebillingForm.get("paymentMethodId").value,i=this.prebillingForm.get("operationTypeId").value,a=this.prebillingForm.get("multiplier").value;if(this.prebillingForm.get("products").clear(),this.searchCustomerControl.reset(),this.prebillingForm.reset(),this.total=0,this.selectedCustomerName="",this.searchProductControl.setValue(""),this.prebillingForm.get("paymentMethodId").setValue(n),this.prebillingForm.get("operationTypeId").setValue(i),this.prebillingForm.get("multiplier").setValue(a),this.prebillingForm.get("billDate").setValue(new Date),this.prebillingForm.get("observation").setValue(""),this.prebillingForm.get("surcharge").setValue(0),this.prebillingForm.get("discount").setValue(0),Re.H.IsNullOrEmpty(this.merchant.bankAccounts)||(this.bankAccounts=this.merchant.bankAccounts,this.prebillingForm.get("bankAccountId").setValue(this.merchant.bankAccounts[0].id)),!Re.H.IsNullOrEmpty(this.currencies)){const o=this.currencies.find(s=>s.id===this.merchant.currencyId);this.prebillingForm.get("currencyId").setValue(o.id)}}_mapProductToBill(n){const{productId:i,price:a,depotId:o,quantity:s}=n,l=new On.tz(i,"","",Number(a.toFixed(2)),Number(Number(s).toFixed(4)),o);return delete l.name,delete l.uom,l}_calculateBillTotal(){const n=this.prebillingForm.get("products").getRawValue().map(a=>Number(a.quantity)*a.price).reduce((a,o)=>a+o,0),i=this.prebillingForm.get("assistances").getRawValue().map(a=>Number(a.quantity)*a.price).reduce((a,o)=>a+o,0);this.total=Number(n.toFixed(2))+Number(i.toFixed(2))}_mapChecked(n){return n.pipe((0,Fe.T)(i=>i.map(a=>this.prebillingForm.get("products").getRawValue().some(s=>s.productId===a.productId&&s.depotId===a.depotId)?{...structuredClone(a),checked:!0}:{...structuredClone(a),checked:!1})))}_mapCheckedAssistances(n){return n.pipe((0,Fe.T)(i=>i.map(a=>this.prebillingForm.get("assistances").getRawValue().some(s=>s.id===a.id)?{...structuredClone(a),checked:!0}:{...structuredClone(a),checked:!1})))}_mapAssistanceToBill(n){const{assistanceId:i,price:a,quantity:o}=n;return new On.At(i,a,o)}_resetSelectedProductsRates(){const n=this.prebillingForm.get("currencyId").value,i=this.prebillingForm.get("multiplier").value;for(const a of this.prebillingForm.get("products").controls){const o=a.getRawValue(),s=structuredClone(this.prebillingForm.get("rates").value);let l=s.find(p=>p.currencyBaseId===n&&p.currencyRefId===o.currencyId);!l&&n!==o.currencyId&&(l=s.find(p=>p.currencyRefId===n&&p.currencyRefId!==p.currencyBaseId),l&&(l.value=1/l.value));let c=l?l.value:null;const u=a.get("price").value,d=a.get("staticPrice").value;let f=a.get("rate").value?a.get("rate").value:1;f&&c===f&&(f=1,c=1),a.patchValue({...o,price:(c?u*c:1*u/f)*i,staticPrice:c?d*c:1*d/f,multiplier:i,rate:l?l.value:null,rateId:l?l.id:null})}this._changeDetectorRef.markForCheck()}_calcAllAssistancePrice(n){const i=this.prebillingForm.get("assistances").getRawValue();this.previewsAssistancesFormData=[...i];for(const a of this.prebillingForm.get("assistances").controls){const o=a.getRawValue();let s=o.price/o.multiplier!==o.staticPrice?o.price:o.staticPrice,l=Number((s*n).toFixed(2));n===o.multiplier&&(l=Number((+o.price).toFixed(2)),s=o.price/n),a.patchValue({...o,staticPrice:s,price:l,pt:l*Number(o.quantity),multiplier:n})}}calcAllProductPrice(n){const i=this.prebillingForm.get("products").getRawValue();this.previewsProductsFormData=[...i];for(const a of this.prebillingForm.get("products").controls){const o=a.getRawValue();let s=o.price/o.multiplier!==o.staticPrice?o.price:o.staticPrice,l=Number((s*n).toFixed(2));n===o.multiplier&&(l=Number((+o.price).toFixed(2)),s=o.price/n),a.patchValue({...o,staticPrice:s,price:l,pt:l*Number(o.quantity),multiplier:n})}}_verifyChanges(n,i){for(let a=0;a<n.length;a++)if(n.length!==i.length||n[a].price!==i[a].price||Number(n[a].quantity)!==Number(i[a].quantity))return!0;return!1}updateSelectedRates(){const n=this.prebillingForm.get("currencyId").value,i=this.prebillingForm.get("products").getRawValue();let a=[];for(const s of i)a=[...this.rates.filter(u=>u.currencyBaseId===n&&u.currencyRefId===s.currencyId),...this.rates.filter(u=>u.currencyBaseId===s.currencyId&&u.currencyRefId===n&&u.currencyRefId!==u.currencyBaseId),...a];const o=a.reduce((s,l)=>(s.find(u=>u.id===l.id&&u.name===l.name)||s.push(l),s),[]);this.prebillingForm.get("rates").setValue(o)}_resetSelectedAssistancesRates(){const n=this.prebillingForm.get("currencyId").value,i=this.prebillingForm.get("multiplier").value;for(const a of this.prebillingForm.get("assistances").controls){const o=a.getRawValue(),s=structuredClone(this.prebillingForm.get("rates").value);let l=s.find(p=>p.currencyBaseId===n&&p.currencyRefId===o.currencyId);!l&&n!==o.currencyId&&(l=s.find(p=>p.currencyRefId===n&&p.currencyRefId!==p.currencyBaseId),l&&(l.value=1/l.value));let c=l?l.value:null;const u=a.get("price").value,d=a.get("staticPrice").value;let f=a.get("rate").value?a.get("rate").value:1;f&&c===f&&(f=1,c=1),a.patchValue({...o,price:(c?u*c:1*u/f)*i,staticPrice:c?d*c:1*d/f,multiplier:i,rate:l?l.value:null,rateId:l?l.id:null})}this._changeDetectorRef.markForCheck()}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-prebilling"]],standalone:!0,features:[e.aNF],decls:124,vars:62,consts:[["billNgForm","ngForm"],["customerAutocomplete","matAutocomplete"],["billDate",""],["productsAutocomplete","matAutocomplete"],["assistancesAutocomplete","matAutocomplete"],["fuseScrollbar","",1,"absolute","inset-0","flex","flex-col","flex-auto","min-w-0",3,"fuseScrollbarOptions"],[1,"relative","flex","flex-col","px-6","py-8","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/desktop",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","sm:leading-10"],[1,"flex","items-center","gap-2","mt-6","shrink-0","lg:mt-0","lg:ml-4"],["color","primary",3,"ngModelChange","ngModel"],["mat-flat-button","",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click","disabled"],[1,"flex","flex-col","px-4","mt-4","mb-12","gap-y-8","sm:px-8"],[1,"col-span-2","shadow","rounded-2xl","bg-card"],[1,"grid","gap-4","p-10","sm:grid-cols-4","lg:grid-cols-5",3,"formGroup"],["appearance","fill",1,"w-full","md:col-span-2","fuse-mat-dense"],["matPrefix","",3,"svgIcon"],["type","text","matInput","",3,"formControl","matAutocomplete","placeholder","required"],[1,"ath-autocomplete",3,"displayWith"],[3,"value"],[1,"w-full","fuse-mat-dense"],["matInput","",3,"matDatepicker","formControlName","max","required"],["matIconSuffix","",3,"for"],[3,"formControlName","required"],["placeholder","Moneda",3,"formControlName","required"],["multiple","","placeholder","Tasa de cambio",3,"formControlName","required"],[1,"text-sm","opacity-75"],["matInput","","type","number","name","quantity",3,"min","max","formControlName"],[1,"flex","flex-col","gap-3","sm:flex-row","lg:flex-col","sm:col-span-2"],[3,"formControlName"],[1,"w-full","sm:col-span-4","lg:col-span-3","fuse-mat-textarea"],["matInput","",3,"formControlName","rows"],[1,"col-span-4","shadow","rounded-2xl","bg-card"],[3,"click","value"],[1,"w-18"],[1,"p-6","pb-0"],["appearance","fill",1,"w-full","fuse-mat-dense",3,"subscriptSizing"],["type","text","matInput","",3,"formControl","matAutocomplete","placeholder"],[1,"ath-autocomplete",3,"closed","displayWith"],[1,"w-full",3,"value"],["fuseScrollbar","",1,"flex","flex-col","flex-auto","pb-6","mt-2","min-h-36",3,"fuseScrollbarOptions"],[1,"grid"],[1,"flex","items-center","justify-center","w-full","gap-2","p-2","font-mono","text-3xl","font-semibold","leading-7","text-white","rounded-b-2xl","bg-gradient-to-r","from-primary-500","to-primary-700",3,"ngClass"],[1,"w-full",3,"click","value"],[1,"grid","w-full","grid-cols-6",3,"click"],[1,"flex","flex-row","items-center","col-span-5","truncate","md:col-span-3"],["color","primary",3,"checked"],[1,"items-center","hidden","col-span-2","md:flex"],[1,"flex","items-center","text-center"],[1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","billing-products-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-primary","dark:bg-opacity-5"],[1,"text-left"],[1,"text-center"],[1,"text-right"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","billing-products-grid","md:px-8"],[1,"truncate",3,"matTooltip"],[1,"truncate"],[1,"flex","flex-col","justify-center"],[1,"flex","flex-row","items-center","justify-center","gap-2"],["mat-stroked-button","",1,"p-2","leading-6","min-w-7","min-h-7","h-7",3,"click","disabled"],[1,"icon-size-5",3,"svgIcon"],[1,"fuse-mat-dense","fuse-mat-rounded",3,"subscriptSizing"],["matInput","","type","text","name","quantity",1,"font-mono","font-semibold","text-center",3,"min","max","formControl"],[1,"w-full","text-sm","text-center"],[1,"flex","flex-col","items-center","justify-center"],["matInput","","type","number",1,"font-mono","font-semibold","text-center",3,"min","max","formControl"],[1,"text-center",3,"ngClass"],[1,"font-mono","text-right"],[1,"flex","justify-center"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"],[1,"flex","items-center","justify-center","w-full","gap-2","p-2","font-mono","text-3xl","font-semibold","leading-7","text-white","rounded-b-2xl","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click","ngClass"],["fuseScrollbar","",1,"flex","flex-col","flex-auto","pb-2","mt-2","min-h-36",3,"fuseScrollbarOptions"],[1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","billing-assistances-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-primary","dark:bg-opacity-5"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","billing-assistances-grid","md:px-8"],["mat-stroked-button","",1,"p-2","leading-6","min-w-7","min-h-7","h-7",3,"click"],["matInput","","type","text","name","quantity",1,"font-mono","font-semibold","text-center",3,"min","formControl"]],template:function(i,a){if(1&i){const o=e.RV6();e.j41(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"div")(5,"a",9),e.EFF(6,"Inicio"),e.k0s()(),e.j41(7,"div",10),e.nrm(8,"mat-icon",11),e.j41(9,"a",12),e.EFF(10,"Ventas"),e.k0s()(),e.j41(11,"div",10),e.nrm(12,"mat-icon",11),e.j41(13,"a",12),e.EFF(14,"Facturaci\xf3n"),e.k0s()(),e.j41(15,"div",10),e.nrm(16,"mat-icon",11),e.j41(17,"a",12),e.EFF(18,"Prefacturar"),e.k0s()()(),e.j41(19,"div",13)(20,"h2",14),e.EFF(21," Hacer Prefactura "),e.k0s()()(),e.j41(22,"div",15),e.DNE(23,Vq,4,2),e.j41(24,"mat-checkbox",16),e.mxI("ngModelChange",function(l){return e.eBV(o),e.DH7(a.stayHere,l)||(a.stayHere=l),e.Njj(l)}),e.EFF(25,"Permanecer aqu\xed"),e.k0s(),e.j41(26,"button",17),e.bIt("click",function(){return e.eBV(o),e.Njj(a.createPrebill())}),e.EFF(27," Generar Prefactura "),e.k0s()()(),e.j41(28,"div",18)(29,"div",19)(30,"form",20,0)(32,"mat-form-field",21)(33,"mat-label"),e.EFF(34,"Cliente"),e.k0s(),e.nrm(35,"mat-icon",22)(36,"input",23),e.j41(37,"mat-autocomplete",24,1),e.Z7z(39,zq,2,2,"mat-option",25,e.fX1),e.nI1(41,"async"),e.k0s()(),e.j41(42,"mat-form-field",26)(43,"mat-label"),e.EFF(44,"Fecha de la Prefactura"),e.k0s(),e.nrm(45,"input",27),e.j41(46,"mat-hint"),e.EFF(47,"DD/MM/YYYY"),e.k0s(),e.nrm(48,"mat-datepicker-toggle",28)(49,"mat-datepicker",null,2),e.DNE(51,qq,2,0,"mat-error"),e.k0s(),e.j41(52,"mat-form-field",26)(53,"mat-label"),e.EFF(54,"Multiplicador"),e.k0s(),e.j41(55,"mat-select",29),e.DNE(56,Uq,2,1,"mat-option",25),e.nI1(57,"async"),e.Z7z(58,Xq,2,2,"mat-option",25,e.fX1),e.nI1(60,"async"),e.k0s(),e.DNE(61,Wq,2,0,"mat-error"),e.k0s(),e.j41(62,"mat-form-field",26)(63,"mat-label"),e.EFF(64,"M\xe9todo de pago"),e.k0s(),e.j41(65,"mat-select",29),e.Z7z(66,Qq,2,2,"mat-option",25,Hi),e.k0s(),e.DNE(68,Jq,2,0,"mat-error"),e.k0s(),e.j41(69,"mat-form-field",26)(70,"mat-label"),e.EFF(71,"Tipo de Operaci\xf3n"),e.k0s(),e.j41(72,"mat-select",29),e.Z7z(73,Hq,2,2,"mat-option",25,Hi),e.k0s(),e.DNE(75,Zq,2,0,"mat-error"),e.k0s(),e.j41(76,"mat-form-field",26)(77,"mat-label"),e.EFF(78,"Moneda"),e.k0s(),e.j41(79,"mat-select",30),e.Z7z(80,Kq,2,2,"mat-option",25,Hi),e.k0s()(),e.j41(82,"mat-form-field",26)(83,"mat-label"),e.EFF(84,"Tasa de Cambio"),e.k0s(),e.j41(85,"mat-select",31)(86,"mat-select-trigger"),e.EFF(87),e.DNE(88,eU,2,2,"span",32),e.k0s(),e.Z7z(89,tU,6,6,"mat-option",25,e.fX1),e.nI1(91,"async"),e.k0s(),e.DNE(92,nU,2,0,"mat-error"),e.k0s(),e.j41(93,"mat-form-field",26)(94,"mat-label"),e.EFF(95,"Descuento"),e.k0s(),e.nrm(96,"input",33),e.k0s(),e.j41(97,"mat-form-field",26)(98,"mat-label"),e.EFF(99,"Recargo"),e.k0s(),e.nrm(100,"input",33),e.k0s(),e.j41(101,"div",34)(102,"mat-form-field",26)(103,"mat-label"),e.EFF(104,"Cuenta Bancaria"),e.k0s(),e.j41(105,"mat-select",29),e.Z7z(106,rU,2,3,"mat-option",25,e.fX1),e.k0s(),e.j41(108,"mat-hint"),e.EFF(109,"Cuentas Bancarias registradas en el negocio"),e.k0s(),e.DNE(110,iU,2,0,"mat-error"),e.k0s(),e.j41(111,"mat-form-field",26)(112,"mat-label"),e.EFF(113,"Transportista"),e.k0s(),e.j41(114,"mat-select",35),e.Z7z(115,aU,2,2,"mat-option",25,e.fX1),e.nI1(117,"async"),e.k0s()()(),e.j41(118,"mat-form-field",36)(119,"mat-label"),e.EFF(120,"Observaciones"),e.k0s(),e.nrm(121,"textarea",37),e.k0s()()(),e.DNE(122,gU,14,12,"div",38)(123,kU,16,19,"div",38),e.k0s()()}if(2&i){let o,s;const l=e.sdS(38),c=e.sdS(50);e.Y8G("fuseScrollbarOptions",e.lJ4(61,Yq)),e.R7$(8),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(7),e.vxM(23,a.assistances.length>0&&a.productsInStock.length>0?23:-1),e.R7$(),e.R50("ngModel",a.stayHere),e.R7$(2),e.Y8G("disabled",a.prebillingForm.invalid||0===a.prebillingForm.get("products").controls.length),e.R7$(4),e.Y8G("formGroup",a.prebillingForm),e.R7$(5),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",a.searchCustomerControl)("matAutocomplete",l)("placeholder","Buscar cliente")("required",!0),e.R7$(),e.Y8G("displayWith",a.displayFn),e.R7$(2),e.Dyx(e.bMT(41,51,a.customersFiltered)),e.R7$(6),e.Y8G("matDatepicker",c)("formControlName","billDate")("max",a.maxDate)("required",!0),e.R7$(3),e.Y8G("for",c),e.R7$(3),e.vxM(51,a.prebillingForm.get("billDate").hasError("required")?51:-1),e.R7$(4),e.Y8G("formControlName","multiplier")("required",!0),e.R7$(),e.vxM(56,0===e.bMT(57,53,a.multipliers$).length?56:-1),e.R7$(2),e.Dyx(e.bMT(60,55,a.multipliers$)),e.R7$(3),e.vxM(61,a.prebillingForm.get("multiplier").hasError("required")?61:-1),e.R7$(4),e.Y8G("formControlName","paymentMethodId")("required",!0),e.R7$(),e.Dyx(a.paymentMethods),e.R7$(2),e.vxM(68,a.prebillingForm.get("paymentMethodId").hasError("required")?68:-1),e.R7$(4),e.Y8G("formControlName","operationTypeId")("required",!0),e.R7$(),e.Dyx(a.operationTypes),e.R7$(2),e.vxM(75,a.prebillingForm.get("operationTypeId").hasError("required")?75:-1),e.R7$(4),e.Y8G("formControlName","currencyId")("required",!0),e.R7$(),e.Dyx(a.currencies),e.R7$(5),e.Y8G("formControlName","rates")("required",!0),e.R7$(2),e.SpI(" ",(null==(o=a.prebillingForm.get("rates").value)||null==o[0]?null:o[0].name)||""," "),e.R7$(),e.vxM(88,((null==(s=a.prebillingForm.get("rates").value)?null:s.length)||0)>1?88:-1),e.R7$(),e.Dyx(e.bMT(91,57,a.ratesFiltered)),e.R7$(3),e.vxM(92,a.prebillingForm.get("rates").hasError("required")?92:-1),e.R7$(4),e.Y8G("min",0)("max",a.total)("formControlName","discount"),e.R7$(4),e.Y8G("min",0)("max",99999)("formControlName","surcharge"),e.R7$(5),e.Y8G("formControlName","bankAccountId")("required",!0),e.R7$(),e.Dyx(a.bankAccounts),e.R7$(4),e.vxM(110,a.prebillingForm.get("bankAccountId").hasError("required")?110:-1),e.R7$(4),e.Y8G("formControlName","courierId"),e.R7$(),e.Dyx(e.bMT(117,59,a.employees$)),e.R7$(6),e.Y8G("formControlName","observation")("rows",4),e.R7$(),e.vxM(122,a.billProducts?122:-1),e.R7$(),e.vxM(123,a.billAssistances?123:-1)}},dependencies:[U.Jj,U.oe,U.QX,m.YN,m.qT,m.me,m.Q0,m.BC,m.cb,m.YS,m.VZ,m.zX,m.vS,m.X1,m.l_,m.j4,m.JD,mr.p,yt.jL,yt.$3,Hr.wT,yt.pN,te.Hl,te.$z,mt.g7,mt.So,Z.X6,Z.Vh,Z.bZ,Z.bU,O.RG,O.rl,O.nJ,O.MV,O.TL,O.JW,O.yw,de.m_,de.An,le.fS,le.fg,ve.Cn,gt.Ve,gt.VO,gt.$2,De.uc,De.oV,U.YU,ft.Wk],encapsulation:2,changeDetection:0})}return t})();var En=R(70877);const r2=t=>t.prebills,js=((0,fe.Mz)(r2,t=>t.prebill),(0,fe.Mz)(r2,t=>t.prebills));let i2=(()=>{class t{constructor(n,i){this.apolloProvider=n,this.store=i,this._apollo=this.apolloProvider.use("BALANC")}getPrebills(n=0,i=50,a="no",o="desc",s="",l=null,c=[],u=[],d=[],f=null,p=null,h=null){return this._apollo.query({query:jq,errorPolicy:"all",variables:{page:n,size:i,sort:a,order:o,search:s,status:u,paymentStatus:d,customerId:l,currenciesId:c,billDate:f,startDate:p,endDate:h}}).pipe((0,oe.M)(({data:b})=>{b&&(this.store.dispatch((0,En.S9)({prebills:structuredClone(b).findAllPrebills.prebills.map(g=>{const _=g.products.reduce((C,S)=>{const F=C.find(D=>D.productId===S.productId);return F?F.quantity+=S.quantity:C.push({productId:S.productId,price:S.price,quantity:S.quantity,product:S.product}),C},[]);return g.products=_,g})})),this.store.dispatch((0,Jr.Bp)({pagination:b.findAllPrebills.pagination})))}))}getPrebillsByDate(n){return this._apollo.query({query:Dq,errorPolicy:"all",variables:{date:n}})}getPrebillById(n){return this._apollo.query({query:Aq,variables:{findBillByIdId:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:i})=>{this.store.dispatch((0,En.PZ)({prebill:i.dispatchPrebill.prebill}))}))}updateBill(n){return this.store.select(js).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:Pq,variables:{updateBillInput:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:a})=>{const o=structuredClone(i);o[i.findIndex(l=>l.id===n.id)]=a.updatedBill,this.store.dispatch((0,En.S9)({prebills:o}))}))))}updatePrebillStatus(n,i,a){return this.store.select(js).pipe((0,Be.s)(1),(0,ce.n)(o=>this._apollo.mutate({mutation:Bq,variables:{updatePrebillStatusInput:{id:n,status:i,paymentStatus:a}},errorPolicy:"all"}).pipe((0,oe.M)(({data:s})=>{const l=structuredClone(o);l[o.findIndex(u=>u.id===n)]=s.updatePrebillStatus.prebill,this.store.dispatch((0,En.S9)({prebills:l}))}))))}removeBill(n){return this.store.select(js).pipe((0,Be.s)(1),(0,ce.n)(i=>this._apollo.mutate({mutation:Oq,variables:{removePrebillId:n},errorPolicy:"all"}).pipe((0,oe.M)(({errors:a})=>{if(a)return;const o=structuredClone(i),s=i.findIndex(l=>l.id===n);o.splice(s,1),this.store.dispatch((0,En.S9)({prebills:o}))}))))}dispatchPrebill(n){return this._apollo.mutate({mutation:Nq,variables:{billId:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:i})=>{i&&this.store.dispatch((0,En.Al)({prebill:i.dispatchPrebill.prebill}))}))}generateBillFromPrebill(n){return this._apollo.mutate({mutation:Gq,variables:{billId:n},errorPolicy:"all"}).pipe((0,oe.M)(({data:i})=>{i&&this.store.dispatch((0,En.Al)({prebill:i.generateBillFromPrebill.prebill}))}))}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(X.Ic),e.KVO(fe.il))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const IU=["billDateFilter"],wU=["customerFilter"],RU=["currencyFilter"],TU=["statusFilter"],EU=["paymentStatusFilter"],jU=(t,r)=>r.id,DU=()=>({wheelPropagation:!1}),AU=()=>["/modules/sales/prebilling"],MU=()=>["nueva","entregada","cancelada","rechazada"],PU=()=>["pendiente","cobrada"],BU=(t,r)=>({"pointer-events-none":t,hidden:r}),OU=()=>[10,25,100],NU=(t,r,n,i)=>({"bg-amber-50 text-amber-700":t,"text-green-700 bg-green-50":r,"text-red-700 bg-red-50":n,"text-blue-700 bg-blue-50":i}),GU=(t,r)=>({"text-blue-700 bg-blue-50":t,"text-green-700 bg-green-50":r});function LU(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-icon",34),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.range.reset())}),e.k0s()}}function YU(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1,"Fecha de inicio no v\xe1lida "),e.k0s())}function VU(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1,"Fecha de final no v\xe1lida "),e.k0s())}function zU(t,r){if(1&t&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&t){const n=e.XpG().$implicit;e.R7$(),e.SpI(" ",n.bill.no," ")}}function qU(t,r){1&t&&e.nrm(0,"mat-icon",60),2&t&&e.Y8G("svgIcon","mat_solid:done")}function UU(t,r){1&t&&e.nrm(0,"mat-icon",60),2&t&&e.Y8G("svgIcon","mat_solid:done")}function XU(t,r){1&t&&e.nrm(0,"mat-icon",60),2&t&&e.Y8G("svgIcon","mat_solid:done")}function WU(t,r){1&t&&e.nrm(0,"mat-icon",60),2&t&&e.Y8G("svgIcon","mat_solid:done")}function QU(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",50)(1,"div",51),e.EFF(2),e.k0s(),e.j41(3,"div",51),e.DNE(4,zU,2,1,"span"),e.k0s(),e.j41(5,"div",52),e.EFF(6),e.nI1(7,"date"),e.k0s(),e.j41(8,"div",53),e.EFF(9),e.k0s(),e.j41(10,"div",54),e.EFF(11),e.k0s(),e.j41(12,"div",55),e.EFF(13),e.nI1(14,"number"),e.k0s(),e.j41(15,"div",56)(16,"span",57),e.EFF(17),e.nI1(18,"uppercase"),e.k0s()(),e.j41(19,"div",56)(20,"span",57),e.EFF(21),e.nI1(22,"uppercase"),e.k0s()(),e.j41(23,"div",58)(24,"button",59),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.generatePrebillDocument(a))}),e.nrm(25,"mat-icon",60),e.k0s(),e.j41(26,"button",61),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.dispatchPrebill(a.id))}),e.nrm(27,"mat-icon",60),e.k0s(),e.j41(28,"button",62),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.generateBillFromPrebill(a.id))}),e.nrm(29,"mat-icon",60),e.k0s(),e.j41(30,"div")(31,"button",63),e.nrm(32,"mat-icon",60),e.k0s(),e.j41(33,"mat-menu",null,6)(35,"div",64),e.EFF(36," Actualizar Estado "),e.k0s(),e.j41(37,"button",65),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.updatePrebillStatus(a.id,"entregada"))}),e.j41(38,"div",66),e.DNE(39,qU,1,1,"mat-icon",60),e.k0s(),e.j41(40,"span",67),e.EFF(41,"Entregada"),e.k0s()(),e.j41(42,"button",65),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.updatePrebillStatus(a.id,null,"cobrada"))}),e.j41(43,"div",66),e.DNE(44,UU,1,1,"mat-icon",60),e.k0s(),e.j41(45,"span",67),e.EFF(46,"Cobrada"),e.k0s()(),e.j41(47,"button",65),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.updatePrebillStatus(a.id,"cancelada"))}),e.j41(48,"div",66),e.DNE(49,XU,1,1,"mat-icon",60),e.k0s(),e.j41(50,"span",67),e.EFF(51,"Cancelada"),e.k0s()(),e.j41(52,"button",65),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(3);return e.Njj(o.updatePrebillStatus(a.id,"rechazada"))}),e.j41(53,"div",66),e.DNE(54,WU,1,1,"mat-icon",60),e.k0s(),e.j41(55,"span",67),e.EFF(56,"Rechazada"),e.k0s()()()()()()}if(2&t){const n=r.$implicit,i=e.sdS(34);e.R7$(2),e.SpI(" ",n.no," "),e.R7$(2),e.vxM(4,n.bill?4:-1),e.R7$(2),e.SpI(" ",e.i5U(7,26,n.billDate,"dd/MM/yyyy")," "),e.R7$(3),e.SpI(" ",n.customer.name," "),e.R7$(2),e.SpI(" ",n.currency.iso," "),e.R7$(2),e.SpI(" ",e.i5U(14,29,n.total,"1.2-2")," "),e.R7$(2),e.Y8G("ngClass",e.ziG(36,NU,"nueva"===n.status,"facturada"===n.status,"cancelada"===n.status,"entregada"===n.status)),e.R7$(2),e.SpI(" ",e.bMT(18,32,n.status)," "),e.R7$(2),e.Y8G("ngClass",e.l_i(41,GU,"pendiente"===n.paymentStatus,"cobrada"===n.paymentStatus)),e.R7$(2),e.SpI(" ",e.bMT(22,34,n.paymentStatus)," "),e.R7$(4),e.Y8G("svgIcon","mat_solid:print"),e.R7$(),e.Y8G("disabled",0===n.products.length||n.isDispatched||"facturada"===n.status||"cancelada"===n.status),e.R7$(),e.Y8G("svgIcon","mat_solid:logout"),e.R7$(),e.Y8G("disabled","facturada"===n.status||"cancelada"===n.status),e.R7$(),e.Y8G("svgIcon","mat_solid:request_page"),e.R7$(2),e.Y8G("matMenuTriggerFor",i)("disabled",n.paymentStatus.includes("cobrada")||n.status.includes("cancelada")||n.status.includes("rechazada")),e.R7$(),e.Y8G("svgIcon","mat_solid:update"),e.R7$(5),e.Y8G("disabled",n.status.includes("entregada")||n.status.includes("cancelada")||n.status.includes("rechazada")||n.paymentStatus.includes("cobrada")||n.status.includes("facturada")),e.R7$(2),e.vxM(39,n.status.includes("entregada")?39:-1),e.R7$(3),e.Y8G("disabled",n.paymentStatus.includes("cobrada")||n.status.includes("cancelada")||n.status.includes("rechazada")),e.R7$(2),e.vxM(44,n.paymentStatus.includes("cobrada")?44:-1),e.R7$(3),e.Y8G("disabled",n.paymentStatus.includes("cobrada")||n.status.includes("rechazada")||n.status.includes("cancelada")||n.status.includes("facturada")),e.R7$(2),e.vxM(49,n.status.includes("cancelada")?49:-1),e.R7$(3),e.Y8G("disabled",n.paymentStatus.includes("cobrada")||n.status.includes("cancelada")||n.status.includes("rechazada")||n.status.includes("facturada")),e.R7$(2),e.vxM(54,n.status.includes("rechazada")?54:-1)}}function JU(t,r){if(1&t&&e.Z7z(0,QU,57,44,"div",50,jU),2&t){const n=e.XpG();e.Dyx(n)}}function HU(t,r){1&t&&(e.j41(0,"div",68),e.EFF(1," \xa1No se ha registrado ninguna prefactura! "),e.k0s())}function ZU(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",33)(1,"div",35)(2,"div",36)(3,"span"),e.EFF(4,"No."),e.k0s()(),e.j41(5,"div",37)(6,"span"),e.EFF(7,"No.Factura"),e.k0s()(),e.j41(8,"div",37)(9,"span",38),e.EFF(10,"Fecha"),e.k0s(),e.j41(11,"table-filter",39,1),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addDate(a))}),e.k0s()(),e.j41(13,"div",40)(14,"span"),e.EFF(15,"Cliente"),e.k0s(),e.j41(16,"table-filter",41,2),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addCustomer(a))}),e.k0s()(),e.j41(18,"div",37)(19,"span"),e.EFF(20,"Moneda"),e.k0s(),e.j41(21,"table-filter",42,3),e.nI1(23,"async"),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addCurrencies(a))}),e.k0s()(),e.j41(24,"div",43)(25,"span"),e.EFF(26,"Importe"),e.k0s()(),e.j41(27,"div",37)(28,"span",38),e.EFF(29,"Estado"),e.k0s(),e.j41(30,"table-filter",44,4),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addStatus(a))}),e.k0s()(),e.j41(32,"div",37)(33,"span",45),e.EFF(34,"E.Pago"),e.k0s(),e.j41(35,"table-filter",44,5),e.bIt("dataChange",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addPaymentStatus(a))}),e.k0s()(),e.j41(37,"div",46)(38,"span"),e.EFF(39,"Acciones"),e.k0s(),e.j41(40,"button",47),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.clearTableFilters())}),e.nrm(41,"mat-icon",48),e.k0s()()(),e.DNE(42,JU,2,0)(43,HU,2,0),e.nrm(44,"mat-paginator",49),e.k0s()}if(2&t){const n=e.XpG();e.R7$(2),e.Y8G("mat-sort-header","no"),e.R7$(7),e.Y8G("mat-sort-header","billDate"),e.R7$(2),e.Y8G("filterType","date"),e.R7$(5),e.Y8G("filterType","filterEntity")("searchEntityControl",n.searchCustomersControl)("entitiesFiltered",n.customersFiltered),e.R7$(5),e.Y8G("filterType","multiSelectEntity")("entityPropertyName","iso")("useUpperCase",!0)("data",e.bMT(23,26,n.currencies$)),e.R7$(3),e.Y8G("mat-sort-header","total"),e.R7$(4),e.Y8G("mat-sort-header","status"),e.R7$(2),e.Y8G("filterType","multiSelect")("data",e.lJ4(28,MU)),e.R7$(3),e.Y8G("mat-sort-header","paymentStatus"),e.R7$(2),e.Y8G("filterType","multiSelect")("data",e.lJ4(29,PU)),e.R7$(5),e.Y8G("disabled",!n.existTableFilter()),e.R7$(),e.Y8G("svgIcon","mat_solid:filter_list_off"),e.R7$(),e.vxM(42,r.length>0?42:43),e.R7$(2),e.Y8G("ngClass",e.l_i(30,BU,n.isLoading,n.pagination.length<10&&n.pagination.page<1))("length",n.pagination.length)("pageIndex",n.pagination.page)("pageSize",n.pagination.size)("pageSizeOptions",e.lJ4(33,OU))("showFirstLastButtons",!0)}}let KU=(()=>{class t{constructor(){this.currencies$=(0,ie.of)([]),this.filterInputControl=new m.MJ,this.filterStatusInputControl=new m.MJ(null),this.isLoading=!1,this.isSlideLoading=!1,this.maxDate=new Date,this.merchant=null,this.merchantLogo=null,this.prebills$=(0,ie.of)([]),this.range=new m.gE({start:new m.MJ({disabled:!1,value:null},[Je.t.futureDateValidator()]),end:new m.MJ({disabled:!1,value:null},[Je.t.futureDateValidator()])}),this.searchCustomersControl=new m.MJ(null),this.searchInputControl=new m.MJ,this.selectedCurrenciesId=[],this.selectedCustomer=null,this.selectedDate=null,this.selectedPaymentStatus=[],this.selectedSlide=null,this.selectedStatus=[],this.user=null,this._changeDetectorRef=(0,e.WQX)(e.gRc),this._documentsService=(0,e.WQX)(hr.Q),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._prebillsService=(0,e.WQX)(i2),this._snackBar=(0,e.WQX)(Oe.UG),this._unsubscribeAll=new Ke.B,this._customersService=(0,e.WQX)(Zr.h),this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.store.select(bn.SW).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.user=n,this._changeDetectorRef.markForCheck()}),this.currencies$=this.store.select(Pn.y$),this.store.select(At.Xb).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.merchant=n,this._changeDetectorRef.markForCheck()}),this.prebills$=this.store.select(js),this.store.select(Mn.Dz).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.pagination=n,this._changeDetectorRef.markForCheck()}),this.searchInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,ce.n)(n=>(this.isLoading=!0,this._prebillsService.getPrebills(0,25,"no","desc",n,this.selectedCustomer?this.selectedCustomer.id:null,this.selectedCurrenciesId,this.selectedStatus,this.selectedPaymentStatus,this.selectedDate,this.range.get("start").value,this.range.get("end").value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe(),this.filterInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,ce.n)(n=>(this.isLoading=!0,this._prebillsService.getPrebills(0,25,"no","desc",this.searchInputControl.value,this.selectedCustomer?this.selectedCustomer.id:null,this.selectedCurrenciesId,this.selectedStatus,this.selectedPaymentStatus,this.selectedDate,this.range.get("start").value,this.range.get("end").value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe(),this.customersFiltered=this.searchCustomersControl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,bt.j)(()=>{this.isLoading=!1}),(0,Qe.Z)(n=>null!==n&&"string"==typeof n&&(this.selectedCustomer&&n!==this.selectedCustomer.name||!this.selectedCustomer)?(this.isLoading=!0,this._customersService.findActiveCustomers(n.trim())):(0,ie.of)())),this.range.valueChanges.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.billDateFilter.clearFilter(),this._prebillsService.getPrebills(0,this.pagination.size,"no","desc",this.searchInputControl.value,this.selectedCustomer?this.selectedCustomer.id:null,this.selectedCurrenciesId,this.selectedStatus,this.selectedPaymentStatus,null,n.start,n.end).pipe((0,T.Q)(this._unsubscribeAll)).subscribe()})}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"no",start:"desc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,An.h)(this._sort.sortChange,this._paginator.page).pipe((0,ce.n)(()=>(this.isLoading=!0,this._prebillsService.getPrebills(this._paginator.pageIndex,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value,this.selectedCustomer?this.selectedCustomer.id:null,this.selectedCurrenciesId,this.selectedStatus,this.selectedPaymentStatus,this.selectedDate,this.range.get("start").value,this.range.get("end").value))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete(),this.store.dispatch((0,En.Jx)())}resetCustomer(){this.selectedCustomer=null,this.searchInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addCustomer(n){this.selectedCustomer=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addDate(n){this.selectedDate=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addCurrencies(n){this.selectedCurrenciesId=n.map(i=>i.id),this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addStatus(n){this.selectedStatus=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}addPaymentStatus(n){this.selectedPaymentStatus=n,this.filterInputControl.setValue(""),this._changeDetectorRef.markForCheck()}dispatchPrebill(n){this._fuseConfirmationService.open({title:"Despachar factura",message:"\xbfEsta seguro que desea despachar esta prefactura?.",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(a=>{"confirmed"===a&&this._prebillsService.dispatchPrebill(n).pipe((0,T.Q)(this._unsubscribeAll),(0,bt.j)(()=>{this._changeDetectorRef.markForCheck()})).subscribe(({data:o})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.dispatchPrebill.message,title:"Confirmaci\xf3n",type:"success",appearance:"fill"}})})})}generateBillFromPrebill(n){this._fuseConfirmationService.open({title:"Generar factura",message:"\xbfEsta seguro que desea generar esta factura?.",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{"confirmed"===a&&this._prebillsService.generateBillFromPrebill(n).pipe((0,T.Q)(this._unsubscribeAll),(0,bt.j)(()=>{this._changeDetectorRef.markForCheck()})).subscribe(({data:o})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.generateBillFromPrebill.message,title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"mat_solid:done"}})})})}updatePrebillStatus(n,i=null,a=null){this._fuseConfirmationService.open({title:"Actualizar estado de la prefactura",message:"\xbfEsta seguro que desea actualizar esta prefactura?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(s=>{"confirmed"===s&&this._prebillsService.updatePrebillStatus(n,i,a).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:l})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:l.updatePrebillStatus.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}})}),this._changeDetectorRef.markForCheck()})}generatePrebillDocument(n){this._documentsService.generateBillDocument(n,aa.prefactura,this.merchant,this.user)}existTableFilter(){return this.statusFilter?.hasFilter||this.billDateFilter?.hasFilter||this.currencyFilter?.hasFilter||this.customerFilter?.hasFilter||this.paymentStatusFilter?.hasFilter}clearTableFilters(){this.statusFilter?.hasFilter&&this.statusFilter.clearFilter(),this.billDateFilter?.hasFilter&&this.billDateFilter.clearFilter(),this.currencyFilter?.hasFilter&&this.currencyFilter.clearFilter(),this.customerFilter?.hasFilter&&this.customerFilter.clearFilter(),this.paymentStatusFilter?.hasFilter&&this.paymentStatusFilter.clearFilter()}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-prebills"]],viewQuery:function(i,a){if(1&i&&(e.GBs(Ie.iy,5),e.GBs(pe.B4,5),e.GBs(IU,5),e.GBs(wU,5),e.GBs(RU,5),e.GBs(TU,5),e.GBs(EU,5)),2&i){let o;e.mGM(o=e.lsd())&&(a._paginator=o.first),e.mGM(o=e.lsd())&&(a._sort=o.first),e.mGM(o=e.lsd())&&(a.billDateFilter=o.first),e.mGM(o=e.lsd())&&(a.customerFilter=o.first),e.mGM(o=e.lsd())&&(a.currencyFilter=o.first),e.mGM(o=e.lsd())&&(a.statusFilter=o.first),e.mGM(o=e.lsd())&&(a.paymentStatusFilter=o.first)}},standalone:!0,features:[e.aNF],decls:44,vars:24,consts:[["picker",""],["billDateFilter",""],["customerFilter",""],["currencyFilter",""],["statusFilter",""],["paymentStatusFilter",""],["listStatusMenu","matMenu"],["fuseScrollbar","",1,"absolute","inset-0","flex","flex-col","flex-auto","min-w-0","bg-card","dark:bg-transparent",3,"fuseScrollbarOptions"],[1,"relative","flex","flex-col","px-6","py-8","border-b","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/desktop",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","sm:leading-10"],[1,"flex","flex-wrap","items-center","w-full","gap-2","mt-6","lg:fixed","right-8","shrink-0","lg:mt-0","lg:ml-4","lg:w-auto","sm:w-1/2"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],[1,"sm:mx-4","min-w-64","fuse-mat-dense","fuse-mat-rounded",3,"subscriptSizing"],[3,"formGroup","rangePicker","max"],["matStartDate","","formControlName","start","placeholder","Fecha de inicio"],["matEndDate","","formControlName","end","placeholder","Fecha final"],["matPrefix","",3,"for"],["disabled","false"],["svgIcon","mat_solid:cancel","matSuffix","",1,"cursor-pointer"],["mat-raised-button","",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700",3,"routerLink"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],[1,"flex","flex-auto"],[1,"z-10","flex","flex-col","flex-auto","bg-white","dark:bg-default"],[1,"relative","grid"],["svgIcon","mat_solid:cancel","matSuffix","",1,"cursor-pointer",3,"click"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","pre-bills-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-slate-900"],[1,"flex","items-center","justify-center",3,"mat-sort-header"],[1,"flex","items-center","justify-center"],[3,"mat-sort-header"],[3,"dataChange","filterType"],[1,"flex","items-center","justify-start"],[3,"dataChange","filterType","searchEntityControl","entitiesFiltered"],[3,"dataChange","filterType","entityPropertyName","useUpperCase","data"],[1,"flex","items-center","justify-end",3,"mat-sort-header"],[3,"dataChange","filterType","data"],["matTooltip","Estado del pago",3,"mat-sort-header"],[1,"flex","items-center","justify-end","mr-6"],["color","warn","mat-icon-button","","matTooltip","Limpiar filtros",1,"w-6","h-6","min-h-6","min-w-6",3,"click","disabled"],[1,"icon-size-4",3,"svgIcon"],[1,"border-b","first-letter:z-10","sm:inset-x-0","sm:sticky","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-gray-900",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],[1,"z-0","grid","items-center","gap-4","px-6","py-3","border-b","pre-bills-grid","md:px-8"],[1,"font-mono"],[1,"font-mono","text-center"],[1,""],[1,"text-center"],[1,"font-mono","text-right"],[1,"flex","items-center","justify-center","mr-4","text-center","truncate","delay-100","rounded-full","h-7","lock","dark:bg-white","dark:bg-opacity-5",3,"ngClass"],[1,"w-full","px-2","text-sm","font-medium","text-center"],[1,"flex","flex-row","justify-end","gap-2"],["mat-stroked-button","","matTooltip","Imprimir Prefactura",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"icon-size-5",3,"svgIcon"],["mat-stroked-button","","matTooltip","Despachar Prefactura",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click","disabled"],["mat-stroked-button","","matTooltip","Generar factura",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click","disabled"],["mat-stroked-button","","matTooltip","Actualizar estados",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"matMenuTriggerFor","disabled"],[1,"w-full","p-2","text-lg","font-semibold","text-center","text-secondary"],["mat-menu-item","",1,"grid","w-full","grid-cols-4",3,"click","disabled"],[1,"col-span-1"],[1,"col-span-3","text-center"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"]],template:function(i,a){if(1&i&&(e.j41(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10)(4,"div")(5,"a",11),e.EFF(6,"Inicio"),e.k0s()(),e.j41(7,"div",12),e.nrm(8,"mat-icon",13),e.j41(9,"a",14),e.EFF(10,"Ventas"),e.k0s()(),e.j41(11,"div",12),e.nrm(12,"mat-icon",13),e.j41(13,"a",14),e.EFF(14,"Facturaci\xf3n"),e.k0s()(),e.j41(15,"div",12),e.nrm(16,"mat-icon",13),e.j41(17,"a",14),e.EFF(18,"Prefacturas"),e.k0s()()(),e.j41(19,"div",15)(20,"h2",16),e.EFF(21," Registro de Prefacturas "),e.k0s()()(),e.j41(22,"div",17)(23,"mat-form-field",18),e.nrm(24,"mat-icon",19)(25,"input",20),e.k0s(),e.j41(26,"mat-form-field",21)(27,"mat-date-range-input",22),e.nrm(28,"input",23)(29,"input",24),e.k0s(),e.nrm(30,"mat-datepicker-toggle",25)(31,"mat-date-range-picker",26,0),e.DNE(33,LU,1,0,"mat-icon",27)(34,YU,2,0,"mat-error")(35,VU,2,0,"mat-error"),e.k0s(),e.j41(36,"button",28),e.nrm(37,"mat-icon",29),e.j41(38,"span",30),e.EFF(39,"Registrar"),e.k0s()()()(),e.j41(40,"div",31)(41,"div",32),e.DNE(42,ZU,45,34,"div",33),e.nI1(43,"async"),e.k0s()()()),2&i){let o;const s=e.sdS(32);e.Y8G("fuseScrollbarOptions",e.lJ4(22,DU)),e.R7$(8),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(7),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",a.searchInputControl)("autocomplete","off")("placeholder","Escriba para buscar..."),e.R7$(),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("formGroup",a.range)("rangePicker",s)("max",a.maxDate),e.R7$(3),e.Y8G("for",s),e.R7$(3),e.vxM(33,a.range.get("start").value||a.range.get("end").value?33:-1),e.R7$(),e.vxM(34,a.range.controls.start.hasError("matStartDateInvalid")?34:-1),e.R7$(),e.vxM(35,a.range.controls.end.hasError("matEndDateInvalid")?35:-1),e.R7$(),e.Y8G("routerLink",e.lJ4(23,AU)),e.R7$(),e.Y8G("svgIcon","mat_solid:edit"),e.R7$(5),e.vxM(42,(o=e.bMT(43,20,a.prebills$))?42:-1,o)}},dependencies:[U.Jj,U.vh,U.QX,mr.p,te.Hl,te.$z,te.iY,Z.X6,Z.bU,Z.el,Z.xR,Z.IG,Z.SG,O.RG,O.rl,O.TL,O.JW,O.yw,de.m_,de.An,le.fS,le.fg,ve.Cn,ve.kk,ve.fb,ve.Cp,Ie.Ou,Ie.iy,pe.NQ,pe.B4,pe.aE,De.uc,De.oV,U.YU,m.X1,m.me,m.BC,m.cb,m.l_,m.j4,m.JD,ft.Wk,Ys.i,U.Pc],styles:[".pre-bills-grid{grid-template-columns:100px 100px 100px 250px 50px 100px 100px 100px 170px}@media (min-width: 960px){.pre-bills-grid{grid-template-columns:100px 100px 80px 250px 50px 100px 100px 100px 170px}}@media (min-width: 1280px){.pre-bills-grid{grid-template-columns:10% 100px 80px auto 50px 10% 10% 10% 170px}}\n"],encapsulation:2,changeDetection:0})}return t})();var eX=R(86800),a2=R(67336),Zi=R(36471),tX=R(67943),nX=R(53159),rX=R(51973),iX=R(57084),aX=R(62590);const o2=t=>({"cursor-not-allowed":t});function oX(t,r){1&t&&(e.j41(0,"h2",5),e.EFF(1,"Agregar Terminal"),e.k0s())}function sX(t,r){1&t&&(e.j41(0,"h2",5),e.EFF(1,"Editar terminal "),e.k0s())}function lX(t,r){1&t&&(e.j41(0,"h2",5),e.EFF(1,"Detalles de la terminal "),e.k0s())}function cX(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El nombre es requerido "),e.k0s())}function uX(t,r){if(1&t&&(e.j41(0,"mat-option",14),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function dX(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," La marca es requerida "),e.k0s())}function fX(t,r){if(1&t&&(e.j41(0,"mat-option",14),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function mX(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El almac\xe9n de venta es obligatorio "),e.k0s())}function pX(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El modelo es requerido "),e.k0s())}function hX(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El n\xfamero de serie es requerido "),e.k0s())}function gX(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El PIN debe tener 4 d\xedgitos "),e.k0s())}function bX(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El PIN debe tener 4 d\xedgitos "),e.k0s())}function vX(t,r){if(1&t&&(e.j41(0,"mat-option",14),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.name," ")}}function _X(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-chip",25),e.bIt("removed",function(){const a=e.eBV(n).$implicit,o=e.XpG(2);return e.Njj(o.removeEmployee(a))}),e.EFF(1),e.nrm(2,"mat-icon",26),e.k0s()}if(2&t){const n=r.$implicit;e.Y8G("removable",!0),e.R7$(),e.SpI(" ",n.fullname," "),e.R7$(),e.Y8G("svgIcon","mat_solid:cancel")}}function yX(t,r){if(1&t&&(e.j41(0,"mat-option",14),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",n.fullname," ")}}function CX(t,r){1&t&&(e.j41(0,"mat-error"),e.EFF(1," El empleado es requerido "),e.k0s())}function xX(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",7)(1,"div",9)(2,"form",10)(3,"mat-form-field",11)(4,"mat-label"),e.EFF(5,"Nombre del terminal"),e.k0s(),e.nrm(6,"input",12),e.DNE(7,cX,2,0,"mat-error"),e.k0s(),e.j41(8,"mat-form-field",11)(9,"mat-label"),e.EFF(10,"Marca"),e.k0s(),e.j41(11,"mat-select",13),e.Z7z(12,uX,2,2,"mat-option",14,e.fX1),e.j41(14,"mat-option",15),e.bIt("click",function(){e.eBV(n);const a=e.XpG();return e.Njj(a.createBrand())}),e.EFF(15," Agregar marca "),e.k0s()(),e.DNE(16,dX,2,0,"mat-error"),e.k0s(),e.j41(17,"mat-form-field",11)(18,"mat-label"),e.EFF(19,"Almac\xe9n de venta"),e.k0s(),e.j41(20,"mat-select",13),e.Z7z(21,fX,2,2,"mat-option",14,e.fX1),e.k0s(),e.DNE(23,mX,2,0,"mat-error"),e.k0s(),e.j41(24,"mat-form-field",11)(25,"mat-label"),e.EFF(26,"Modelo"),e.k0s(),e.nrm(27,"input",16),e.DNE(28,pX,2,0,"mat-error"),e.k0s(),e.j41(29,"mat-form-field",11)(30,"mat-label"),e.EFF(31,"N\xfamero de serie"),e.k0s(),e.nrm(32,"input",16),e.DNE(33,hX,2,0,"mat-error"),e.k0s(),e.j41(34,"mat-form-field",11)(35,"mat-label"),e.EFF(36,"PIN"),e.k0s(),e.nrm(37,"input",17),e.DNE(38,gX,2,0,"mat-error")(39,bX,2,0,"mat-error"),e.j41(40,"mat-hint"),e.EFF(41,"Solo 4 d\xedgitos"),e.k0s()(),e.j41(42,"div")(43,"mat-form-field",11)(44,"mat-label"),e.EFF(45,"Ubicaci\xf3n"),e.k0s(),e.j41(46,"mat-select",13),e.Z7z(47,vX,2,2,"mat-option",14,e.fX1),e.nI1(49,"async"),e.k0s()()(),e.j41(50,"div",18)(51,"mat-checkbox",19),e.EFF(52," \xbfTiene impresora? "),e.k0s(),e.j41(53,"mat-checkbox",19),e.EFF(54," \xbfTiene caja de efectivo? "),e.k0s()(),e.j41(55,"mat-form-field",20)(56,"mat-label"),e.EFF(57,"Asignar a:"),e.k0s(),e.j41(58,"mat-chip-grid",21,0),e.Z7z(60,_X,3,3,"mat-chip",22,e.fX1),e.nrm(62,"input",23,1),e.k0s(),e.j41(64,"mat-autocomplete",24,2),e.bIt("optionSelected",function(a){e.eBV(n);const o=e.XpG();return e.Njj(o.addEmployee(a.option.value))}),e.Z7z(66,yX,2,2,"mat-option",14,e.fX1),e.nI1(68,"async"),e.k0s(),e.DNE(69,CX,2,0,"mat-error"),e.k0s()()()()}if(2&t){const n=e.sdS(59),i=e.sdS(65),a=e.XpG();e.R7$(2),e.Y8G("formGroup",a.terminalForm)("autocomplete","off"),e.R7$(4),e.Y8G("formControlName","name")("placeholder","Ejemplo: Caja 1"),e.R7$(),e.vxM(7,a.terminalForm.controls.name.hasError("required")?7:-1),e.R7$(4),e.Y8G("formControlName","brandId")("required",!0),e.R7$(),e.Dyx(a.brands),e.R7$(4),e.vxM(16,a.terminalForm.controls.brandId.hasError("required")?16:-1),e.R7$(4),e.Y8G("formControlName","depotId")("required",!0),e.R7$(),e.Dyx(a.depots),e.R7$(2),e.vxM(23,a.terminalForm.controls.depotId.hasError("required")?23:-1),e.R7$(4),e.Y8G("formControlName","model")("placeholder","Modelo del terminal"),e.R7$(),e.vxM(28,a.terminalForm.controls.model.hasError("required")?28:-1),e.R7$(4),e.Y8G("formControlName","sn")("placeholder","Serie del terminal"),e.R7$(),e.vxM(33,a.terminalForm.controls.sn.hasError("required")?33:-1),e.R7$(4),e.Y8G("formControlName","pin")("placeholder","0000"),e.R7$(),e.vxM(38,a.terminalForm.controls.pin.hasError("minlength")?38:-1),e.R7$(),e.vxM(39,a.terminalForm.controls.pin.hasError("max")?39:-1),e.R7$(7),e.Y8G("formControlName","locationId")("required",!0),e.R7$(),e.Dyx(e.bMT(49,34,a.locations$)),e.R7$(4),e.Y8G("formControlName","havePrinter"),e.R7$(2),e.Y8G("formControlName","haveDrawer"),e.R7$(5),e.Y8G("required",!0),e.R7$(2),e.Dyx(a.terminalForm.get("employeesId").value),e.R7$(2),e.Y8G("formControl",a.employeeCtrl)("matAutocomplete",i)("placeholder","Buscar empleado")("matChipInputFor",n)("matChipInputSeparatorKeyCodes",a.separatorKeysCodes)("matChipInputAddOnBlur",!0),e.R7$(2),e.Y8G("displayWith",a.displayFn),e.R7$(2),e.Dyx(e.bMT(68,36,a.filteredEmployees$)),e.R7$(3),e.vxM(69,a.terminalForm.controls.employeesId.hasError("required")?69:-1)}}function FX(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",29),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.updateTerminal())}),e.EFF(1," Actualizar "),e.k0s()}if(2&t){const n=e.XpG(2);e.Y8G("color","primary")("disabled",n.terminalForm.invalid)("ngClass",e.eq3(3,o2,n.terminalForm.invalid))}}function SX(t,r){if(1&t){const n=e.RV6();e.j41(0,"button",29),e.bIt("click",function(){e.eBV(n);const a=e.XpG(2);return e.Njj(a.createTerminal())}),e.EFF(1," Agregar "),e.k0s()}if(2&t){const n=e.XpG(2);e.Y8G("color","primary")("disabled",n.terminalForm.invalid)("ngClass",e.eq3(3,o2,n.terminalForm.invalid))}}function kX(t,r){if(1&t&&(e.j41(0,"div",8)(1,"button",27),e.EFF(2," Cancelar "),e.k0s(),e.DNE(3,FX,2,5,"button",28)(4,SX,2,5,"button",28),e.k0s()),2&t){const n=e.XpG();e.R7$(),e.Y8G("matDialogClose","cancelled"),e.R7$(2),e.vxM(3,"edit"===n.data.dialogMode?3:-1),e.R7$(),e.vxM(4,"add"===n.data.dialogMode?4:-1)}}let $X=(()=>{class t{constructor(n){this.data=n,this.depots=[],this.dialogMode="view",this.employeeCtrl=new m.MJ,this.employees$=(0,ie.of)([]),this.filteredEmployees$=(0,ie.of)([]),this.locations$=(0,ie.of)([]),this.separatorKeysCodes=[a2.Fm,a2.KE],this._changeDetectorRef=(0,e.WQX)(e.gRc),this._dialog=(0,e.WQX)(se.bZ),this._dialogRef=(0,e.WQX)(se.CP),this._employeesService=(0,e.WQX)(aX.r),this._formBuilder=(0,e.WQX)(m.ok),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._snackBar=(0,e.WQX)(Oe.UG),this._terminalsService=(0,e.WQX)(rf.T),this._unsubscribeAll=new Ke.B,this.store=(0,e.WQX)(fe.il),this.dialogMode=n.dialogMode,this.terminal=n.terminal}ngOnInit(){this.terminalForm=this._formBuilder.group({id:new m.MJ(null),brandId:new m.MJ(null,[m.k0.pattern(/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i)]),depotId:new m.MJ(null,[m.k0.pattern(/^[0-9A-F]{8}-[0-9A-F]{4}-[4][0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i)]),model:new m.MJ(null,[m.k0.minLength(1),m.k0.maxLength(255)]),sn:new m.MJ(null,[m.k0.minLength(1),m.k0.maxLength(255)]),pin:new m.MJ(null,[m.k0.minLength(4),m.k0.maxLength(4)]),locationId:new m.MJ(null,[m.k0.maxLength(255)]),name:new m.MJ(null,[m.k0.required,m.k0.maxLength(100)]),employeesId:new m.MJ([]),havePrinter:new m.MJ(!1,[m.k0.required]),haveDrawer:new m.MJ(!1,[m.k0.required])}),"edit"===this.dialogMode&&(this.terminalForm.patchValue(this.terminal),this.terminalForm.get("employeesId").setValue(structuredClone(this.terminal.employees))),this.store.select(tX.DC).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.brands=n,this._changeDetectorRef.markForCheck()}),this.store.select(nX.c_).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.depots=n,this._changeDetectorRef.markForCheck()}),this.locations$=this.store.select(Wy.BF),this.employees$=this.store.select(Ns.OB),this.filteredEmployees$=this.employeeCtrl.valueChanges.pipe((0,ye.B)(200),(0,Ne.Z)(null),(0,Qe.Z)(n=>{const i=this.terminalForm.get("employeesId").value;return i?null!==n&&"string"==typeof n?this._employeesService.findActiveEmployees(n.trim()).pipe((0,Fe.T)(o=>o.filter(s=>!i.some(l=>l.id===s.id)))):this.employees$.pipe((0,Fe.T)(a=>a.filter(o=>!i.some(s=>s.id===o.id)))):this.employees$}))}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}addEmployee(n){const i=this.terminalForm.get("employeesId").value;i.push({id:n.id,fullname:n.fullname}),this.terminalForm.get("employeesId").setValue(i),this.employeeCtrl.setValue(null)}removeEmployee(n){const i=this.terminalForm.get("employeesId").value,a=i.indexOf(n);a>=0&&i.splice(a,1)}closeDialog(){this._dialogRef.close()}createTerminal(){const n=this.terminalForm.getRawValue();delete n.id,n.employeesId=n.employeesId.map(a=>a.id),this._fuseConfirmationService.open({title:"Crear Terminal",message:"\xbfEsta seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{"confirmed"===a&&this._terminalsService.createTerminal(n).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:o})=>{o&&(this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e3,data:{message:o.createTerminal.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this._dialogRef.close())})})}updateTerminal(){const n=this.terminalForm.getRawValue();n.employeesId=n.employeesId.map(a=>a.id),this._fuseConfirmationService.open({title:"Actualizar Terminal",message:"\xbfEsta seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(a=>{"confirmed"===a&&this._terminalsService.updateTerminal(n).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(({data:o})=>{o&&(this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e3,data:{message:o.updateTerminal.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this._dialogRef.close())})})}createBrand(){this._dialog.open(rX.a,{data:{brand:new iX.m,dialogMode:"add"},panelClass:"ath-dialog-panel",disableClose:!0})}displayFn(n){return n&&n.fullname?n.fullname:""}static#e=this.\u0275fac=function(i){return new(i||t)(e.rXU(se.Vh))};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-terminal-dialog"]],standalone:!0,features:[e.aNF],decls:8,vars:5,consts:[["chipGrid",""],["employeeInput",""],["auto","matAutocomplete"],[1,"relative","flex","flex-col","w-full","h-full","max-h-screen"],[1,"flex","flex-col","items-center","px-8","pt-4","space-y-1","text-center","sm:items-start","sm:mt-0","sm:pr-8","sm:text-left"],[1,"text-2xl","text-gray-400"],[1,"flex","flex-col","items-center","flex-auto","w-full","px-8","pb-6","sm:flex-row","sm:items-start","sm:pb-8"],[1,"w-full","overflow-hidden"],[1,"flex","items-center","justify-center","px-6","py-4","space-x-3","sm:justify-end","bg-gray-50","dark:bg-black/10"],[1,"flex"],[1,"grid","w-full","gap-4","pt-4","mt-4","border-t","sm:grid-cols-2",3,"formGroup","autocomplete"],[1,"w-full","fuse-mat-dense"],["matInput","","type","text","maxlength","100",3,"formControlName","placeholder"],[3,"formControlName","required"],[3,"value"],[3,"click"],["matInput","","type","text","maxlength","250",3,"formControlName","placeholder"],["matInput","","type","number","minlength","4","max","9999",3,"formControlName","placeholder"],[1,"flex","flex-col"],[1,"w-full",3,"formControlName"],[1,"w-full","fuse-mat-dense","sm:col-span-2"],[3,"required"],[3,"removable"],["matInput","",3,"formControl","matAutocomplete","placeholder","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur"],[3,"optionSelected","displayWith"],[3,"removed","removable"],["matChipRemove","",3,"svgIcon"],["mat-stroked-button","",3,"matDialogClose"],["mat-flat-button","",3,"color","disabled","ngClass"],["mat-flat-button","",3,"click","color","disabled","ngClass"]],template:function(i,a){1&i&&(e.j41(0,"div",3)(1,"div",4),e.DNE(2,oX,2,0,"h2",5)(3,sX,2,0,"h2",5)(4,lX,2,0,"h2",5),e.k0s(),e.j41(5,"div",6),e.DNE(6,xX,70,38,"div",7),e.k0s(),e.DNE(7,kX,5,3,"div",8),e.k0s()),2&i&&(e.R7$(2),e.vxM(2,"add"===a.data.dialogMode?2:-1),e.R7$(),e.vxM(3,a.data.terminal.id&&"edit"===a.data.dialogMode?3:-1),e.R7$(),e.vxM(4,a.data.terminal.id&&"view"===a.data.dialogMode?4:-1),e.R7$(2),e.vxM(6,6),e.R7$(),e.vxM(7,"view"!==a.data.dialogMode?7:-1))},dependencies:[U.Jj,yt.jL,yt.$3,Hr.wT,yt.pN,te.Hl,te.$z,mt.g7,mt.So,Zi.YN,Zi.Jl,Zi.HW,Zi.D7,Zi.Zv,se.hM,se.tx,O.RG,O.rl,O.nJ,O.MV,O.TL,de.m_,de.An,le.fS,le.fg,gt.Ve,gt.VO,U.YU,m.X1,m.qT,m.me,m.Q0,m.BC,m.cb,m.YS,m.xh,m.tU,m.zX,m.l_,m.j4,m.JD],encapsulation:2,changeDetection:0})}return t})();class IX{}const wX=t=>({"pointer-events-none":t}),RX=()=>[5,10,25,100];function TX(t,r){if(1&t&&(e.j41(0,"span",27),e.EFF(1),e.k0s()),2&t){const n=r.$implicit;e.R7$(),e.SpI(" ",n.fullname," ")}}function EX(t,r){if(1&t){const n=e.RV6();e.j41(0,"mat-slide-toggle",34),e.bIt("change",function(a){e.eBV(n);const o=e.XpG(),s=o.$implicit,l=o.$index,c=e.XpG(4);return e.Njj(c.updateTerminalStatus(a,s,l))}),e.k0s()}if(2&t){const n=e.XpG().$implicit;e.Y8G("checked",n.active)("color","primary")}}function jX(t,r){1&t&&e.nrm(0,"mat-spinner",30),2&t&&e.Y8G("diameter",20)("color","primary")}function DX(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",24)(1,"div",25),e.EFF(2),e.k0s(),e.j41(3,"div",25),e.EFF(4),e.k0s(),e.j41(5,"div",26),e.Z7z(6,TX,2,1,"span",27,e.fX1),e.k0s(),e.j41(8,"div",25),e.EFF(9),e.k0s(),e.j41(10,"div",28),e.DNE(11,EX,1,2,"mat-slide-toggle",29)(12,jX,1,2,"mat-spinner",30),e.k0s(),e.j41(13,"div",31)(14,"button",32),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(4);return e.Njj(o.updateTerminal(a))}),e.nrm(15,"mat-icon",33),e.k0s(),e.j41(16,"button",32),e.bIt("click",function(){const a=e.eBV(n).$implicit,o=e.XpG(4);return e.Njj(o.deleteTerminal(a))}),e.nrm(17,"mat-icon",33),e.k0s()()()}if(2&t){const n=r.$implicit,i=r.$index,a=e.XpG(4);e.R7$(2),e.SpI(" ",n.no," "),e.R7$(2),e.SpI(" ",n.name," "),e.R7$(2),e.Dyx(n.employees),e.R7$(3),e.SpI(" ",n.brand.name," "),e.R7$(2),e.vxM(11,a.isSlideLoading&&a.selectedSlide===i?-1:11),e.R7$(),e.vxM(12,a.isSlideLoading&&a.selectedSlide===i?12:-1),e.R7$(3),e.Y8G("svgIcon","mat_solid:edit"),e.R7$(2),e.Y8G("svgIcon","mat_solid:delete")}}function AX(t,r){1&t&&e.Z7z(0,DX,18,7,"div",24,e.BUC().trackByFn,!0),2&t&&e.Dyx(r)}function MX(t,r){if(1&t&&(e.j41(0,"div",19)(1,"div",20)(2,"div",21),e.EFF(3,"No."),e.k0s(),e.j41(4,"div",22),e.EFF(5," Nombre "),e.k0s(),e.j41(6,"div",22),e.EFF(7," Asignado a "),e.k0s(),e.j41(8,"div",22),e.EFF(9," Marca "),e.k0s(),e.j41(10,"div",22),e.EFF(11," Activo "),e.k0s(),e.j41(12,"div",22),e.EFF(13," Detalles "),e.k0s()(),e.DNE(14,AX,2,0),e.nI1(15,"async"),e.k0s(),e.nrm(16,"mat-paginator",23)),2&t){let n;const i=e.XpG(2);e.R7$(2),e.Y8G("mat-sort-header","no"),e.R7$(12),e.vxM(14,(n=e.bMT(15,8,i.terminals$))?14:-1,n),e.R7$(2),e.Y8G("ngClass",e.eq3(10,wX,i.isLoading))("length",i.pagination.length)("pageIndex",i.pagination.page)("pageSize",i.pagination.size)("pageSizeOptions",e.lJ4(12,RX))("showFirstLastButtons",!0)}}function PX(t,r){1&t&&(e.j41(0,"div",35),e.EFF(1,"\xa1No se ha creado ninguna terminal!"),e.k0s())}function BX(t,r){1&t&&e.DNE(0,MX,17,13)(1,PX,2,0),2&t&&e.vxM(0,r.length>0?0:1)}let OX=(()=>{class t{constructor(){this.flashMessage=null,this.isLoading=!1,this.isSlideLoading=!1,this.merchant=null,this.merchantInputControl=new m.MJ,this.searchInputControl=new m.MJ,this.selectedSlide=null,this.terminals=[],this.terminals$=(0,ie.of)([]),this.user=null,this._unsubscribeAll=new Ke.B,this._terminalsService=(0,e.WQX)(rf.T),this._fuseConfirmationService=(0,e.WQX)(Mt.G),this._changeDetectorRef=(0,e.WQX)(e.gRc),this._dialog=(0,e.WQX)(se.bZ),this._snackBar=(0,e.WQX)(Oe.UG),this.store=(0,e.WQX)(fe.il)}ngOnInit(){this.store.select(bn.SW).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.user=n,this._changeDetectorRef.markForCheck()}),this.store.select(At.Xb).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.merchant=n,this._changeDetectorRef.markForCheck()}),this.terminals$=this.store.select(eX.Ye),this.terminals$.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.terminals=n,this._changeDetectorRef.markForCheck()}),this.store.select(Mn.Dz).pipe((0,T.Q)(this._unsubscribeAll)).subscribe(n=>{this.pagination=n,this._changeDetectorRef.markForCheck()}),this.searchInputControl.valueChanges.pipe((0,T.Q)(this._unsubscribeAll),(0,ye.B)(300),(0,ce.n)(n=>(this.isLoading=!0,this._terminalsService.getTerminals(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,n))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe()}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"no",start:"asc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,T.Q)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,An.h)(this._sort.sortChange,this._paginator.page).pipe((0,ce.n)(()=>(this.isLoading=!0,this._terminalsService.getTerminals(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction))),(0,Fe.T)(()=>{this.isLoading=!1})).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}createTerminal(){this._openDialog(new IX,"add")}updateTerminal(n){this._openDialog(n,"edit")}updateTerminalStatus(n,i,a){this.isSlideLoading=!0,this.selectedSlide=a,this._terminalsService.updateTerminalStatus({id:i.id,active:n.checked}).subscribe(({data:o})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.updateTerminalStatus.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this.isSlideLoading=!1,this.selectedSlide=null,this._changeDetectorRef.markForCheck()})}deleteTerminal(n){this._fuseConfirmationService.open({title:"Eliminar terminal",message:`\xbfEst\xe1s seguro de que deseas eliminar la terminal ${n.no}? Esta acci\xf3n no se puede deshacer.`,actions:{confirm:{label:"Eliminar",color:"warn"}}}).afterClosed().pipe((0,T.Q)(this._unsubscribeAll)).subscribe(a=>{"confirmed"===a&&this._terminalsService.removeTerminal(n.id).subscribe(({data:o})=>{this._snackBar.openFromComponent(ue.p,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:o.removeTerminal.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this._changeDetectorRef.markForCheck()})})}trackByFn(n,i){return n||i.id}_openDialog(n,i){this._dialog.open($X,{data:{terminal:n,dialogMode:i},panelClass:"ath-dialog-panel",disableClose:!0})}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=e.VBU({type:t,selectors:[["sales-terminals"]],viewQuery:function(i,a){if(1&i&&(e.GBs(Ie.iy,5),e.GBs(pe.B4,5)),2&i){let o;e.mGM(o=e.lsd())&&(a._paginator=o.first),e.mGM(o=e.lsd())&&(a._sort=o.first)}},standalone:!0,features:[e.aNF],decls:30,vars:11,consts:[[1,"flex","flex-col","flex-auto","min-w-0","sm:absolute","sm:inset-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","px-6","py-8","border-b","lg:flex-row","flex-0","lg:items-center","lg:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/desktop",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","sm:leading-10"],[1,"flex","items-center","gap-2","mt-6","shrink-0","lg:mt-0","lg:ml-4"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],["mat-raised-button","",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","overflow-hidden","sm:mb-18","sm:overflow-auto"],[1,"grid"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","terminals-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-slate-900"],[3,"mat-sort-header"],[1,""],[1,"z-10","border-b","sm:absolute","sm:inset-x-0","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","terminals-grid","md:px-8"],[1,"truncate"],[1,"flex","flex-wrap","gap-1"],[1,"px-2","rounded-md","bg-hover"],[1,"hidden","lg:block"],[3,"checked","color"],[3,"diameter","color"],[1,"flex","flex-row","items-center","justify-center","gap-1"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"icon-size-5",3,"svgIcon"],[3,"change","checked","color"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"]],template:function(i,a){if(1&i&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"a",4),e.EFF(6,"Inicio"),e.k0s()(),e.j41(7,"div",5),e.nrm(8,"mat-icon",6),e.j41(9,"a",7),e.EFF(10,"Ventas"),e.k0s()(),e.j41(11,"div",5),e.nrm(12,"mat-icon",6),e.j41(13,"a",7),e.EFF(14,"Terminales"),e.k0s()()(),e.j41(15,"div",8)(16,"h2",9),e.EFF(17," Terminales "),e.k0s()()(),e.j41(18,"div",10)(19,"mat-form-field",11),e.nrm(20,"mat-icon",12)(21,"input",13),e.k0s(),e.j41(22,"button",14),e.bIt("click",function(){return a.createTerminal()}),e.nrm(23,"mat-icon",15),e.j41(24,"span",16),e.EFF(25,"Agregar"),e.k0s()()()(),e.j41(26,"div",17)(27,"div",18),e.DNE(28,BX,2,1),e.nI1(29,"async"),e.k0s()()()),2&i){let o;e.R7$(8),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(4),e.Y8G("svgIcon","mat_solid:chevron_right"),e.R7$(7),e.Y8G("subscriptSizing","dynamic"),e.R7$(),e.Y8G("svgIcon","mat_solid:search"),e.R7$(),e.Y8G("formControl",a.searchInputControl)("autocomplete","off")("placeholder","Escriba para filtrar..."),e.R7$(2),e.Y8G("svgIcon","mat_solid:add"),e.R7$(5),e.vxM(28,(o=e.bMT(29,9,a.terminals$))?28:-1,o)}},dependencies:[U.Jj,te.Hl,te.$z,O.RG,O.rl,O.JW,de.m_,de.An,le.fS,le.fg,Ie.Ou,Ie.iy,ot.D6,ot.LG,ea.mV,ea.sG,pe.NQ,pe.B4,pe.aE,U.YU,m.X1,m.me,m.BC,m.l_],encapsulation:2,changeDetection:0})}return t})();var jn=R(23301),af=R(34413),s2=R(24121),NX=R(63425);const of=(t,r)=>(0,e.WQX)(ta).getAssistancesActive();var YX=R(47399),sf=R(36646),zX=R(16551),lf=R(57981),l2=R(23285),cf=R(59013),uf=R(43801);let XX=(()=>{class t{constructor(n){this._salesDashboardStatsService=n}resolve(n,i){const a=new Date((new Date).getTime()-6048e5);return this._salesDashboardStatsService.getSalesDashboardStatsData(a,new Date)}static#e=this.\u0275fac=function(i){return new(i||t)(e.KVO(Qy))};static#t=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var QX=R(40382);const JX=[{path:"",component:Y7,children:[{path:"dashboard",component:Fz,resolve:{salesDashboardStatsResolver:XX,currencies:jn.I,locations:s2.FH}},{path:"assistances",component:G2,resolve:{assistances:(t,r)=>(0,e.WQX)(ta).getAssistances(),currencies:jn.I,uoms:NX.B}},{path:"bid",component:k4,resolve:{assistances:of,currencies:jn.I,customers:sf.iL,multipliers:lf.d,productsInStock:uf.N4}},{path:"billing",component:C3,resolve:{assistances:of,currencies:jn.I,customers:sf.iL,employees:af.MI,multipliers:lf.d,operationTypes:l2.h,paymentMethods:cf.v,productsInStock:uf.N4}},{path:"prebills",component:KU,resolve:{prebills:(t,r)=>(0,e.WQX)(i2).getPrebills(),currencies:jn.I}},{path:"prebilling",component:$U,resolve:{assistances:of,currencies:jn.I,customers:sf.iL,employees:af.MI,multipliers:lf.d,operationTypes:l2.h,paymentMethods:cf.v,productsInStock:uf.N4}},{path:"bills",component:c7,resolve:{bills:(t,r)=>(0,e.WQX)(ia).getBills(),currencies:jn.I}},{path:"collections",component:L7,resolve:{collections:(t,r)=>(0,e.WQX)(qs).getCollections()}},{path:"offers",component:Eq,resolve:{offers:(t,r)=>(0,e.WQX)(Zy).getOffers()}},{path:"terminals",component:OX,resolve:{brands:YX.T,depots:zX.MQ,employees:af.MI,terminals:QX.Y,locations:s2.FH}},{path:"list",component:_q,resolve:{paymentMethods:cf.v,sales:(t,r)=>(0,e.WQX)(Rs.w).getSales(),currencies:jn.I}}]}]},22417:(df,Ds,R)=>{var e={"./af.js":[73333,2076,3333],"./am.js":[85300,2076,5300],"./ar-dz.js":[51292,2076,1292],"./ar-iq.js":[28616,2076,8616],"./ar-kw.js":[5632,2076,5632],"./ar-ly.js":[59933,2076,9933],"./ar-ma.js":[65708,2076,5708],"./ar-sa.js":[55918,2076,5918],"./ar-tn.js":[59632,2076,9632],"./ar.js":[19913,2076,9913],"./az.js":[43377,2076,3377],"./be.js":[75195,2076,5195],"./bg.js":[39101,2076,9101],"./bi.js":[45623,2076,5623],"./bm.js":[64211,2076,4211],"./bn-bd.js":[55553,2076,5553],"./bn.js":[70742,2076,742],"./bo.js":[79701,2076,9701],"./br.js":[1090,2076,1090],"./bs.js":[85329,2076,7710],"./ca.js":[92334,2076,2334],"./cs.js":[50356,2076,356],"./cv.js":[9823,2076,9823],"./cy.js":[2902,2076,2902],"./da.js":[52269,2076,2269],"./de-at.js":[67035,2076,7035],"./de-ch.js":[19437,2076,9437],"./de.js":[51409,2076,1409],"./dv.js":[25480,2076,5480],"./el.js":[58455,2076,8455],"./en-au.js":[26364,2076,6364],"./en-ca.js":[35726,2076,5726],"./en-gb.js":[51583,2076,1583],"./en-ie.js":[37236,2076,7236],"./en-il.js":[74195,2076,4195],"./en-in.js":[89685,2076,9685],"./en-nz.js":[29238,2076,9238],"./en-sg.js":[25224,2076,5224],"./en-tt.js":[26082,2076,6082],"./en.js":[69785,9785],"./eo.js":[57002,2076,7002],"./es-do.js":[88194,2076,8194],"./es-mx.js":[70678,2076,678],"./es-pr.js":[33857,2076,3857],"./es-us.js":[51251,2076,1251],"./es.js":[72494,2076,2494],"./et.js":[76175,2076,6175],"./eu.js":[41816,2076,1816],"./fa.js":[73987,2076,3987],"./fi.js":[91115,2076,1115],"./fo.js":[15569,2076,5569],"./fr-ca.js":[36591,2076,8972],"./fr-ch.js":[8048,2076,8048],"./fr.js":[34230,2076,4230],"./fy.js":[38683,2076,8683],"./ga.js":[63698,2076,3698],"./gd.js":[67677,2076,7677],"./gl.js":[56693,2076,6693],"./gom-latn.js":[24435,2076,4435],"./gu.js":[30766,2076,766],"./he.js":[89165,2076,9165],"./hi.js":[39177,2076,9177],"./hr.js":[62376,2076,2376],"./ht.js":[9374,2076,9374],"./hu.js":[58941,2076,8941],"./hy-am.js":[72948,2076,2948],"./id.js":[41275,2076,1275],"./is.js":[16098,2076,6098],"./it-ch.js":[81727,2076,1727],"./it.js":[59531,2076,9531],"./ja.js":[90599,2076,599],"./jv.js":[27510,2076,7510],"./ka.js":[57910,2076,7910],"./kk.js":[14420,2076,4420],"./km.js":[15506,2076,5506],"./kn.js":[22303,2076,2303],"./ko.js":[30216,2076,216],"./ku.js":[17274,2076,7274],"./ky.js":[46830,2076,6830],"./lb.js":[56396,2076,6396],"./lo.js":[51775,2076,1775],"./lt.js":[30394,2076,394],"./lv.js":[50544,2076,544],"./me.js":[62928,2076,2928],"./mi.js":[14852,2076,4852],"./mk.js":[12910,2076,2910],"./ml.js":[16591,2076,6591],"./mn.js":[38577,2076,8577],"./mr.js":[49301,2076,9301],"./ms-my.js":[84989,2076,4989],"./ms.js":[40342,2076,342],"./mt.js":[98871,2076,8871],"./my.js":[80500,2076,500],"./nb.js":[47406,2076,7406],"./ne.js":[1615,2076,1615],"./nl-be.js":[76708,2076,6708],"./nl.js":[74128,2076,4128],"./nn.js":[10906,2076,906],"./oc-lnc.js":[18486,2076,8486],"./pa-in.js":[9845,2076,9845],"./pl.js":[3518,2076,3518],"./pt-br.js":[7803,2076,7803],"./pt.js":[31014,2076,1014],"./rn.js":[60486,2076,486],"./ro.js":[91205,2076,1205],"./ru.js":[30587,2076,587],"./rw.js":[45533,2076,5533],"./sd.js":[75329,2076,5329],"./se.js":[55602,2076,5602],"./si.js":[72886,2076,2886],"./sk.js":[77484,2076,7484],"./sl.js":[59097,2076,9097],"./sq.js":[39022,2076,9022],"./sr-cyrl.js":[31190,2076,1190],"./sr.js":[46123,2076,6123],"./ss.js":[24100,2076,4100],"./sv-fi.js":[63057,2076,3057],"./sv.js":[175,2076,175],"./sw.js":[56248,2076,6248],"./ta.js":[18237,2076,8237],"./te.js":[33985,2076,3985],"./tet.js":[78081,2076,8081],"./tg.js":[33503,2076,3503],"./th.js":[66230,2076,6230],"./tk.js":[20051,2076,51],"./tl-ph.js":[88595,2076,8595],"./tlh.js":[61912,2076,1912],"./tr.js":[1092,2076,1092],"./tzl.js":[21122,2076,1122],"./tzm-latn.js":[20227,2076,227],"./tzm.js":[89009,2076,9009],"./ug-cn.js":[86074,2076,6074],"./uk.js":[73318,2076,3318],"./ur.js":[42013,2076,2013],"./uz-latn.js":[8447,2076,8447],"./uz.js":[47381,2076,7381],"./vi.js":[28443,2076,8443],"./x-pseudo.js":[80047,2076,47],"./yo.js":[18182,2076,8182],"./zh-cn.js":[84564,2076,4564],"./zh-hk.js":[36228,2076,6228],"./zh-tw.js":[87556,2076,7556],"./zh.js":[89576,2076,9576]};function U(m){if(!R.o(e,m))return Promise.resolve().then(()=>{var pe=new Error("Cannot find module '"+m+"'");throw pe.code="MODULE_NOT_FOUND",pe});var Ie=e[m],Oe=Ie[0];return Promise.all(Ie.slice(1).map(R.e)).then(()=>R.t(Oe,19))}U.keys=()=>Object.keys(e),U.id=22417,df.exports=U}}]);